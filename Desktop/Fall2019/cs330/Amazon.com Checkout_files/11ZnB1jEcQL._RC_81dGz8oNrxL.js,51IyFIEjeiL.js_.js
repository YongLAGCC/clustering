(function(c){var g=window.AmazonUIPageJS||window.P,h=g._namespace||g.attributeErrors,a=h?h("WidgetStreamer",""):g;a.guardFatal?a.guardFatal(c)(a,window):a.execute(function(){c(a,window)})})(function(c,g,h){c.when("jQuery","widget-streamer-action-ws-append","widget-streamer-action-ws-prepend","widget-streamer-action-ws-update","widget-streamer-action-ws-event").register("widget-streamer-actions",function(a,d,e,b,f){var c={"ws-append":d,"ws-prepend":e,"ws-update":b,"ws-event":f},k={execute:a.noop};
return{create:function(f){var b,e,d;b=k;if(a.isArray(f)&&f.length&&f[0]){b=f[0];e=c[b];d="widget-streamer-action-"+b;if("function"!==typeof e)throw Error("Action: "+b+" is not supported. Register component "+d+" to handle this action");b=e(f)}return b}}});"use strict";c.register("widget-streamer-jquery-action",function(){return function(a,d,e){var b,f;if(!a||3>a.length)throw Error("Can not create update action, insufficient data in chunk: "+JSON.stringify(a));b=a[1];f=a[2];return{execute:function(a){var c=
a._$target.find(b).add(a._$target.filter(b));a._isTargetUpdated?e(c,f):d(c.get(0),f)}}}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-update",function(a){return function(d){return a(d,function(a,b){a.innerHTML=b},function(a,b){a.html(b)})}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-append",function(a){return function(d){return a(d,function(a,b){a.innerHTML+=b},function(a,b){a.append(b)})}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-prepend",
function(a){return function(d){return a(d,function(a,b){a.innerHTML=b+a.innerHTML},function(a,b){a.prepend(b)})}});c.register("widget-streamer-action-ws-event",function(){return function(a){var d=a[1],c;try{c=JSON.parse(a[2])}catch(b){c=null}return{execute:function(a){a._emitEvent(d,c)}}}});"use strict";c.register("widget-streamer-utils",function(){return{isStreamingAjax:function(a){if(a&&"function"===typeof a.getResponseHeader)a=a.getResponseHeader("Content-Type");else if(a&&a.http&&"function"===
typeof a.http.getResponseHeader)a=a.http.getResponseHeader("Content-Type");else throw Error("Unable to retrive headers for the given xhr object: "+a);return"application/json-amazonui-streaming"===a}}});"use strict";c.when("A","jQuery","widget-streamer-actions").register("widget-streamer",function(a,c,e){function b(a){a=a||{};this._$originalTarget=a.$target;this._$target=a.$target.clone();this._actions=[];this._isExecutable="undefined"===typeof a.immediateExecution||a.immediateExecution;this._onUpdate=
a.onUpdate||c.noop;this._hasExecutionStarted=!1;this._events=a.events||{};this._isTargetUpdated=!1;this._updateTriggerEvent=a.updateTriggerEvent;this.chunkHandler=c.proxy(this.chunkHandler,this)}b.prototype.chunkHandler=function(a){a=e.create(a);this._actions.push(a);this.executeActions()};b.prototype.enableExecution=function(){this._isExecutable=!0;this.executeActions()};b.prototype.executeActions=function(){var a;if(this._isExecutable&&this._actions.length)for(this._hasExecutionStarted||(this._hasExecutionStarted=
!0,this._updateTriggerEvent||this._updateTarget()),a=this._actions.shift();a;)a.execute(this),a=this._actions.shift()};b.prototype._emitEvent=function(a,b){var e=(this._events||{})[a]||c.noop;a===this._updateTriggerEvent&&this._updateTarget(b);e.call(this,b)};b.prototype._updateTarget=function(){this._onUpdate.apply(this,arguments);this._$originalTarget.html(this._$target.html());this._$target=this._$originalTarget;this._isTargetUpdated=!0};return function(a){return new b(a)}})});
/* ******** */
(function(r){var q=window.AmazonUIPageJS||window.P,Da=q._namespace||q.attributeErrors,la=Da?Da("CheckoutCommonAsset",""):q;la.guardFatal?la.guardFatal(r)(la,window):la.execute(function(){r(la,window)})})(function(r,q,Da){r.register("polyfill-indexof",function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a,m){if(null==this)throw new TypeError('"this" is null or not defined');var l=Object(this),c=l.length>>>0;if(0===c)return-1;m=+m||0;Infinity===Math.abs(m)&&(m=0);if(m>=c)return-1;for(m=
Math.max(0<=m?m:c-Math.abs(m),0);m<c;){if(m in l&&l[m]===a)return m;m++}return-1})});"use strict";r.register("polyfill-filter",function(){Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var m=Object(this),l=m.length>>>0;if("function"!==typeof a)throw new TypeError;for(var c=[],e=2<=arguments.length?arguments[1]:void 0,k=0;k<l;k++)if(k in m){var n=m[k];a.call(e,n,k,m)&&c.push(n)}return c})});"use strict";r.register("polyfill-json-stringify",
function(){"object"!==typeof JSON&&(JSON={});(function(){function a(a){return 10>a?"0"+a:a}function m(){return this.valueOf()}function l(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=w[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var h,g,f=b,e,k=d[a];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(a));"function"===typeof v&&(k=v.call(d,a,k));switch(typeof k){case "string":return l(k);case "number":return isFinite(k)?
String(k):"null";case "boolean":case "null":return String(k);case "object":if(!k)return"null";b+=p;e=[];if("[object Array]"===Object.prototype.toString.apply(k)){g=k.length;for(a=0;a<g;a+=1)e[a]=c(a,k)||"null";d=0===e.length?"[]":b?"[\n"+b+e.join(",\n"+b)+"\n"+f+"]":"["+e.join(",")+"]";b=f;return d}if(v&&"object"===typeof v)for(g=v.length,a=0;a<g;a+=1)"string"===typeof v[a]&&(h=v[a],(d=c(h,k))&&e.push(l(h)+(b?": ":":")+d));else for(h in k)Object.prototype.hasOwnProperty.call(k,h)&&(d=c(h,k))&&e.push(l(h)+
(b?": ":":")+d);d=0===e.length?"{}":b?"{\n"+b+e.join(",\n"+b)+"\n"+f+"}":"{"+e.join(",")+"}";b=f;return d}}var e=/^[\],:{}\s]*$/,k=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,n=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,d=/(?:^|:|,)(?:\s*\[)+/g,f=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=m,Number.prototype.toJSON=m,String.prototype.toJSON=m);var b,p,w,v;"function"!==typeof JSON.stringify&&(w={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=
function(a,d,h){var g;p=b="";if("number"===typeof h)for(g=0;g<h;g+=1)p+=" ";else"string"===typeof h&&(p=h);if((v=d)&&"function"!==typeof d&&("object"!==typeof d||"number"!==typeof d.length))throw Error("JSON.stringify");return c("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var h,f,p=a[d];if(p&&"object"===typeof p)for(h in p)Object.prototype.hasOwnProperty.call(p,h)&&(f=c(p,h),void 0!==f?p[h]=f:delete p[h]);return b.call(a,d,p)}a=String(a);h.lastIndex=0;h.test(a)&&
(a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(e.test(a.replace(k,"@").replace(n,"]").replace(d,"")))return a=eval("("+a+")"),"function"===typeof b?c({"":a},""):a;throw new SyntaxError("JSON.parse");})})()});"use strict";r.when("A","jQuery","client-side-metrics","weblab-helper","polyfill-filter","polyfill-json-stringify").register("ajax-wrapper",function(a,m,l,c){function e(a,b){function c(a,b){for(var g=0;g<a._options.length;g++){var d=a._options[g];
if(d=b.call(a,d,"object"===typeof d?d.name:d))return d}}this._options=a instanceof e&&b&&b.length?a._options.concat(b):a instanceof e?a._options:a&&a.length?a:[];this.filter=function(a){var b={};c(this,function(c,d){d in a&&(b[d]=a[d])});return b};this.getOption=function(a){return c(this,function(b,c){if(c===a)return b})};return this}function k(a){this._options=a.allowedOptions;this._messageForViolation=a.messageForViolation;this._messageForViolationWithValue=a.messageForViolationWithValue;this._optionName=
a.optionName;this._valueName=a.valueName;this.validate=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=this._options.getOption(b);if(!c)throw c=this._messageForViolation.replace(this._optionName,b),Error(c);if("object"===typeof c&&!c.validate(a[b]))throw c=this._messageForViolationWithValue.replace(this._optionName,b),c=c.replace(this._valueName,a[b]),Error(c);}};return this}function n(a){try{D.validate(a)}catch(b){console.error(b)}var c=g.filter(a),c=m.extend(c,d(a));return m.ajax(c)}function d(a){if(a.params){if(a.data&&
a.params)throw Error("The option data can not be present with the emulated params option. Merge both and use just one.");return{data:a.params}}}function f(d){try{L.validate(d)}catch(g){console.error(g)}var f={url:void 0,options:u.filter(d)},e=new m.Deferred;f.url=d.url;if(d.data){if(d.data&&d.params)throw Error("Unsupported options. 'params' and 'data' options are both specified. Remove one of them.");if("object"===typeof d.data)f.options.params=d.data;else if("string"===typeof d.data)c.isSetParamsFormatAsStirngWeblabOn()?
"GET"===d.type?f.url+="?"+d.data:(f.options.params=d.data,f.options.paramsFormat="string"):f.url+="?"+d.data;else throw Error("Unsupported type provided in the 'data' attribute of an AJAX call");}if(d.type){if(d.type&&d.method)throw Error("Unsupported options. 'type' and 'method' options are both specified. Remove one of them.");f.options.method=d.type}if("crossDomain"in d){if("crossDomain"in d&&"withCredentials"in d)throw Error("Unsupported options. 'crossDomain' and 'withCredentials' options are both specified. Remove one of them.");
f.options.withCredentials=d.crossDomain}f=b(f,d,e);f=h(f,d,e);f=w(f,d,e);f=p(f,d,e);f=v(f,d,e);d.beforeSend&&d.beforeSend(f.options);f=z(f,d,e);d=a.ajax(f.url,f.options);return d=e.promise(d)}function h(a,b,c){var d=a.options.success;a.options.success=function(a,b,g){d&&d(a,b,g);c.resolve(a,b,g)};var g=a.options.error;a.options.error=function(a,b,d){g&&g(a,b,d);c.reject(a,b,d)};var h=a.options.abort;a.options.abort=function(a){h&&h(a);c.reject(a,"abort")};return a}function b(a,b){if(!b.complete)return a;
var c=a.options.success;a.options.success=function(a,d,g){c&&c(a,d,g);b.complete(g,"success")};var d=a.options.error;a.options.error=function(a,c,g){d&&d(a,c,g);b.complete(a,"error")};var g=a.options.abort;a.options.abort=function(a){g&&g(a);b.complete(a,"abort")};return a}function p(a,b){var c=a.options.success;a.options.success=function(a,d,g){c&&("text"===b.dataType&&"object"===typeof a&&(a=JSON.stringify(a)),c(a,d,g))};return a}function w(a,b){if(!b.useXMLHttp)return a;var c=a.options.success;
a.options.success=function(a,b,d){d&&(d=d.http);c(a,b,d)};var d=a.options.error;a.options.error=function(a,b,c){a&&(a=a.http);d(a,b,c)};var g=a.options.abort;a.options.abort=function(a){a&&(a=a.http);g(a)};return a}function v(a,b){var c=a.options.success;a.options.success=function(a,b,d){d&&304===d.http.status?c(a,"notmodified",d):c(a,"success",d)};var d=a.options.error;a.options.error=function(a,b,g){a&&a.http.readyState<t.DONE?d(a,"timeout",g):a&&200<=a.http.status&&300>a.http.status&&a.http.readyState===
t.DONE?c(a.http.responseText,"success",a):a&&0==a.http.status?d(a,"abort",g):d(a,"error",g)};return a}function z(a,b){var c=a.options.success;a.options.success=function(a,b,d){x(d,"success");c(a,b,d)};var d=a.options.error;a.options.error=function(a,b,c){x(a,"error");d(a,b,c)};return a}function x(a,b){a?(l.increaseCount("AUI:Ajax:"+b+":xhr:defined"),a.http?l.increaseCount("AUI:Ajax:"+b+":xhr:http:defined"):void 0===a.http?l.increaseCount("AUI:Ajax:"+b+":xhr:http:undefined"):null===a.http&&l.increaseCount("AUI:Ajax:"+
b+":xhr:http:null")):void 0===a?l.increaseCount("AUI:Ajax:"+b+":xhr:undefined"):null===a&&l.increaseCount("AUI:Ajax:"+b+":xhr:null")}var t={UNSET:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},g=new e("accepts async beforeSend cache complete contents contentType context converters crossDomain data dataFilter dataType error global headers ifModified isLocal jsonp jsonpCallback method mimeType password processData scriptCharset statusCode success timeout traditional type url username xhr xhrFields".split(" ")),
u=new e("abort accepts cache chunk contentType error headers indicator method params success timeout withCredentials".split(" ")),K=new e(u,[{name:"async",validate:function(a){return a}},"useXMLHttp","beforeSend","complete","crossDomain","dataType","data","type","url"]),A=new e(g,["params"]),L=new k({allowedOptions:K,messageForViolation:"The option %O is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",
optionName:"%O",valueName:"%V"}),D=new k({allowedOptions:A,messageForViolation:"The option %O is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",optionName:"%O",valueName:"%V"}),E=m("meta[name\x3ddefaultAJAX]").attr("content");"jQuery"!==E&&"AUI"!==E&&(E="jQuery");return{default:function(a){try{L.validate(a),D.validate(a)}catch(b){console.error(b)}if("jQuery"===
E)n(a);else if("AUI"===E)f(a);else throw Error("Unknown AJAX method: "+E);},jQuery:n,aui:f,READY_STATE:t}});"use strict";r.when("jQuery").register("weblab-helper",function(a){return{isAJAXWeblabOn:function(){return"1"===a("meta[name\x3dPAGE_CONDUCTOR_AUI_AJAX]").attr("content")},isAjaxStreamingEnabled:function(){return"1"===a("meta[name\x3dENABLE_AJAX_STREAMING]").attr("content")},isNavCFWeblabOn:function(){return"1"===a("meta[name\x3dEMIT_NAV_CF]").attr("content")},isFixExtraPspPrefetchEnabled:function(){return"1"===
a("meta[name\x3dFIX_EXTRA_PSP_PREFETCH]").attr("content")},isRemoveOrderSummaryPrimaryActionBtnTextWeblabOff:function(){return"1"!==a("#is-remove-os-pabt").val()},isSetParamsFormatAsStirngWeblabOn:function(){return"1"===a("meta[name\x3dSET_PARAMS_FORMAT_AS_STRING]").attr("content")},disablePrefetchForScheduledDeliveryWeblabOn:function(){return"1"===a("meta[name\x3dDISABLE_PREFETCH_FOR_SCHEDULED_DELIVERY]").attr("content")},isRemoveAddressFormOnDeleteAddressWeblabOn:function(){return"1"===a("meta[name\x3dREMOVE_ADDRESS_FORM_ON_DELETE_ADDRESS]").attr("content")},
isSOSPExclusiveJSHandlerWeblabOn:function(){return"1"===a("meta[name\x3dSOSP_EXCLUSIVE_JS]").attr("content")},sospPartialAvailabilityWeblabOn:function(){return"1"===a("meta[name\x3dSOSP_PARTIAL_UNAVAILABILITY]").attr("content")},refactorExtractURL:function(){return"1"===a("meta[name\x3dREFACTOR_EXTRACT_URL]").attr("content")},showGiftTextAreaOnWarning:function(){return"1"===a("meta[name\x3dSHOW_GIFT_TEXT_AREA_ON_WARNING]").attr("content")},isInterceptionAddressFormWidthFixEnabled:function(){return"1"===
a("meta[name\x3dFIX_FIELD_WIDTH_IN_CHECKOUT_INTERCEPTION_FIX_ENABLED]").attr("content")},removesGiftOptionOnRush:function(){return"1"===a("meta[name\x3dREMOVE_GIFT_OPTION_RUSH]").attr("content")},isSPCMobileDisplayMoreShipOptionsEnabled:function(){return"1"===a("meta[name\x3dSPC_MOBILE_DISPLAY_MORE_SHIP_OPTIONS]").attr("content")},isMCBMultiTenderWeblabEnabled:function(){return"1"===a("meta[name\x3dMCB_MULTI_TENDER_ENABLED]").attr("content")},isCreateAddressLinkForTaxAddressFormWeblabOn:function(){return"1"===
a("meta[name\x3dCREATE_ADDRESS_IN_TAX_COLLECTION_ENABLED]").attr("content")},isClearTemporaryPreferenceBugFixWeblabOn:function(){return"1"===a("meta[name\x3dSWP_CLEAR_TPP_BUG_FIX]").attr("content")},isMfaPSD2DeviceDescriptionCollectionEnabled:function(){return"1"===a("meta[name\x3dMFA_PSD2_DEVICE_DESCRIPTION_COLLECTION_ENABLED]").attr("content")},isSospCalendarFixEnabled:function(){return"1"===a("meta[name\x3dSOSP_CALENDAR_FIX]").attr("content")},isTaxExemptionMessagingEnabled:function(){return"1"===
a("meta[name\x3dTAX_EXEMPTION_MSGING_PHASE_2]").attr("content")},getFixFederatedAssetsInjectionTimingIssueTreatment:function(){var m=a("meta[name\x3dFIX_FEDERATED_ASSETS_INJECTION_TIMING_ISSUE]");return m.length?m.attr("content"):"C"},isUpdateMobileNumberEnabled:function(){return"1"===a("meta[name\x3dUPDATE_MOBILE_NUMBER]").attr("content")},isFixDisabledPyoForMissingBlockerMessageEnabled:function(){return"1"===a("meta[name\x3dFIX_DISABLE_PYO_FOR_MISSING_BLOCKER_MESSAGE]").attr("content")},isShippingOptionTrialCallsDisabled:function(){return"1"===
a("meta[name\x3dDISABLE_SHIPPING_OPTION_TRIAL_CALLS_194487]").attr("content")},isGILCreditCardEnabled:function(){return"1"===a("meta[name\x3dGIL_CREDIT_CARD_PAYMENT_METHOD]").attr("content")},isFTCMobileUpsellBannerMetricsEnabled:function(){return"1"===a("meta[name\x3dFTC_MOBILE_UPSELL_BANNER_METRICS_ENABLED]").attr("content")},isRefreshPageStateEnabled:function(){return"1"===a("meta[name\x3dPAGE_STATE]").attr("content")},isPyoClientSideInitiationEnabled:function(){return"1"===a("meta[name\x3dPYO_CLIENT_SIDE_INITIATION]").attr("content")},
isNoshiGiftMessageEnabled:function(){return"1"===a("meta[name\x3dGCX_ENABLE_NOSHI_GIFT_MESSAGE]").attr("content")},isSppItemSelectPageTypeFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SPP_ITEMSELECT_PAGETYPE_FIX_ENABLED]").attr("content")},isFixTfxCurrencyToggleEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_FIX_TFX_CURRENCY_TOGGLE_ENABLED]").attr("content")},isFreshMobileNoScrollOnRefreshEnabled:function(){return"1"===a("meta[name\x3dF3_CHECKOUT_MOBILE_NO_SCROLL_TO_TOP]").attr("content")}}});
"use strict";r.when("A","client-side-metrics").register("weekend-availability-expander-helper",function(a,m){function l(a){return(a=n[a])?k("#weekend-availability-expander-header-text-"+a).text():k("#weekend-availability-default").text()}function c(){return 1==k("input[name\x3d'isBusinessDefaultWeekendDeliveryEnabled']").attr("value")?!0:!1}function e(a,c){return a&&c?"BOTH":a?"SAT":c?"SUN":"NONE"}var k=a.$,n={BOTH:"both",SAT:"sat",SUN:"sun",NONE:"none"};return{isBusinessDefaultWeekendDeliveryViewActive:c,
logExpanderState:function(a,c,h,b){m.increaseCount("checkout:delivery-preferences:"+a+":expander:"+c+":"+(h&&b?"neverExpanded":b?"collapsed":"expanded"),1)},stateToCheckboxes:function(a){var f=!1,h=!1;if(c()){if("BOTH"===a||"SAT"===a)f=!0;if("BOTH"===a||"SUN"===a)h=!0}else{if("BOTH"===a||"OTH"===a||"SAT"===a)f=!0;if("BOTH"===a||"OTH"===a||"SUN"===a)h=!0}return{isSaturdayChecked:f,isSundayChecked:h}},updateAllOptOutMessages:function(a){a.isSaturdayChecked||a.isSundayChecked?a.isSaturdayChecked?a.isSundayChecked?
k(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!0):(k(".weekend-availability-opt-out-message").text(k("#weekend-availability-opt-out-sun-text").text()),k(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(k(".weekend-availability-opt-out-message").text(k("#weekend-availability-opt-out-sat-text").text()),k(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(k(".weekend-availability-opt-out-message").text(k("#weekend-availability-opt-out-both-text").text()),
k(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1))},updateAllTitles:function(a){a=e(a.isSaturdayChecked,a.isSundayChecked);k(".sat-sun-expander-heading-text").text(l(a))},updateAllWeekendAvailabilityStates:function(a){a=e(a.isSaturdayChecked,a.isSundayChecked);k("input[name\x3d'BusinessHours']").attr("value",a)}}});"use strict";r.when("A","loading-spinner-controller","page-transition-controller","page-conductor","checkout-general-utils","address-utilities","page-detector-current-page",
"client-side-metrics","weblab-helper").register("address-popovers",function(a,m,l,c,e,k,n,d,f){function h(a){a.getResponseHeader("x-amz-checkout-popover-valid")||c.redirect({conductoraction:{url:"/gp/cart/view.html",type:"redirect"}})}function b(b,g,p){e.protectAgainstDoubleAction("show-add-address-popover",200)||(E=b.popover,!D('input[name\x3d"preloadAddressPopover"]').length||g.is(":empty")?(g.empty(),g.css("min-height",397),E.updatePosition(!0),m.showSpinner(g,!1,E),b=(new Date).getTime(),p=n.getCurrentPage(),
d.increaseCount("checkout:address-popover-pagetype:".curPage,1),p="itemselect"===p||"spp-itemselect"===p&&f.isSppItemSelectPageTypeFixEnabled()?1:0,D.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/display.html?cachebuster\x3d"+b,data:{isBilling:N,isMultiAddress:p},async:!0,cache:!1,headers:{"x-amz-checkout-page":"itemselect"},success:function(a,b,c){h(c);g.css("min-height",0);u(g,a)},error:c.ajaxRedirect})):(k.customizeFormFromIdentity(g),k.countrySpecificPopoverOptimizationCheck(D("html")),
p&&a.trigger("identity-assets")))}function p(a,b){if(!e.protectAgainstDoubleAction("add-new-address",200)){d.resetMetrics();var g=!1;D(".identity-protect-from-errant").each(function(){var a=D(this),a=a.is("input")?a:a.find("input:first");-1!==a.val().search(/(\d[ -]?){13}/)&&(g=!0)});if(g){var f=D(".address-form-security-error:first");f.length?alert(f.text()):alert("Please check that the address you have entered is correct.")}else{b.$event.preventDefault();m.showSpinner(a,!1,E);var p=D("#domestic-address-popover-form, #international-address-popover-form, #address-popover-suggestions-form").filter(":visible"),
f=p.serialize(),k=(new Date).getTime();b=b.$currentTarget.find('input[type\x3d"submit"]').attr("name");"useSelectedAddress"===b?f+="\x26fromSuggestionPage\x3d1":"fromAddressEditToContinue"===b&&(f+="\x26fromAddressEditToContinue\x3d1");D("#addAddressOnly").length&&(f+="\x26addOnly\x3d1");N&&(f+="\x26isBilling\x3d1");var l="/gp/buy/addressselect/handlers/popover/new.html";if(E){if("domestic-address-popover-form"===p.attr("id")&&(p.find(".enterAddressFormField").blur(),p="#"+a.attr("id")+" div[id^\x3donblur-character-validation-error-]",
0<D(p).size())){m.hideSpinner(a);return}l+="/ref\x3dchk_addr_editPopoverSubmit";c.isSPP()&&(E.lock(11),setTimeout(function(){E.unlock(12)},2E3))}var n=null!==M&&void 0!==M&&null!==P&&void 0!==P;"useSelectedAddress"===b&&!N&&n&&(f+="\x26fromSTMAPopover\x3d1");D("#international-address-popover-form").filter(":visible").length&&(f+="\x26showSecondaryForm\x3d1");A()&&Q?w(a,k,f):D.ajax({type:"POST",url:l+"?cachebuster\x3d"+k,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:f,async:!0,
cache:!1,error:c.ajaxRedirect,success:function(b,d,g){c.isSPP()&&E.unlock(12);h(g);g.getResponseHeader("x-amz-checkout-open-new-popover")?z(b,d,g):g.getResponseHeader("x-amz-checkout-reload-popover")?u(a,b):n?x(g):t("added")}})}}}function w(a,b,g){var d=Q.getNewTaxAddressPopoverURL();D.ajax({type:"POST",url:d+"?cachebuster\x3d"+b,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:g,async:!0,cache:!1,error:c.ajaxRedirect,success:function(b,g,d){c.isSPP()&&E.unlock(12);h(d);d.getResponseHeader("x-amz-checkout-reload-popover")?
u(a,b):d.getResponseHeader("x-amz-checkout-new-address-id")&&(D(".a-button-close").trigger("click"),e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"),b=d.getResponseHeader("x-amz-checkout-new-address-id"),Q.submitTaxAddressFormWithNewAddressId(b))}})}function v(a){if(!e.protectAgainstDoubleAction("show-edit-address-popover",200)){var b=D("#address-suggestions-popover");a.$event.preventDefault();m.showSpinner(b,!1,E);a=D("#address-popover-suggestions-form");var d=a.serialize();a.find('input[type\x3d"radio"]').each(function(){var a=
D(this);a.attr("checked")&&(d+="\x26edit_"+a.val()+"\x3d1")});N&&(d+="\x26isBilling\x3d1");E&&c.isSPP()&&(E.lock(11),setTimeout(function(){E.unlock(12)},2E3));a=(new Date).getTime();D.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+a,data:d,async:!0,cache:!1,error:c.ajaxRedirect,success:function(a,b,d){c.isSPP()&&E.unlock(12);h(d);z(a,b,d)}})}}function z(b,c,d){D('input[name\x3d"preloadAddressPopover"]').remove();c=d.getResponseHeader("x-amz-checkout-open-new-popover");
"suggestions"===c?(D("#address-suggestions-popover").empty().append(b),D("#address-suggestions-popover-link").trigger("click")):"edit"===c&&(q=1,c=D("#edit-address-popover"),c.empty().append(b),D("#edit-address-popover-link").trigger("click"),u(c,b));a.trigger("identity-assets")}function x(a){a=a.getResponseHeader("x-amz-checkout-new-address-id");var b=(new Date).getTime();D.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html?cachebuster\x3d"+b,data:{action:"update-address",lineitems:M,
quantities:P,addresses:a+".home..",returnHTML:0},async:!0,cache:!1,error:c.ajaxRedirect,success:function(a,b,c){t("applied")}})}function t(b){var d=(new Date).getTime();if(D('input[name\x3d"shipToAddress"]').length)b=function(){c.isSPP()?(l.blockAllActions(),l.shrinkPanel(D(".spp-panel.expanded"),!0)):l.show()},c.isNonBlockingAnimationEnabled()?a.delay(b,0):b(),b=n.getCurrentPage(),c.loadPage(b,"",void 0,{refTag:"chk_addr_editPopoverSubmit"});else{var g=c.setAjaxTransitionHeader();D.ajax({type:"POST",
headers:g,url:"/gp/buy/shared/handlers/pipeline-dispatch.html?cachebuster\x3d"+d,data:{useCase:"multiAddress",showAddressAdded:b,page:"itemselect"},dataType:"text",async:!0,cache:!1,error:c.ajaxRedirect,success:function(a,b,d){c.ajaxUpdatePage(a,b,d);D(".a-button-close").trigger("click");e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}})}}function g(a){a=D("#"+a);a.length&&a.empty()}function u(b,c){b.html(c);k.customizeFormFromIdentity(b);E.updatePosition(!0);a.trigger("identity-assets");
k.countrySpecificPopoverOptimizationCheck(D("html"))}function K(a){a=a.$currentTarget.closest(".lineitem");M=a.find('input[name^\x3d"lineItemEntityID."]').val();P=a.find('input[name^\x3d"quantity."]').val();a=D("#add-address-popover-link");a.length?a.trigger("click"):D("#add-new-address-popover").trigger("click")}function A(){return f.isCreateAddressLinkForTaxAddressFormWeblabOn()&&0<D("#isTaxAddress").length}function L(){N=D("#isBilling").length?1:0;if(f.isInterceptionAddressFormWidthFixEnabled()){var a=
D(".enter-address-form");k.customizeFormFromIdentity(a)}}var D=a.$,E,M,P,q=0,N=0,Q=null;if(!D("html").hasClass("a-ie6"))return a.on("a:popover:show:add-address",function(a){g("edit-address-popover");g("add-billing-address-popover");N=0;b(a,D("#add-address-popover"),!1)}),a.on("a:popover:show:add-billing-address",function(a){g("edit-address-popover");g("add-address-popover");b(a,D("#add-billing-address-popover"),!0)}),a.on("a:popover:show:address-suggestions",function(a){E=a.popover}),a.on("a:popover:show:edit-address",
function(a){E=a.popover;if(e.protectAgainstDoubleAction("show-edit-address-popover",200)||q)q=0;else{var b=D("#edit-address-popover"),d=E.$trigger.closest(".address-edit-link").find("a").attr("href");b.empty();g("add-address-popover");g("add-billing-address-popover");var f=D("#delete-address-popover-button");f.length&&f.addClass("aok-hidden").addClass("a-disabled");a.popover.updatePosition(!0);m.showSpinner(b,!1,E);a=(new Date).getTime();D.ajax({type:"POST",url:d+"\x26cachebuster\x3d"+a,async:!0,
cache:!1,success:function(a,c,d){h(d);u(b,a);f.length&&D("#delete-address-button").length&&f.removeClass("aok-hidden").removeClass("a-disabled")},error:c.ajaxRedirect})}}),a.on("a:popover:show:select-billing-address",function(b){if(!e.protectAgainstDoubleAction("show-select-billing-address-popover",200)){var d=D("#select-billing-address-popover");d.empty();d.css("min-height",250);b.popover.updatePosition(!0);m.showSpinner(d,!1,b.popover);var f=(new Date).getTime(),p="/gp/buy/billingaddressselect/handlers/popover.html";
c.isSPP()&&(p+="/ref\x3dchk_pay_billing_change_coll");g("add-billing-address-popover");D.ajax({type:"POST",url:p+"?cachebuster\x3d"+f,async:!0,cache:!1,success:function(c,g,f){h(f);d.html(c);a.trigger("checkout:reload:spp-billing-address");d.css("min-height",0);b.popover.updatePosition(!0)},error:c.ajaxRedirect})}}),a.on("a:expander:delivery-expander:toggle:expand",function(a){a=D(".a-expander-content");k.fixOverflow(a)}),a.declarative("close-delete-popover",["click","touchend"],function(a){r.when("a-popover-base").execute(function(b){(b=
b.get(a.data.popoverName))&&b.hide()})}),a.declarative("rm-address-action",["click","touchend"],function(a){r.when("a-popover-base").execute(function(b){(b=b.get(a.data.popoverName))&&b.hide()});f.isRemoveAddressFormOnDeleteAddressWeblabOn()&&(g("edit-address-popover"),g("add-address-popover"),g("add-billing-address-popover"));r.when("page-conductor").execute(function(b){b.continueClicked(null,a.$target)})}),a.declarative("select-billing-address-action",["click","touchend"],function(a){r.when("a-popover-base").execute(function(a){a.get("select-billing-address").hide()});
r.when("page-conductor").execute(function(b){b.continueClicked(null,a.$target)})}),D(document).delegate("a.prevent-default-marker","click",function(a){a.preventDefault()}),a.declarative("select-billing-address-in-popover",["click","touchend"],function(a){r.when("a-popover-base").execute(function(a){(a=a.get("select-billing-address"))&&a.hide()})}),a.declarative("trigger-popover-from-link",["click","touchend"],function(a){e.protectAgainstDoubleAction("trigger-popover-from-link",200)||(P=M=null,D("#add-address-popover-link").trigger("click"))}),
a.declarative("add-address-popover-submit",["click","touchend"],function(a){p(D("#add-address-popover"),a)}),a.declarative("add-billing-address-popover-submit",["click","touchend"],function(a){p(D("#add-billing-address-popover"),a)}),a.declarative("edit-address-popover-submit",["click","touchend"],function(a){p(D("#edit-address-popover"),a)}),a.declarative("address-suggestions-submit",["click","touchend"],function(a){p(D("#address-suggestions-popover"),a)}),a.declarative("delete-address-popover-submit",
["click","touchend"],function(a){a=D("#delete-address-button");0<a.length&&a.click()}),a.declarative("edit-address-suggestions",["click","touchend"],v),a.declarative("add-address-popover-edit",["click","touchend"],function(a){if(!e.protectAgainstDoubleAction("add-address-popover-edit",200)){a.$event.preventDefault();var b=D("#add-address-popover");m.showSpinner(b,!1,E);a=D("#address-popover-suggestions-form").serialize()+"\x26"+a.$currentTarget.find('input[type\x3d"submit"]').attr("name")+"\x3d1";
var d=(new Date).getTime();D.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+d,data:a,async:!0,cache:!1,error:c.ajaxRedirect,success:function(a,c,d){h(d);u(b,a)}})}}),a.declarative("add-address-popover-toggle",["click","touchend"],function(a){e.protectAgainstDoubleAction("add-address-popover-toggle",200)||(a.$event.preventDefault(),a=a.$currentTarget.closest(".enter-address-form"),k.toggleAddressForm(a,a.siblings(".enter-address-form")))}),a.declarative("select-radio-option",
["click","touchend"],function(a){a=a.$currentTarget.find(".radio-option");a.find('input[type\x3d"radio"]').attr("checked","checked");a.closest(".radio-option-list").find(".radio-option").removeClass("radio-option-selected");a.addClass("radio-option-selected")}),a.declarative("trigger-address-popover",["click","touchend"],function(a){e.protectAgainstDoubleAction("trigger-address-popover",200)||D("#add-address-popover-link").trigger("click")}),a.on("checkout:reload:spp-shipaddress",L),a.on("checkout:reload:spp-billing-address",
L),a.on("checkout:reload:itemselect",L),a.on("checkout:reload:spp-itemselect",L),{actionTriggerPopoverFromDropdown:K,actionRegisterTaxAddressController:function(a){A()&&!Q&&a&&(Q=a)}}});"use strict";r.when("A").register("address-book-controller",function(a){function m(){l("div.address-book").unbind("recalculate-address-height").bind("recalculate-address-height",function(){var a,e=l(),k=0,n=l("div.address-book .js-same-height"),d=n.length;n.css({height:"auto"}).each(function(f){var h=l(this);a=a||
h.offset().top;a!==h.offset().top&&(e.height(k),e=l(),k=0,a=h.offset().top);var b=h.height();e=e.add(h);b>k&&(k=b);f===d-1&&0<k&&e.height(k)})}).trigger("recalculate-address-height");l(q).unbind("resize.checkout-as").bind("resize.checkout-as",function(){l("div.address-book").trigger("recalculate-address-height")})}var l=a.$;a.on("checkout:reload:spp-shipaddress",m);a.on("checkout:reload:shipaddressselect",m);a.on("checkout:reload:billingaddressselect",m);a.on("checkout:reload:spp-billing-address",
m)});"use strict";r.when("A","client-side-metrics","weblab-helper").register("address-utilities",function(a,m,l){function c(a){a.find("input").each(function(){var a=d(this),b=a.outerWidth(!0),c=a.parent().outerWidth(!0);b>c&&a.attr("size")&&(document.getElementById(a.attr("id")).removeAttribute("size"),a.width("100%"))})}function e(a){if(d('input[name\x3d"useLiveAUI"]').length)r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder&&a.find(".field-description").each(function(){var a=
d(this),b=a.text(),c=a.closest(".a-col-right").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");c.attr("maxlength")<b.length&&c.attr("size",b.length);c.attr("placeholder",a.text())})}),a.find("input").each(function(){d(this).outerWidth()}),a.find("input[type\x3d'text'], select").each(function(){var a=d(this).closest(".full-width-config"),b=d(this);0===a.find(".a-popover-trigger").length&&(l.isInterceptionAddressFormWidthFixEnabled()?b.addClass("addressform-textfield-width"):
b.width("96%"))});else{r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder?a.find(".field-description").each(function(){var a=d(this),b=a.text(),c=a.closest(".a-column").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");c.attr("maxlength")<b.length&&c.attr("size",b.length);c.attr("placeholder",a.text())}):a.find(".field-description").each(function(){var a=d(this);a.find("br").remove();a.show()})});a.find(".popover-field-label").each(function(){var a=
d(this);a.find("b").each(function(){var a=d(this);a.text(d.trim(a.text()))});a.find("font").each(function(){var a=d(this);"-2"===a.attr("size")&&a.remove()})});var h=d(".enter-address-form");c(h);var b=0,h=a.find(".one-new-address-form-field").first();h.length&&h.find(".a-column").each(function(){b+=d(this).outerWidth()});a.width(0<b?b:"")}}function k(c){function d(){n=p.val();(t=l[n])&&e.find(".learn-more a").text(t.popOverLinkText)}var b=q.P&&q.P.AUI_BUILD_DATE,p=c.find("#enterAddressCountryCode"),
e=c.find(".country-specific-form-input"),k,l;b?(k=e.find("input"),l=c.find(".country-specific-config").data("popovercountryconfig")):(m.increaseCount("removeauijs2"),k=e.find("#"+e.data("inputid")),l=e.find(".country-specific-config").data("popovercountryconfig"));if(p.length&&e.length&&k.length&&l){var n=p.val(),t=l[n];p.unbind("change.countryChangeConfigUpdate").bind("change.countryChangeConfigUpdate",d);d();var g=b?"show":"beforeShow";a.on("a:popover:"+g+":checkout-"+e.data("inputid")+"Name",function(a){"beforeShow"===
g&&m.increaseCount("removeauijs3");t&&(a.popover.$popover.find(".a-popover-header h4").html(t.popOverTitle),a.popover.$popover.find(".a-popover-inner").html(t.popOverText),a.popover.updatePosition())})}}function n(a){function c(){var a=p.val();(a=l[a])?(a=(a=a.label)||"",k.attr("placeholder",d("\x3cdiv /\x3e").html(a).text().replace(":","")),e.show()):e.hide()}var b=q.P&&q.P.AUI_BUILD_DATE,p=a.find("#enterAddressCountryCode"),e=a.find(".country-specific-form-input-mobile"),k,l;b?(k=e.find("input"),
l=a.find(".country-specific-config").data("labelcountryconfig")):(m.increaseCount("removeauijs3"),k=e.find("#"+e.data("inputid")),l=e.find(".country-specific-config").data("labelcountryconfig"));p.length&&e.length&&k.length&&l&&(p.unbind("change.countryChangeLabelUpdate").bind("change.countryChangeLabelUpdate",function(){e.hasClass("initial-edit-value")?e.removeClass("initial-edit-value"):k.val("");c()}),c())}var d=a.$;r.when("a-checkbox").execute(function(c){a.declarative("delivery-preferences-weekend-availability-checkbox-triggered",
"click",function(a){if("undefined"!==typeof a.$target){var b=a.$target.val();a.$target.is(":checked")&&("NONE"===b?(c("#delivery-preferences-weekend-availability-sat").uncheck(),c("#delivery-preferences-weekend-availability-sun").uncheck()):"SAT"!==b&&"SUN"!==b||c("#delivery-preferences-weekend-availability-none").uncheck())}})});a.declarative("wdp-redesign-addresstype-radio-clicked","click",function(a){var c=a.$target.context.id;a=d(".com-businesshours-text");var b=d("#delivery-preferences-weekend-availability-sat").is(":checked"),
e=d("#delivery-preferences-weekend-availability-sun").is(":checked");"devyPrefs_AddressType_COM"===c?(m.increaseCount("WDPTotalCOMClick"),d(".wdp-res").removeClass("a-color-base-background").addClass("a-color-alternate-background"),d(".wdp-com").removeClass("a-color-alternate-background").addClass("a-color-base-background"),d(".wdp-BusinessHours").removeClass("aok-hidden")):"devyPrefs_AddressType_RES"===c?(m.increaseCount("WDPTotalRESClick"),d(".wdp-com").removeClass("a-color-base-background").addClass("a-color-alternate-background"),
d(".wdp-res").removeClass("a-color-alternate-background").addClass("a-color-base-background"),d(".wdp-BusinessHours").addClass("aok-hidden")):"delivery-preferences-weekend-availability-sat"===c?(m.increaseCount("WDPTotalSATClick"),c=b?e?"BOTH":"SAT":e?"SUN":"OTH",a.addClass("aok-hidden"),d(".com-businesshours-"+c).removeClass("aok-hidden")):"delivery-preferences-weekend-availability-sun"===c&&(m.increaseCount("WDPTotalSUNClick"),c=e?b?"BOTH":"SUN":b?"SAT":"OTH",a.addClass("aok-hidden"),d(".com-businesshours-"+
c).removeClass("aok-hidden"))});return{toggleAddressForm:function(a,h){a.hide();h.find("div.a-alert-error:not(.js-originally-shown-imb)").hide();a.find("input[type\x3d'text'], select, input[type\x3d'radio']:checked, input[type\x3d'hidden']").each(function(){var a=d(this),c=a.attr("name")||a.data("copyto")||a.attr("id");if(!a.is(":disabled")&&!a.find(":selected").is(".js-not-a-value")){var e=h.find("input[name\x3d'"+c+"']");"enterAddressLandmark"===c&&(e=h.find("input[name\x3d'Landmark']"));"Landmark"!==
c||e.length||(e=h.find("input[name\x3d'enterAddressLandmark']"));1<e.length&&a.is("input[type\x3d'radio']")?e.filter("[value\x3d'"+a.val()+"']").attr("checked",!0):e.is("select")?e.find("option[value\x3d'"+a.val()+"']").attr("selected",!0):a.is("input[type\x3d'hidden']")||e.is("input[type\x3d'hidden']")||e.val(a.val())}});h.show();c(h);e(h)},customizeFormFromIdentity:e,fixOverflow:c,countrySpecificLabelOptimizationCheck:function(a){var c=a.find(".enter-address-form");1===c.data("taxidOpt")?setTimeout(function(){n(c)},
100):n(c)},countrySpecificPopoverOptimizationCheck:function(a){var c=a.find(".enter-address-form");1===c.data("taxidOpt")?setTimeout(function(){k(c)},100):k(c)}}});"use strict";r.when("A","page-conductor","page-transition-controller","client-side-metrics").register("address-form-helper",function(a,m,l,c){var e=a.$;a.on("a:popover:afterUpdatePosition:edit-address",function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:edit-address",c.popover)});a.on("a:popover:afterUpdatePosition:add-address",
function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:add-address",c.popover)});a.on("a:popover:visible:add-address",function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:add-address",c.popover)});return{setDestination:function(a){a||(c.increaseCount("checkout:addressForm:setDestination:noRequest",1),a={});var l=a.addressId;l||c.increaseCount("checkout:addressForm:setDestination:noAddressId",1);var d=a.purchaseId||e("input[name\x3d'purchaseId']").val();
d||c.increaseCount("checkout:addressForm:setDestination:noPurchaseId",1);a=a.ref||"ox_shipaddress_add_new_addr";e(".a-button-close").trigger("click");a=e("\x3cform/\x3e").attr("action","/gp/buy/addressselect/handlers/continue.html/ref\x3d"+a);e('\x3cinput name\x3d"addressID"/\x3e').val(l).appendTo(a);e('\x3cinput name\x3d"purchaseId"/\x3e').val(d).appendTo(a);e('\x3cinput name\x3d"action" value\x3d"select-shipping"/\x3e').appendTo(a);m.continueClicked(null,a)},onPageTransitionStart:function(a){m.isSPP()?
(l.blockAllActions(),l.showTransitionInContainer(a)):l.show()},onPageTransitionComplete:function(a){m.isSPP()?(l.unblockAllActions(),e(a).find("div.section-overwrap").remove()):l.hide()}}});"use strict";r.when("A","client-side-metrics","weblab-helper").register("action-logger",function(a,m){var l=a.$;a.declarative("ue-count",["click","touchend"],function(a){m.increaseCount(a.data.countFlag,a.data.countValue)});return{logUsedPrefetch:function(a,e,k,n){n||(m.increaseCount("Checkout:action-log:MissingRefMarker"),
n="");l.ajax({type:"GET",url:"/gp/buy/shared/handlers/log-used-prefetch.html"+n,data:"pageType\x3d"+a+"\x26subPageType\x3d"+e+"\x26relatedRequestId\x3d"+k,dataType:"text",cache:!1})}}});"use strict";r.when("A","weblab-helper").register("ajax-utility",function(a,m){return{jsonify:function(l){var c;if(c=m.isAJAXWeblabOn()){c=l instanceof Function;var e=l instanceof Array,k=l instanceof String;c=l instanceof Object&&!e&&!c&&!k}if(c)return l;try{l=a.$.parseJSON(l)}catch(n){l=null}return l}}});"use strict";
r.when("A","page-conductor","client-side-metrics","weblab-helper").register("button-blocker",function(a,m,l,c){function e(a,b,c,d){m.isSPP()?b.closest("span.a-declarative").data("blockerText",c):b.find("input.a-button-text").data("blockerText",c);k(d);p?(a.addClass("aok-hidden"),b.removeClass("aok-hidden"),n("#hasTVNavigation").length&&r.when("a-tv").execute(function(b){b.remove(a)})):(l.increaseCount("removeauijs10"),a.hide(),b.show(),b.hasClass("aok-hidden")&&b.removeClass("aok-hidden"))}function k(a){var b=
n(".continue-button-blocker-text");b.length&&(a?(b.html(a),b.removeClass("aok-hidden")):(b.addClass("aok-hidden"),b.empty()))}var n=a.$,d={},f=[],h,b,p=q.P&&q.P.AUI_BUILD_DATE,w=!1,v=c.isPyoClientSideInitiationEnabled()?"checkout:unload":"checkout:beforeReload";a.on(v,function(){f=[];d={};h=""});return{show:function(a,b,p){if(!w){var g=n(".continue-button");if(g.length){if(!b)if(q.console&&q.console.error&&console.error("showBlockerOnContinue should not be called with an empty tooltip."),l.increaseCount("Checkout:ButtonBlocker:EmptyTooltip"),
c.isFixDisabledPyoForMissingBlockerMessageEnabled())b="";else return;var k=n(".continue-button-blocker");if(k.length){p=p||"";var m=void 0!==d[a]&&d[a].tooltipText!==b,A=void 0!==d[a]&&d[a].buttonInlineText!==p;if(0===f.length||!d[a]||m||A)e(g,k,b,p),h=a;void 0===d[a]&&f.push(a);d[a]={tooltipText:b,buttonInlineText:p}}}}},hide:function(a){if(!w){if(void 0!==d[a]){delete d[a];var b=n.inArray(a,f);f.splice(b,1)}var c=n(".continue-button");c.length&&(b=n(".continue-button-blocker"),b.length&&(0===f.length?
(k(),p?(b.addClass("aok-hidden"),c.removeClass("aok-hidden"),n("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.add(c)})):(l.increaseCount("removeauijs11"),b.hide(),c.show(),c.hasClass("aok-hidden")&&c.removeClass("aok-hidden"))):h===a&&(h=f[0],e(c,b,d[h].tooltipText,d[h].buttonInlineText))))}},lock:function(){w=!0},unlock:function(){w=!1},getButtonBlocker:function(){b||(b=n(".continue-button-blocker"));return b}}});"use strict";r.when("A","button-blocker","client-side-metrics").register("button-blocker-controller",
function(a,m,l){function c(a){return void 0!==d[a]?1:0}function e(a,e){c(a)&&d[a].state!==e&&(d[a].state=e,k())}function k(){var a=!0,c;n.each(d,function(d,e){c=e.owner;if(e.state===h.DISABLE_CONTINUE)return a=!1,m.show(c,e.toolTipMessage,e.buttonInlineMessage),f||(l.increaseCount("removeauijs12"),n(".continue-button-blocker").css("display","inline-block")),!1});a&&m.hide(c)}var n=a.$,d={},f=q.P&&q.P.AUI_BUILD_DATE,h={ENABLE_CONTINUE:"enableContinue",DISABLE_CONTINUE:"disableContinue"};a.on("checkout:beforeReload",
function(){d={}});return{disableContinue:function(a,f,l,n){n=n||"";c(f)||(l?(c(f)||(d[f]={state:h.ENABLE_CONTINUE,owner:a,toolTipMessage:l,buttonInlineMessage:n}),k()):q.console&&q.console.error&&console.error("_registerElement should not be called with an empty tooltip."));e(f,h.DISABLE_CONTINUE)},enableContinue:function(a){c(a)&&e(a,h.ENABLE_CONTINUE)}}});"use strict";r.when("jQuery").register("cache-page-data-controller",function(a){var m={};return{clearCache:function(){m={}},setCachedPageData:function(l,
c,e,k,n){var d=[],f=!0;a(".cacheable-spp-panel").each(function(){var b=a(this),c;c=!b||b.find(".is-scheduled-delivery").length?!1:!0;if(!c)return f=!1;b.find(".expand-panel-button").removeClass("a-button-focus");d.push({id:b.attr("id"),content:b[0].outerHTML})});if(f){var h={panels:d};a(".cacheable-spp-section").each(function(){var b=a(this);h[b.attr("id")]=b[0].outerHTML});m[l+"-"+c]={curPageData:h,state:q.history?history.state:e,page:l,title:document.title||k,url:q.location.href||n}}},getCachedPageData:function(a,
c){return m[a+"-"+c]}}});"use strict";r.when("A").register("checkout-general-utils",function(a){var m=a.$,l={moveToNextInput:function(a){a=a.nextAll(":visible").find("input").get(0);a!==[]&&a.focus()},hide:function(a){a.hide()},show:function(a){q.P&&q.P.AUI_BUILD_DATE&&a.hasClass("aok-hidden")&&a.removeClass("aok-hidden");a.show()},getAssocParamValuesFromUrl:function(a){var e={};if("string"!==typeof a||-1===a.indexOf("?"))return e;a=a.slice(a.indexOf("?")+1);if(!a)return e;-1!=a.indexOf("#")&&(a=
a.substring(a,a.indexOf("#")));a=a.split("\x26");for(var k=0;k<a.length;k++){var l=a[k].split("\x3d");e[l[0]]=l[1]}return e},addQueryStringParameter:function(a,e,k){var n=l.getAssocParamValuesFromUrl(a);n[e]=k;e=0<=a.indexOf("?")?a.substring(0,a.indexOf("?")):a;e=e+"?"+m.param(n,1);(a=l.getFragmentFromUrl(a))&&(e+="#"+a);return e},getFragmentFromUrl:function(a){var e=a.indexOf("#");return-1==e?void 0:a.substring(e+1)},extractURLParts:function(a){if(!a||"string"!==typeof a)return{};a=/(.*html)(\/ref[^?\n]*)?[?]?(.*)/g.exec(a);
var e={};a&&(a[1]&&(e.normalizedUrl=a[1]),a[2]&&(e.refMarker=a[2]),a[3]&&(e.query=a[3]));return e},redirectWithJavascript:function(a){q.location=l.addQueryStringParameter(a,"hasWorkingJavascript","1")},bindActionEnterKeyOnButton:function(a){a.keyup(function(a){13===a.which&&m(a.target).trigger("click")})},toggleExpanderContent:function(a){a=a.$target.closest(".a-box");a.hasClass("a-single")?a.removeClass("a-single").addClass("a-first"):a.addClass("a-single").removeClass("a-first")},validateNumber:function(a,
e,k){m.trim(a);return/^\d+$/.test(a)&&a>=e&&a<=k}};l.protectAgainstDoubleAction=function(){var a={};return function(e,k){if(!e)return q.console&&q.console.error&&console.error("Function is not used properly, use a unique owner to identify the caller."),!1;if(a.hasOwnProperty(e))return!0;a[e]=1;setTimeout(function(){delete a[e]},k||100);return!1}}();l.logErrorOnLevel=function(a,e){(q.ueLogError||m.noop)({message:a,logLevel:e});if(q.console){var k={FATAL:q.console.error,"default":q.console.warn};e=
k[e]||k["default"]}else e=m.noop;e.call(q,a)};l.logError=function(a){l.logErrorOnLevel(a,"FATAL")};l.updateCartByMash=function(a){r.when("safe-mash").execute(function(e){null!==a&&void 0!==a&&"1"===m("#updateCartByMash").attr("content")&&e&&e.cart&&e.cart.didUpdate&&e.cart.didUpdate({newCartQuantity:a})})};l.getPosition=function(a,e,k){for(var l=0,d=a.length,f=0;f<d;f++)if(a.charAt(f)===e&&(l++,l===k))return f;return-1};l.limitInputToNumbers=function(a){var e=a.$event.keyCode;-1!==m.inArray(e,[46,
8,9,37,39])||-1!==m.inArray(e,[65,67,86])&&!0===a.ctrlKey||(a.$event.shiftKey||(48>e||57<e)&&(96>e||105<e))&&a.$event.preventDefault()};l.nukeDropdowns=function(a){r.when("a-popover-base").execute(function(e){m.each(m(a),function(){e.remove(this.name)})})};a.on("checkout:reload",function(){m('input[name\x3d"useLiveAUI"]').length||a.defer(function(){m(".a-declarative, .a-button").filter("[data-action]").unbind("keypress.checkout-page").bind("keypress.checkout-page",function(a){13===a.which&&m(this).trigger("click")})})});
a.on("checkout:beforeLoadPage",function(){m("div.a-popover").find(".a-declarative:first:[data-action\x3dcustom-popover-close|a-popover-close]").click()});return l});"use strict";r.when("A","weblab-helper").register("client-side-metrics",function(a,m){var l=a.$,c=null,e=null,k=0,n;a=function(){};var d=q.uet||a,f=q.uex||a,h=function(a){q.ue&&q.ue.t&&q.uet(a,c)},b=function(a){q.ue&&q.uex&&q.uex(a,c)},p=function(a){q.ue&&q.ues&&q.ues("id",c,a)},w=function(){q.ue&&q.ues&&q.ues("ctb",c,"1")},v=function(){q.ue&&
q.ues&&(q.ues("t0",c,(new Date).getTime()),h("ue"),h("bb"))},z=function(a){a?e="ctbajax"+k++:c="ajax"+k++},x=function(a){if(a&&a.length){var b=c;c=e;p(a);c=b}},t=function(){void 0===n&&(n=0<l("#transitionLogging").length);return n};return{getscope:function(){return c},getasyncscope:function(){return e},setmarker:h,sendue:b,setrid:p,setctb:w,resetue:v,createscope:z,setscope:function(a){c=a},increaseCount:function(a,b,c){"undefined"!==typeof q.ue&&"undefined"!==typeof q.ue.count&&(b=b?b:1,c?q.ue.count(a,
(q.ue.count(a)||0)+1):q.ue.count(a,b))},resetMetrics:function(){c=e;w();v()},setAsyncRequestId:x,sendUEPageLoadStats:function(){b("ld");z(1)},isTransitionLoggingEnabled:t,logPageTransition:function(a,b,c,d){if(t()){var e=(new Date).getTime();l.ajax({type:"POST",url:"/gp/buy/shared/handlers/log-page-transition.html?cachebuster\x3d"+e,data:{fromPage:a,toPage:b},async:!0,cache:!1,timeout:1E3,success:function(a,b,d){var g=d.getResponseHeader("x-amz-checkout-requestid");x(g);c&&c.call(this,a,b,d)},complete:function(a,
b){d&&d.call(this,a,b)}})}},logError:function(a,b,c,d){q.ueLogError&&q.ueLogError(a,{message:b,attribution:c,logLevel:d})},startWidgetTiming:function(a){d("bb",a,{wb:1})},finishWidgetTiming:function(a){f("ld",a,{wb:1})},setMarkerForWidget:function(a,b){d(a,b,{wb:1})}}});"use strict";r.register("currency-formatter",function(){function a(m,l){isNaN(l)||(m=Number(m).toFixed(l));m=m.toString();l=0<=m.lastIndexOf(".")?m.lastIndexOf("."):m.length;return 3>=l?m:a(m.substring(0,l-3),0)+","+m.substring(l-
3)}return{getNumberWithSeparators:a}});"use strict";r.when("A","client-side-metrics","page-conductor","page-detector").register("delivery-preferences-csm-helper",function(a,m,l,c){function e(a){var e=l.isSPP()?"spp":"mpp",h="desktop";c.isMobile()?h="mobile":c.isTablet()&&(h="tablet");m.increaseCount("checkout:delivery-preferences:"+h+":"+e+":"+a,1)}function k(a){return 0===a.length?"NoValueSet":a}var n=a.$;return{recordCSM:e,recordCSMWithCurrentFieldValues:function(a,c,h){c=n("input[name\x3d"+c+"]:checked");
c.length&&(c=c.val(),e(a+":preference:"+k(c)));h=n("input[name\x3d"+h+"]");h.length&&e(a+":set-as-default:"+(h.is(":checked")?"yes":"no"))},recordCSMForEligiblePages:function(a){a=a||"";e(a+"eligible-page-displayed");var c=n("input[name\x3ddelivery-preferences-preference-set]");c.length&&e(a+"summary-displayed:preference:"+k(c.val()))}}});"use strict";r.when("page-detector-current-page","A").register("error-feature-detection",function(a,m){function l(a){q.errorFeatureDetection&&q.errorFeatureDetection.safelyLogError?
q.errorFeatureDetection.safelyLogError(a):(q.ueLogError&&q.ueLogError(a),q.console&&q.console.error&&console.error(a))}try{m.on("page-detector:page-changed",function(){var c=a.getCurrentPage();if(c&&"spc"===c)try{q.errorFeatureDetection&&q.errorFeatureDetection.enableErrorHandling&&q.errorFeatureDetection.enableErrorHandling()}catch(e){l(e)}else try{q.errorFeatureDetection&&q.errorFeatureDetection.disableErrorHandling&&q.errorFeatureDetection.disableErrorHandling()}catch(e){l(e)}})}catch(c){l(c)}return{registerFeature:function(a,
e){try{q.errorFeatureDetection&&q.errorFeatureDetection.registerFeature&&q.errorFeatureDetection.registerFeature(a,e)}catch(k){l(k)}},markFeatureAvailable:function(a){try{q.errorFeatureDetection&&q.errorFeatureDetection.markFeatureAvailable&&q.errorFeatureDetection.markFeatureAvailable(a)}catch(e){l(e)}},markFeatureUnavailable:function(a){try{q.errorFeatureDetection&&q.errorFeatureDetection.markFeatureUnavailable&&q.errorFeatureDetection.markFeatureUnavailable(a)}catch(e){l(e)}}}});r.when("error-feature-detection").execute(function(a){a.registerFeature("continue-action",
0);a.markFeatureAvailable("javascript-detection");a.markFeatureAvailable("continue-action")});"use strict";r.when("A","loading-spinner-controller","ajax-utility","currency-formatter","page-conductor","page-transition-controller").register("inline-points-register-controller",function(a,m,l,c,e,k){function n(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,
String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))}function d(a){var b=v.$popover.find(".rewards-registration");m.hideSpinner(b);b.children("div").hide();b=b.find(".rewards-registration-error");a&&a.error?(a=b.find("[data-error\x3d'"+a.error+"']"),a.length?a.show():b.find("[data-error\x3d'rewards_SystemUnavailable']").show()):b.find("[data-error\x3d'rewards_SystemUnavailable']").show();b.fadeIn(300)}function f(a){v=a.popover;var b=v.$popover.find(".rewards-registration");
m.showSpinner(b,!1,v);a=b.data("issuer-id");var c=b.data("program-id"),e=b.data("cc-issuer"),h=b.data("cc-brand"),b=b.data("parent-payment-method-id"),f="/gp/buy/payselect/handlers/get-rewards-configuration.html?cachebuster\x3d"+(new Date).getTime();w.ajax({type:"POST",url:f,data:"programid\x3d"+c+"\x26partner\x3d"+a+"\x26ccpaymentinstrumentid\x3d"+b+"\x26issuer\x3d"+e+"\x26brand\x3d"+h+"\x26hasWorkingJavascript\x3d1",dataType:"text",async:!0,cache:!1,dataFilter:function(a){return l.jsonify(a)},success:function(a,
b,c){b=v.$popover.find(".rewards-registration");m.hideSpinner(b);c=a.fields||{};for(var d in c)if(c.hasOwnProperty(d)){var g=c[d],e=b.find("[data-field\x3d'"+g.type+"']");g.value&&e.filter("input").attr("value",g.value);e.parents(".rewardsfield").show()}a.termshtml&&b.find(".rewardstermstext").html(n(a.termshtml));a.billingzip&&b.find("[data-field\x3dBILLING_POSTAL_CODE]").attr("value",a.billingzip);if(a.displaydata){d=b.find("[data-field]");for(var h in a.displaydata)a.displaydata.hasOwnProperty(h)&&
d.filter("[data-field\x3d"+h+"]").html(a.displaydata[h])}a.marketinglink&&b.find("[data-field\x3d'rewards_marketing_link']").html(a.marketinglink);b.find("#rewards-registration-image").show();b.find(".rewards-registration-main").fadeIn(300);v.updatePosition(!0)},error:function(a){d(a)}})}function h(){if(v){var a=v.$popover.find(".rewards-registration");m.hideSpinner(a);a.find(".rewards-registration-success").hide();a=a.find(".rewards-registration-error");a.hide();a.find("h4").hide();z&&(k.show(),
e.isSPP()?e.reloadPage():w("div.pay").length?e.loadPage("payselect","payselect"):w("div.spc").length&&e.loadPage("spc","spc"))}}function b(a){return a.is("input")?a:a.find("input")}function p(){if(v){var a=v.$popover.find(".rewards-registration");a.find(".rewards-registration-main").hide();a.find("#rewards-registration-image").hide();m.showSpinner(a,!1,v);var e=(new Date).getTime(),g="programid\x3d"+encodeURIComponent(a.data("programId")),g=g+("\x26paymentinstrumentid\x3d"+encodeURIComponent(a.data("parent-payment-method-id"))+
"\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26cachebuster\x3d"+e),h=a.find("[data-field]");h.each(function(){var a=w(this).attr("data-field");if("CVV2"===a)g+="\x26registerRewardsCreditCardVerificationNumber\x3d"+encodeURIComponent(w(this).val());else if(w(this).data("entryindex")){if(1===w(this).data("entryindex")){var c=h.filter("[data-field\x3d"+a+"]").sort(function(a,b){return Number(w(a).data("entryindex"))-Number(w(b).data("entryindex"))});g+="\x26"+a+"\x3d";c.each(function(){g+=encodeURIComponent(w(this).val())})}}else"TERMS_AND_CONDITIONS"===
a?b(w(this)).is(":checked")&&(g+="\x26"+a+"\x3dtrue"):g+="\x26"+a+"\x3d"+encodeURIComponent(w(this).val())});e="ox_pay_page_swp_reg_popover_submit";a.data("programId")&&(e+="_"+a.data("programId"));a="/gp/buy/payselect/handlers/register-rewards-account.html/ref\x3d"+e+"?cachebuster\x3d"+(new Date).getTime();w.ajax({type:"POST",url:a,data:g,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return l.jsonify(a)},success:function(a,b,g){a?a&&0===a.success?d(a):v&&(b=v.$popover.find(".rewards-registration-success"),
b.find(".customername").text(a.customername),a.dollarbalancedisplay&&a.pointsbalance&&(b.find("[data-field\x3d'rewardsamount']").html(a.dollarbalancedisplay),b.find("[data-field\x3d'pointsamount']").html(c.getNumberWithSeparators(a.pointsbalance,a.rewardsdecimalplaces)),b.find(".rewardsuccessbalance").show()),a.showwarnmessage&&b.find(".warnmessage").show(),z=!0,b.fadeIn(300),m.hideSpinner(v.$popover.find(".rewards-registration"))):d()},error:function(a){d(a)}})}}var w=a.$,v,z=!1;a.on("a:popover:show:rewards-registration",
f);a.on("a:popover:hide:rewards-registration",h);a.declarative("close-rewards",["click"],function(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")});a.declarative("rewards-signup",["click"],function(a){a.$event.preventDefault();p(a)});a.declarative("toggle-reward-signup-button","change",function(a){a=a.$target;var b=v.$popover.find(".rewards-registration");a&&a.is(":checked")?(b.find("#reward-signup-button").removeClass("aok-hidden"),b.find("#disabled-reward-signup-button").addClass("aok-hidden")):
(b.find("#reward-signup-button").addClass("aok-hidden"),b.find("#disabled-reward-signup-button").removeClass("aok-hidden"))});a.on("a:popover:beforeShow:cvv2helpcontent",function(a){a.popover.$popover.find(".a-popover-inner").html(w(".cvv2helpcontent").text());a.popover.updatePosition()});return{displayRewardsRegister:f,hideRewardsRegister:h}});"use strict";r.when("A","error-feature-detection","safe-mash","ready").register("shared-kitchensink",function(a,m,l){var c=a.$;a.on("checkout:reload",function(){(c("body.a-touch").length||
c("div.a-touch:first").length)&&c("html").addClass("a-touch");c("form").each(function(){var a=c(this).find('input[name\x3d"hasWorkingJavascript"]');a&&0<a.length?a.val("1"):c(this).append('\x3cinput type\x3d"hidden" name\x3d"hasWorkingJavascript" value\x3d"1" /\x3e')});l&&(c("div.checkout-tablet a[target\x3d'AmazonHelp']").each(function(){var a=c(this).attr("href"),a=a+(0<=a.indexOf("?")?"\x26app-nav-type\x3dmodal":"?app-nav-type\x3dmodal"),a=a.replace("#","");c(this).attr("href",a);c(this).removeAttr("data-action");
c(this).removeAttr("data-help-popup");c(this).removeAttr("onclick")}),c("div.checkout.mobile a[target\x3d'AmazonHelp']").each(function(){var a=c(this).attr("href"),a=a.replace("#","");c(this).attr("href",a);c(this).removeAttr("data-help-popup");c(this).removeAttr("onclick");c(this).addClass("a-declarative help-popup");c(this).attr("data-action","help-popup")}));if(0<c("div.checkout-tablet").length)for(var a=document.getElementsByTagName("a"),k=0;k<a.length;k++)a[k].href||(a[k].href="#")});c(document).bind("jsdetection",
function(){m.markFeatureAvailable("javascript-detection")})});r.when("A","safe-mash","ready").execute(function(a,m){var l=a.$;a.declarative("mash-navigate",["click"],function(a){a=a.$currentTarget.attr("href");m&&m.navigate?m.navigate({url:a}):q.location.href=a});a.declarative("expander-scroll-there",["click"],function(a){if("false"!==a.$currentTarget.closest(".a-expander-container").find(".a-expander-content").attr("aria-expanded")){var e=l(q),k=l(document),m=a.$currentTarget.offset().top,d=0,f=
0,h=function(){q.setTimeout(function(){e.scrollTop(m);d===k.height()?f++:(f=0,d=k.height());10>f&&h()},10)};h()}})});q.amz_js_PopWin=function(a,m,l){(a=q.open(a,m,l))&&a.focus&&a.focus();return!1};var la=!1;q.confirmPurchase_onSubmit||(q.confirmPurchase_onSubmit=function(){return la?!1:la=!0});"use strict";r.when("A","error-feature-detection","loading-spinner-spp-controller").register("loading-spinner-controller",function(a,m,l){function c(a){if(k&&n){var c,f,g;h&&w?(a=h.getContent(),c=a.innerHeight(),
f=a.innerWidth()):(c=a.height(),f=a.width());g=a.offset();a=n.width();var p=n.height();if(d)g="1"===e("input[name\x3dfromAnywhere]").val()?e(document).height():e(q).height(),k.width(e(document).width()).height(g).css("left","0px").css("z-index",2E3),n.css("left",f/2-a/2+"px").css("top",c/2-p/2+"px").css("z-index",4E3).show();else{var l=e(q),m=w?l.scrollLeft():0;k.css("position","fixed").width(f).height(c).css("z-index",3E3).css("left",g.left-m).css("top",g.top-l.scrollTop());b?n.css("position","fixed").css("left",
g.left-m+(f/2-a/2)+"px").css("top",g.top-l.scrollTop()+(c/2-p/2)+"px").css("z-index",4E3).show():n.css("left",f/2-a/4+"px").css("top",c/2-p/4+"px").css("z-index",4E3).show()}}}var e=a.$,k,n,d,f,h,b=!1,p=!1,w=!1,v=!1;a.on("a:popover:positionUpdated",function(a){if(w&&h&&h.name===a.popover.name&&k&&n){var b=h.getContent();a=b.innerHeight();var c=b.innerWidth(),b=b.offset(),d=e(q);k.width(c).height(a).css("left",b.left-d.scrollLeft()).css("top",b.top-d.scrollTop());n.css("left",b.left-d.scrollLeft()+
(c/2-n.width()/2)+"px").css("top",b.top-d.scrollTop()+(a/2-n.height()/2)+"px")}});a.on("checkout:reload",function(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",c=e("#first-pipeline-load-page-spinner-img");c.length&&(a=e.trim(c.attr("src")));1>e("#loading-spinner-blocker-doc").length&&(a=e(['\x3cdiv class\x3d"template loading-spinner" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-inner"\x3e',
'\x3cimg id\x3d"loading-spinner-img" class\x3d"loading-spinner-img" src\x3d"'+a+'"/\x3e','\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"loading-spinner-blocker-doc" class\x3d"loading-spinner-blocker" style\x3d"display:none;"\x3e\x3c/div\x3e\x3cdiv id\x3d"spinner-anchor" class\x3d"spinner-anchor" style\x3d"display:none"\x3e\x3c/div\x3e'].join("")),n=k=f=null,"1"===e("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),e("body").prepend(a));e("input[name\x3duseModifiedSpinnerResizeFn]").length&&
(b=!0);e("#useRelativeSpinner").length&&(p=!0);e("#modifiedBlockerDivSize").length&&(w=!0)});return{showSpinner:function(a,x,t){if(p&&!x&&w&&b&&t)return v=!0,l.showSpinner(a,t);v=!1;0!==a.length&&(h=(d=x)?void 0:t,f||(f=e(".loading-spinner.template").clone().removeClass("template"),f.show()),a.append(f),d?(k=e("#loading-spinner-blocker-doc"),a.find(".loading-spinner-blocker").hide()):k=a.find(".loading-spinner-blocker"),k.show(),d&&m.markFeatureUnavailable("continue-action"),n=a.find(".loading-spinner-inner"),
c(a))},hideSpinner:function(a,b){if(v)return v=!1,l.hideSpinner(a,b);v=!1;k&&(d&&(k.hide(),m.markFeatureAvailable("continue-action")),f.detach());b&&a.hide()},adjustSize:function(a){return v?l.adjustSize():c(a)}}});"use strict";r.when("A","error-feature-detection").register("loading-spinner-spp-controller",function(a,m){function l(){if(e&&k){var a=d.innerHeight(),b=d.innerWidth();e.width(b).height(a);k.css("left",b/2-k.width()/2+"px").css("top",a/2-k.height()/2+"px")}}var c=a.$,e,k,n,d,f;a.on("a:popover:positionUpdated",
function(a){f&&f.name===a.popover.name&&l()});a.on("checkout:reload",function(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",b=c("#first-pipeline-load-page-spinner-img");b.length&&(a=c.trim(b.attr("src")));1>c(".loading-spinner-spp").length&&(a=c(['\x3cdiv class\x3d"template loading-spinner-spp" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-spp-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-spp-inner"\x3e','\x3cimg class\x3d"loading-spinner-spp-img" src\x3d"'+
a+'"/\x3e',"\x3c/div\x3e\x3c/div\x3e"].join("")),k=e=n=null,"1"===c("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),c("body").prepend(a))});return{showSpinner:function(a,b){0!==a.length&&(f=b,d=a,n||(n=c(".loading-spinner-spp.template").clone().removeClass("template"),n.show()),b.getContent().before(n),d.prepend(n),e=d.find(".loading-spinner-spp-blocker"),e.show(),k=d.find(".loading-spinner-spp-inner"),l())},hideSpinner:function(a,
b){e&&n.detach();b&&a.hide()},adjustSize:l}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-detector-current-page","checkout-general-utils","client-side-metrics","safe-mash","cache-page-data-controller","ajax-wrapper","widget-streamer","widget-streamer-utils","weblab-helper","temporary-preference-indicator").register("page-conductor",function(a,m,l,c,e,k,n,d,f,h,b,p,w){function v(a){q.ueLogError&&q.ueLogError({message:a},{logLevel:"WARN",attribution:"CheckoutCommonAsset-PageConductor"})}
function z(a){ia&&(a?(a["x-amz-checkout-transition"]||(a["x-amz-checkout-transition"]="ajax"),a["x-amz-checkout-type"]||(a["x-amz-checkout-type"]="spp")):a={"x-amz-checkout-transition":"ajax","x-amz-checkout-type":"spp"});return a}function x(){ra=!1;da=null;va=0;ta=!1;na=null}function t(a){var b=parseInt(R("#checkoutDisplayPage").data("delaySetTitle"),10)||0;b?q.setTimeout(function(){document.title=a},b):document.title=a}function g(b){p.isRefreshPageStateEnabled()&&"function"===typeof a.state.parse&&
a.state.parse();a.trigger("checkout:beforeReload");a.trigger("checkout:reload");b&&("spp-revieworder"===b?a.trigger("checkout:reload:spc"):a.trigger("checkout:reload:"+b));a.trigger("checkout:afterReload")}function u(a){m.show();var b="/gp/buy/addtocart/handlers/display.html";a&&(b+="?errorType\x3d"+a);q.location=b}function K(b){(b=R("#pageTypeRedirectedTo").text())&&a.trigger("checkout:reload:"+b)}function A(b,c){var d;if(c.getResponseHeader("x-amz-force-full-page-update"))L(b);else{if(c.getResponseHeader("x-amz-checkout-redirect-addtocart")){(c=
l.jsonify(b))?u(c.errorCode):u();return}d=wa(b)}b=R("#pipelinedPageTitle").text();t(b);var e=c.getResponseHeader("x-amz-checkout-page");ia?a.delay(function(){g(e)},d):g(e)}function L(a){var b=document.open("text/html","replace");b.write(a);b.close()}function D(a,b){try{if(b.getResponseHeader("x-amz-force-full-page-update"))L(a);else{if(!xa)throw Error("Member _updateDisplayPageContent not set in page-conductor. Make sure 'initFunc' is called.");xa(a)}}catch(c){a="Error while replacing page content.",
c.message&&(a+="  Error message: "+c.message),r.error(a,"page-conductor","replaceDisplayPage",c)}a=R("#pipelinedPageTitle").text();t(a);b=b.getResponseHeader("x-amz-checkout-page");g(b)}function E(a){var b=parseInt(R("#showPageTransition").attr("content"),10);(b=isNaN(b)?1:b)||m.hide();b="/gp/buy/shared/handlers/dispatch.html";a&&(a.conductoraction&&a.conductoraction.url?b=a.conductoraction.url:a.pipedata&&a.pipedata.conductoraction&&a.pipedata.conductoraction.url&&(b=a.pipedata.conductoraction.url));
b=0<b.indexOf("?")?b+"\x26":b+"?";R("input[name\x3dfromAnywhere][value\x3d1]").length&&(b+="fromAnywhere\x3d1");b=X(b);n&&R("html").hasClass("a-tablet")&&-1<b.indexOf("/gp/cart/view.html")&&(b="/gp/aw/c?app-action\x3dcart");q.location=b}function M(a,b,c,g,e){g=g||{};g.pushNewFrame=g.pushNewFrame||"true";g.anchor=g.anchor||void 0;x();"true"===g.pushNewFrame&&n&&n.navigate&&R("#checkoutDisplayPage").data("useMashNavigateForTransitions")?n.navigate({url:null,transitionEffect:"slide",successCallback:function(){H(a,
b,c,g,e)},failCallback:function(a){}}):H(a,b,c,g,e);g.keepCachedPagesData||d.clearCache()}function P(){var a=R("input#isPipelinedPage");return 0<a.length&&"1"===a.val()}function H(d,h,f,G,m){G=G||{};G.pushNewFrame=G.pushNewFrame||"true";G.anchor=G.anchor||void 0;var n=f.getResponseHeader("x-amz-checkout-page");c.setCurrentPage(n);if(G.freshLoad)G.freshLoad=!1,r.when("first-load-dependencies").execute(function(a){H(d,h,f,G)});else if(n){R("head .aui-page-asset").removeAttr("disabled");R("head .old-pipeline-asset").removeAttr("disabled");
var u=f.getResponseHeader("x-amz-checkout-requestid");k.setAsyncRequestId(u);if(u=f.getResponseHeader("x-amz-checkout-redirect"))E({conductoraction:{url:u,type:"redirect"}});else{var u=f.getResponseHeader("x-amz-checkout-url"),w=f.getResponseHeader("x-amz-checkout-additional-page-args");if(p.isAJAXWeblabOn()&&b.isStreamingAjax(f))p.isAjaxStreamingEnabled()?g(n):(K(f),Q(d,n));else if(a.trigger("checkout:unload"),0<R("#checkoutDisplayPage").length?D(d,f):A(d,f),p.isAjaxStreamingEnabled()){var t=R("#pipelinedPageTitle").text(),
V=R("input#executionId").val();P()&&N(n,t,u,V,w,G.anchor,G.pushNewFrame)}p.isAjaxStreamingEnabled()||(t=R("#pipelinedPageTitle").text(),P()&&t&&u&&q.history&&q.history.pushState&&(u=X(u),G.anchor&&(u+=G.anchor),(V=R("input#executionId").val())&&(u=e.addQueryStringParameter(u,"executionId",V)),"true"===G.pushNewFrame&&history.state&&history.state.page!==n&&history.pushState({page:n,additionalURLArgs:w},t,u)));G.anchor&&(n=R(G.anchor),0===n.length&&(n=G.anchor.replace("#",""),n=R(document.getElementsByName(n))),
n.length&&R(document).scrollTop(n.offset().top));G.logUsedPrefetch&&r.when("action-logger").execute(function(a){a.logUsedPrefetch(f.getResponseHeader("x-amz-checkout-page-type"),f.getResponseHeader("x-amz-checkout-sub-page-type"),f.getResponseHeader("x-amz-checkout-requestid"),m)})}}else{if(q.getOldAjaxSuccessCallback)return q.getOldAjaxSuccessCallback("ajaxConductor","generalErrorHandling","generalErrorHandling")(d,h,f);d=l.jsonify(d);E(d)}}function N(a,b,c,d,g,f,h){b&&c&&q.history&&q.history.pushState&&
(c=X(c),f&&(c+=f),d&&(c=e.addQueryStringParameter(c,"executionId",d)),"true"===h&&history.state&&history.state.page!==a&&history.pushState({page:a,additionalURLArgs:g},b,c))}function Q(a,b){a.executeActions();a=R("#pipelinedPageTitle").text();t(a);g(b)}function W(){q.location=ja?"/gp/buy/addtocart/handlers/display.html":"/gp/buy/payselect/handlers/error.html"}function F(c,d,g,e,h){e=e||{};e.refTag=e.refTag||"";e.pushNewFrame=e.pushNewFrame||"true";e.anchor=e.anchor||void 0;e.refTag&&0!==e.refTag.indexOf("/ref\x3d")&&
(e.refTag="/ref\x3d"+e.refTag);c="fromPage\x3d"+c+"\x26page\x3d"+d;(d=R("input#executionId").val())&&(c+="\x26executionId\x3d"+d);g&&(c+="\x26"+g);g=function(){};d=function(){};var k,G;"function"===typeof e.resultscallback?(k=function(a,b,c){e.resultscallback(a,b,c)},G=function(a,b,c){e.resultscallback(void 0,b,a)}):(g=function(b){a.trigger("checkout:beforeLoadPage");pa&&pa.abort();pa=b},k=function(a,c,d){p.isAJAXWeblabOn()&&b.isStreamingAjax(d)||e.callbackBeforePageUpdate&&e.callbackBeforePageUpdate();
M(a,c,d,e);e.callbackAfterPageUpdate&&e.callbackAfterPageUpdate()},G=function(a,b,c){"abort"!==b&&("error"===b&&a.readyState===f.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){q.cordova.exec(null,null,"MASHDisplayErrorPlugin","execute",{})}):(ca(a,b),W()))},d=function(a){pa=null});h={type:"GET",url:(h?h:"/gp/buy/shared/handlers/pipeline-dispatch.html")+e.refTag,data:c,dataType:"text",async:!0,beforeSend:g,success:k,error:G,complete:d,cache:!1};ia&&(h.headers=z({"x-amz-checkout-transition":"ajax"}));
return p.isAJAXWeblabOn()?(h.useXMLHttp=!0,h=p.isAjaxStreamingEnabled()?B(h,e.callbackBeforePageUpdate,e.anchor,e.pushNewFrame):B(h,e.callbackBeforePageUpdate),f.aui(h)):R.ajax(h)}function B(d,g,e,f){d.timeout=5E4;d.data=Y(d.data,"acceptsStreaming\x3d1");var k;k=d.data.match(/.*isAsync=1.*/)?!0:!1;sa=h({$target:R("#checkoutDisplayPage"),updateTriggerEvent:"pageReady",immediateExecution:!k,updateTarget:R("#checkoutDisplayPage"),onUpdate:function(b){"function"===typeof g&&g();a.trigger("checkout:unload");
t(b.title);N(b.page,b.title,b.url,b.executionId,b.additionalURLArgs,e,f||"true");c.setCurrentPage(b.page)}});d.chunk=sa.chunkHandler;if(!p.isAjaxStreamingEnabled()){var G=d.success;d.success=function(a,c,d){G&&b.isStreamingAjax(d)?G(sa,c,d):G&&G(a,c,d)}}return d}function Y(a,b){return a?a+"\x26"+b:b}function ca(a,b){k.increaseCount("Checkout:PageConductor:Ajax:Error");p.isAJAXWeblabOn()?(a?(k.increaseCount("Checkout:AUI:Ajax:jqXHR:defined"),v("jqXHR defined throw CheckoutErrorAW under AJAX Weblab, textStatus:"+
b+" stateCode:"+a.state+" readyState:"+a.readyState)):void 0===a?(k.increaseCount("Checkout:AUI:Ajax:jqXHR:undefined"),v("jqXHR undefined throw CheckoutErrorAW under AJAX Weblab")):null===a&&(k.increaseCount("Checkout:AUI:Ajax:jqXHR:null"),v("jqXHR null throw CheckoutErrorAW under AJAX Weblab")),k.increaseCount("Checkout:AUI:Ajax:Error:textStatus:"+b),k.increaseCount("Checkout:AUI:Ajax:Error:statusCode:"+a.status),k.increaseCount("Checkout:AUI:Ajax:Error:readyState:"+a.readyState)):(a?(k.increaseCount("Checkout:jQuery:Ajax:jqXHR:defined"),
v("jqXHR defined throw CheckoutErrorAW using jQuery, textStatus:"+b+" stateCode:"+a.state+" readyState:"+a.readyState)):void 0===a?(k.increaseCount("Checkout:jQuery:Ajax:jqXHR:undefined"),v("jqXHR undefined throw CheckoutErrorAW using jQuery")):null===a&&(k.increaseCount("Checkout:jQuery:Ajax:jqXHR:null"),v("jqXHR null throw CheckoutErrorAW using jQuery")),k.increaseCount("Checkout:jQuery:Ajax:Error:textStatus:"+b),k.increaseCount("Checkout:jQuery:Ajax:Error:statusCode:"+a.status),k.increaseCount("Checkout:jQuery:Ajax:Error:readyState:"+
a.readyState))}function Z(a,b,c,d){var g=a;b=Y(b,"isClientTimeBased\x3d1");if(p.refactorExtractURL()){var h=e.extractURLParts(a);a=h.normalizedUrl;if(!a)return k.increaseCount("Checkout:PageConductor:submitAjax:url:missingHtml:T1"),v("Unable to normalize url ["+g+"]. Ajax request aborted."),!1;var G=a.indexOf("/gp/buy/");0<G?(a=a.substring(G),k.increaseCount("Checkout:PageConductor:submitAjax:url:removedGpBuy:T1")):k.increaseCount("Checkout:PageConductor:submitAjax:url:missingGpBuy:T1");h.query?(b+=
"\x26"+h.query,k.increaseCount("Checkout:PageConductor:submitAjax:url:hasQueryPart:T1")):k.increaseCount("Checkout:PageConductor:submitAjax:url:missingQueryPart:T1");g=h.refMarker;g||(k.increaseCount("Checkout:PageConductor:submitAjax:url:missingRefMarker:T1"),g="");g&&-1===g.indexOf("ref\x3d")&&(k.increaseCount("Checkout:PageConductor:submitAjax:url:refMarkerMalformed:T1"),g="")}else{h=a.indexOf("?");0<h?(b+="\x26"+a.substring(h+1),a=a.substring(0,h),k.increaseCount("Checkout:PageConductor:submitAjax:url:hasQueryPart:C")):
k.increaseCount("Checkout:PageConductor:submitAjax:url:missingQueryPart:C");G=a.indexOf("/gp/buy/");0<G?(a=a.substring(G),k.increaseCount("Checkout:PageConductor:submitAjax:url:removedGpBuy:C")):k.increaseCount("Checkout:PageConductor:submitAjax:url:missingGpBuy:C");if(-1===a.indexOf(".html"))return k.increaseCount("Checkout:PageConductor:submitAjax:url:missingHtml:C"),v("url ["+g+"] is missing html extension. Ajax request aborted."),!1;h=a.indexOf(".html");g=a.substring(h+5);a=a.substring(0,h+5);
g||k.increaseCount("Checkout:PageConductor:submitAjax:url:missingRefMarker:C");g&&-1===g.indexOf("ref\x3d")&&(k.increaseCount("Checkout:PageConductor:submitAjax:url:refMarkerMalformed:C"),g="")}b+="\x26handler\x3d"+a;a={type:"POST",url:"/gp/buy/shared/handlers/async-continue.html"+g,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:z({"x-amz-checkout-transition":"ajax"}),data:b,dataType:"text",async:!0,success:c,error:function(a,b,c){"abort"!==b&&("error"===b&&a.readyState===
f.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){q.cordova.exec(null,null,"MASHDisplayErrorPlugin","execute",{})}):"function"===typeof d&&(ca(a,b),d()))},cache:!1};return p.isAJAXWeblabOn()?(a.useXMLHttp=!0,B(a),f.aui(a)):R.ajax(a)}function aa(a,b,c,d,g){g=g&&g.action?g.action:a.attr("action");a=a.serialize();d&&(a+="\x26isAsync\x3d1");return Z(g,a,b,c)}function ba(a,b,c,d){a=X(a.attr("href"));d&&(a+="\x26isAsync\x3d1");return Z(a,"",b,c)}function O(a){a=a||{};a.logUsedPrefetch=1;M(da.data,
da.status,da.response,a,da.refMarker)}function X(a){-1===a.toLowerCase().indexOf("hasworkingjavascript")&&(a+=(0<=a.indexOf("?")?"\x26":"?")+"hasWorkingJavascript\x3d1");return a}function fa(a){ta=!1;J&&clearTimeout(J);if(a.is("form"))y(a)?O():aa(a,M,W);else if(a.is("a"))if(ea(a)){var b;1===parseInt(a.data("keepCachedPagesData"),10)&&(b={keepCachedPagesData:1});O(b)}else ba(a,M,W);else r.error("function called without a trigger","page-conductor","handleContinueAction")}function y(a){return a.is("form")&&
null!==da&&da.serializedValue===a.serialize()}function ea(a){return a.is("a")&&null!==da&&X(da.serializedValue)===X(a.attr("href"))}function V(a){return T&&(a.is("form")&&T!==a.serialize()||a.is("a")&&X(T)!==X(a.attr("href")))}function ka(a,c,d,g,h){function f(e,u,t){var V=!0;if("success"===u){if(!p.isAJAXWeblabOn()||!b.isStreamingAjax(t)){var D=l.jsonify(e);null!==D&&D&&D.result&&"noPrefetch"===D.result&&(da=null,V=!1)}V&&(da={},da.serializedValue=w,da.data=e,da.status=u,da.response=t,da.refMarker=
n)}else da=null;ra=!1;ia&&r.when("spp-button-blocker").execute(function(a){a.hideDefaultContinueBtnBlocker()});if(ta)return fa(na),!0;if(V){var K=function(){g?ka(a,c,d,!0,h):G(a)};if(null===da||"form"===m&&da.serializedValue!==a.serialize())return K(),!0;c&&(0===c?k.increaseCount("checkoutPrefetchTimeoutSetToZero",1):J=setTimeout(function(){da=null;K()},1E3*c))}return!0}if(!P()||0===a.length)return!1;var m=a.get(0).tagName.toLowerCase();if("form"!==m&&"a"!==m||"function"===typeof h&&!h(m))return!1;
c=c||0;d=d||0;g=g||!1;if(ra||va>=d)return!1;ra=!0;ia&&r.when("spp-button-blocker").execute(function(a){a.showDefaultContinueBtnBlocker()});va++;J&&clearTimeout(J);var n=e.extractURLParts("form"===m?a.attr("action"):a.attr("href")).refMarker,u,w=null;"form"===m?(w=a.serialize(),u=p.isAJAXWeblabOn()?aa(a,f,f,!0):aa(a,null,null,!0)):"a"===m&&(w=X(a.attr("href")),u=p.isAJAXWeblabOn()?ba(a,f,f,!0):ba(a,null,null,!0));p.isAjaxStreamingEnabled()&&w&&(T=w);"object"!==typeof u||"function"!==typeof u.always||
p.isAJAXWeblabOn()||u.always(f)}function G(a){var b=parseInt(a.data("prefetchTimeout"),10),c=parseInt(a.data("maxPrefetches"),10);return ka(a,b,c,!1,function(b){if(a.find("input:checked").hasClass("no-prefetch"))return!1;if(p.disablePrefetchForScheduledDeliveryWeblabOn()){var c=a.find("div.one-shipment:not(:hidden)").find("input:checked");if(c.parents('[data-a-input-name\x3d"'+c.attr("name")+'"]').hasClass("no-prefetch"))return!1}return"1"===R("input#block-prefetch").val()||"1"===R("input#block-all-prefetch").val()||
"form"===b&&!a.data("checkoutFormReady")?!1:!0})}function za(){var a=c.getCurrentPage();return"payselect"===a||"spp-payment"===a||"pay"===a}function ua(b,c){b&&b.preventDefault();p.isClearTemporaryPreferenceBugFixWeblabOn()&&za()&&w.hasActiveTemporaryPreference&&w.hasActiveTemporaryPreference()&&x();var d=b?R(b.currentTarget):c;b=function(){if(ia){m.blockAllActions();var a=d.data("shrink-panel"),b=d.data("loading-text");(a=R("#"+a))&&a.length?a.hasClass("expanded")||m.shrinkPanel(R(".spp-panel.expanded"),
!1):a=R(".spp-panel.expanded");m.shrinkPanel(a,!0,b)}else m.show()};k.resetMetrics();!ga||y(d)||ea(d)?b():a.delay(b,0);try{ta=!0,na=d,p.isAjaxStreamingEnabled()&&sa&&!V(d)&&sa.enableExecution(),ra||fa(d)}catch(g){b="An error occured while click on the continue button.",g.message&&(b+="  Error message: "+g.message),r.error(b,"page-conductor","continueClicked",g)}}function U(){R("#checkout-btf-spinner").addClass("aok-hidden")}var R=a.$,ra,pa,da,va,ta,na,J,Aa,xa,T,wa=function(a){if(!Aa)throw Error("Member _updatePageContent not set in page-conductor. Make sure 'initFunc' is called.");
return Aa(a)},ia=!1,ja=!1,qa=!1,ga=!1,ha=!1,sa;x();a.declarative("page-transit-no-update-action","click",function(b){if(!qa){b.$event.preventDefault();k.resetMetrics();var e=b.data.targetDeclarativeActionId;if(e&&(e=R("#"+e),e.length)){e.trigger("click");return}var h=b.data.toPage,e=b.data.fromPage||c.getCurrentPage(),f=b.data.refTag||"chk_"+e+"_cancel_pri",G=b.data.args,l=b.$currentTarget.find("a.checkout-pipeline-pref-link");ia&&d.setCachedPageData(e,h);if(d.getCachedPageData(h,e)){k.increaseCount("checkout:"+
e+":cancelpri",1);f=d.getCachedPageData(h,e);x();c.setCurrentPage(f.page);var u;u=p.isAJAXWeblabOn()?wa(f.curPageData):wa(JSON.stringify(f.curPageData));if(ia)if(k.isTransitionLoggingEnabled()){var n=(new Date).getTime();k.logPageTransition(e+"-cached",h,void 0,function(b){b=(new Date).getTime()-n;b<u?a.delay(function(){g(h)},u-b):g(h)})}else a.delay(function(){g(h)},u);else g(h);f.title&&f.url&&q.history&&q.history.pushState&&history.state&&history.state.page!==f.page&&history.pushState(f.state,
f.title,f.url)}else l.length?ua(null,l):(k.increaseCount("checkoutSPPCancelNoCachedData",1),l=function(){if(ia)if(m.blockAllActions(),b.data.noShrink)m.show();else{var a=b.data.loadingText,c=R("#"+b.data.shrinkPanel);c.length||(c=b.$currentTarget.closest("div.spp-panel"));m.shrinkPanel(c,!0,a)}else m.show()},ga?a.delay(l,0):l(),F(e,h,G,{refTag:f,keepCachedPagesData:1}))}});p.isAjaxStreamingEnabled()&&(a.on("checkout:page:atf",function(){m.hide();R("#checkout-btf-spinner").removeClass("aok-hidden")}),
a.on("checkout:page:end",function(){U()}));a.on("ready",function(){ga=0<R("#executeNonBlockingAnimations").length;ha=0<R("#prefetchFromAddressEnabled").length});a.on("checkout:afterReload",function(){m.hide();p.isAjaxStreamingEnabled()&&U();a.delay(k.sendUEPageLoadStats);if(P()){var b=R("form.checkout-page-form:not(:disabled):first"),c=R("a.checkout-continue-link:not(:disabled):first");R("#useFirstActivePrefetch").length&&(c=R("a.checkout-continue-link:not(:disabled)").filter(function(){return 0<
(parseInt(R(this).data("maxPrefetches"),10)||0)}).first());var g=!1;b.length&&(g=G(b));!g&&c.length&&(g=G(c));!g&&ia&&(b=R("a.checkout-pipeline-pref-link:not(:disabled):first"),b.length&&(c=b.data("fromPage"),g=b.data("toPage"),d.getCachedPageData(g,c)||(g=G(b))))}});return{ajaxUpdatePage:M,ajaxRedirect:E,ajaxSorryPage:W,isPageLoadRequestInProgress:function(){return pa?1:0},submitFormAjax:aa,reloadPage:function(){var a=c.getCurrentPage();F(a,a)},loadPage:F,usePrefetch:O,makePrefetch:G,makePrefetchWithParams:ka,
isPrefetchValidFor:function(a){if(null!==da){var b=da.response.getResponseHeader("x-amz-checkout-page");return a===b}return!1},redirect:E,continueClicked:ua,initFunc:function(a,b){Aa=a;xa=b},overrideIsSPP:function(a){ia=a},isSPP:function(){return ia},overrideAddToCart:function(a){ja=a},isAnimating:function(){return qa},overrideIsAnimating:function(a){qa=a},setAjaxTransitionHeader:z,isPipeliningOn:P,disablePageNoUpdateTransition:function(){ha&&r.when("a-button").execute(function(a){var b=R(".spp-panel.expanded").data("stepIndex");
R(".expand-collapsed-panel-trigger").each(function(){var c=R(this),d=c.parents(".spp-panel").data("stepIndex");if(!b||!d||d>b)c.filter(".clickable-heading").removeClass("clickable-heading").addClass("off-clickable-heading"),a(c.filter(".expand-panel-button")).disable(),c.filter("a.expand-panel-button").addClass("disabled-link"),c.parents(".a-declarative").addClass("off-declarative").removeClass("a-declarative")});R(".panel-cancel-row").hide()})},enablePageNoUpdateTransition:function(){ha&&r.when("a-button").execute(function(a){R(".off-clickable-heading").addClass("clickable-heading").removeClass("off-clickable-heading");
a(".expand-collapsed-panel-trigger.expand-panel-button").enable();R(".off-declarative").addClass("a-declarative").removeClass("off-declarative")})},isNonBlockingAnimationEnabled:function(){return ga},isPrefetchFromAddressEnabled:function(){return ha}}});r.when("jQuery","page-transition-controller","ajax-utility","page-detector-current-page","checkout-general-utils","page-conductor","cache-page-data-controller","client-side-metrics","weblab-helper","ready").execute(function(a,m,l,c,e,k,n,d,f){if(k.isPipeliningOn()){q.history&&
a(q).bind("popstate",function(){var b=this.history.state,e=c.getCurrentPage();b&&b.page&&e&&(b.page!==e||k.isPageLoadRequestInProgress())&&(m.show(),e=a("#checkoutDisplayPage"),e.data("wipeOnPipelineBackTransition")&&e.empty(),d.resetMetrics(),a("#useFastBackButton").length&&k.isPrefetchValidFor(b.page)?k.usePrefetch({pushNewFrame:!1}):(e="spc"===b.page?"":b.page,k.loadPage(c.getCurrentPage(),e,b.additionalURLArgs,{refTag:"pipelinedBackButton",pushNewFrame:"false"})))});a(document).delegate("form.checkout-page-form",
"change",function(b){a(b.target).parent().hasClass("no-prefetch-on-change")||(b=a(b.currentTarget),k.makePrefetch(b))});a(document).delegate("form.checkout-page-form","submit",function(a){k.continueClicked(a)});a(document).delegate("a.checkout-continue-link","click",function(a){k.continueClicked(a)});a(document).delegate("form.checkout-page-form .submit-button-with-name","click",function(b){b=a(b.currentTarget);a("\x3cinput\x3e").attr({type:"hidden",name:b.attr("name"),value:b.val()}).appendTo(b.closest("form.checkout-page-form"))});
var h=!1;a(document).delegate("a.pipeline-link, div.pipeline-link, span.pipeline-link a","touchmove",function(a){h=!0});a(document).delegate("a.pipeline-link, div.pipeline-link, span.pipeline-link a","click keypress touchend",function(b){if(h)h=!1,b.preventDefault();else if(e.protectAgainstDoubleAction("pipeline-link"))b.preventDefault();else if("keypress"!==b.type||13===b.which){var c=a(b.currentTarget),f=c.data("pipelineLinkFromPage"),l=c.data("pipelineLinkToPage"),z=c.data("pipelineLinkAnchor"),
x=c.data("pipelineLinkRef");x||((x=e.extractURLParts(c.attr("href")).refMarker)?d.increaseCount("Checkout:PageConductor:LoadPage:AddedRefMarker"):d.increaseCount("Checkout:PageConductor:LoadPage:NoRefMarkerInUrl"));c=c.data("pipelineLinkArgs");l&&(d.resetMetrics(),b.preventDefault(),k.isSPP()&&n.setCachedPageData(f,l),m.show(),b={refTag:x,anchor:z},k.isSPP()&&(b.keepCachedPagesData=1),k.loadPage(f,l,c,b))}});a(document).delegate("a.spclite-dispatch-link","click keypress touchend",function(b){if("keypress"!==
b.type||13===b.which){var c=a(b.currentTarget),d=c.data("spcliteLinkFromPage"),e=c.data("spcliteLinkToPage");c.data("spcliteLinkAnchor");var h=c.data("spcliteLinkRef"),c=c.data("spcliteLinkArgs"),f=a("input#executionId").val(),c=c?c+("\x26executionId\x3d"+f):"executionId\x3d"+f;e&&(b.preventDefault(),m.show(),k.loadPage(d,e,c,{refTag:h},"/gp/buy/shared/handlers/spclite-dispatch.html"))}})}a(document).delegate("input.submit","click touchend",function(){d.resetMetrics()});a(document).delegate("form",
"submit",function(){d.resetMetrics()});a(document).delegate(".panel-cancel-row a, .clickable-heading","click",function(){d.isTransitionLoggingEnabled()&&d.resetMetrics()})});"use strict";r.when("A","a-popover-base","a-popover-util").register("checkout-modal-popover",function(a,m,l){function c(b){return b.disableHide?function(){}:function(){var c=this;c.animating=!0;a.fadeOut(this.$popover,250);b.secondaryPopover||f("#a-popover-modal").hide();a.delay(function(){c.animating=!1},250)}}function e(a,b){var d=
c(b);a=a.$event.triggerPositioningElement?a.$event.triggerPositioningElement:a.$declarativeParent;(h=m.show({$trigger:a,name:b.name,skin:p(b.header,b.closeButton,b.closeTextOverride),content:b.content,url:b.url,data:b.data,update:v,alone:b.alone?"true"===b.alone:!0,position:b.position||"triggerVertical",hide:d}))&&h.$trigger!==a&&(h.$trigger=a,h.updatePosition())}function k(a,d){d.disableHide=!0;var e=c(d);b=!1;(d=m.show({$trigger:a.$declarativeParent,skin:w(d.header,d.footer,d.closeButton,d.contentClass),
name:d.name,requestURL:d.url,position:"windowCenter",update:v,data:d.data,updatePosition:d.allowScrollOnPage?z:x,modal:!0,alone:d.alone?"true"===d.alone:!0,show:function(){this.animating=!0;this.$popover.show();f("#a-popover-modal").show();this.animating=!1},hide:e}))&&d.$trigger!==a.$declarativeParent&&(d.$trigger=a.$declarativeParent,d.updatePosition())}function n(b){var c=b.$declarativeParent;a.delay(function(){d(b,c)},250)}function d(b,c){h&&(l.eventOccursWithin(b,c)||l.eventOccursWithin(b,h.$popover))?
a.delay(function(){d(b,c)},250):m.hide(c)}var f=a.$,h,b=!1,p=function(a,b,c){return function(d){var e=c;void 0===c&&(e=f("input#closeButtonText").val()||"");var h="";e&&(h='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+e+"\x3c/a\x3e\x26nbsp;");e="false"===b?"":['\x3cdiv class\x3d"popover-close-section"\x3e',h,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");
return['\x3cdiv class\x3d"a-popover"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',a||e?['\x3cdiv class\x3d"a-popover-header"\x3e\x3ch4\x3e',a,"\x3c/h4\x3e",e,"\x3c/div\x3e"].join(""):"",'\x3cdiv class\x3d"a-popover-inner"\x3e',d,'\x3c/div\x3e\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}},w=function(a,b,c,d){return function(e){var h=f("input#closeButtonText").val()||"",p="";h&&(p='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+
h+"\x3c/a\x3e\x26nbsp;");h="false"===c?"":['\x3cdiv class\x3d"popover-close-section"\x3e',p,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");h=a||h?['\x3cdiv class\x3d"a-popover-header huawei-device-header-fix"\x3e\x3ch4\x3e',a,"\x3c/h4\x3e",h,"\x3c/div\x3e"].join(""):"";p="";if(b){var k=f("#a-popover-footer-"+b);0<k.length&&(p=['\x3cdiv class\x3d"a-popover-footer"\x3e',
k.html(),"\x3c/div\x3e"].join(""))}return['\x3cdiv class\x3d"a-popover a-popover-modal"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',h,'\x3cdiv class\x3d"a-popover-inner ',d,'"\x3e',e,"\x3c/div\x3e",p,'\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}};a.declarative("custom-popover-close",["click","touchend"],function(b){b.$event.preventDefault();var c=b.$target;f("html").hasClass("a-ie6")||f("html").hasClass("a-ie7")||
f("html").hasClass("a-ie8")?c.closest(".a-popover").hide():a.fadeOut(c.closest(".a-popover"),250);f("#a-popover-modal").hide();a.trigger("a:declarative:a-popover-close:click",{$target:c,$event:b.$event,$currentTarget:b.$currentTarget})});a.on("a:popover:positionUpdated",function(a){a=a.popover.$popover;0>a.offset().left&&a.offset({left:0});0>a.offset().top&&a.offset({top:0})});a.on("a:popover:show",function(a){if(a.popover&&a.popover.$trigger){var b=a.popover.$trigger.data("aCheckoutModalPopover");
b&&b.allowScrollOnPage&&a.popover.$popover.css("position","absolute")}});var v=function(a){f(".a-popover-inner",this.$popover).html(a)},z=function(a){if(!b||a)x.call(this,!0),b=!0},x=function(a){var b=f(q),c=b.height()/2,d=b.width()/2,e=this.$popover.height()/2,h=this.$popover.width()/2,c=c-e;if(a||"fixed"!==this.$popover.css("position"))c+=b.scrollTop();a=Math.max(0,d-h);c=Math.max(0,c);this.$popover.css({top:c,left:a})};a.declarative("a-checkout-popover",["click","mouseenter","mouseleave","keyup",
"touchend"],function(a){a.data.showOnHover&&"touchend"!==a.type?"mouseenter"===a.type||"click"===a.type?e(a,a.data):"mouseleave"===a.type&&n(a):("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&e(a,a.data)});a.declarative("a-checkout-modal-popover",["click","keyup","touchend"],function(a){("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&k(a,a.data)});a.on("checkout:reload",function(){a.defer(function(){0===f("#a-popover-modal").length&&
f("body").append('\x3cdiv id\x3d"a-popover-modal" /\x3e')})});return{hideById:function(a){m.hide(a)},createModal:k}});"use strict";(function(){var a=!1;r.when("A").register("page-detector",function(m){function l(){return c("checkout-as")}function c(a){d||(d={});d.hasOwnProperty(a)||(d[a]=0<n("div."+a).length);return d[a]}function e(){return c("checkout.pay")}function k(){return c("checkout.spc")}var n=m.$,d;m.on("checkout:reload",function(){d={};a||r.when("page-detector-current-initializer").execute(function(a){a.initializeDetectorWithCurrentPage(null)})});
return{isAddressSelect:l,isAddressTranslation:function(){return c("translate-address-form")},isDesktopPayment:function(){return e()&&c("pay-desktop")},isDesktopSpc:function(){return k()&&c("spc-desktop")},isMobileAddressSelect:function(){return l()&&c("checkout-as-mobile")},isMobilePayment:function(){return e()&&c("pay-mobile")},isMobileSpc:function(){return k()&&c("spc-mobile")},isTabletAddressSelect:function(){return l()&&c("checkout-as-tablet")},isTabletPayment:function(){return e()&&c("pay-tablet")},
isTabletSpc:function(){return k()&&c("spc-tablet")},isSpcLite:function(){return k()&&c("spclite")},isPayment:e,isSosp:function(){return c("checkout.sosp")},isSpc:k,isMobile:function(){return c("checkout.mobile")},isTablet:function(){return c("checkout.tablet")}}});r.register("page-detector-current-initializer",function(){return{initializeDetectorWithCurrentPage:function(m){if(!a){var l=m;r.register("page-detector-current-page",function(){return{getCurrentPage:function(){return l},setCurrentPage:function(a){var e=
l;l=a;r.when("A").execute(function(k){k.trigger("page-detector:page-changed",e,a)})}}});a=!0}}}})})();"use strict";r.when("jQuery","loading-spinner-controller").register("page-spinner-controller",function(a,m){function l(){"function"===typeof z.blockAllActions&&z.blockAllActions()}function c(){"function"===typeof z.unblockAllActions&&z.unblockAllActions()}function e(a){"function"===typeof z.showTransitionInContainer&&z.showTransitionInContainer(a)}function k(){var b=a(q).width(),c=a(q).height(),d=
a(q),e=0;null!==v&&(e=v.outerHeight()-a(q).scrollTop(),0>e&&(e=0));p.css("top",d.scrollTop()+e+"px").css("left",d.scrollLeft()+"px").width(b).height(c);"1"!==a("input[name\x3dfromAnywhere]").val()&&a("#loading-spinner-blocker-doc").css("top",d.scrollTop()+e+"px").css("left",d.scrollLeft()+"px").width(b).height(c)}function n(){var b;b=document.activeElement?a(document.activeElement):a(":focus:first");b.is("button, a, input:enabled")&&b.blur()}function d(){if(x){l();r.when("spp-button-blocker").execute(function(a){a.hideContinueBtnBlocker()});
var c=a(".spp-panel.expanded");if(0<c.length&&c.is(":visible")){e(c,1);return}}if(w)return p.length&&p.find(".loading-spinner-inner").show(),!1;w=!0;n();p=a("#spinner-anchor");p.find(".loading-spinner-inner").show();a("#unblockHeader").length&&(v=a("#header"));h=p.css("z-index");a(q).unbind("scroll.checkout-page-spinner").bind("scroll.checkout-page-spinner",function(a){b&&q.clearTimeout(b);b=setTimeout(function(){k();b=null},50)});a(q).unbind("resize.checkout-page-spinner").bind("resize.checkout-page-spinner",
function(){k();m.adjustSize(p)});a(q).unbind("orientationchange.checkout-page-spinner").bind("orientationchange.checkout-page-spinner",function(){k();m.adjustSize(p)});k();p.show();p.css("z-index",2E3);m.showSpinner(p,!0);return!0}function f(){if(x)c(),"function"===typeof z.hideSpinner&&z.hideSpinner();else{a("#first-pipeline-load-page-spinner").remove();if(!w)return!1;w=!1;p.length&&p.find(".loading-spinner-inner").show();p&&(a(q).unbind(".checkout-page-spinner"),p.hide(),p.css("z-index",h),m.hideSpinner(p));
return!0}}var h,b=null,p,w=!1,v=null,z={},x=!1;return{show:d,showPageTransition:function(){return"0"===a("#showPageTransition").attr("content")?!1:d()},hide:f,hidePageTransition:function(){"0"===a("#showPageTransition").attr("content")&&f();return!0},hideAnimatedSpinnerImage:function(){p.length&&p.find(".loading-spinner-inner").hide()},initFunc:function(a){null!==a&&(z=a,x=!0)},blockAllActions:l,unblockAllActions:c,showTransitionInContainer:e,shrinkPanel:function(a,b,c){"function"===typeof z.shrinkPanel&&
z.shrinkPanel(a,b,c)},clearFocus:n}});"use strict";r.when("A").execute(function(a){a=a.$;var m="",m="mash-transitions"===a("input[name\x3dpageTransitionType]").val()?"page-mash-transition-controller":"page-spinner-controller";r.when(m).register("page-transition-controller",function(a){r.when("A").execute(function(c){c.declarative("page-spinner-show",["click"],{allowLinkDefault:!0},function(c){c=c.$target;c.hasClass("a-button-disabled")||c.closest(".a-button-disabled").length||a.showPageTransition()})});
r.when("A").execute(function(c){c.declarative("page-spinner-show-on-submit",["submit"],{allowLinkDefault:!0},function(c){a.showPageTransition()})});return{show:a.show,hide:a.hide,showPageTransition:a.showPageTransition,hidePageTransition:a.hidePageTransition,blockAllActions:a.blockAllActions,unblockAllActions:a.unblockAllActions,showTransitionInContainer:a.showTransitionInContainer,shrinkPanel:a.shrinkPanel}})});"use strict";r.when("A","page-conductor","client-side-metrics","page-detector-current-page",
"a-popover","ready").execute(function(a,m,l,c){function e(a,c,e){m.isSPP()&&l.setmarker&&l.setmarker("af");l.sendUEPageLoadStats()}var k=a.$,n=!1;a.on("a:popover:afterHide",function(a){a.popover&&(n=!1)});a.on("a:popover:beforeShow",function(a){var c=a.popover;c&&(n=!0,c.$trigger.find(".modal-parameters").each(function(){k.each(k(this).data(),function(a,b){c.attrs(a,b)})}))});a.on("a:popover:dismiss",function(a){a=a.popover;if(l.isTransitionLoggingEnabled()&&a&&n){n=!1;var f,h;"prime-acquisition-spc-popover"===
a.name&&(f="prime-acquisition",h=c.getCurrentPage());f||h||!a.attrs||(f=a.attrs("returnfrom"),h=a.attrs("returnto"));f&&h&&(l.resetMetrics(),l.logPageTransition(f,h,e))}})});"use strict";r.when("weblab-helper").execute(function(a){function m(a,c,e,k){function m(){"function"===typeof q.uet&&"function"===typeof q.uex&&(q.uet("cf","first-load-dependencies-ready",{wb:1}),q.uex("ld","first-load-dependencies-ready",{wb:1}));a.trigger("checkout:beforeReload");a.trigger("checkout:reload");f&&("spp-revieworder"===
f?a.trigger("checkout:reload:spc"):a.trigger("checkout:reload:"+f));a.trigger("checkout:afterReload");setTimeout(function(){var a=d("#first-pipeline-load-page-spinner");a.is(":visible")&&(a.remove(),e.logError("The page has taken more than 90 seconds to load, or there was a JS error preventing it from loading, hiding page spinner."))},9E4)}var d=a.$,f=c.getCurrentPage();"function"===typeof q.uet&&q.uet("bb","first-load-dependencies-ready",{wb:1});return{allDependenciesCheck:function(a){if(a&&a.length){var b=
!1,c={};d.each(a,function(a,b){c[b]=1;r.when(b).execute(function(){delete c[b]})});var l=function(a){a="Page ("+f+") is missing dependencies ["+a.join(", ")+"] after 5 secs.";k.increaseCount("checkout:dependency:missed:regular-page:error");e.logErrorOnLevel(a,"ERROR")},v=setTimeout(function(){if(!b){var a=[];d.each(c,function(b){a.push(b)});k.increaseCount("checkout:dependency:missed");0<d("#assets-prefetch").length?k.increaseCount("checkout:dependency:missed:assets-prefetch"):(k.increaseCount("checkout:dependency:missed:regular-page"),
l(a));m()}},5E3);r.when.apply(r,a).execute(function(){b=!0;q.clearTimeout&&v&&q.clearTimeout(v);m()})}else m()}}}/T1|T2/.test(a.getFixFederatedAssetsInjectionTimingIssueTreatment())?r.when("A","page-detector-current-page","checkout-general-utils","client-side-metrics").register("first-load-dependencies-base",m):r.when("A","page-detector-current-page","checkout-general-utils","client-side-metrics","afterReady").register("first-load-dependencies-base",m)});"use strict";r.when("A","page-detector","client-side-metrics").register("gift-utility",
function(a,m,l){var c=a.$,e=/[^\s\u0020-\u007E\u00A0-\u00FF]/g,k=q.P&&q.P.AUI_BUILD_DATE,n=/((?:file|https?|ftps?|sip):\/\/)/im,d=/((?:\b|[\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?])www\.(?:(?:[^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?]+\.[^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?]+))+)(?:[\s!@#$%^&*()_=+[\]{}\|;:'",<>\?]|$|\b)/im,f=/([^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?\/]+\.(?:[a-z][a-z]|aero|arpa|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|om|pro|qa|tel|travel|xxx)(?:\b|$))/im,h=/^\S+\@\S+\.\S+$/im;
return{getInput:function(a){return a.is("input")?a:a.find("input")},getCharCount:function(a,c){return c?q.unescape(encodeURIComponent(a)).length:a.length},getLineCount:function(a,c){var d=a.split("\n").length;c=Math.floor(c);a=a.split("\n");for(var e=0;e<a.length;e++)a[e].length>c&&(d+=Math.floor(a[e].length/c),0===a[e].length%c&&d--);return d},getNameWithNoTitle:function(a){var c=!1;a=a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(c=!0);c&&a.shift();return a.join(" ")},
getFirstName:function(a){var c=!1;a=a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(c=!0);c&&a.shift();return a.shift()},toggleGiftMessageWarning:function(a,d){var h=d.find(".gift-message-warning");if(e.test(a.val())){var f=d.find(".gift-message-preview-trigger"),m=a.val().replace(e,"?");k?r.when("a-popover").execute(function(a){var b=a.get(f);b?b.update({content:m}):a.create(f,{inlineContent:m,position:"triggerVertical",closeButton:"false"})}):(l.increaseCount("removeauijs13"),
f.unbind("click.preview").bind("click.preview",function(a){r.when("a-popover-base").execute(function(b){var d=c(a.target);d.data("popoverid")&&(b=b.get(d.data("popoverid")))&&(b.update(m),b.updatePosition())})}));a.addClass("a-form-error");h.show()}else a.removeClass("a-form-error"),h.hide()},valueContainsUrl:function(a){return n.test(a)||d.test(a)||f.test(a)},isValidEmail:function(a){return h.test(""+a)}}});"use strict";r.when("A","page-detector","safe-mash","client-side-metrics").register("help-popup",
function(a,m,l,c){function e(){if(k("div#help-popover").length){k(q).unbind("resize.checkout-help-popover");var a=k("#help-popover-frame")[0];k(a.contentWindow?a.contentWindow:a.contentDocument.defaultView).undelegate("a","click");k("div#help-popover").remove()}}var k=a.$;m=m.isMobile();c=k("input#isPipelinedPage");c=0<c.length&&"1"===c.val();var n=m&&c&&l&&l.navigate;a.declarative("help-popup",["click"],function(a){if(!k(".a-touch").length||n){a.$event.preventDefault();a.data&&"1"===a.data.stopPropagation&&
a.$event.stopPropagation();var c=a.$target.closest("a").attr("href");a=a.data;n?l.navigate({url:c,transitionEffect:"slide"}):(a.width||(a.width="340"),a.height||(a.height="340"),q.open(c,"AmazonHelp","width\x3d"+a.width+",height\x3d"+a.height+",left\x3d10,top\x3d10,resizable\x3dyes,scrollbars\x3dyes,menubar\x3dno,toolbar\x3dyes,location\x3dno,directories\x3dno,status\x3dyes"))}else q.open(a.$target.closest("a").attr("href"),"AmazonHelp")});if(n)a.on("checkout:reload",e)});"use strict";r.when("jQuery",
"page-conductor").register("quantity-service",function(a,m){function l(c,e){e=e||{};var k;e.additionalData&&(k=e.additionalData);var l="/gp/buy/pipeline/handlers/update-quantity.html",d={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};k&&k.deletePrimeMembership&&k.primeMembershipASIN&&(d.deletePrimeMembershipItemIn=k.deletePrimeMembership,d.deletedPrimeMembershipASINIn=k.primeMembershipASIN);e.ref&&(l+="/ref\x3d"+e.ref,delete e.ref);k=e.success;delete e.success;
var f=m.ajaxRedirect;e.error&&(f=e.error,delete e.error);a.extend(d,e);e=[];for(var h in c)void 0!==c[h]&&(e.push(h),d[h]=c[h]);d.entityids=e;c=m.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"});a.ajax({type:"POST",url:l,data:a.param(d,!0),dataType:"text",async:!0,cache:!1,headers:c,success:k,error:f})}return{callBatch:function(a,e){l(a,e)},call:function(a,e,k){var m={};m[a]=e;l(m,k)}}});"use strict";r.when("jQuery").register("scroll-controller",function(a){return{scrollToTop:function(){a(q).scrollTop(0)},
toggleScrollOn:function(){a(document).unbind("touchmove")},toggleScrollOff:function(){a(document).bind("touchmove",function(a){a.preventDefault()})}}});"use strict";r.when("A","checkout-general-utils","ready").execute(function(a,m){a.$("#checkout-mash-will-load").length?r.when("mash").execute(function(a){var c;"object"===typeof a?c=a:q.amazon&&q.amazon.mash&&(c=q.amazon.mash);"object"!==typeof c?m.logError("MASH is expected but can't be found"):r.register("safe-mash",function(){return c})}):r.register("safe-mash",
function(){})});"use strict";r.when("A","scheduled-delivery-external-interface","shipping-speed-selection-controller","page-detector","ready").register("scheduled-delivery-controller",function(a,m,l,c){var e=a.$,k={};l=function(){k={};e("div.fake-label input[type\x3d'radio']:checked").each(function(){var a=e(this),c=a.closest("div.fake-label");(c=m.getSdWidgetRootId(c))&&(k[a.attr("name")]=c)})};a.on("checkout:reload:shipoptionselect",l);a.on("checkout:reload:spp-revieworder",l);c.isSosp()&&l();e(document).delegate("div.fake-label",
"click",function(){if(c.isSosp()){var l=e(this),d=l.find("input[type\x3d'radio']");d.attr("disabled")||(d=d.attr("name"),l=m.getSdWidgetRootId(l),a.trigger("scheduled-delivery:ship-option-changed",{current:l,previous:k[d]}),k[d]=l)}});e(document).delegate(".ship-option.is-scheduled-delivery","click",function(){if(c.isSpc()){var k=e(this);k.find("input[type\x3d'radio']").attr("disabled")||(k=m.getSdWidgetRootId(k))&&a.trigger("scheduled-delivery:ship-option-changed",{current:k,previous:null})}});a.on("scheduled-delivery:unblock-continue",
function(){r.when("button-blocker").execute(function(a){a.hide("scheduled-delivery")})});a.on("scheduled-delivery:block-continue",function(a){r.when("button-blocker").execute(function(c){c.show("scheduled-delivery",a)})});a.on("scheduled-delivery:disable-ship-option",function(a,d){var f;a=e("#"+a);if(0!==a.length){if(c.isSpc())a=a.closest(".shipping-speed");else if(c.isSosp())a=a.closest("div.fake-label.a-box");else return;f=a.find("input[type\x3d'radio']");f.attr("disabled",!0);f.is(":checked")&&
d&&(d=e("input[name\x3d"+f.attr("name")+"]:radio:not(:disabled):first"),d.prop("checked",!0),d.trigger("change"));a.addClass("sd-disabled")}});a.on("scheduled-delivery:enable-ship-option",function(a){var d;a=e("#"+a);if(0!==a.length){if(c.isSpc())a=a.closest(".shipping-speed");else if(c.isSosp())a=a.closest("div.fake-label.a-box");else return;d=a.find("input[type\x3d'radio']");d.removeAttr("disabled");a.removeClass("sd-disabled")}})});"use strict";r.when("A","ready").register("mobile-nav-bar-back-controller",
function(a){a.capabilities.history&&(a=a.$,a=a("#mobile-top-bar-navigation-back"),1<=a.length&&a.click(function(a){a.preventDefault();q.history.back()}))});"use strict";r.when("A","page-spinner-controller","page-detector","page-conductor","weblab-helper","ready").execute(function(a,m,l,c,e){function k(a,b){var c=[];a.addressId||c.push("addressId");a.slotKey||c.push("slotKey");a.shippingOfferingId||c.push("shippingOfferingId");a.conflictItems&&!p.isArray(a.conflictItems)&&c.push("conflictItems");if(0<
c.length){a="Error calling fresh widget callback on "+b+": Bad or Missing Input: "+c[0];for(b=1;b<c.length;b++)a+=", "+c[b];console.error(a);return 0}return 1}function n(){p("#freshSlotKey").val("");p("#freshAddressId").val("");p("#freshReservationToCancel").val("");p("#freshConflictingItems").val("");p("#freshShipOfferingId").val("")}function d(a){var b="",c=e.sospPartialAvailabilityWeblabOn();if(a&&p.isArray(a)&&0<a.length)for(var b=a[0].asin+":"+a[0].merchantId+(c?"|"+a[0].maxQtyAvailable:""),
d=1;d<a.length;d++)b+="-"+a[d].asin+":"+a[d].merchantId+(c?"|"+a[d].maxQtyAvailable:"");return b}function f(a){var b;b="page\x3dspc\x26returnFullHTML\x3d1\x26callSetters\x3d1\x26freshSlotKey\x3d"+a.addressId;b+="\x26freshAddressId\x3d"+a.slotKey;a.reservationToCancel&&(b+="\x26freshReservationToCancel\x3d"+a.reservationToCancel);(a=d(a.conflictItems))&&(b+="\x26freshConflictingItems\x3d"+a);a=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});m.show();p.ajax({type:"POST",url:"/gp/buy/shared/handlers/handle-fresh-widget-results.html/ref\x3dset-fresh-information",
data:b,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,b,d){return d.getResponseHeader("x-amz-checkout-page")?c.ajaxUpdatePage(a,b,d):c.redirect(a)},error:function(a,b,d){c.ajaxRedirect(a,b,d)}})}function h(){p(".sosp-continue-button").removeClass("js-hide").removeClass("aok-hidden");p(".continue-button-blocker").addClass("aok-hidden")}function b(){p(".sosp-continue-button").addClass("aok-hidden");p(".continue-button-blocker").removeClass("aok-hidden")}var p=a.$;a.on("handle-fresh-results",
function(a){if(p("#isfresh").val())if(a)if(l.isSosp())if(k(a,"sosp")){p("#freshSlotKey").val(a.slotKey);p("#freshAddressId").val(a.addressId);p("#freshReservationToCancel").val(a.reservationToCancel);var e=d(a.conflictItems);p("#freshConflictingItems").val(e);p("#freshShipOfferingId").val(a.shippingOfferingId);e&&0<e.length?p("input#block-prefetch").val(1):p("input#block-prefetch").val(0);e=p("#shippingOptionFormId");a.conflictItems&&0<a.conflictItems.length||c.makePrefetch(e);h()}else n(),b();else l.isSpc()?
k(a,"spc")&&f(a):console.error("remote fresh widget JS callback called on unsupported page.");else console.error("remote fresh widget JS callback called with empty data.");else console.error("remote fresh widget JS callback called without isfresh flag on page")});a.on("block-continue",function(a){p("#isfresh").val()?a?"undefined"===typeof a.blockContinue?console.error("block continue callback - missing blockContinue"):l.isSosp()?1===a.blockContinue?(b(),n()):0===a.blockContinue?h():console.error("block continue callback - invalid value"):
console.error("block continue callback called on unsupported page."):console.error("block continue callback called with no argument"):console.error("block continue callback called without isfresh flag on page")});a.on("confirm-and-continue",function(){p("div.sosp-fresh #shippingOptionFormId").submit()});a.on("redirect-to-spc",function(){c.redirect({conductoraction:{url:'/gp/buy/spc/handlers/display.html/ref\x3d"cancel-fresh-address-select"',type:"redirect"}})})});"use strict";r.when("A","ready").execute(function(a){function m(){(0<
l(".change-preference-block").length||0<l(".mobile-change-preference-block").length)&&!1===c&&(r.register("loadVasRcxCheckoutAsset",function(){}),c=!0)}var l=a.$,c=!1;m();a.on("checkout:reload:spc",m);a.on("checkout:reload:shipoptionselect",m);a.on("checkout:reload:spp-revieworder",m)});"use strict";r.register("time-left-formatter",function(){function a(a,c,e,k,m){return 0>=c?a:a+c+" "+(1===c?m.HOUR:m.HOURS)+(!k&&0<e?" "+m.AND+" ":"")}function m(a,c,e,k,m){return 0>=c?a:a+c+" "+(1===c?m.MINUTE:m.MINUTES)+
(!k&&1>e?" "+m.AND+" ":"")+(1===k&&1>e?" ":"")}return{getTimeLeftFormatted:function(l,c,e){var k="",n=86400<l?(l-l%86400)/86400:0,d=3600<l?(l-l%3600)/3600:0;l-=3600*d;var f=60<l?(l-l%60)/60:0;l-=60*f;if(c&&0<n)return k+n+" "+(1===n?e.DAY:e.DAYS);if(c&&0<d)return a(k,d,f,c,e);if(c&&5<=f)return m(k,f,d,c,e);k=a(k,d,f,c,e);k=m(k,f,d,c,e);1<=d||(k=k+l+" "+(1===l?e.SECOND:e.SECONDS));return k}}});"use strict";r.when("A","page-transition-controller","checkout-general-utils","page-detector","page-detector-current-page",
"safe-mash","loading-spinner-controller","weblab-helper").register("shipoptionselect-controller",function(a,m,l,c,e,k,n,d){function f(a){var b=x(".delivery-window-groups .more-window");n.showSpinner(b,!1);a=a.$currentTarget.closest(".delivery-window-groups").data("orderid");b=x("input[name\x3dlineItemEntityIds_"+a+"]").attr("value");x.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/long-calendar-content.html",data:"lineitemids\x3d"+b+"\x26orderid\x3d"+a+"\x26isMobile\x3d1\x26fromPage\x3dsosp",dataType:"json",
async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:function(a){n.hideSpinner();if(a&&a.deliveryWindowGroups){var b=x(".delivery-window-groups .a-box-group");b.empty();x.each(a.deliveryWindowGroups,function(a,c){b.append(c)});a=x(".delivery-window-groups .selected-group");a.length&&a.trigger("click")}}})}function h(a,b){var c=x("div.one-shipment:visible");a=A?x("div.one-shipment").slice(parseInt(a,10),parseInt(b,10)+1):x("div.one-shipment#"+a);g&&0!==a.size()&&c.last().attr("id")!==a.last().attr("id")&&
(c.hide(),a.show(),x(q).scrollTop(0))}function b(){if(g){var a=(location.hash?location.hash.replace("#",""):"0-"+K).split("-");2===a.length&&h(a[0],a[1])}}function p(){function f(a,b){x.ajax({type:"POST",url:"/gp/buy/gift/handlers/remove-gift-option.html",data:b,dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:a,error:function(a,b,c){m.hide()}})}function p(a){var b=a.closest("div."+n);a.is(":checked")?(b.siblings("div."+n+".selected").removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),
b.addClass("selected").find(".a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active")):b.removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");v("triggerChangeEvent",[a])}0<x(".prime-calendar-container").length&&x(".prime-calendar-container").contents().each(function(a,b){8===b.nodeType&&x(b).replaceWith(b.nodeValue)});var l=x(".delivery-window-groups .selected-group");
l.length&&l.trigger("click");t=x(".sosp-continue-button");g="1"===x("#isClientSidePagingEnabled").val()?1:0;K=(x("div.one-shipment:visible").length-1).toString();u="1"===x("#useMashNavigateForClientSidePaging").val()?1:0;A="1"===x("#collapseDigitalShipmentsEnabled").val()?1:0;var n=(l=q.P&&q.P.AUI_BUILD_DATE)?"selectable-box":"fake-label";g&&(x(".one-shipment:gt("+K+")").hide(),b());t.bind("click",function(b){function g(a,b){var c=e.getCurrentPage();if(q.history&&q.history.pushState){var d=location.href;
0<d.indexOf("#")&&(d=d.substring(0,d.indexOf("#")));d+="#"+a.attr("id")+"-"+b.attr("id");history.pushState({page:c,id:a.attr("id")},x("title"),d)}}var f=!1;x("div.one-shipment:visible input[type\x3d'radio'][checked]").each(function(){if(x(this).data("blockingOn"))return alert(x(this).data("blockingOn")),b.preventDefault(),f=!0,!1});if(f)return!1;if(d.removesGiftOptionOnRush()&&c.isMobile()&&null!=L){var p=x("div.one-shipment:visible"),l=p.find("input[type\x3d'radio']:checked").closest(".shipping-option");
if("1"===p.find("input[type\x3dhidden][name\x3disGiftWrapped]").attr("value")&&1===l.data("nosupportforgiftoption"))return L.show(),!1}w();p=x("div.one-shipment:visible");l=p.nextAll("div.one-shipment:hidden");if(0<l.length){b.preventDefault();var m=l.first(),n=m;A&&(n=l.filter(".shipment-with-ship-options"),n=1<n.length?n.eq(1).prev():l.last());u&&k&&k.navigate?k.navigate({url:null,transitionEffect:"slide",successCallback:function(){g(m,n)},failCallback:function(a){}}):g(m,n);h(m.attr("id"),n.attr("id"));
a.trigger("active-shipment-changed")}z("logInlineCalMetrics",[p])});x(".gift-option-removal-cancel-button").bind("click",function(a){L.hide()});x(".gift-option-removal-confirm-button").bind("click",function(a){m.show();L.hide();a="lineItemsToRemoveGiftOptionFrom\x3d"+x("div.one-shipment:visible").find("input[name^\x3dlineItemEntityIds_]").attr("value");var b=x("div.one-shipment:visible"),c=b.nextAll("div.one-shipment:hidden");f(function(a,d,e){b.find("input[type\x3dhidden][name\x3disGiftWrapped]").each(function(){x(this).remove()});
0<c.length?(t.click(),m.hide()):x(".checkout-page-form").submit()},a)});x(q).bind("popstate",function(a){c.isSosp()&&b()});x(document).delegate("div."+n,"click",function(a){a=x(this);a.find("input[type\x3d'radio']").trigger("change",["setActive"]);a.parent().hasClass("timeslot-picker")&&(a=a.find(".a-button-selected").length,t&&t.length&&(a?t.removeClass("a-button-disabled").addClass("a-button-primary").find("input").prop("disabled",!1):t.removeClass("a-button-primary").addClass("a-button-disabled").find("input").prop("disabled",
!0)))});var r;a.declarative("faster-than-same-day-sosp-save",["click","submit"],function(){var b="lineItemsToRemoveGiftOptionFrom\x3d"+r.closest(".one-shipment").find("input[name^\x3dlineItemEntityIds_]").attr("value");a.$("div.a-popover button.a-button-close").trigger("click");m.show();f(function(a,b,c){r.closest(".one-shipment").find(".isGiftWrapped").each(function(){x(this).remove()});r.attr("checked",!0);p(r);m.hide()},b)});x(document).delegate("div."+n+" input[type\x3d'radio']","change",function(a,
b){a=x(this);if("setActive"===b&&!a.attr("disabled")&&d.removesGiftOptionOnRush()&&0<a.closest(".one-shipment").find(".isGiftWrapped").length&&1==a.data("nosupportforgiftoption"))r=a,a.is(":checked")&&(b=a.closest("div."+n).siblings("div."+n+".selected").find('input[type\x3d"radio"]'),r.attr("checked",!1),b.attr("checked",!0)),setTimeout(function(){x("#faster-than-same-day-sosp-popover").trigger("click")},10);else{if("setActive"===b){if(a.attr("disabled"))return;a.attr("checked",!0)}if("disabling"===
b)if(a.attr("disabled",!0),a.is(":checked"))a.removeAttr("checked");else return;p(a)}});x("div."+n+" input[type\x3d'radio']:checked").change();x("h3").children().removeAttr("style");0===x("div."+n+".scheduled-delivery").length&&x("form.checkout-page-form").data("checkoutFormReady",!0).change();l&&x(document).delegate(".a-touch-radio a","click",function(a){if(!d.isSOSPExclusiveJSHandlerWeblabOn()||c.isSosp())k&&k.navigate?k.navigate({url:x(a.target).attr("href"),transition:"slide"}):a.preventDefault=
!1})}function w(){if(1===x("div.store-upsell-ship-options").length){var a="/gp/buy/shared/handlers/store-upsell-async.html",b="ox_store_upsell_continue_",c=x("div.ship-speed, div.store-upsell-ship-options").find("input.shipping-option, input.store-upsell-ship-option"),d=[],e;x.each(c,function(a,c){a=x(c);c=a.attr("value");d.push(c.toLowerCase());a.is(":checked")&&(e=a.attr("value"),b=a.hasClass("store-upsell-ship-option")?b+"success":b+"failure")});a=l.addQueryStringParameter(a,"ref",b);x.ajax({url:a,
type:"POST",async:!0,data:{shown:d.toString(),clicked:e}})}}function v(a,b){r.when("checkout-federation-wrapper","shipspeed-provider").execute(function(c,d){c.wrap(function(){d&&!x.isEmptyObject(d)&&"function"===typeof d[a]&&d[a].apply(this,b)},"VasCheckoutShipSpeedProvider")})}function z(a,b){r.when("checkout-federation-wrapper","sd-methods").execute(function(c,d){c.wrap(function(){d&&!x.isEmptyObject(d)&&"function"===typeof d[a]&&d[a].apply(this,b)},"CricketInlineCalendarHeavyBulkyIN")})}var x=
a.$,t,g,u,K,A=0,L;a.declarative("sosp-change-quantity-link",["click"],function(a){var b=a.$currentTarget,c=x("\x3cinput type\x3d'hidden' /\x3e").attr("name","change-quantities-or-delete").val("1");b.hasClass("pipeline-link")?(a.$event.preventDefault(),b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click")):b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click").end().trigger("submit")});
r.when("A","a-sheet").register("shipoptionselect-gift-removal-controller-mobile",function(a,b){L=b.create({name:"gift-removal-popover",height:220,preloadDomId:"gift-option-removal-message",closeType:"icon",sheetType:"web"})});a.declarative("sosp-extender-toggle",["click","touchend"],function(a){if(!l.protectAgainstDoubleAction("sosp-extender-toggle")){var b=a.$target.closest("a"),c=x(".delivery-window-groups .a-box-group").find(".lazy-loaded");if(b.hasClass("aui-extender"))c.length?c.remove():f(a);
else{var d=b.find("i"),b=b.closest("div.extender-section");d.hasClass("a-icon-extender-expand")?(b.find(".collapsed").hide(),b.find(".expanded").slideDown("fast"),d.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse"),f(a)):(b.find(".collapsed").show(),b.find(".expanded").slideUp("fast"),d.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"),c.length&&c.remove())}}});a.declarative("sosp-select-prime-slot",["click","touchend"],function(a){if(!l.protectAgainstDoubleAction("sosp-select-prime-slot")){a=
a.$currentTarget;var b=a.closest(".valid-slot");if(b.closest(".prime-calendar").hasClass("long-calendar")){var c=b.closest(".prime-calendar").data("orderid"),d=x("#calendar-"+c),c=x("#calendar-delivery-message-"+c),e=a.closest(".long-calendar");e.find(".selected-slot").removeClass("selected-slot");0<b.length&&b.addClass("selected-slot");x(".a-button-close").trigger("click");b=a.data("slotid");b=d.find(".slot-"+b);if(0<b.length)d.show(),c.parent().hide(),b.closest(".prime-calendar").find(".selected-slot").removeClass("selected-slot"),
b.closest(".valid-slot").addClass("selected-slot");else{var g=a.parent()[0],h=a.parent().parent().find(".rhead")[0],b=h.innerText;b||(b=h.textContent);g=g.cellIndex;e=e.find("th")[g];g=e.innerText;g||(g=e.textContent);c.text(g+" "+b);d.hide();c.parent().show()}}else c=b.closest(".prime-calendar-container").data("orderid"),d=x("#calendar-"+c).find(".selected-slot"),0<d.length&&(d.removeClass("selected-slot"),0<b.length&&b.addClass("selected-slot"));d=a.closest(".prime-calendar-container").data("orderid");
a.data("key")&&x("#order_"+d+"_ShippingSpeed").val(a.data("key"));a.data("isscheduleddeliveryslot")&&x("#sdData"+d).val(a.data("sddatastring"))}});a.declarative("sosp-select-delivery-window",["click","touchend"],function(a){if(!l.protectAgainstDoubleAction("sosp-select-delivery-window")){a=a.$currentTarget;a.length&&!a.hasClass("dwg-button")&&(a=a.find(".dwg-button"));x(".dwg-button").removeClass("selected-dwg-button");a.addClass("selected-dwg-button");var b=a.closest(".delivery-window-groups").data("orderid"),
c=a.data("key");!c&&a.find("button").length&&(c=a.find("button").data("key"));c&&x("#order_"+b+"_ShippingSpeed").val(c);c=a.data("isscheduleddeliveryslot");!c&&a.find("button").length&&(c=a.find("button").data("isscheduleddeliveryslot"));c&&(c=a.data("sddatastring"),!c&&a.find("button").length&&(c=a.find("button").data("sddatastring")),x("#sdData"+b).val(c))}});a.on("checkout:reload:shipoptionselect",p);a.on("checkout:reload:spp-shipoption",p)});r.when("jQuery","page-detector").register("deliv-prefs-sosp",
function(a,m){function l(){a(".sosp .order-delivery-time-preference").each(function(){var c=a(this);c.bind("selectionChanged",function(){0===c.find(".delivery-time-preference-group").length?c.hide():(c.show(),0===c.find("input:checked").length&&c.find("input:first").trigger("change",["setActive"]))}).bind("empty",function(){c.find(".delivery-time-preference-group").detach()});var e=c.closest(".one-shipment").find("input.shipping-option");c.find(".delivery-time-preference-group").each(function(){var e=
a(this),l=e.data("shippingoptionid"),l=a("#"+l);e.is(".template")&&e.detach().removeClass("template");l.change(function(){c.trigger("empty");e.appendTo(c);c.trigger("selectionChanged")}).addClass("hasDeliveryTimePreference")});e.not(".hasDeliveryTimePreference").change(function(e,l){"disabling"===l||a(this).is(":disabled")||(c.trigger("empty"),c.trigger("selectionChanged"))});c.trigger("selectionChanged")})}r.when("A").execute(function(a){a.on("checkout:reload:shipoptionselect",l)})});r.when("A",
"shipoptionselect-controller").execute(function(a){var m=a.$,l={},c={};a.on("checkout:reload:shipoptionselect",function(){var a=m("#shippingOptionFormId"),k=a.find("input[name\x3dtrialKey]");if(1===k.length){for(var n in l)l.hasOwnProperty(n)&&(l[n].abort(),delete l[n]);l={};c={};var d=function(a){return a.join("::").replace(/\s+/g,"_")},f=function(){return m.map(a.find("input[type\x3dradio]:checked"),function(a){return a.name})},h=function(){return m.map(a.find("input[type\x3dradio]:checked"),function(a){return a.value})},
b=function(a,b){if(l.hasOwnProperty(a)||c.hasOwnProperty(a))return!1;console.debug('initiating ajax call for trial key "'+a+'"');b=m.ajax({type:"POST",url:"/gp/buy/shipoptionselect/handlers/launch-delivery-trial.html",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:{"x-amz-checkout-transition":"ajax"},data:b,dataType:"json",async:!0,success:function(b){b?console.debug('trial "'+a+'" success'):console.debug('trial "'+a+'" failed');c[a]=b;delete l[a]},error:function(b,c,d){delete l[a];
"abort"!==d&&(console.debug("trial "+a+" error"),r.error("issue with set-delivery-options trial: "+c,d))},cache:!1});l[a]=b;return!0},p=function(){for(var a=h(),a=d(a),b=Object.keys(l),c=0;c<b.length;++c){var e=b[c];e!==a&&(console.debug('removing ajax call for trial key "'+e+'"'),l[e].abort(),delete l[e])}};m(document).delegate("#shippingOptionFormId","change",function(c){c=h();if(d(c)!==k.val())a:{p(),c=f();var l=h(),n=d(l);k.val(n);var x=b(n,a.serialize()),n=0;x&&++n;for(var t=0;t<c.length;++t)for(var g=
a.find('input[type\x3dradio][name\x3d"'+c[t]+'"][value!\x3d"'+l[t]+'"]'),u=0;u<g.length;++u){var K=g[u],x=l.slice(0);x[t]=K.value;for(var x=d(x),A=K.name,K=K.value,L=a.serializeArray(),D=0;D<L.length;++D)L[D].name===A&&(L[D].value=K),"trialKey"===L[D].name&&(L[D].value=x);A=m.param(L);if((x=b(x,A))&&5===++n)break a}}});m(document).delegate("#shippingOptionFormId","submit",function(a){p()})}})});r.when("A","button-blocker","page-detector").register("scheduled-delivery-readiness-checker",function(a,
m,l){function c(){l.isMobile()&&l.isSosp()&&n("div.scheduled-delivery").length&&(n(document).delegate("div."+f+":visible input[type\x3d'radio'].shipping-option","change",function(){k(n(this).closest("div."+f))}),a.on("active-shipment-changed",k))}function e(a){d||(a.hasClass("scheduled-delivery-loading")?d=a.find(".loading-tooltip").text():a.hasClass("scheduled-delivery-picking")&&(d=a.find(".picking-tooltip").text()))}function k(a){d=null;a?e(a):n("div.one-shipment:visible div."+f+".scheduled-delivery").each(function(){var a=
n(this);a.find("input").is(":checked")&&e(a)});d?m.show("scheduled-delivery",d):m.hide("scheduled-delivery")}var n=a.$,d,f=q.P&&q.P.AUI_BUILD_DATE?"selectable-box":"fake-label";if(l.isMobile())a.on("checkout:reload:shipoptionselect",c);return{check:k}});"use strict";r.when("A","quantity-service","page-conductor","page-detector","ajax-utility","page-transition-controller","gift-utility","client-side-metrics","weblab-helper").register("gift-form-base-controller",function(a,m,l,c,e,k,n,d,f){function h(a){a.is(":checked")||
(ea?a.is(":checked")||a.closest("label").click():(d.increaseCount("removeauijs4"),a.attr("checked",!0).trigger("change")))}function b(a){a.attr("disabled","disabled");ea&&a.closest("div").bind("click.disable",function(a){a.stopPropagation()})}function p(a){a.removeAttr("disabled");ea&&a.closest("div").unbind("click.disable")}function w(){r.when("a-dropdown").execute(function(a){var b=y(".select-recipient");b.empty();for(var c=0;c<O.length;c++){var d=y("\x3coption/\x3e").attr({value:O[c].value}).text(O[c].text);
b.append(d)}b.each(function(){var b=y(this).closest(".gift-connection-section"),c=b.find(".include-gift-connection-checkbox").is(":checked"),d=b.find(".item-id").val(),e=b.find(".item-giftlist-type-id").val(),g;!e||"0"!==e&&"1"!==e&&"2"!==e?e&&"3"===e&&(g=b.find(".item-giftlist-id").val()):g=e;!g&&c&&(c=b.find(".item-registry-id").val())&&fa&&fa[c]&&(g=fa[c]);g&&(a.setValue(y(this).attr("id"),g),(e&&"1"===e||"2"===e)&&b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show(),A(d))})})}
function v(){y(".gift-connection-recipient-section").unbind("click").bind("click",function(){if(!X)return y(this).find(".select-recipient-spinner").removeClass("aok-hidden").show(),!1});y(".select-recipient").each(function(){y(this).unbind("change").bind("change",function(){var a=y(this),b=a.next().find(".a-dropdown-prompt"),c=y("\x3cdiv/\x3e").html(a.find(":selected").text()).clone().html();setTimeout(function(){b.html(c)},0)})});r.when("a-dropdown").execute(function(a){y(".gift-connection-section").each(function(){var b=
y(this),c=b.find(".item-id").val(),d=b.find(".item-giftlist-type-id").val();b.find(".item-giftlist-id").val();var e=b.find(".item-occasion-id").val(),g=b.find(".item-occasion-month").val(),h=b.find(".item-occasion-day").val(),f=b.find(".item-age").val();b.find("#input-recipient-first-name-"+c).unbind("keyup").keyup(function(){A(c)});b.find("#input-recipient-last-name-"+c).unbind("keyup").keyup(function(){A(c)});if("1"===d||"2"===d)a.setValue(b.find(".select-recipient").attr("id"),d),b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show();
a.setValue(b.find(".select-occasion").attr("id"),e);a.setValue(b.find(".select-occasion-month").attr("id"),g);a.setValue(b.find(".select-occasion-day").attr("id"),h);a.setValue(b.find(".select-occasion-age").attr("id"),f);if("1"===e||"2"===e)b.find(".gift-connection-occasion-extra").removeClass("aok-hidden").show(),"2"===d&&b.find(".select-occasion-age-row").removeClass("aok-hidden").show();"1"!==e&&"2"!==e&&"3"!==e&&A(c)})});var a="/gp/buy/pipeline/handlers/list-of-giftlists.html",b=y(".item-registry-id").map(function(){if(y(this).val())return y(this).val()}).get().join();
b&&(a+="?fromRegistryIds\x3d"+b);O?(w(),y(".select-recipient-spinner").hide(),X=!0):(X=!1,y.ajax({type:"POST",url:a,dataType:"json",async:!0,cache:!1,timeout:5E3,success:function(a){!O&&a.options&&0<a.options.length&&(O=a.options);a.registryIdMapping&&(fa=a.registryIdMapping);O&&w();y(".select-recipient-spinner").hide();X=!0},error:function(a,b,c){y(".select-recipient-spinner").hide();X=!0}}))}function z(){ba=[];a.state("giftNotificationEmailConstraints",[]);a.state("giftDeliveryDateConstraints",
[]);y('[data-action\x3d"gift-form-element"]').each(function(){var a=y(this);a.is("span")?a.find("input, textarea, select:first").trigger({type:"change",isInit:!0}):a.trigger({type:"change",isInit:!0})});y("textarea").unbind("keyup.gift-textarea click.gift-textarea").bind("keyup.gift-textarea click.gift-textarea",function(){y(this).trigger("change")});0<y(".enable-gift-connections").length&&v()}function x(a,b){var c=31;if("1"===b)c=0===a%4&&0!==a%100||0===a%400?29:28;else if("3"===b||"5"===b||"8"===
b||"10"===b)c=30;return c}function t(a,b,c){a=e.jsonify(a);l.redirect(a)}function g(a){r.when("a-dropdown").execute(function(b){y(".gift-connection-recipient-extra-"+a).hide();b.setValue("select-recipient-"+a,"0");y("#input-recipient-first-name-"+a).val("");y("#input-recipient-last-name-"+a).val("")})}function u(a){r.when("a-dropdown").execute(function(b){y(".gift-connection-occasion-extra-"+a).hide();b.setValue("select-occasion-"+a,"0");b.setValue("select-occasion-month-"+a,"0");b.setValue("select-occasion-day-"+
a,"0");b.setValue("select-occasion-age-"+a,"-1");y("#occasion-has-reminder-checkbox-"+a).attr("checked",!0)})}function K(a,b){r.when("a-dropdown").execute(function(c){for(var d=0;d<O.length;d++)b&&b===O[d].value&&O[d].bMonth&&O[d].bDay&&(c.setValue("select-occasion-month-"+a,O[d].bMonth),c.setValue("select-occasion-day-"+a,O[d].bDay))})}function A(a){r.when("a-dropdown").execute(function(b){var c=y("#select-recipient-"+a).find(":selected").val();"0"!==c&&("1"!==c&&"2"!==c||y("#input-recipient-first-name-"+
a).val()||y("#input-recipient-last-name-"+a).val())?b.updateSelect("select-occasion-"+a,{status:"enabled"}):(u(a),b.updateSelect("select-occasion-"+a,{status:"disabled"}))})}function L(a,b,c){"1"===b&&"2"===c?y("#select-occasion-age-row-"+a).removeClass("aok-hidden").show():y("#select-occasion-age-row-"+a).hide()}function D(){var a=y("#hidePricesCheckbox"),b=y("#kindle-reg-radio-your-account");ea?b.is(":checked")?y("#kindle-reg-radio-another-account").closest("label").click():a.is(":checked")||a.closest("label").click():
(d.increaseCount("removeauijs6"),a.is(":checked")||a.attr("checked","checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),y("#kindle-reg-radio-another-account").attr("checked","checked").trigger("change")))}function E(){var a=y("#hidePricesCheckbox"),b=y("#kindle-reg-radio-another-account");ea?b.is(":checked")?y("#kindle-reg-radio-your-account").closest("label").click():a.is(":checked")&&a.closest("label").click():(d.increaseCount("removeauijs7"),a.is(":checked")&&
a.removeAttr("checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),y("#kindle-reg-radio-your-account").attr("checked","checked").trigger("change")))}function M(){y("#hidePricesCheckboxLabel").hide();var a=y("#hidePricesCheckbox");ea&&(a.is(":checked")||a.closest("label").click());a.attr("disabled",!0).hide().trigger("change");y("#kindle-reg-radio-another-account").attr("disabled",!0).trigger("change");y("#kindle-reg-radio-your-account").attr("disabled",!0).trigger("change");
y("#hidePricesDisabledMessage").show();y("#hidePricesDisabledMessage").removeClass("aok-hidden");ea&&(y("label.a-touch-checkbox.hide-prices-checkbox").addClass("a-touch-selector-disabled").bind("click.disable",function(a){a.stopPropagation()}),y("label.a-touch-radio.kindle-reg-option").addClass("a-touch-selector-disabled").bind("click.disable",function(a){a.stopPropagation()}))}function P(a){var b=!1;y(".afn-wrap-checkbox").each(function(){var a=y(this),a=a.is("input")?a:a.find("input");if(a.is(":checked"))return b=
!0,!1});y(".mfn-no-wrap-radio").each(function(){var a=y(this),a=a.is("input")?a:a.find("input");if(!a.is(":checked"))return b=!0,!1});if(b)D(),M();else if(y("#hidePricesCheckbox").is(":disabled"))y("#hidePricesCheckboxLabel").show(),y("#hidePricesCheckbox").removeAttr("disabled").show().trigger("change"),y("#kindle-reg-radio-another-account").removeAttr("disabled").trigger("change"),y("#kindle-reg-radio-your-account").removeAttr("disabled").trigger("change"),y("#hidePricesDisabledMessage").hide(),
ea&&(y("label.a-touch-checkbox.hide-prices-checkbox").removeClass("a-touch-selector-disabled").unbind("click.disable"),y("label.a-touch-radio.kindle-reg-option").removeClass("a-touch-selector-disabled").unbind("click.disable"));else if(a.is("input")||(a=a.find("input")),"hidePricesCheckbox"===a.attr("id"))a.is(":checked")?D():E();else if("kindle-reg-radio-another-account"===a.attr("id")||"kindle-reg-radio-your-account"===a.attr("id"))y("#kindle-reg-radio-your-account").is(":checked")?E():D()}function H(a){var b=
y("#giftwrap-carousel-wrap-pane-"+a+" ul li").size();b&&(y("#giftwrap-carousel-wrap-holder-"+a).css("width",90*b),y("#giftwrap-carousel-wrap-pane-"+a).css("width",360));N(a)}function N(a){y("#giftwrap-carousel-wrap-holder-"+a).find("ul li, ol li").each(function(b,c){b=y(c);b.find("input").is(":checked")&&Q(b,{itemId:a})})}function Q(a,b){a.parent().find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".giftwrap-carousel-item-image").addClass("selected-giftwrap-image");a.parent().find(".wrap.a-button-selected").removeClass("a-button-selected");
a.addClass("a-button-selected");var c=b.itemId;b=b.wrapNo;var d=l.isSPP();if(!f.isNoshiGiftMessageEnabled())if(a.hasClass("noshi-wrap")&&!a.hasClass("none-wrap")){l.isSPP();var e="#item-"+c;y("#gift-message-noshi-warning-"+c).removeClass("aok-hidden");y("#includeMessageCheckbox-"+c).attr("disabled","disabled");Z()?(y("#afn-message-span-"+c,y(e)).addClass("aok-hidden"),y("#gift-message-"+c).addClass("aok-hidden")):(y("#afn-message-span",y(e)).removeClass("enable-message-area").addClass("disable-message-area"),
y("#message-area-"+c).attr("disabled","disabled"))}else e="#item-"+c,Z()&&(y("#afn-message-span-"+c,y(e)).removeClass("aok-hidden"),y("#gift-message-"+c).removeClass("aok-hidden")),y("#gift-message-noshi-warning-"+c).addClass("aok-hidden"),y("#afn-message-span",y(e)).removeClass("disable-message-area").addClass("enable-message-area"),y("#includeMessageCheckbox-"+c).removeAttr("disabled"),y("#message-area-"+c).removeAttr("disabled");e=a.find("input[type\x3dradio]");e.attr("checked",!0);d||(d=a.data("giftwrap-id"),
e.val(d).change());var d=a.data("wrap-no"),e=y("#giftwrap-option-preview-imagearea-default-"+c),g=y("#giftwrap-option-preview-imagearea-image-"+c),h=y(".selectedWrapLargeLink","#item-"+c),c=y(".wrapNo-"+c+"-"+b);a.hasClass("none-wrap")?(e.removeClass("aok-hidden"),g.addClass("aok-hidden"),h.length&&(h.addClass("aok-hidden"),h.removeClass("selectedWrapLargeLink"))):(a=a.find("img").attr("src"),g.find("img").attr("src",a),e.addClass("aok-hidden"),g.removeClass("aok-hidden"),h.length&&(h.addClass("aok-hidden"),
h.removeClass("selectedWrapLargeLink")),c.length&&(c.addClass("selectedWrapLargeLink"),c.removeClass("aok-hidden")));a=y(".selectedWrapLargeLink");c=y(".larger-image-link-carousel-"+d);a.removeClass("selectedWrapLargeLink").addClass("aok-hidden");c.removeClass("aok-hidden").addClass("selectedWrapLargeLink")}function W(a,b){var c;c=b.itemId;b=y("#giftwrap-option-preview-imagearea-default-"+c);c=y("#giftwrap-option-preview-imagearea-image-"+c);a.hasClass("none-wrap")?(b.removeClass("aok-hidden"),c.addClass("aok-hidden")):
(a=a.find("img").attr("src"),c.find("img").attr("src",a),b.addClass("aok-hidden"),c.removeClass("aok-hidden"))}function F(a,b){var c=b.itemId;b=y("#giftwrap-option-preview-imagearea-default-"+c);c=y("#giftwrap-option-preview-imagearea-image-"+c);if(a.parent().find(".selected-giftwrap-image").parents("li").hasClass("none-wrap"))b.removeClass("aok-hidden"),c.addClass("aok-hidden");else{var d=".selected-giftwrap-image img";l.isSPP()&&(d="img.selected-giftwrap-image");a=a.parent().find(d).attr("src");
c.find("img").attr("src",a);b.addClass("aok-hidden");c.removeClass("aok-hidden")}}function B(a,b){var c=a.find(".empty-message-warning"),d=a.find(".no-receipt-warning"),e=a.find("textarea");a=a.find(".message-counter");b&&!d.is(":visible")?(a.hide(),c.show(),e.addClass("gift-warning")):(c.hide(),e.removeClass("gift-warning"),a.show())}function Y(a){var b=y("#"+a.id),c=n.getCharCount(b.val(),a.useByteSize),b=n.getLineCount(b.val(),a.maxChars/a.maxLines);return{length:c,charDelta:a.maxChars-c,lineDelta:a.maxLines-
b}}function ca(a,b){b=y("#item-"+b.itemId);var c=a.is(":checked")&&!a.hasClass("mfn-no-wrap-radio");Z()&&(c=!a.hasClass("mfn-no-wrap-radio"));c?(b.find(".gift-message-pslip").hide(),b.find(".gift-message-card").show()):(b.find(".gift-message-card").hide(),b.find(".gift-message-pslip").show())}function Z(){return l.isSPP()&&y("#carouselGiftWrap").length}function aa(b,c){var d=c.itemId;c=l.isSPP()?c.currentTab:b.data("current-tab");var e=y("#afn-gift-options-wrapper-"+d).data("active-tab");c!==e&&(b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab"),
b.addClass("selected-giftwrap-tab"),y("#afn-gift-options-wrapper-"+d).data("active-tab",c),b="#item-"+d,e=l.isSPP()?y("#giftwrap-carousel-wrap-holder-"+d,b):b,e.length&&a.trigger("checkout:gift:changeCarouselWrapOptions",e,c,d),c=y(".none-wrap",y(b)).find("input"),c.prop("checked",!0),c.val("").change(),l.isSPP()?(c=y("#afn-gift-options-wrapper-"+d),c.length&&(c=c.data("active-tab"),a.trigger("checkout:gift:adaptCarouselGiftPanel",d,c))):a.trigger("checkout:gift:adaptCarousel",d),y("#giftwrap-carousel-wrap-holder-"+
d).removeClass("a-button-selected").find(".selected-giftwrap-image").removeClass("selected-giftwrap-image"),y("#giftwrap-carousel-item-image-"+d).addClass("selected-giftwrap-image").parents(".wrap").addClass("a-button-selected"),y("#giftwrap-option-preview-imagearea-default-"+d).removeClass("aok-hidden"),y("#giftwrap-option-preview-imagearea-image-"+d).addClass("aok-hidden"),c=y(".selectedWrapLargeLink"),c.length&&(c.addClass("aok-hidden"),c.removeClass("selectedWrapLargeLink")),c=l.isSPP(),b="#item-"+
d,y("#gift-message-noshi-warning-"+d).addClass("aok-hidden"),y("#includeMessageCheckbox-"+d).removeAttr("disabled"),c?y("#afn-message-span-"+d,y(b)).removeClass("aok-hidden"):(y("#afn-message-span",y(b)).removeClass("disable-message-area").addClass("enable-message-area"),y("#gift-message-heading-"+d).removeClass("disable-message-area").addClass("enable-message-area"),y("#message-area-"+d).removeAttr("disabled")))}var ba,O,X=!1,fa,y=a.$,ea=q.P&&q.P.AUI_BUILD_DATE&&c.isMobile(),V=n.getInput;a.declarative("save-gift-for-later",
["click"],function(a){k.show();a=a.$currentTarget.data("entityId")||a.data.entityId;m.call(a,0,{success:t})});var ka={toggleGiftDataAndDeliveryOptions:function(a){a=a.closest(".gift-options-wrapper");var b=V(a.find(".includeMessageCheckbox"));b&&b.is(":checked")?(a.find(".gift-delivery-option").show(),a.find(".item-wrap-span").show(),a.find(".item-wrap-row").show(),a.find(".item-gift-message-span").show()):(a.find(".gift-delivery-option").hide(),a.find(".item-wrap-span").hide(),a.find(".item-wrap-row").hide(),
a.find(".item-gift-message-span").hide())},toggleGiftDeliveryOptions:function(a){var b=a.closest(".gift-options-wrapper");a.is("input[type\x3dcheckbox]")?a.is(":checked")?b.find(".gift-notification-email").removeClass("a-form-disabled"):b.find(".gift-notification-email").addClass("a-form-disabled"):(b.find(".gift-notification-email").removeClass("a-form-disabled"),a=b.find(".includeMessageCheckbox"),h(a.find("input[type\x3dcheckbox]")),ea&&(a=a.find("i.a-icon"),a.length&&(a.removeClass("a-icon-checkbox-inactive"),
a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-checkbox-active"),a.addClass("a-icon-touch-checkbox-active"))))},initGiftNotificationEmail:function(b){var c=a.state("giftNotificationEmailConstraints");c.push({id:b.attr("id")});a.state("giftNotificationEmailConstraints",c)},initGiftDeliveryDate:function(b){var c=a.state("giftDeliveryDateConstraints");b.hasClass("year-select")||(b=b.parents("div.del-opt-date-section").find("select.year-select:first"));c.push({id:b.attr("id")});a.state("giftDeliveryDateConstraints",
c)},updateDateDropdown:function(a){var b=a.closest(".gift-options-wrapper");a=b.find(".month-select").val();var c=b.find(".day-select");c.val();var b=b.find(".year-select").val(),d=x(b,a);if(c.hasClass("a-native-dropdown"))r.when("a-dropdown").execute(function(a){a=a.getSelect(c);if(a.getOptions().size()>d)for(var b=a.getOptions().size()-1;b>=d;b--)a.removeOption(b);else for(b=a.getOptions().size();b<d;b++)a.addOption({text:b+1,value:b+1},b)});else{if(c.find("option").length>d)c.find("option:gt("+
(d-1)+")").remove();else for(a=c.find("option").length+1;a<=d;a++)c.append(y("\x3coption\x3e",{value:a}).text(a));c.trigger("change")}},initSelectedTabAndWrapHolderWidth:H,initGiftMessage:function(a,b){ea&&!a.is("textarea")&&(a=a.find("textarea"));ba.push({id:a.attr("id"),maxChars:parseInt(b.maxChars,10),maxLines:parseInt(b.maxLines,10),useByteSize:b.useByteSize});V(a.closest(".gift-options-wrapper").find(".includeMessageCheckbox")).is(":checked")||a.addClass("a-form-disabled");"1"===y("#multipleAFNGiftWrapOption").val()&&
(a=a.attr("id").substring(a.attr("id").lastIndexOf("-")+1,a.attr("id").size),H(a))},enforceSelectorParity:P,enforceGiftReceiptParity:function(a,c){a=y("#item-"+c.itemId);if(0!==a.length){c=a.find(".item-receipt-row label");var d=V(a.find(".includeReceiptCheckbox")),e=a.find(".mfn-hide-price-row label"),g=V(a.find(".mfnHidePriceCheckbox")),f=a.find(".item-message-row label"),k=V(a.find(".includeMessageCheckbox")).is(":checked"),l=!1;0<a.find(".afn-wrap-checkbox").length?V(a.find(".afn-wrap-checkbox")).is(":checked")&&
(l=!0):0<a.find(".mfn-no-wrap-radio").length&&(V(a.find(".mfn-no-wrap-radio")).is(":checked")||(l=!0));if(l||k)h(d),h(g);l||k&&f.is(":visible")?(b(d),c.addClass("checkout-gift-option-disabled"),b(g),e.addClass("checkout-gift-option-disabled")):(p(d),p(g),c.removeClass("checkout-gift-option-disabled"),e.removeClass("checkout-gift-option-disabled"))}},enforceHidePriceParity:function(a){var b=!1;y(".includeReceiptCheckbox").each(function(){if(V(y(this)).is(":checked"))return b=!0,!1});var c=!1;y(".mfnHidePriceCheckbox").each(function(){if(V(y(this)).is(":checked"))return c=
!0,!1});b||c?(D(),y(".kindle-reg-msg-your-account").hide(),y(".kindle-reg-msg-another-account").show()):(E(),y(".kindle-reg-msg-another-account").hide(),y(".kindle-reg-msg-your-account").show())},toggleNoReceiptWarning:function(a){var b=V(a).is(":checked"),c=a.closest(".gift-options-wrapper");a=c.find(".no-receipt-warning");var e=c.find(".empty-message-warning"),c=c.find(".item-message-row").find(".includeMessageCheckbox"),g=V(c);b?(a.hide(),c.is(":visible")||h(g)):(e.hide(),a.show(),g.is(":checked")&&
(ea?g.is(":checked")&&g.closest("label").click():(d.increaseCount("removeauijs5"),g.removeAttr("checked").trigger("change"))))},toggleMessageArea:function(a){var b=a.closest(".gift-options-wrapper");if(a.is("textarea"))b=V(b.find(".includeMessageCheckbox")),h(b);else{a=V(b.find(".includeMessageCheckbox")).is(":checked");var c=b.find(".item-message-row label").is(":visible"),d=0<b.find(".empty-message-warning").length,e=b.find("textarea"),g=e.data("default-text"),f=0<e.val().length;a?(b.find(".gift-message-edit").show(),
b.find(".gift-message-label").removeClass("a-color-secondary"),e.removeClass("a-form-disabled"),g&&e.val(g)):(c&&b.find(".gift-message-edit").hide(),b.find(".gift-message-label").addClass("a-color-secondary"),e.addClass("a-form-disabled"),g&&e.val(""));d&&(a&&f?B(b,!1):B(b,!0))}},toggleMessageLocationText:ca,toggleMessageBoxDisplay:function(c,d){var e=y("#item-"+d.itemId);if(0!==e.length){var g=e.find(".item-message-row");d=e.find(".item-receipt-row");var f=e.find(".gift-message-on-card"),k=e.find(".gift-message-on-receipt"),
l=g.find("label"),g=V(g.find(".includeMessageCheckbox")),m=a.trim(e.find(".gift-message-default-placeholder").text()),u=a.trim(e.find(".gift-message-with-wrap-placeholder").text()),e=e.find("textarea"),n=c.hasClass("mfn-no-wrap-radio")||c.closest("div").hasClass("mfn-no-wrap-radio");V(c).is(":checked")&&!n?(k.hide(),f.show(),e.attr("placeholder",u),d.is(":visible")&&(h(g),l.is(":visible")&&(b(g),l.addClass("checkout-gift-option-disabled")))):(f.hide(),k.show(),e.attr("placeholder",m),p(g),l.removeClass("checkout-gift-option-disabled"))}},
updateContinueButtons:function(){for(var b=!0,c,d=0;d<ba.length;d++)if(c=y("#"+ba[d].id),c.closest(".gift-options-wrapper").find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]').is(":checked")&&(c=Y(ba[d]),0>c.charDelta||0>c.lineDelta))b=!1;b?(y(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").show(),y(".save-gift-button-box span.a-button-disabled").hide()):(y(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").hide(),b=y(".save-gift-button-box span.a-button-disabled"),
b.removeClass("aok-hidden"),b.show());a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")},updateMessageCounter:function(a){ea&&!a.is("textarea")&&(a=a.find("textarea"));for(var b,c=0;c<ba.length;c++)a.attr("id")===ba[c].id&&(b=Y(ba[c]));if(b){a=a.closest(".gift-options-wrapper");c=a.find(".message-counter");c.find(".remaining-count").hide();if(0<a.find(".empty-message-warning").length){if(0===b.length){B(a,!0);return}B(a,!1)}(-1>b.charDelta?c.find(".remaining-char-over-multiple").show():
0>b.charDelta?c.find(".remaining-char-over-single").show():1===b.charDelta?c.find(".remaining-char-single").show():c.find(".remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(b.charDelta));(-1>b.lineDelta?c.find(".remaining-line-over-multiple").show():0>b.lineDelta?c.find(".remaining-line-over-single").show():1===b.lineDelta?c.find(".remaining-line-single").show():c.find(".remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(b.lineDelta));c.show()}},updateSelectedGiftWrap:Q,
clearGiftConnection:function(a,b){y("#include-gift-connection-checkbox-"+b.itemId).is(":checked")||(g(b.itemId),A(b.itemId))},toggleGiftConnectionAgeDropdown:L,toggleGiftConnectionRecipientArea:function(a,b){a=y("#select-recipient-"+b.itemId).find(":selected").val();var c=y("#select-occasion-"+b.itemId).find(":selected").val();!a||"1"!==a&&"2"!==a?(y(".gift-connection-recipient-extra-"+b.itemId).hide(),"1"===c&&a&&K(b.itemId,a)):y(".gift-connection-recipient-extra-"+b.itemId).removeClass("aok-hidden").show();
L(b.itemId,c,a);A(b.itemId)},toggleGiftConnectionOccasionArea:function(a,b){a=y("#select-occasion-"+b.itemId).find(":selected").val();var c=y("#select-recipient-"+b.itemId).find(":selected").val();!a||"1"!==a&&"2"!==a?y(".gift-connection-occasion-extra-"+b.itemId).hide():("1"===a&&c&&"1"!==c&&"2"!==c&&K(b.itemId,c),y(".gift-connection-occasion-extra-"+b.itemId).removeClass("aok-hidden").show());L(b.itemId,a,c)},includeGiftConnection:function(a,b){(a=y("#select-recipient-"+b.itemId).find(":selected").val())&&
"0"===a||y("#include-gift-connection-checkbox-"+b.itemId).attr("checked",!0)},updateGiftOptionsTabSelection:aa,updatePreviewImageOnMouseEnter:W,updatePreviewImageOnMouseLeave:F,toggleGiftMessageWarning:function(a){var b=y("#"+a.attr("id"));n.toggleGiftMessageWarning(b,a.closest(".item-gift-message-span"))}};a.declarative("gift-form-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(ka[b[c]])ka[b[c]](a.$target,a.data)});a.declarative("gift-form-element",
"click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(ka[b[c]])ka[b[c]](a.$currentTarget,a.data,a)});a.declarative("select-gift-wrap","click",function(a){Q(a.$target.parents("li"),{itemId:a.data.itemId,wrapNo:a.data.wrapNo});P(a.$target);var b=a.$target.parents("li").find(".gift-hidden-radio");ca(b,{itemId:a.data.itemId})});a.declarative("select-gift-wrap","mouseenter",function(a){W(a.$target.parents("li"),
a.data)});a.declarative("select-gift-wrap","mouseleave",function(a){F(a.$target.parents("li"),a.data)});a.declarative("update-gift-options-tab-selection",["click"],function(a){var b=a.$target.parents("li");b.attr("data",a.data);aa(b,a.data)});a.on("checkout:reload:giftselect",z);a.on("checkout:reload:spp-giftoptions",z);return{extendFunctions:function(a){y.extend(ka,a)}}});"use strict";r.when("A","page-transition-controller","page-conductor").register("gift-form-del-opt-controller",function(a,m,l){function c(a){var c=
a.closest(".expando-box");c&&(c=c.find(".a-expander-header"),a.closest(".expando-content").is(":hidden")&&c.click())}function e(a){var c=a.closest(".gift-options-wrapper"),b=c.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(b&&!b.is(":checked"))return!0;b=c.find(".email-error-selector");c.find(".gift-notification-email-error").hide();b.removeClass("a-form-error");if(64<q.unescape(encodeURIComponent(a.val())).length)return b.addClass("a-form-error"),c.find(".gift-notification-email-length-exceeded-error").removeClass("aok-hidden").show(),
!1;if(/^\S+[@]\S+[.]\S+$/.test(a.val()))return!0;b.addClass("a-form-error");c.find(".gift-notification-invalid-email-error").removeClass("aok-hidden").show();return!1}function k(){d("#giftForm").find(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").unbind("click").bind("click",function(a){a.preventDefault();n(a)});d(".checkout-gift-image-preview-trigger \x3e a").show();d("#gift-kindle-imb").show()}function n(f){f=d("#giftForm");var h=f.find('input[name\x3d"hidePrices"]'),b=h.is(":disabled");
b&&h.removeAttr("disabled");for(var k=!0,n=a.state("giftNotificationEmailConstraints"),v=a.state("giftDeliveryDateConstraints"),z=0;z<n.length;z++){var x=d("#"+n[z].id);e(x)||(k=!1,c(x))}for(n=0;n<v.length;n++){z=d("#"+v[n].id);var x=z.closest(".gift-options-wrapper"),t=x.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(t&&!t.is(":checked"))x=!0;else{var g=x.find(".month-select").val(),u=x.find(".day-select").val(),t=x.find(".year-select"),K=t.val(),A=x.find("#current-date").val().split("-"),
g=new Date(K,g,u),A=new Date(A[0],A[1]-1,A[2]),u=new Date(A.getTime());u.setMonth(u.getMonth()+12);x.find(".gift-delivery-date-error").hide();K=x.find(".date-error-selector");t=t.hasClass("a-native-dropdown")?"error-border a-form-error":"a-form-error";K.removeClass(t);g>=u||g<A?(x.find(".gift-delivery-date-error").removeClass("aok-hidden").show(),K.addClass(t),x=!1):x=!0}x||(k=!1,c(z))}a.state("continueAction",{enable:k});if(a.state("continueAction").enable)l.isSPP()||m.showPageTransition(),f.submit();
else return d("html, body").animate({scrollTop:d(".a-form-error").closest("div").offset().top},500),!1;b&&h.attr("disabled",!0)}var d=a.$;a.declarative("submit-gift-options","click",function(a){n(a)});a.declarative("discard-gift-options","click",function(a){d('#giftForm input[type\x3d"checkbox"]').prop("checked",!1);d("#giftForm textarea").addClass("a-form-disabled");n(a)});a.on("checkout:reload:giftselect",k);a.on("checkout:reload:spp-giftoptions",k)});"use strict";r.when("A").register("teen-message-controller",
function(a){var m=a.$;a.declarative("teen-message-form-element","click keyup",function(a){a=a.data.maxChars;var c=m("#teen-message-box").val(),e=c.match(/(\r\n|\n|\r)/g),k=0;e&&(k=e.length);c=c.length+k;m(".remaining-char").text(Math.max(a-c,0))});m("#aui-teen-message-box").length&&m(".remaining-char").length&&r.when("A").execute(function(a){function c(a){a=a.val();var c=(a.match(/(\r\n|\n|\r|\n\r)/g)||{}).length||0;return a.length+c}a=a.$;var e,k,m;e=a("#aui-teen-message-box");e.bind("change keypress",
function(a){return c(e)>=m?(a.preventDefault(),!1):!0});e.bind("paste",function(a){if(a&&a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData("Text")){var f=a.originalEvent.clipboardData.getData("Text"),h=c(e);if(h+f.length>=m)return f=f.substring(0,m-h),f=e.val()+f,e.attr("value",f),a.preventDefault(),!1}return!0});e.bind("click keyup",function(){var a=Math.max(m-c(e),0);k.text(a)});k=a(".remaining-char");m=e.parent().data("maxchars")})});"use strict";r.when("A",
"page-transition-controller","page-conductor","loading-spinner-controller","client-side-metrics").register("concealment-form-del-opt-controller",function(a,m,l,c,e){function k(a){var c=d("#concealmentForm");c.find("input:checked").length?(a=a.data.saveConcealmentRefTag,e.increaseCount("CPEX.Checkout.Select.Concealment",1)):(a=a.data.cancelConcealmentRefTag,e.increaseCount("CPEX.Checkout.Cancel.Concealment",1));c.find("input[name\x3dref]").val(a);c.attr("action",c.attr("action")+"/ref\x3d"+a)}function n(a){a=
d("#concealmentForm");l.isSPP()||m.showPageTransition();a.submit()}var d=a.$;a.declarative("submit-concealment-options","click",function(a){k(a);n(a)});a.declarative("discard-concealment-options","click",function(a){d('#concealmentForm input[type\x3d"checkbox"]').prop("checked",!1);k(a);n(a)});a.declarative("submit-concealment-form","click",function(a){k(a);a.$target.closest(".a-button").addClass("a-button-disabled");c.showSpinner(a.$target.closest("form"))})});"use strict";r.when("A","page-transition-controller",
"page-conductor","address-popovers","checkout-general-utils","a-popover","client-side-metrics","weblab-helper").register("itemselect-address-controller",function(a,m,l,c,e,k,n,d){function f(){w(".lineitem").each(function(a,b){a=w(b);a.find(".no-js-address-dropdown").remove();a.find(".no-js-address-select").remove();a.find(".js-address-dropdown").prop("disabled",!1);a.find(".address-dropdown").removeClass("a-button-disabled")});w("#suppressAddAddressPopover").val()&&w('select[name^\x3d"addressID."]').find("option").each(function(){var a=
w(this);"New"===a.val()&&a.closest("optgroup").remove()})}function h(a){var c=(new Date).getTime(),d=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});w.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+c,data:a,dataType:"text",headers:d,error:l.ajaxRedirect,success:function(a,c,d){var g=d.getResponseHeader("x-amz-checkout-fatal-error");if(null!==g&&void 0!==g)q.location=g;else if(b(d)){p(a,d);var h;a=t.find('input[name^\x3d"previousAddress."]');
if(null!==a||void 0!==a)h=z||a.val();var f=t.find('select[name^\x3d"addressID."]');null===f&&void 0===f||r.when("a-dropdown").execute(function(a){a.setValue(f.attr("id").replace(/\./g,"\\."),h);f.find("option").removeAttr("selected");f.find('option[value\x3d"'+h+'"]').attr("selected","selected")});m.hide()}else l.ajaxUpdatePage(a,c,d),e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}})}function b(a){a=a.getResponseHeader("x-amz-checkout-show-addon-warning");return null!==a&&void 0!==
a}function p(a,b){b=b.getResponseHeader("x-amz-checkout-show-addon-warning");w(".item-list").hide();a.trim().split(",").forEach(function(a){w('[data-asin\x3d"'+a+'"]').show()});a=w("#addon-warning-"+b+"-launcher");a.length&&(w(".delete-title").hide(),w(".reduce-title").hide(),w(".select-address-title").show(),w("input[name\x3duseLiveAUI]").length?k.get(a).attrs({$trigger:x,position:"triggerHorizontal"}).show():(b=w.Event("keyup",{triggerPositioningElement:x,manualTrigger:!0}),a.trigger(b)))}var w=
a.$,v,z,x,t;a.declarative("itemselect-get-address",["click","touchend"],function(a){e.protectAgainstDoubleAction("itemselect-get-address",200)||(z=a.$currentTarget.find(".js-address-dropdown").val())});a.declarative("itemselect-update-address",["change"],function(a){if(!e.protectAgainstDoubleAction("itemselect-update-address",200)){n.resetMetrics();var b=a.$currentTarget.is("select")?a.$currentTarget:a.$currentTarget.find("select");v=b.val();if("New"===v)c.actionTriggerPopoverFromDropdown(a),r.when("a-dropdown").execute(function(a){a.setValue(b.attr("id").replace(/\./g,
"\\."),z)});else{m.show();t=b.closest(".lineitem");var d,f;if(t){var k=t.find('input[name^\x3d"lineItemEntityID."]');k&&(d=k.val());(k=t.find('input[name^\x3d"quantity."]'))&&(f=k.val());(k=t.find(".js-address-dropdown"))&&(v=k.val())}x=a.$currentTarget.is("select")?a.$currentTarget.closest(".address-dropdown"):a.$currentTarget;a=0;k=w("#addon-indicator");k.length&&"true"===k.attr("data-has-addon-items")&&(a=1);h({lineitems:d,addresses:v,quantities:f,isTrial:a})}}});a.declarative("itemselect-update-pantry-address",
["change"],function(a){if(!e.protectAgainstDoubleAction("itemselect-update-pantry-address",200)){v=a.$currentTarget.val();m.show();var b="";a=a.$currentTarget.closest(".pantry-row");w(a).find(".pantry-item").each(function(a,c){a=w(c);b+="lineitems\x3d"+a.find('input[name^\x3d"lineItemEntityID."]').val()+"\x26";b+="addresses\x3d"+v+"\x26";b+="quantities\x3d"+a.find('input[name^\x3d"quantity."]').val()+"\x26"});h(b)}});a.declarative("addon-delete-items",["click","touchend"],function(a){if(void 0!==
x&&null!==x&&!e.protectAgainstDoubleAction("itemselect-delete-addons",200)){w(".a-button-close").trigger("click");m.show();a=(new Date).getTime();var b=w("#useCase").val(),c=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"}),d=t.find('input[name^\x3d"lineItemEntityID."]').val(),h=t.find('input[name^\x3d"quantity."]').val();w.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+a,data:{lineitems:d,addresses:v,quantities:h,isTrial:0,
deleteAddons:1,returnHTML:1,useCase:b},headers:c,error:l.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==d&&void 0!==d?q.location=d:(d=c.getResponseHeader("x-amz-checkout-fatal-error"),null!==d&&void 0!==d?q.location=d:(l.ajaxUpdatePage(a,b,c),e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}});a.on("checkout:reload:itemselect",f);a.on("checkout:reload:spp-itemselect",f)});"use strict";r.when("A","page-transition-controller",
"page-conductor","checkout-general-utils","a-popover","client-side-metrics","weblab-helper").register("itemselect-delete-controller",function(a,m,l,c,e,k,n){function d(a,b){f(a,null===b||void 0===b?a.$currentTarget.closest(".lineitem"):b)}function f(a,d){a.$event.preventDefault();if(!c.protectAgainstDoubleAction("itemselect-delete-single-item",200)){k.resetMetrics();m.show();z=d;t=a.$currentTarget.is("select")?a.$currentTarget.closest(".quantity-dropdown"):a.$currentTarget;a=z.find('input[name^\x3d"lineItemEntityID."]').val();
d=0;(new Date).getTime();var e=v("#addon-indicator");e.length&&"true"===e.attr("data-has-addon-items")&&(d=1);b({lineitems:a,isTrial:d})}}function h(a,d){a.$event.preventDefault();if(!c.protectAgainstDoubleAction("itemselect-delete-multiple-items",200)){m.show();x=d;t=a.$currentTarget;var e="";a=0;d=v("#addon-indicator");d.length&&"true"===d.attr("data-has-addon-items")&&(a=1);d=x.hasClass("pantry-row")?!0:!1;x.find(d?".pantry-item":".lineitem").each(function(a,b){e+="lineitems\x3d"+v(b).find('input[name^\x3d"lineItemEntityID."]').val()+
"\x26"});b(e+"isTrial\x3d"+a)}}function b(a){var b=(new Date).getTime(),c=v('input[name\x3d"useCase"]').val(),d=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});v.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3ddelete\x26useCase\x3d"+c+"\x26cachebuster\x3d"+b,data:a,dataType:"text",headers:d,error:l.ajaxRedirect,success:p})}function p(a,b,d){var e;e=d.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==e&&void 0!==e?(q.location=e,e=!0):e=!1;e||(e=
d.getResponseHeader("x-amz-checkout-fatal-error"),null!==e&&void 0!==e?q.location=e:(e=d.getResponseHeader("x-amz-checkout-show-addon-warning"),null!==e&&void 0!==e?(w(a,d),m.hide()):(l.ajaxUpdatePage(a,b,d),c.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))))}function w(a,b){b=b.getResponseHeader("x-amz-checkout-show-addon-warning");v(".item-list").hide();a.trim().split(",").forEach(function(a){v('[data-asin\x3d"'+a+'"]').show()});a=v("#addon-warning-"+b+"-launcher");a.length&&(v(".delete-title").show(),
v(".reduce-title").hide(),v(".select-address-title").hide(),v("input[name\x3duseLiveAUI]").length?e.get(a).attrs({$trigger:t,position:"triggerHorizontal"}).show():(b=v.Event("keyup",{triggerPositioningElement:t,manualTrigger:!0}),a.trigger(b)))}var v=a.$,z,x,t;a.declarative("itemselect-delete-item",["click","touchend"],d);a.declarative("itemselect-delete-item-row",["click","touchend"],function(a){h(a,a.$currentTarget.closest(".item-row"))});a.declarative("addon-delete-items",["click","touchend"],
function(a){if(void 0!==t&&!c.protectAgainstDoubleAction("itemselect-delete-addons",200)){v(".a-button-close").trigger("click");m.show();var d="";null!==x&&void 0!==x?(a=x.hasClass("pantry-row")?x.find(".pantry-item"):x.find(".lineitem"),v(a).each(function(a,b){d+="lineitems\x3d"+v(b).find('input[name^\x3d"lineItemEntityID."]').val()+"\x26"})):null!==z&&void 0!==z&&(d+="lineitems\x3d"+z.find('input[name^\x3d"lineItemEntityID."]').val()+"\x26");b(d+"isTrial\x3d0\x26deleteAddons\x3d1")}});a.declarative("itemselect-delete-pantry-item",
["click","touchend"],function(a){f(a,a.$currentTarget.closest(".pantry-item"))});a.declarative("itemselect-delete-pantry",["click","touchend"],function(a){h(a,a.$currentTarget.closest(".pantry-row"))});a.declarative("itemselect-delete-popover-item",["click","touchend"],function(a){var b=a.$currentTarget.data("entityidtodelete");h(a,v('a[data-entityid\x3d"'+b+'"]').closest(".item-row"))});return{actionDeleteItem:d}});"use strict";r.when("A","page-transition-controller","page-conductor","itemselect-delete-controller",
"checkout-general-utils","a-popover","client-side-metrics","weblab-helper").register("itemselect-quantity-controller",function(a,m,l,c,e,k,n,d){function f(){z(".lineitem, .pantry-item").each(function(a,b){a=z(b);a.find(".no-js-quantity").remove();b=a.find(".quantity-dropdown");b.is(":visible")?(a.find(".js-select").prop("disabled",!1),b.removeClass("a-button-disabled")):(a=a.find(".quantity-input"),a.prop("disabled",!1),a.removeClass("a-form-disabled"))})}function h(a){a.find(".quantity-input").val(a.find('input[name^\x3d"previousQuantity."]').val())}
function b(a){var b=a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),c=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val(),d;d="itemselect-show-update-pantry-button"===a.action?".pantry-item":".lineitem";0===parseInt(c,10)||""===c?("change"===a.type&&h(a.$currentTarget.closest(d)),b.hide()):(a=a.$currentTarget.closest(d).find('input[name^\x3d"previousQuantity."]').val(),c!==a?b.show():b.hide())}function p(a){a.$event.preventDefault();
if(!e.protectAgainstDoubleAction("itemselect-update-quantity",200)){n.resetMetrics();g=a.$currentTarget.closest("itemselect-update-pantry-quantity"===a.action||"itemselect-update-pantry-quantity-text-field"===a.action?".pantry-item":".lineitem");var b=g.find(".js-address-dropdown").val(),d=a.$currentTarget.find("select"),f=d.length?d:a.$currentTarget;x=f.is("select")?f.val():g.find(".quantity-input").val();if(0===parseInt(x,10)||""===x)h(g);else if("Delete"===x)r.when("a-dropdown").execute(function(a){a.setValue(f.attr("id").replace(/\./g,
"\\."),t)}),c.actionDeleteItem(a,g);else{m.show();a=g.find('input[name^\x3d"lineItemEntityID."]').val();var d=0,k=(new Date).getTime(),p=z("#useCase").val(),P=z("#addon-indicator");u=f.is("select")?f.parent():g.find(".quantity-input");P.length&&"true"===P.attr("data-has-addon-items")&&(d=1);P=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});z.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+k,data:{lineitems:a,quantities:x,
address:b,isTrial:d,returnHTML:1,useCase:p},dataType:"text",headers:P,error:l.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-fatal-error");null!==d&&void 0!==d?q.location=d:(d=c.getResponseHeader("x-amz-checkout-show-addon-warning"),null!==d&&void 0!==d?(v(a,c),w(void 0===t?g.find('input[name^\x3d"previousQuantity."]').val():t,c),m.hide()):(l.ajaxUpdatePage(a,b,c),e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}}}function w(a,b){10>a?(r.when("a-dropdown").execute(function(b){var c=
g.find('select[name^\x3d"quantity."]');b.setValue(c.attr("id").replace(/\./g,"\\."),a);c.find("option").removeAttr("selected");c.find('option[value\x3d"'+a+'"]').attr("selected","selected")}),g.find(".quantity-dropdown").show(),g.find(".quantity-text-field").hide(),g.find(".js-select").prop("disabled",!1),g.find(".quantity-input").prop("disabled",!0)):(g.find(".quantity-dropdown").hide(),g.find(".quantity-text-field").show(),g.find(".update-quantity-link").hide(),g.find(".js-select").prop("disabled",
!0),g.find(".quantity-input").prop("disabled",!1));g.find(".quantity-input").val(a);g.find('input[name^\x3d"previousQuantity."]').val(a)}function v(a,b){b=b.getResponseHeader("x-amz-checkout-show-addon-warning");z(".item-list").hide();a.trim().split(",").forEach(function(a){z('[data-asin\x3d"'+a+'"]').show()});a=z("#addon-warning-"+b+"-launcher");a.length&&0<a.length&&(z(".reduce-title").show(),z(".delete-title").hide(),z(".select-address-title").hide(),z("input[name\x3duseLiveAUI]").length?k.get(a).attrs({$trigger:u}).show():
(b=z.Event("keyup",{triggerPositioningElement:u,manualTrigger:!0}),a.trigger(b)))}var z=a.$,x,t,g,u;a.declarative("itemselect-get-quantity",["click","touchend"],function(a){e.protectAgainstDoubleAction("itemselect-get-quantity",200)||a.$currentTarget.find("select").length&&(t=a.$currentTarget.find("select").val())});a.declarative("itemselect-update-quantity",["change"],p);a.declarative("itemselect-update-pantry-quantity",["change"],p);a.declarative("addon-delete-items",["click","touchend"],function(a){if(void 0!==
u&&!e.protectAgainstDoubleAction("itemselect-delete-addons",200)){z(".a-button-close").trigger("click");m.show();a=g.find('input[name^\x3d"lineItemEntityID."]').val();var b=(new Date).getTime(),c=z("#useCase").val(),d=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});z.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+b,data:{lineitems:a,quantities:x,isTrial:0,deleteAddons:1,returnHTML:1,useCase:c},headers:d,error:l.ajaxRedirect,
success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==d&&void 0!==d?q.location=d:(d=c.getResponseHeader("x-amz-checkout-fatal-error"),null!==d&&void 0!==d?q.location=d:(l.ajaxUpdatePage(a,b,c),e.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}});a.declarative("itemselect-sanitize-input",["keydown"],function(a){e.limitInputToNumbers(a)});a.declarative("itemselect-update-quantity-text-field",["click","touchend"],p);a.declarative("itemselect-update-pantry-quantity-text-field",
["click","touchend"],p);a.declarative("itemselect-show-update-button",["change","keyup"],b);a.declarative("itemselect-show-update-pantry-button",["change","keyup"],b);a.on("checkout:reload:itemselect",f);a.on("checkout:reload:spp-itemselect",f)});"use strict";r.when("A","page-transition-controller","page-conductor","checkout-general-utils","client-side-metrics").register("itemselect-ship-to-multiple-controller",function(a,m,l,c,e){var k=a.$;a.declarative("itemselect-ship-to-multiple",["click","touchend"],
function(a){a.$event.preventDefault();e.resetMetrics();if(!c.protectAgainstDoubleAction("itemselect-ship-to-multiple",200)){m.show();var d=null,f=null,h=null;a.$currentTarget.closest(".item-row").find(".lineitem").each(function(a,b){a=k(b);b=a.find('select[name^\x3d"quantity."]');var c=a.find('input[type\x3d"number"]');if(a.find(".quantity-dropdown").is(":visible")&&1<b.val())return d=a.find('input[name^\x3d"lineItemEntityID."]').val(),f=b.val(),h=a.find(".js-address-dropdown").val(),!1;if(a.find(".quantity-text-field").is(":visible")&&
1<c.val())return d=a.find('input[name^\x3d"lineItemEntityID."]').val(),f=c.val(),h=a.find(".js-address-dropdown").val(),!1});if(null!==d){a=(new Date).getTime();var b=l.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});k.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dship-to-multiple\x26cachebuster\x3d"+a,data:{lineitem:d,quantity:f,address:h},headers:b,dataType:"text",error:l.ajaxRedirect,success:function(a,b,d){var e=d.getResponseHeader("x-amz-checkout-fatal-error");
null!==e&&void 0!==e?q.location=e:(l.ajaxUpdatePage(a,b,d),c.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}}})});"use strict";r.when("A").register("safe-apx-helper",function(a){var m={},l=a.$;return{get:function(a){return m[a]},set:function(){1===arguments.length?m=l.extend(m,arguments[0]):2===arguments.length?m[arguments[0]]=arguments[1]:q.console&&q.console.error&&q.console.error("Unexpected number of arguments: %d. Expected 1 or 2.",arguments.length)}}});"use strict";r.when("A",
"weblab-helper").register("mobile-carrier-billing-util",function(a,m){var l=!1;return{determineIsMCBEnabled:function(a){l=0<a.paymentRows.find('input[type\x3d"radio"][name\x3dpaymentMethod]').filter("[value^\x3dMCB]").size()},toggleGCForMCB:function(a,e){if(!m.isMCBMultiTenderWeblabEnabled()&&l&&(a=a.find('input[type\x3d"radio"][name\x3dpaymentMethod]'),a.length)){var k=e.paymentRows.find('input[type\x3d"checkbox"][name\x3duseAvailableBalance]'),k=e.existingBalance||k,n=0<e.paymentRows.find('input[type\x3d"hidden"][name\x3d"gcBalance"]').length,
d="paymentsForm"in e&&0<e.paymentsForm.find('input[type\x3d"hidden"][name\x3d"gcBalance"]').length,n=n||d;0<a.filter("[value^\x3dMCB]").size()&&n?(k.length&&(k.prop("checked",!1),k.prop("disabled",!0)),e.mcbBalanceWarning&&e.mcbBalanceWarning.show()):(k.length&&k.prop("disabled",!1),e.mcbBalanceWarning&&e.mcbBalanceWarning.hide())}},showMCBWarningMessageForPoints:function(a){l&&a.mcbPointsWarning&&a.mcbPointsWarning.show()},hideMCBWarningMessageForPoints:function(a){l&&a.mcbPointsWarning&&a.mcbPointsWarning.hide()}}});
"use strict";r.when("A").register("emi-utils",function(a){return{}});"use strict";r.when("A").register("emi-helper",function(a){return{}});"use strict";r.when().register("instant-bank-discount-helper",function(){return{showInstantBankDiscountAmazonPayDeselected:function(){},showInstantBankDiscountAmazonPaySelected:function(){}}});"use strict";r.when("A","page-detector","checkout-general-utils").register("pay-common-lib",function(a,m,l){function c(a,b){b.attr("name")&&(a[b.attr("name")]=b.val());b.attr("id")&&
(a[b.attr("id")]=b.val())}function e(a,b){if(!b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function k(a,b,c){n.each(b,function(b,d){a[b]=c?c.find(d):n(d)})}var n=a.$,d="checkbox hidden password radio text number tel month".split(" "),f={};a.declarative("move-to-next-field",["keypress"],function(a){13===a.$event.charCode&&(l.moveToNextInput(a.$declarativeParent),a.$event.preventDefault())});a.declarative("scroll-to-input",["keypress"],function(a){13===a.$event.charCode&&(n(q).scrollTop(a.$declarativeParent.offset().top),
a.$event.preventDefault())});return{getAttributeData:function(a,b){if(a)return a.attr(b)||a.attr("data-"+b)||a.data(b)},getElements:function(a,b){var c={};k(c,a,b);return c},getInputValues:function(a){var b=a.find(".data-row").data()||{};a.find("input").each(function(){var a=n(this),e=a.attr("type");("radio"!==e&&"checkbox"!==e||a.is(":checked"))&&-1<n.inArray(e,d)&&c(b,a)});a.find("select").each(function(){c(b,n(this))});return b},isDesktopCX:m.isDesktopPayment,isMobileCX:m.isMobilePayment,isPayPage:m.isPayment,
isTouchCX:m.isTabletPayment,mergeFrom:function(a,b){b=e({},b);return e(b,a)},prop:function(a,b,c){if(a){if(1<arguments.length)return void 0===b?delete f[a]:f[a]={isOneTime:c?1:0,value:b},b;var d=f[a];if(d)return d.isOneTime&&delete f[a],d.value}},refreshElements:k,scrollTopTo:function(a){a&&a.length&&n("html,body").animate({scrollTop:a.offset().top-20},"fast")},selectDefaultPaymentMethodIfNotSelected:function(){var a=n("#existing-payment-methods .payment-row").find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),
b=a.closest("div.payment-selected");b&&0<b.length||(a=a.closest("div.default-payment-marker"))&&a.length&&(a.addClass("payment-selected"),a.find("[name\x3dpaymentMethod]").attr("checked",!0))},processSubmissionParameters:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].name]=a[c].value;return b}}});"use strict";r.when("A","pay-common-lib","a-popover-base","ajax-utility","loading-spinner-controller","page-conductor","page-transition-controller").register("pay-desktop-util",function(a,m,l,c,e,k,n){function d(a){a.$event.preventDefault();
a.$target.closest(".a-popover").hide();a.$target.siblings("span.error-message").hide()}function f(a){a.preventDefault();var b=u(a.currentTarget),c=b.closest("div.expando-section");a=c.find("div.expando-content");var c=c.find("div.expando-reverse-content"),d=a.is(":visible"),e=function(){var a=b.find("i");a.hasClass("a-icon-collapse")||a.hasClass("a-icon-expand")?d?(a.removeClass("a-icon-collapse").addClass("a-icon-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):
(a.removeClass("a-icon-expand").addClass("a-icon-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show()):d?(a.removeClass("a-icon-section-collapse").addClass("a-icon-section-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):(a.removeClass("a-icon-section-expand").addClass("a-icon-section-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show())};d?(c.slideDown("fast"),
a.slideUp("fast",e)):(c.slideUp("fast"),a.slideDown("fast",e))}function h(a){var b=a.$target.closest("a");a=b.closest("div.extender-section");b=b.find("i");b.hasClass("a-icon-extender-expand")?(a.find(".collapsed").hide(),a.find(".expanded").slideDown("fast"),b.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse")):(a.find(".collapsed").show(),a.find(".expanded").slideUp("fast"),b.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"))}function b(a){E.msgPopovers.filter(":visible").hide();
a.$event.preventDefault();a.$event.stopPropagation();a=a.$target.parent().find(".a-popover");a.is(":visible")||a.show()}function p(a,b,c){var d=a||{},e="string"===typeof a;c=c&&c.useSif?u('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0;e?(d+="\x26ajaxResponse\x3d1\x26returnjson\x3d1",c&&(d+="\x26isAmazonApp\x3d1")):(d.ajaxResponse=1,d.returnjson=1,c&&(d.isAmazonApp=1));for(c=0;c<D.length;c++){var f=D[c],g=u("input[name\x3d"+f+"]").val();e?-1===b.search(f)&&-1===a.search(f)&&(d=d+"\x26"+
f+"\x3d"+g):d[f]=g}return d}function w(a,b){if(0>a)return 0;isNaN(b)||(a=Number(a).toFixed(b));a=a.toString();b=0<=a.lastIndexOf(".")?a.lastIndexOf("."):a.length;return 3>=b?a:w(a.substring(0,b-3),0)+","+a.substring(b-3)}function v(a,b,c,d){a="timeout"===b?"pay-ajax-timeout":"abort"===b?"pay-ajax-abort":"abort-for-cleanup"===b?"pay-ajax-abort-for-cleanup":"parsererror"===b?"pay-ajax-parsererror":500===a.status?"pay-ajax-500":"pay-ajax-error";if(c){a=c=-1===c.lastIndexOf(".html?")?c+("?ref\x3d"+a):
c+("\x26ref\x3d"+a);E.pageContainer.find("#tempForm").remove();c=u('\x3cform id\x3d"#tempForm" method\x3d"post"\x3e\x3c/form\x3e');c.attr("action",a);if("string"===typeof d){a={};b=d.split("\x26");for(var e=0;e<b.length;e++){var f=b[e].split("\x3d");2===f.length&&(a[f[0]]=f[1])}}else a=d;for(var g in a)"ajaxResponse"!==g&&"returnjson"!==g&&(a=u('\x3cinput type\x3d"hidden"/\x3e').attr("name",g).val(d[g]),c.append(a));E.pageContainer.append(c);c.submit()}}function z(a,b,d,e){var f=k.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),
f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:p(b,a,e),dataType:"text",headers:f,timeout:A,type:"POST",url:a,beforeSend:function(a,b){d&&d.beforeHandler&&d.beforeHandler(a,b)},complete:function(a,b){d&&d.completeHandler&&d.completeHandler(a,b)},error:function(c,e){d&&d.errorHandler?d.errorHandler(c,e):v(c,e,a,b)},success:function(a,b,e){var f=e.getResponseHeader("x-amz-checkout-page");if("payselect"!==f&&"spp-payment"!==f)return a=c.jsonify(a),k.redirect(a);d&&d.successHandler?
d.successHandler(a,b,e):k.ajaxUpdatePage(a,b,e)}};u.extend(f,e);q.push(u.ajax(f))}function x(a,b,c,d){var e=k.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),e={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:p(b,a,d),dataType:"text",headers:e,timeout:A,type:"POST",url:a,error:function(d,e){c&&c.errorHandler?c.errorHandler(d,e):v(d,e,a,b)},success:function(a,b,d){var e=d.getResponseHeader("x-amz-checkout-page");"payselect"!==e&&"spp-payment"!==e&&c&&c.pageUpdater?
c.pageUpdater(a):k.ajaxUpdatePage(a,b,d)}};u.extend(e,d);q.push(u.ajax(e))}function t(){A=parseInt(u("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10);A=isNaN(A)?1E4:A;m.isMobileCX()?K&&(K=!1):(E=m.getElements(r),K&&(a.declarative("close-popover",["click"],d),a.declarative("toggle-msg-popover",["click"],b),a.declarative("a-extender-toggle",["click"],h),K=!1),E.pageContainer.undelegate(".expando-link","click").delegate(".expando-link","click",f),E.pageContainer.find("form select.a-touch-select-input").unbind("change",
g).bind("change",g),u(".a-dropdown-container").each(function(){l.remove(u(this).find("select").attr("name"))}),u(document).bind("click",function(a){a.isPropagationStopped()||0===u(a.target).closest(".pay-popover-msg").length&&E.msgPopovers.filter(":visible").hide()}))}function g(a){var b=u(a.currentTarget);a=b.siblings("a.a-placeholder");b=b.find(":selected").text();a.html(b);return!1}var u=a.$,K=!0,A,q=[],D=["forceResponsive","fromAnywhere","hasWorkingJavascript"],E={},r={msgPopovers:"div.pay-popover-msg",
pageContainer:"div.a-container"};a.on("checkout:reload:payselect",t);a.on("checkout:reload:spp-payment",t);return m.mergeFrom({decodeJSONResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:E,getNumberWithSeparators:w,handleForm:function(a,b,c){a.$event.preventDefault();
var d=a.$declarativeParent;d.is("span")&&(d=d.find("form"));d=d.serializeArray();d=m.processSubmissionParameters(d);z(a.data.action,d,b,c)},makeAjaxCall:z,handleAjaxError:v,handlePaymentsPortalForm:function(a,b,c,d){a=m.processSubmissionParameters(a.submissionParameters);z(b,a,c,d)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,b,c,d){a=m.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;x(b,a,c,d)}},m)});"use strict";r.when("A","pay-common-lib","page-transition-controller").register("pay-mobile-util",
function(a,m,l){function c(a,b,c){a=a||{};var d=z.fromAnywhereField.val(),e=c&&c.useSif?p('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0,f=n();"string"===typeof a?(a=a+"\x26ajaxResponse\x3d1\x26currentPage\x3d"+f,-1===b.search("fromAnywhere")&&-1===a.search("fromAnywhere")&&(a=a+"\x26fromAnywhere\x3d"+d),e&&(a+="\x26isAmazonApp\x3d1")):(a.ajaxResponse=1,a.currentPage=f,-1===b.search("fromAnywhere")&&(a.fromAnywhere=d),e&&(a.isAmazonApp=1),c&&c.isAddCardAndContinueEnabled&&(a.isHideSpinnerDisabled=
!0));return a}function e(){w&&w.abort("abort-for-cleanup");w=null}function k(a,b,c,d){a=a&&a.status;b="timeout"===b?"pay-ajax-timeout":"abort"===b?"pay-ajax-abort":"abort-for-cleanup"===b?"pay-ajax-abort-for-cleanup":"parsererror"===b?"pay-ajax-parsererror":500===a?"pay-ajax-500":"unknown"===a?"pay-unknown-page":"pay-ajax-error";c&&(c=-1===c.lastIndexOf(".html?")?c+("?ref\x3d"+b):c+("\x26ref\x3d"+b),h(c,d))}function n(){var a;p.each(v,function(b,c){if(c.pageId&&p(c.pageId).is(":visible"))return a=
b,!1});return a}function d(a){(a=v[a]&&v[a].componentId)&&r.when(a).execute(function(a){a.init&&a.init()})}function f(a,b,e,f,h){h&&h.suppressSpinner||l.show();h={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:c(b,a,f),dataType:"text",timeout:g,type:"POST",url:a,beforeSend:function(a,b){e&&e.beforeHandler&&e.beforeHandler(a,b)},complete:function(a,c){e&&e.completeHandler&&e.completeHandler(a,c);b&&b.isHideSpinnerDisabled||l.hide()},error:function(c,d){e&&e.errorHandler?e.errorHandler(c,
d):k(c,d,a,b)},success:function(c,f,g){var h=g.getResponseHeader("x-amz-checkout-pay-page-name");if(h){var l=g.getResponseHeader("x-amz-checkout-pay-page-title");l&&z.pageTitle.text(decodeURIComponent(l));e&&e.successHandler?e.successHandler(c,f,g):z.pageContainer.html(c);d(h)}else k(null,"unknown",a,b)}};p.extend(h,f);w=p.ajax(h)}function h(a,b,c){var d=p("#tempForm",z.pageContainer);0<d.length&&d.remove();d=p('\x3cform method\x3d"post"\x3e\x3c/form\x3e');d.attr("action",a);c&&c.target&&d.attr("target",
c.target);if("string"===typeof b)for(a=b.split("\x26"),b=0;b<a.length;b++)c=a[b].split("\x3d"),2===c.length&&"ajaxResponse"!==c[0]&&(c=p('\x3cinput type\x3d"hidden"/\x3e').attr("name",c[0]).val(c[1]),d.append(c));else for(var e in b)"ajaxResponse"!==e&&d.append(p('\x3cinput type\x3d"hidden"/\x3e').attr("name",e).val(b[e]));z.pageContainer.append(d);d.submit()}function b(a,b,e,f,h){h&&h.suppressSpinner||l.show();h={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:c(b,a,f),dataType:"text",
timeout:g,type:"POST",url:a,complete:function(a,b){e&&e.completeHandler&&e.completeHandler(a,b);l.hide()},error:function(c,d){e&&e.errorHandler?e.errorHandler(c,d):k(c,d,a,b)},success:function(a,b,c){var f=c.getResponseHeader("x-amz-checkout-pay-page-name");if(!f&&e&&e.pageUpdater)e.pageUpdater(a);else{var g=c.getResponseHeader("x-amz-checkout-pay-page-title");g&&z.pageTitle.text(decodeURIComponent(g));e&&e.successHandler?e.successHandler(a,b,c):z.pageContainer.html(a);d(f)}}};p.extend(h,f);w=p.ajax(h)}
var p=a.$,w=null,v={main:{componentId:"page-main",pageId:"#select-payments-view"},"credit-card-rewards":{componentId:"page-rewards",pageId:"#select-payment-rewards-view"},"financial-offer":{componentId:"page-financial-offer",pageId:"#select-payment-financial-offer-view"},"new-payment-methods":{pageId:"#new-payments-view"},"gil-estimates":{pageId:"#gil-estimates-subpage"}},z={},x={cvvHelper:"div#cvv-help-popover",fromAnywhereField:"input[name\x3dfromAnywhere]",jppoints:"div#jppoints",pageContainer:"div#page-container",
pageTitle:"head title"},t=!0,g;return m.mergeFrom({decodeJSonResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:z,getCurrentPage:function(){return z.pageContainer.children("div.page").filter(":visible")},getCurrentPageName:n,getPageId:function(a){a=
a.getResponseHeader("x-amz-checkout-pay-page-name");return v[a]&&v[a].pageId},handleForm:function(a,b,c){a.$event.preventDefault();f(a.data.action,a.$target.serialize(),{successHandler:function(a,c,d){b(a,c,d)}},c)},submitFormRequest:h,init:function(){m.isMobileCX()&&(q.onbeforeunload=e,m.refreshElements(z,x),g=parseInt(p("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10),g=isNaN(g)?1E4:g,t&&(t=!1,p("div.pay-mobile").bind("keypress",function(a){m.prop("activeGoElement",13===a.keyCode?
document.activeElement:null,!0)})))},makeAjaxCall:f,handleAjaxError:k,pages:v,handlePaymentsPortalForm:function(a,b,c,d){a=m.processSubmissionParameters(a.submissionParameters);f(b,a,c,d)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,c,d,e){a=m.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;b(c,a,d,e)}},m)});"use strict";r.when("page-detector","pay-desktop-util","pay-mobile-util").register("pay-common-util",function(a,m,l){return a.isMobile()?l:m});"use strict";
r.when("A","pay-common-util","pay-rewards-currency","checkout-federation-wrapper","safe-apx-helper","weblab-helper").register("pay-validator",function(a,m,l,c,e,k){function n(){function a(b,c,d,e){O.push({identifier:b,priority:d||100,target:c,isPincodeError:e})}function p(a){if(!a)return null;var b=new RegExp(String.fromCharCode(32),"g"),c=new RegExp(String.fromCharCode(45),"g");return a.replace(b,"").replace(c,"")}function n(){return 0<O.length}function v(a){if(!a||0===a.length)return!1;for(var b=
0,c=!1,d=a.length-1;0<=d;--d){var e=a.charAt(d);c&&(e*=2,9<e&&(e-=9));b+=parseInt(e,10);c=!c}return 0===b%10}function z(a,b){return a&&a.match(/^[0-9]+$/)&&a.length===b}function x(a,b,c){return a&&a.match(/^[0-9A-Za-z]+$/)&&a.length>=b&&a.length<=c}function t(a,b){if(!a||!b)return!1;a=parseInt(a,10);b=parseInt(b,10);return g(a,b)}function g(a,b){var c=new Date,d=c.getFullYear();return b>d||b===d&&a>=c.getMonth()+1}function u(a){a=a.val();return!a||0===a.length}function q(){var c=d("#pm_pay_by_check").is(":checked"),
e=d("#existing-balance [paymentmethodid\x3d'availablebalance'] input").is(":checked");c&&e&&a("continue_BadCombinationCheckExistingBalance")}function A(c){if(d("#jppoints").length){var e,f=!1;1===c.length&&"jppoints"===c.attr("id")?(e=c,f=!0):e=c.filter("#jppoints");if(e&&e.find("#redeemPoints").is(":checked")){c=e.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val();c=parseInt(c,10);d('input[type\x3d"checkbox"][name\x3d"useAvailableBalance"]').is(":checked")&&(c-=parseInt(e.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),
10));var g=parseInt(e.find("#redeemableAmount").text(),10),h=e.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]');e.find("#jpPointsMax").is(":checked")?e=g:(e=parseInt(h.val(),10))||(e=0);e>g?a("continue_jpPointsExceedsRedeemableAmount",h):f&&e<c?a("continue_notEnoughJPPoints"):e>c&&a("continue_jpPointsExceedsTotalPurchase")}}}function L(c){c&&(c=c.find(".pci-blocking-cvv"),c.length&&c.is(":visible")&&a("PCI_Block_CVV"))}function D(c){var d=c.find(".currency-list");d.length&&d.is(":visible")&&
(c=d.find("[type\x3dradio]:checked").val(),d=d.find("#cardCurrencyDropDown option:selected").val(),c&&("Other"!==c||"-1"!==d&&"-2"!==d)||a("continue_SelectCardCurrency"))}function E(c){var d=c.find("#existingCvvNum");if(0!==d.length){var e=d.val();c=f?c.data("validcvvlength"):c.attr("validcvvlength");z(e,parseInt(c,10))||a("continue_BadSecurityCode",d)}}function M(c){var d=c.find('input[name\x3d"paymentMethod"]').val();/^creditCard/.test(d)&&c.find("#savedCardSuppressed").length&&a("continue_BankTemporarilyNotAvailable")}
function P(c){c=c.find("#existingPincodeNum");if(0!==c.length){var d=c.val();d?x(d,4,8)||a("existingCreditCard_PincodeInvalid",c,null,!m.isMobileCX()):a("continue_EmptyPincode",c)}}function H(c){if(c&&c.length)for(var e=0;e<c.length;e++){var f=d(c[e]);L(f.parent());E(f);P(f);"netBanking"===f.find('input[name\x3d"paymentMethod"]').val()&&(d("#netBanking_select").val(),d("#net-banking-list").find("option:selected").data("isdisabled")&&a("continue_BankTemporarilyNotAvailable"));M(f);var g=f;g.find('input[name\x3d"paymentMethod"]').val();
g.find("#vdcBanksSelect").val();d("#vdcBanksSelect").find("option:selected").data("isdisabled")&&a("continue_BankTemporarilyNotAvailable");ba(f);f=f.siblings("#upi-acceptance-input").find("#vpaCollect");if(!f||f.length)(g=f.val())&&g.match(/.+@.+/)||a("continue_BadVpaForUpi",f)}}function N(c){var d=c.find("#newMonth"),e=c.find("#newYear");c=c.find("#newExpDate");!(d=d.length&&!t(d.val(),e.val()))&&(d=c.length)&&((c=c.val())?(d=c.split("-"),c=parseInt(d[0],10),d=parseInt(d[1],10),c=g(d,c)):c=!1,d=
!c);d&&a("continue_BadExpiration")}function Q(c){"domesticCards"===c.find('input[name\x3d"paymentMethod"]').val()&&((c=c.find("select").val())&&c.match(/^[0-9]*$/)||a("continue_BlankSlate"))}function W(c){var e=d("#existing-balance input[name\x3duseFlexiblePayments]").is(":checked");c=m.getAttributeData(c,"paymentmethodtype");e&&"creditCard"!==c&&a("continue_FlexiblePaymentsNeedsCreditCard")}function F(c){"thirdPartyAccounts"===c.find('input[name\x3d"paymentMethod"]').val()&&((c=c.find("select").val())&&
0!==c.length||a("continue_BlankSlate"))}function B(c){var d=c.find(".rewards-list");if(d.length&&d.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked")){c=d.find("input.custom-rewards-input");var e=c.val();if(d.hasClass("show-currency-input-widget-new")){var d=c.data("country-code"),f=l.getCurrencyFormatByCountryCode(d),d=c.data("min"),e=l.getAmount(e,f.decimalPlace);e<d&&a("continue_BadRewardsMin")}else/^\s*$/.test(e)||isNaN(e)?a("continue_BadRewardsValue"):(e=parseFloat(c.val()),
d=c.data("min"),0>=e||e<d?a("continue_BadRewardsMin"):e>c.data().max&&a("continue_BadRewardsMax"))}}function Y(c){var e=c.find('input[name\x3d"paymentMethod"]').val();"verifiedCreditCard"===e?a("continue_BlankSlate"):"verifiedDebitCard"===e&&(e=c.find("#vdcBanksSelect").val(),(""===e||"OtherBanks"===e||"1"===d("#save_citi_card").val()&&"CIT"===e)&&a("continue_BlankSlate"),c.find("option:selected").prop("disabled")&&a("continue_BankTemporarilyNotAvailable"))}function ca(c){"cashOnDeliveryCash"===c.find('input[name\x3d"paymentMethod"]').val()&&
c.find(".phonenumberNotVerified").length&&a("continue_OTPforCOD")}function Z(c){if("netBanking"===c.find('input[name\x3d"paymentMethod"]').val()){var d=c.find("#net-banking-select-list").val();c=c.find("option:selected").prop("disabled");""===d&&a("continue_BlankSlate");c&&a("continue_BankTemporarilyNotAvailable")}}function aa(c){"morePaymentMethod"===c.find('input[name\x3d"paymentMethod"]').val()&&""===c.find("#more-payment-methods-select-list").val()&&a("continue_BlankSlate")}function ba(c){var e=
c.find('input[name\x3d"paymentMethod"]').val();if("StandaloneInstallment"===e||"StandaloneCreditCardInstallment"===e||"StandaloneReusableCreditLineInstallment"===e)c.find('input[name\x3d"gilShowContinueBlocker"]').val()&&("StandaloneCreditCardInstallment"===e?a("continue_GilCCContinueError"):"StandaloneReusableCreditLineInstallment"===e?a("continue_GilRCLContinueError"):a("continue_GilContinueError")),c.find('input[name\x3d"showIneligibleItemSubpage"]').val()&&("StandaloneCreditCardInstallment"===
e?a("continue_GilCCContinueErrorIneligibleItems"):"StandaloneReusableCreditLineInstallment"===e?a("continue_GilRCLContinueErrorIneligibleItems"):a("continue_GilContinueErrorIneligibleItems")),c.find('input[name\x3d"gilShowContinueBlockerIfPromotions"]').val()&&0<d("#existing-balance input[name\x3duseAvailableBalance]:checked").length&&("StandaloneCreditCardInstallment"===e?a("continue_GilCCContinueErrorPromotions"):"StandaloneReusableCreditLineInstallment"===e?a("continue_GilRCLContinueErrorPromotions"):
a("continue_GilContinueErrorPromotions"))}var O=[],X=null,fa=null,y=function(a){h=a};h||(m.isMobileCX()?r.when("rewards-section-mobile").execute(y):r.when("rewards-section-desktop").execute(y));return{displayErrors:function(a,b){(X=a)&&X.hide().find(".error-message").hide().addClass("hidden");(fa=b)&&fa.find(".a-form-error").removeClass("a-form-error");if(n()){for(a=0;a<O.length;a++){b=O[a];if(b.target){var c=b.target.parent();c.hasClass("a-input-text-wrapper")&&!c.hasClass("a-form-error")?c.addClass("a-form-error"):
b.target.hasClass("a-form-error")||b.target.addClass("a-form-error")}b=b.identifier;(X&&X.length?X.find("#"+b):d("#"+b)).show().removeClass("hidden")}X&&X.length&&X.show()}},getHighestErrorId:function(){for(var a={priority:100},b=0;b<O.length;b++){var c=O[b],e;(e=c.identifier)?(e=X&&X.length?X.find("#"+e):d("#"+e),e=parseInt(m.getAttributeData(e,"priority"),10),e=isNaN(e)?100:e):e=100;e<=a.priority&&(a={identifier:c.identifier,priority:e,isPincodeError:c.isPincodeError,target:c.target})}return a},
hasErrors:n,isValidCardCVV:z,isValidCardPincode:x,validateBankAccountNum:function(c,d){u(c)&&a("addBankAccount_NoAccountNumber",d)},validateBankAccountNumConfirm:function(c,d,e){c.val()!==d.val()&&a("addBankAccount_AccountNumberMismatch",e)},validateBankDriverLicense:function(c,d){u(c)&&a("addBankAccount_NoDLNumber",d)},validateBankDriverLicenseState:function(c,d){void 0!==c.val()&&""!==c.val()&&"0"!==c.val()||a("addBankAccount_NoDLState",d)},validateBankHolderName:function(c,d){u(c)&&a("addBankAccount_NoName",
d)},validateBankRoutingNum:function(c,d){9!==c.val().length&&a("addBankAccount_ShortRoutingNumber",d)},validateCreditCardCVV2:function(c,d,e){e="true"===c.attr("isaddresschallenge")?c.attr("issuer"):e&&e.charAt(0);"R"!==e&&(c=c.val(),z(c,"A"===e?4:3)||a("addCreditCard_BadSecurityCode",d))},validateCreditCardDate:function(c,d,e,f){t(c.val(),e.val())||(a("addCreditCard_BadExpiration",d),a("addCreditCard_BadExpiration",f))},validateCreditCardMobile:function(c,d){c=c.val();k.isUpdateMobileNumberEnabled()?
c&&c.replace(/[^0-9]/g,"").match(/^1[0-9]{10}$/)||a("addCreditCard_BadMobileNumber",d):c&&c.replace(/[^0-9]/g,"").match(/^1[34578]{1}[0-9]{9}$/)||a("addCreditCard_BadMobileNumber",d)},validateCreditCardPincode:function(c,d){(c=c.val())&&c.match(/^[a-zA-Z0-9]{4,8}$/)||a("addCreditCard_BadPincode",d)},validateCreditCardName:function(c,d){u(c)&&a("addCreditCard_NoName",d)},validateCreditCardNumber:function(c,e){var f=p(c.val());f&&10<f.length&&v(f)||a("addCreditCard_BadNumber",e);f=d("#creditCardIssuersBlocked").val();
c=c.data("issuer");f&&""!==f&&c&&""!==c&&-1<d.inArray(c,f.split(","))&&a("addCreditCard_IssuerUnsupported",e)},validateSBIMaestroCardNumberLength:function(c,d){19!==p(c.val()).length&&a("addCreditCard_SBIMaestro_BadNumberLength",d)},isAMEXCreditCard:function(a){a=p(a.val());return null!==a?0===a.indexOf("37")||0===a.indexOf("34"):!1},validateCreditCardTail:function(c,d){var e=p(c.val());e&&10<e.length&&v(e)?(c=(m.isMobileCX()&&f?c.parent().data():c.data()).tail+"",e.substr(e.length-c.length)!==c&&
a("addCreditCard_NotMatch",d)):a("addCreditCard_NotMatch",d)},validateCreditCardType:function(c,d){c.is(":visible")&&((c=c.val())&&c.match(/^[A-Z][0-9]*$/)||a("addCreditCard_NoType",d))},validateRegistrationResult:function(c){c.cardStatus?1===c.checkStatusCount&&a("addCreditCard_RegisterFailed"):0<c.errors.length&&a("addCreditCard_RegisterFailed")},validateDirectDebitAccountName:function(c,d){u(c)&&a("addDirectDebit_NoAccountOwnerName",d)},validateDirectDebitAccountNum:function(c,d){u(c)&&a("addDirectDebit_NoAccountNumber",
d)},validateDirectDebitRoutingNum:function(c,d){u(c)&&a("addDirectDebit_NoRoutingNumber",d)},validateInvoiceFirstName:function(c,d){u(c)&&a("addInvoiceAccount_NoFirstName",d)},validateInvoiceLastName:function(c,d){u(c)&&a("addInvoiceAccount_NoLastName",d)},validateLocName:function(c,d){u(c)&&a("addLoc_NoName",d)},validateLocNumber:function(c,d){u(c)&&a("addLoc_BadNumber",d)},validateNewGiftPromotion:function(c,d){u(c)&&a("addGiftCardOrPromo_NoCode",d)},validatePayment:function(e){if(m.isMobileCX())H(e),
h&&c.wrap(function(){h.validatePaymentRewardsInRewardsSection(a)},"shopwithpointsmobile");else if(q(),e&&e.length){for(var f=0;f<e.length;f++){var g=d(e[f]);"true"===m.getAttributeData(g,"isaddresschallenge")&&a("continue_AddressChallenge");"true"===m.getAttributeData(g,"isverifiedfail")&&a("continue_VerifiedFail");"true"===m.getAttributeData(g,"iscupcardexpired")&&a("continue_CUPExpired");L(g);D(g);E(g);P(g);N(g);Q(g);W(g);F(g);B(g);Y(g);Z(g);aa(g);ba(g);ca(g);M(g)}h&&c.wrap(function(){h.validatePaymentRewardsInRewardsSection(a)},
"shopwithpoints");A(e)}else a("continue_BlankSlate")},validateGetCreditCardTypeResult:function(c){if(c.errors&&0<c.errors.length)for(var d=0;d<c.errors.length;d++)a(c.errors[d])},validateEMIMenuForContinueButton:function(c){var d=c.find("#emiPaymentMethodsSelectList").find("option:selected").val();if("CreditCard"===d||"SelectOption"===d)a("continue_BlankSlate");else if(d=d.split("."),1<d.length){var e=d[0];if("emiCreditCard"===e||"netbankingEMI"===e)c=c.find("."+d[1]),c=c.find(".emiMenuTenuresDropDown"),
c.length&&!c.find("option:selected").val()&&a("continue_BlankSlate")}},apxValidatePayment:function(a,b){var c=e.get("payselect");c&&c.validatePayments(this,b,a)},addError:a,errors:O,validatePCICVVBlock:L}}var d=a.$,f=q.P&&q.P.AUI_BUILD_DATE,h=void 0;return{create:function(){return new n}}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator").register("pay-credit-card",function(a,m,l,c){function e(a,c,b,d){a&&a.length&&(c=b+"-"+c,(b=l.prop(c))&&(a=a.find(d).val(b))&&a.length&&
(l.isMobileCX()?a.closest(".card-cvv-field").hide().data("isHidden",1):a.closest(".a-column").hide(),l.prop(c,void 0)))}var k=a.$,n={cc:!1,vcc:!1,vdc:!1},d=q.P&&q.P.AUI_BUILD_DATE;return{confirmCreditCard:function(a,c,b){a.currentPaymentInstrumentID=a.paymentmethodid;a.recommendedPaymentMethodId=a.paymentmethodid;if(a.newMonth&&a.newYear)a.month=a.newMonth,a.year=a.newYear;else if(a.newExpDate){var d=a.newExpDate.split("-");a.year=parseInt(d[0],10);a.month=parseInt(d[1],10)}else a.expmonth&&a.expyear&&
(a.month=a.expmonth,a.year=a.expyear);(d="existingCvvNum"in a?a.addCreditCardVerificationNumber=a.existingCvvNum:a.addCreditCardVerificationNumber)&&l.prop("cvv-"+a.paymentmethodid,d);(d="existingPincodeNum"in a?a.addCreditCardPincode=a.existingPincodeNum:a.addCreditCardPincode)&&l.prop("pincode-"+a.paymentmethodid,d);l.makeAjaxCall(b,a,{successHandler:c,errorHandler:function(b,c){a.handler="confirm-credit-card";l.handleAjaxError(b,c,"/gp/buy/payselect/handlers/submit.html",a)}},{useSif:!0})},handleCreditCardType:function(a,
d){var b=a.$target,e=a.data.type,k=c.create();a.$currentTarget.data("issuer","");k.validateCreditCardNumber(b,b);k.hasErrors()||(n[e]=!0,l.makeAjaxCall(a.data.url,{addCreditCardNumber:b.val(),returnjson:1},{completeHandler:function(){n[e]=!1},successHandler:function(b){b=m.jsonify(b);d(b,e);a.$currentTarget.data("issuer",b.issuer)}},{useSif:!0},{suppressSpinner:!0}))},isWaitingForType:function(a){return n[a]},runConfirmCardValidator:function(a,d){var b=a.find("#existingCvvNum"),b=b.length?b:a.find("#addCreditCardVerificationNumber"),
e=a.find("#addCreditCardNumber"),k=a.find("#newMonth"),l=a.find("#newYear"),m=c.create();m.validateCreditCardTail(e,e);k.length&&l.length&&m.validateCreditCardDate(k,k.closest(".card-date").find(".a-button"),l,l.closest(".card-date").find(".a-button"));b.length&&(e=(e=a.find("#issuer"))&&e.val(),m.validateCreditCardCVV2(b,b,e));m.displayErrors(d,a);return m.hasErrors()},setDateSelectorStatus:function(a,c){var b=c.find(".card-date").find("select");b&&b.length&&r.when("a-dropdown").execute(function(c){b.each(function(){var b=
k(this).attr("id");c.updateSelect(b,{status:"21"===a.brand&&"G"===a.issuer?"disabled":"enabled"})})})},setNewCardCVVInputStatus:function(a){(l.prop("cvv-newcard")||l.prop("pincode-newcard"))&&a.each(function(){var a=k(this);if("1"===(d?a.data("isnewcard")+"":a.attr("isnewcard")))return e(a,"newcard","cvv","#existingCvvNum"),e(a,"newcard","pincode","#existingPincodeNum"),!1})},setCardPasswordInputStatus:e}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator","page-transition-controller",
"page-conductor","pay-credit-card").register("pay-credit-card-reregistration",function(a,m,l,c,e,k,n){function d(a,d){var e=c.create(),f=h("#cupMobileNumber-"+a),k=h("#cupSecurityCode-"+a),l=h("#reRegisterCCErrors-"+a);a=h("#reRegisterCCInputs-"+a);e.validateCreditCardCVV2(k,k,d);e.validateCreditCardMobile(f,f);e.displayErrors(l,a);return e.hasErrors()}function f(a,c,d){k.ajaxUpdatePage(a,c,d)}var h=a.$;return{actionReregisterCardInBox:function(a){a.$event.preventDefault();e.show();var c=a.data.type,
k=h("#cupMobileNumber-"+a.data.paymentMethodID).val(),v=h("#cupSecurityCode-"+a.data.paymentMethodID).val();d(a.data.paymentMethodID,c)?e.hide():(c={isReregistering:a.data.isReregistering,currentPaymentInstrumentID:a.data.paymentMethodID,name:a.data.holderName,year:a.data.expiredYear,month:a.data.expiredMonth,addCreditCardMobileNumber:k,addCreditCardVerificationNumber:v},k={useSif:l.isMobileCX()?!0:!1,success:function(a,b,c){a=m.jsonify(a);b=h("#reRegisterCCErrors-"+a.paymentInstrumentId);n.waitForCreditCardStatus(a,
f,b)}},a.$event.preventDefault(),l.makeAjaxCall(a.data.url,c,null,k))}}});"use strict";r.when("A","client-side-metrics","ajax-utility","pay-common-util","pay-validator","existing-payments","page-conductor","checkout-modal-popover","page-transition-controller","pay-credit-card","pay-gil","new-verified-debit-card","emi-helper").register("new-payments",function(a,m,l,c,e,k,n,d,f,h,b,p,w){function v(a){a.$event.preventDefault();var b=a.data.type;if(h.isWaitingForType(b))f.show(),setTimeout(function(){v(a)},
50);else{var d;d="vdc"===b?U.newVDC:"emi"===b?U.newEMI:U.newVCC;if(V(d,b))f.hide();else{f.show();var e=c.getInputValues(d),g="vdc"===b?"_VDC":"_VCC";d=e["addCreditCardVerificationNumber"+g];var k=e["addCreditCardPincode"+g],b={addCreditCardNumber:e["addCreditCardNumber"+g],addCreditCardVerificationNumber:d,addCreditCardPincode:k,handler:e["handler"+g],month:e["month"+g],name:e["name"+g],newPaymentType:b,year:e["year"+g],cctype:e["cctype"+g],isSBIInternationalMaestroSelected:e["isSBIInternationalMaestroSelected"+
g],isCardSavedFromEMIMenu:e["isCardSavedFromEMIMenu"+g]};c.prop("cvv-newcard",d);k&&c.prop("pincode-newcard",k);c.makeAjaxCall(a.data.url,b,{successHandler:function(a,b,c){E(a,b,c);h.setNewCardCVVInputStatus(U.paymentRows)}},{useSif:!0})}}}function z(a){a.$event.preventDefault();var b=a.data.type;if(h.isWaitingForType(b))f.show(),setTimeout(function(){z(a)},50);else{var d=U.newCCFormContent;if(V(d,b))f.hide();else{f.show();b=c.getInputValues(d);b.handler=b.handler_addCCInBox;var d=a.data.url,e={};
G("#cupSecurityCode").is(":visible")&&G("#cupMobileNumber").is(":visible")?(d="/gp/buy/payselect/handlers/add-credit-card.html",e={successHandler:function(a){a=l.jsonify(a);P(a)}}):e={successHandler:E};c.makeAjaxCall(d,b,e,{useSif:!0})}}}function x(a){a.$event.preventDefault();var b=G("#new-giftcard-promotion"),b=c.getInputValues(b);G("input[name\x3disUnifiedActionsDesignEnabled]").length&&t(a)||(b.handler=b.handler_addGCInBox,a=a.data.url,f.show(),c.makeAjaxCall(a,b,{successHandler:function(a,b,
d){n.ajaxUpdatePage(a,b,d);ua||c.scrollTopTo(G("#existing-balance"))}},{useSif:!0}))}function t(a){a=a.$declarativeParent;var b=G("#gcpromoinput"),c=e.create();c.validateNewGiftPromotion(b,b);c.displayErrors(U.newGCErrors,a);return c.hasErrors()}function g(a){var b=G(a.currentTarget).parents("div.new-payment-line").find(".card-date select");if(b&&b.length){var c=G(a.currentTarget).val();r.when("a-dropdown").execute(function(a){b.each(function(){var b=G(this).attr("id");a.updateSelect(b,{status:"G21"===
c?"disabled":"enabled"})})})}}function u(a){var b=U.newVDC.find(".vdc-form-fields"),c=U.newVDC.find("#vdc-logo-prompt"),d=U.newVDC.find(".top-cell");a?b.show():b.hide();a?c.show():c.hide();a?d.addClass():d.removeClass()}function q(a){var b=G(a.currentTarget).val(),c=U.newVDC.find("#suppressedVerifiedDebitCard").hide(),d=U.newVDC.find(".vdc-selected-bank-prompt").hide();u(!1);var e="1"===U.newVDC.find("#isRupayAsSavedCardEnabled").val()&&"URP"===b;"OtherBanks"===b||"1"===G("#save_citi_card").val()&&
"CIT"===b||e?(u(!0),G.isEmptyObject(p)||p.showExpiryDateAndCvv()):"SMP"!==b||G.isEmptyObject(p)?""!==b&&(b=G(a.currentTarget).find("option:selected").prop("disabled"),a=G(a.currentTarget).find("option:selected").text(),b?c.show().find(".suppressed-card-text").html(a):d.show().find(".bank-name-text").html(a)):(u(!0),p.hideExpiryDateAndCvv())}function A(a,b){if(!G.isEmptyObject(w)&&a)return a(b)}function L(a){A(w.removeEMIMenuSelectionAttributes);U.newEMI.find(".emi-group").hide();a=G(a.currentTarget).find("option:selected").val();
U.newEMI.find("#emiMenuErrors_VCC").length&&U.newEMI.find("#emiMenuErrors_VCC").hide();if(a=A(w.showPaymentOptionBlock,a))A(w.addEMIMenuSelectionAttributes),a.show()}function D(a){h.handleCreditCardType(a,ka)}function E(a,b,d){n.ajaxUpdatePage(a,b,d);ua||c.scrollTopTo(k.getSelectedPayment())}function M(a){a.$event.preventDefault();var b=a.data.type;h.isWaitingForType(b)?(f.show(),setTimeout(function(){M(a)},50)):V(a.$declarativeParent,b)?f.hide():(na&&na.hide(),ra&&ra.hide(),f.show(),G("#cupSecurityCode").is(":visible")&&
G("#cupMobileNumber").is(":visible")?(b=a.$declarativeParent.serializeArray(),b=c.processSubmissionParameters(b),c.makeAjaxCall("/gp/buy/payselect/handlers/add-credit-card.html",b,{successHandler:function(a){a=l.jsonify(a);P(a)}},{useSif:!0})):c.handleForm(a,{successHandler:E},{useSif:!0}))}function P(a){var b={};b.paymentInstrumentId=a.paymentInstrumentId;a.checkStatusCount&&(b.checkStatusCount=a.checkStatusCount);var d={successHandler:function(a){a=l.jsonify(a);var b=e.create();"VERIFIED"===a.cardStatus?
c.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{newPaymentMethodId:a.paymentInstrumentId},{successHandler:E}):"PENDING"===a.cardStatus?(a.checkStatusCount?(a.checkStatusCount=parseInt(a.checkStatusCount,10),isNaN(a.checkStatusCount)&&(a.checkStatusCount=1)):a.checkStatusCount=3,b.validateRegistrationResult(a),1===a.checkStatusCount?(f.hide(),b.displayErrors(U.newCCErrors)):(--a.checkStatusCount,P(a))):(b.validateRegistrationResult(a),f.hide(),b.displayErrors(U.newCCErrors))}};setTimeout(function(){c.makeAjaxCall("/gp/buy/payselect/handlers/check-credit-card-status.html",
b,d)},2500)}function H(a){a.$event.preventDefault();var b=a.$declarativeParent,d=b.find("#loc-name"),g=b.find("#loc-number"),h=e.create();h.validateLocName(d,d);h.validateLocNumber(g,g);h.displayErrors(b.find("#error-box-new-loc"),b);h.hasErrors()||(da&&da.hide(),f.show(),c.handleForm(a,{successHandler:E}))}function N(a){a.$event.preventDefault();var b=a.$declarativeParent,d=b.find("#gcpromoinput");b.find("#gcpromosuccessblock").hide();var g=e.create();g.validateNewGiftPromotion(d,d);g.displayErrors(U.newGCErrors,
b);g.hasErrors()||(f.show(),c.handleForm(a,{successHandler:function(a,b,d){n.ajaxUpdatePage(a,b,d);ua?U.newGCErrors.is(":visible")&&G("#gc-link-expander").trigger("click"):c.scrollTopTo(G("#existing-balance"))}}))}function Q(a){a.$event.preventDefault();G("#ccAddCard").trigger("submit")}function W(a){a.$event.preventDefault();G("#bank-address-popover-submit").trigger("submit")}function F(a){a.$event.preventDefault();G("#direct-debit-popover-submit").trigger("submit")}function B(a){a.$event.preventDefault();
G("#new-loc-popover-submit").trigger("submit")}function Y(a){a.$event.preventDefault();G("#new-invoice-popover-submit").trigger("submit")}function ca(a){a.$event.preventDefault();G("#brdcAddCard").trigger("submit")}function Z(a){a.$event.preventDefault();var b=a.$declarativeParent,d=e.create(),g=b.find("#bank-name"),h=b.find("#bank-routing-number"),k=b.find("#bank-account-number"),l=b.find("#bank-account-number-confirm"),m=b.find("#bank-dl"),p=b.find("#bank-dl-state");d.validateBankHolderName(g,g);
d.validateBankRoutingNum(h,h);d.validateBankAccountNum(k,k);d.validateBankAccountNumConfirm(k,l,l);d.validateBankDriverLicense(m,m);d.validateBankDriverLicenseState(p,p.parents("div.a-button-dropdown"));d.displayErrors(b.find("#new-bank-error-box"),b);d.hasErrors()||(pa&&pa.hide(),f.show(),c.handleForm(a,{successHandler:E}))}function aa(a){a.$event.preventDefault();var b=a.$declarativeParent,d=e.create(),g=b.find("#debit-bank-routing-number"),h=b.find("#debit-account-number"),k=b.find("#debit-account-name");
d.validateDirectDebitRoutingNum(g,g);d.validateDirectDebitAccountNum(h,h);d.validateDirectDebitAccountName(k,k);d.displayErrors(b.find("#new-direct-debit-error"),b);d.hasErrors()||(va&&va.hide(),f.show(),c.handleForm(a,{successHandler:E}))}function ba(a){a.$event.preventDefault();var b=a.$declarativeParent,d=e.create(),g=b.find("#invoice-first-name"),h=b.find("#invoice-last-name");d.validateInvoiceFirstName(g,g);d.validateInvoiceLastName(h,h);d.displayErrors(b.find("#new-invoice-error-box"),b);d.hasErrors()||
(ta&&ta.hide(),f.show(),c.handleForm(a,{successHandler:E}))}function O(a){a=G("#order-summary-total");var b=G("#order-summary-container");a.prev().addClass("a-first");b.addClass("a-box-group");a.show();c.isTouchCX()&&b.parent().find(".bottom-order-summary").show();U.newCCFormContent.is(":visible")||G("#wrapper-new-cc").find("a.a-link-expander").trigger("click");G("#ecard-help-link").show()}function X(a){var b="Unknown";c.isDesktopCX()?b="Desktop":c.isMobileCX()?b="Mobile":c.isTouchCX()&&(b="Tablet");
m.increaseCount("PayPage-ClientSide-AddCupClick-"+b,1);b=G("#cupForm");if(0<b.length)b.submit();else{var d=G("\x3cform\x3e\x3c/form\x3e");d.attr({target:"_blank",method:"POST",action:a.data.url});G("#cup-dc").find("input").each(function(){var a=G(this);"hidden"===a.attr("type")&&a.clone().appendTo(d)});G("body").append(d);d.submit();d.remove()}}function fa(b){var e=b.$target.closest(".a-popover"),g=e.data("a-popover-id");d.hideById(g);e.hide();G("#a-popover-modal").hide();f.show();c.makeAjaxCall(b.data.url,
void 0,{successHandler:function(b){G("#existing-payment-methods").replaceWith(G(b).find("#existing-payment-methods"));a.trigger("checkout:reload:payselect");f.hide()}})}function y(a){a.$event.preventDefault();a=a.data;f.show();b.submitNewGilPayment(a.subtype)}function ea(){if(!c.isMobileCX()){0===G("#form-add-credit-card").length&&(G("#ccAddCard").parents("div.cc-submit").hide(),G("#ccAddCardWithButton").parents("div.cc-submit").show());G("html").hasClass("a-ie6")&&(G("#cup-mbdc").show(),G(".mbdc-link").attr("data-action",
"redirect-cup"));U=c.getElements(R);U.bankNumberConfirm.show();U.newVDC.find(".payment-row").data("hasstatus")||U.newVDC.find(".vdc-form-fields").hide();U.newVDC.find("#suppressedVerifiedDebitCard").hide();U.newCCFormContent.find(".cup-card-field").hide();U.newPayments.find("#cupInfoMessage").hide();U.newPayments.find("#use-ecard-link").show();U.newPayments.find(".mbdc-link").show();U.newPayments.find(".mbdc-button").hide();ua=!1;U.newPayments.each(function(){var a=G(this),b=a.data();b&&0===b.hasstatus?
(a.find("a.a-link-expander i.js-hide").remove(),a.find("a.a-link-section-expander i.js-hide").remove()):b&&1===b.hasstatus&&!ua&&(c.scrollTopTo(a),ua=!0)});var b=U.newVCC.find("#requireCVVOrPincode");b&&b.length&&b.val("1");za&&(a.declarative("new-cc",["submit"],M),a.declarative("new-brdc",["submit"],M),a.declarative("new-loc",["submit"],H),a.declarative("show-card-image",["change"],D),a.declarative("new-giftcard-promotion",["submit"],N),a.declarative("new-verified-card",["click"],v),a.declarative("new-cc-in-dashboard",
["click"],z),a.declarative("new-gc-in-dashboard",["click"],x),a.declarative("add-bank-account",["submit"],Z),a.declarative("add-direct-debit",["submit"],aa),a.declarative("add-invoice",["submit"],ba),a.declarative("show-order-summary",["click"],O),a.declarative("redirect-cup",["click"],X),a.declarative("cup-popover-close",["click"],fa),a.declarative("add-new-debit-and-cc-popover-submit",["click"],Q),a.declarative("add-bank-account-popover-submit",["click"],W),a.declarative("add-loc-account-popover-submit",
["click"],B),a.declarative("new-gil-payment",["click"],y),a.declarative("add-direct-debit-popover-submit",["click"],F),a.declarative("add-invoice-account-popover-submit",["click"],Y),a.declarative("add-new-br-debit-card-popover-submit",["click"],ca),za=!1);U.cardTypeDropdown.unbind("change",g).bind("change",g);U.vdcBankDropdown.unbind("change",q).bind("change",q);U.emiCardsDropdown.unbind("change",L).bind("change",L);G("div.pay-desktop a.a-link-expander").unbind("keypress");G("div.pay-desktop .a-declarative, div.pay-desktop .a-button").filter("[data-action\x3da-checkout-modal-popover]").unbind("keypress");
a.on("a:popover:show:add-new-debit-cc-modal",function(a){ra=a.popover});a.on("a:popover:show:add-new-bank-account-modal",function(a){pa=a.popover});a.on("a:popover:show:add-new-direct-debit-modal",function(a){va=a.popover});a.on("a:popover:show:add-new-loc-account-modal",function(a){da=a.popover});a.on("a:popover:show:add-invoice-account-modal",function(a){ta=a.popover});a.on("a:popover:show:add-br-debit-card-modal",function(a){na=a.popover})}}function V(a,b){var c,d,g,f,h,k,l,m,p,n,u;"vcc"===b?(c=
"#vccCVVNum",b="#newVCCErrors",d="#vccMonth",g="#vccName",f="#newVerifiedCreditCardNumber",h="#vccType",k="#vccYear",l="#vccPincode",u=n=p=m=void 0):"vdc"===b?(c="#vdcCVVNum",b="#newVDCErrors",d="#vdcMonth",g="#vdcName",f="#newVerifiedDebitCardNumber",h="#vdcType",k="#vdcYear",m="#isSBIMaestroAsSavedCardEnabled",p="#isSBIInternationalMaestroSelected",u=n=l=void 0):"emi"===b?(c="#vccCVVNum",b="#newEMIErrors",d="#vccMonth",g="#vccName",f="#newVerifiedCreditCardNumber",h="#vccType",k="#vccYear",l="#vccPincode",
u=n=p=m=void 0):"brdc"===b?(b="#newBRDCErrors",d="#brdcMonth",g="#brdcName",f="#addCreditCardNumber_BRDC",k="#brdcYear",u=n=p=m=l=h=c=void 0):(n="#cupSecurityCode",u="#cupMobileNumber",c="#ccCVVNum",b="#newCCErrors",d="#ccMonth",g="#ccName",f="#addCreditCardNumber",h="#ccType",k="#ccYear",p=m=l=void 0);c=a.find(c);n&&0===c.length&&a.find(n).is(":visible")&&(c=a.find(n));m="1"===a.find(m).val()&&"1"===a.find(p).val();g=a.find(g);f=a.find(f);u=u?a.find(u):null;d=a.find(d);h=a.find(h);k=a.find(k);var t;
l&&a.find(l).is(":visible")&&(t=a.find(l));l=h.val();p=e.create();p.validateCreditCardName(g,g);p.validateCreditCardNumber(f,f);m&&p.validateSBIMaestroCardNumberLength(f,f);m=d.parent();m=m.hasClass("a-button")?m:m.find(".a-button");g=k.parent();g=g.hasClass("a-button")?g:g.find(".a-button");"G21"!==l&&p.validateCreditCardDate(d,m,k,g);p.validateCreditCardType(h,h.closest(".card-type-field").find(".a-button"));k=l?l.substr(0,1):"";c.length&&"R"!==k&&c.is(":visible")&&p.validateCreditCardCVV2(c,c,
l);u&&u.length&&u.is(":visible")&&p.validateCreditCardMobile(u,u);t&&t.length&&p.validateCreditCardPincode(t,t);p.displayErrors(G(b),a);return p.hasErrors()}function ka(a,b){if(a){"1"===a.isDebitCard?U.newCCWarnings.show().removeClass("hidden"):U.newCCWarnings.hide().addClass("hidden");if("1"===a.hasErrors){var d=e.create();d.validateGetCreditCardTypeResult(a);if(d.hasErrors()){d.displayErrors(U.newCCErrors);return}}b="vcc"===b?U.newVCC:"vdc"===b?U.newVDC:"emi"===b?U.newEMI:"brdc"===b?U.newBRDCFormContent:
U.newCCFormContent;var d=a.specificFields,g=b.find(".cup-card-field");0!==g.length&&(d&&1===d.securityCode&&1===d.mobileNumber?(c.isTouchCX()&&b.find("#addCreditCardNumber").closest(".a-input-text-wrapper").removeClass("last-child"),g.show()):g.hide());d=a.specificFields;g=b.find(".amex-field");if(0!==g.length){var f=b.find(".cvv-field");0!==f.length&&(d&&1===d.pincode?(f.hide(),g.show()):d&&0===d.pincode&&0===d.securityCode?(g.hide(),f.hide()):(g.hide(),f.show()))}d=b.find(".card-images");d.find("img").hide();
f=a.installmentProgram;g=!1;f&&(f=d.find('img[data-installmentprogram\x3d"'+f+'"]'),0!==f.length&&(f.show(),g=!0));g||(a.issuerdisplayimage?d.find("img[data-issuer\x3dATM]").attr("src",a.issuerdisplayimage).show():(g=a.issuer+a.brand,d.find("img[data-issuer\x3d"+g+"]").show(),b.find(R.cardTypeDropdown).val(g).trigger("change")));h.setDateSelectorStatus(a,b)}}var G=a.$,za=!0,ua=!1,U={},R={bankNumberConfirm:"#wrapper-bank-account-number-confirm",btnAddCard:"#ccAddCard",btnAddLoc:"#button-new-loc",btnAddGC:"#button-add-gcpromo",
btnAddBank:"#button-add-bank-account",btnAddDirectDebit:"#button-add-direct-debit",btnAddInvoice:"#button-add-invoice",cardImages:"#newCreditCardImages",cardTypeDropdown:".card-type-dropdown select",newCCFormContent:"#new-cc",newBRDCFormContent:"#new-brdc",newGCErrors:"#gcpromoerrorblock",newGCFormContent:"#gc_entry",newPayments:"div.new-payment-line",newVCC:"#new-verified-credit-cards-table",newVDC:"#new-verified-debit-cards-table",newEMI:"#newEmiCard",paymentRows:"#existing-payment-methods .payment-row",
vdcBankDropdown:"#vdcBanksSelect",emiCardsDropdown:"#emiPaymentMethodsSelectList",cardList:"#existing-credit-cards-box",newCCErrors:"#newCCErrors",newCCWarnings:"#newCCWarnings"},ra,pa,da,va,ta,na;a.on("checkout:reload:payselect",ea);a.on("checkout:reload:spp-payment",ea);return{actionShowOrderSummary:O,handleFormHandlerScrollToSelected:E}});r.when("A","page-detector","client-side-metrics","ready").execute(function(a,m,l){function c(a,c,d,f){a=e(c).is(":checked");q.P&&q.P.AUI_BUILD_DATE?a?e(d).val(e(d).parent().data("account-name")):
e(d).val(""):(l.increaseCount("removeauijs8"),a?(e(f).removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active"),e(d).val(e(d).data("account-name"))):(e(f).removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),e(d).val("")));d="undefined"!==typeof q.ue&&"undefined"!==typeof q.ue.count;f=m.isMobilePayment()?"mobile":"tablet";a=e("#showNameOnCardCheckbox").is(":checked");d&&q.ue.count(f+"NameOnCardCheckBox"+(a?"Checked":"Unchecked"),1)}var e=
a.$;a.declarative("show-card-name",["click"],function(a){c(a,"#showNameOnCardCheckbox","#ccName","#showNameOnCardIcon")});a.declarative("show-br-debit-card-name",["click"],function(a){c(a,"#showNameOnCardCheckbox_BRDC","#brdcName","#showNameOnCardIcon_BRDC")})});"use strict";r.when("A").register("pay-rewards-currency",function(a){var m=function(a,c){c=Math.pow(10,c);a=a.replace(/[^0-9]/g,"");return parseFloat(a)/c},l={CA:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},DE:{groupingSeparator:".",
decimalSeparator:",",decimalPlace:2},GB:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},JP:{groupingSeparator:",",decimalSeparator:".",decimalPlace:0},US:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2}},c=function(a,c,d,e,h){this.groupingSeparator=a;this.decimalSeparator=c;this.currencyDecimalPlace=d;this.pointsDecimalPlace=e;this.ratio=h;this.getCurrencyAmount=function(a){return m(a,this.currencyDecimalPlace)};this.getPointsAmount=function(a){return this.getCurrencyAmount(a)/
this.ratio};this.format=function(a,c){var d=parseInt(a,10);a=parseFloat(a-d).toFixed(c);a=this.decimalSeparator+a.slice(2);d=d.toString();c=3<d.length?d.length%3:0;d=(0<c?d.substr(0,c)+this.groupingSeparator:"")+d.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+this.groupingSeparator);return void 0===a||a===this.decimalSeparator?d:d+a};this.formatCurrency=function(a){return this.format(a,d)};this.formatPoints=function(a){return this.format(a,e)}},e=function(c,e,d,f){this.maxAmount=f;this.rewardsFormatter=
d;this.currencyElement=c;this.pointElement=e;var h=this;this.isControlKey=function(a){switch(a.which){case 8:case 46:return!0;case 86:case 88:return a.ctrlKey;default:return!1}};this.isNavigationKey=function(a){switch(a.which){case 9:case 16:case 17:case 35:case 36:case 37:case 39:return!0;case 65:case 67:return a.ctrlKey;default:return!1}};this.isValidKey=function(a){var c=a.which;return 48<=c&&57>=c||96<=c&&105>=c||8===a.which||46===a.which};this.getCaret=function(){var a=h.currencyElement,c=a.get(0),
d=0,e=0;if("number"===typeof c.selectionStart&&"number"===typeof c.selectionEnd)d=c.selectionStart,e=c.selectionEnd;else{var f=document.selection.createRange();if(void 0!==f&&f.parentElement()===c){var a=a.val(),e=a.length,k=c.createTextRange();k.moveToBookmark(f.getBookmark());c=c.createTextRange();c.collapse(!1);-1<k.compareEndPoints("StartToEnd",c)?d=e:(d=-k.moveStart("character",-e),d+=a.slice(0,d).length-1,-1<k.compareEndPoints("EndToEnd",c)||(e=-k.moveEnd("character",-e),e+=a.slice(0,e).length-
1))}}return{start:d,end:e}};this.setCaret=function(a){var c=h.currencyElement.get(0);c.setSelectionRange?c.setSelectionRange(a,a):c.createTextRange&&(c=c.createTextRange(),c.collapse(!0),c.moveStart("character",a),c.moveEnd("character",a),c.select())};this.bind=function(){h.currencyElement.unbind();h.currencyElement.bind("keydown",function(a){h.isNavigationKey(a)||h.isControlKey(a)||h.isValidKey(a)||a.preventDefault()});h.currencyElement.bind("keyup",function(b){if(!h.isNavigationKey(b)){b=h.getCaret();
var c=h.currencyElement.val().length;h.format();var d=h.currencyElement.val().length;b.start===b.end&&h.setCaret(Math.min(b.start+(d-c),d));a.trigger("inlineFormatter:formattingCompleted",h)}})};this.unbind=function(){h.currencyElement.unbind("keydown keyup")};this.format=function(a){a=h.currencyElement.val();a=h.rewardsFormatter.getCurrencyAmount(a);isNaN(a)&&(a=0);a>h.maxAmount&&(a=h.maxAmount);a=h.rewardsFormatter.formatCurrency(a);h.currencyElement.val(a)}};a.on("inlineFormatter:formattingCompleted",
function(a){var c=a.pointElement,d=a.currencyElement.val(),d=a.rewardsFormatter.getPointsAmount(d);a=a.rewardsFormatter.formatPoints(Math.round(d));c.html(a)});return{getCurrencyFormatByCountryCode:function(a){(a=l[a])||(a=l["default"]);return a},getAmount:m,initializeInlineFormatting:function(k,l,d){var f=k.maxAmount;d=new c(d.groupingSeparator,d.decimalSeparator,d.decimalPlace,l.decimalPlace,l.ratio);k=new e(k.$element,l.$element,d,f);k.bind();k.format(0);a.trigger("inlineFormatter:formattingCompleted",
k)}}});"use strict";r.when("A","pay-common-util","pay-validator","page-conductor","mobile-carrier-billing-util","weblab-helper").register("jppoints",function(a,m,l,c,e,k){function n(){!m.isMobileCX()&&q("#jppoints").length&&(A=m.getElements(L),p())}function d(){var a=A.paymentRows.find('input[type\x3d"radio"][name\x3d"paymentMethod"]');a.closest("div.payment-selected").removeClass("payment-selected");a.attr("checked",!1);m.isTouchCX()&&f(a,"radio")}function f(a,b){a.siblings("i").removeClass("a-icon-touch-"+
b+"-active").addClass("a-icon-touch-"+b+"-inactive")}function h(a,b){a.is(":disabled")||a.siblings("i").removeClass("a-icon-touch-"+b+"-inactive").addClass("a-icon-touch-"+b+"-active")}function b(){return q('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]').is(":checked")}function p(){if(A.jppoints&&A.jppoints.length){b()&&w();A.jppoints.show();var a=A.jppoints.find("#redeemPoints");m.isTouchCX()?a.parents("label").bind("click",x):a.bind("click",x);A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("click",
function(){var a=A.jppoints.find("#jpPointsCustom");a.attr("checked",!0);var b=A.jppoints.find("#redeemPoints");b.attr("checked",!0);m.isTouchCX()&&(h(a,"radio"),f(A.jppoints.find("#jpPointsMax"),"radio"),h(b,"checkbox"))});A.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]').bind("click",v);A.jppoints.find("#jpPointsCustom").bind("click",function(){A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').focus()});A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("keyup",
u)}}function w(){var a=A.jppoints.find("#redeemPoints"),b=A.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),d=A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),e=A.jppoints.find("#redeemableAmount"),g=A.jppoints.find("#redeemableValue");a.attr("checked",!1);a.attr("disabled",!0);b.attr("checked",!1);b.attr("disabled",!0);A.jppoints.find("#jpPointsError").hide();d.val("");d.removeClass("a-form-error");d.attr("disabled",!0);g.text(A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val());
e.text(A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val());c.isSPP()&&(A.jppoints.find("label").addClass("disabled-color"),A.jppoints.removeClass("payment-selected"));m.isTouchCX()&&(f(a,"checkbox"),f(b,"radio"),a.siblings("i").addClass("a-button-disabled"),b.siblings("i").addClass("a-button-disabled"))}function v(b){var c=b.currentTarget,e=A.jppoints.find("#redeemPoints");e.attr("checked",!0);if(m.isTouchCX()){h(q("#"+c.id),"radio");var g;g="jpPointsMax"===c.id?A.jppoints.find("#jpPointsCustom"):
A.jppoints.find("#jpPointsMax");f(g,"radio");h(e,"checkbox")}"true"===c.value&&(A.jppoints.find("#jpPointsError").hide(),c=A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),c.removeClass("a-form-error"),c.val(""),e=A.jppoints.find("#redeemableAmount"),g=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),10),c=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),e=parseInt(e.text(),10)*g,q('input[name\x3d"useAvailableBalance"]').is(":checked")&&
(g=A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),c-=parseInt(g.val(),10)),e>=c&&d());r.when("installments-payselect").execute(function(c){a.trigger("installments-payselect:toggleJPPointsInstallmentEligibility",q(b.currentTarget))})}function z(a){var b=A.jppoints.find("#redeemableAmount"),c=A.jppoints.find("#redeemableValue"),e=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),g;a.is(":checked")?(a=A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val(),
g=A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val(),e-=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),10)):(a=A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),g=A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val());var h=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),10)*a;b.text(a);c.text(g);0>=parseInt(a,10)?
(b=A.jppoints.find("#redeemPoints"),b.attr("checked",!1),c=A.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),c.attr("checked",!1),m.isTouchCX()&&(f(b,"checkbox"),f(c,"radio"))):A.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"][value\x3d"true"]').is(":checked")?h>=e&&d():u()}function x(){var d=A.jppoints.find("#redeemPoints");if(!d.is(":disabled")){d=d.is(":checked");if(m.isTouchCX())d?(f(A.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),"radio"),
g()):(h(A.jppoints.find("#jpPointsMax"),"radio"),f(A.jppoints.find("#jpPointsCustom"),"radio"),t());else if(d)t(),c.isSPP()&&A.jppoints.addClass("payment-selected");else if(g(),c.isSPP()){A.jppoints.removeClass("payment-selected");if(b())return;m.selectDefaultPaymentMethodIfNotSelected()}r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:toggleJPPointsInstallmentEligibility",A.jppoints)})}}function t(){var a=A.jppoints.find("#jpPointsMax");a.attr("checked",!0);
var b=parseInt(A.jppoints.find("#redeemableAmount").text(),10),e=A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),g=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10);m.isTouchCX()&&(f(A.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),"radio"),h(a,"radio"));A.jppoints.find("#jpPointsMax").is(":checked")&&(b>=g?d():c.isSPP()&&A.paymentRows.find("#gcPromo, input[name\x3d'useAvailableBalance']").is(":checked")&&(a=A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),
g-=parseInt(a.val(),10),e>=g&&d()))}function g(){var a=A.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]');a.attr("checked",!1);var b=A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]');b.val("");b.removeClass("a-form-error");A.jppoints.find("#jpPointsError").hide();m.isTouchCX()&&f(a,"radio")}function u(){var b=A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),c=parseInt(b.val(),10);!c||0>c?(b.val(""),A.jppoints.find("#jpPointsError").hide(),A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error")):
(b.val(c),parseInt(A.jppoints.find("#redeemableAmount").text(),10)<c?(A.jppoints.find("#jpPointsError").show(),A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').addClass("a-form-error")):(A.jppoints.find("#jpPointsError").hide(),A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error"),b=parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),parseInt(A.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),
10),c>=b&&d(),r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:actionToggleJPPointsSection",c)})))}var q=a.$,A={},L={paymentRows:"#existing-payment-methods .payment-row",jppoints:"#jppoints",mcbPointsWarning:"#mcbPointsWarning"};a.on("checkout:reload:payselect",n);a.on("checkout:reload:spp-payment",n);return{handleJPPointsOnPaymentRows:function(a){a=q(a.currentTarget);if("jppoints"!==a.attr("id"))if("useAvailableBalance"===a.attr("name"))z(a);else{k.isMCBMultiTenderWeblabEnabled()||
e.hideMCBWarningMessageForPoints(A);var b=a.find('input[type\x3d"radio"][name\x3dpaymentMethod]');if(!k.isMCBMultiTenderWeblabEnabled()&&b.length&&0<b.filter("[value^\x3dMCB]").size())e.showMCBWarningMessageForPoints(A),w();else if("availablebalance"===a.attr("value")||a.find("#pm_300")&&"availablebalance"===a.find("#pm_300").attr("value"))w();else{a=A.jppoints.find("#redeemPoints");var b=A.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),d=A.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),
g=A.jppoints.find("#redeemableAmount"),f=A.jppoints.find("#redeemableValue");c.isSPP()&&A.jppoints.find("label").removeClass("disabled-color");a.attr("disabled",!1);b.attr("disabled",!1);d.attr("disabled",!1);q('#existing-balance input[type\x3d"radio"][value\x3d"availablebalance"]').length&&(g.text(A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val()),f.text(A.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val()));m.isTouchCX()&&(a.siblings("i").removeClass("a-button-disabled"),
b.siblings("i").removeClass("a-button-disabled"))}}},handleJPPointsWithGC:z}});"use strict";r.when("A","ajax-utility","client-side-metrics","pay-common-util","pay-validator","page-transition-controller","page-conductor","a-popover-position","inline-points-register-controller","jppoints","pay-credit-card","checkout-general-utils","a-popover-base","a-dropdown","pay-rewards-currency","cache-page-data-controller","pay-credit-card-reregistration","mobile-carrier-billing-util","emi-helper","instant-bank-discount-helper",
"recommendation-helper","safe-apx-helper","apb-limit-messaging-helper").register("existing-payments",function(a,m,l,c,e,k,n,d,f,h,b,p,w,v,z,x,t,g,u,K,A,L,D){function E(){return C.paymentRows.filter(function(){return I(this).hasClass("payment-selected")||I(this).find("#redeemPoints").is(":checked")})}function M(a){k.show();a.$event.preventDefault();var b=E().find(".card-unreg-rewards").data();b.recommendedPaymentMethodId=b.paymentinstrumentid;c.makeAjaxCall(a.$target.attr("href"),b)}function P(b){b=
I(b.currentTarget);var d=b.data();if(!(0>=d.ratio)){var e=b.val()/d.ratio;if(!isNaN(e)){var g=b.val();g<d.min&&(e=0);b=c.getNumberWithSeparators(e,d.decimalplaces);E().find(".custom-reward-points").html(b);r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:actionToggleRewardsSection",g)})}}}function H(a){1===a.data.refresh&&(k.show(),c.makeAjaxCall(a.data.url))}function N(a){Ea(a)?(a=C.continueBtns,a.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),
a.find(".a-button-disabled").removeClass("aok-hidden")):I("#payPageContinueBtnStateFixEnabled").length&&ca(a)}function Q(a){c.isTouchCX()&&(Ea()?a.$event.preventDefault():(C.continueErrPopover.hide().find(".error-message").hide(),k.show()))}function W(a){c.isTouchCX()&&(Ea()||C.continueErrPopover.hide().find(".error-message").hide())}function F(a){a=I(a.currentTarget);a.click();a=a.closest(".payment-container");a.find("#cc-errors").is(":visible")?a.find(".tv-update .a-button-primary").focus():a.click()}
function B(a){a.$event.preventDefault();var d=E();if(!b.runConfirmCardValidator(d,d.find("#cc-errors"))){k.show();var e=(d=c.getInputValues(d))||{},g=c.getInputValues(C.hiddenFormFields),f;for(f in g)g.hasOwnProperty(f)&&(e[f]=g[f]);b.confirmCreditCard(d,ta,a.data.url)}}function Y(){C.continueErrPopover.filter(":visible").length&&C.continueErrPopover.hide()}function ca(){C.continueErrPopover.filter(":visible").length&&C.continueErrPopover.hide().find(".error-message").hide();var a=E();C.disableSubmitButtons.length?
a.find(".no-address").length||(a.find(".continue-center").removeClass("aok-hidden"),a.find(".a-button-disabled").addClass("aok-hidden")):(C.continueBtns.find(".a-button-primary:not(.a-button-disabled)").removeClass("aok-hidden"),C.continueBtns.find(".a-button-disabled").addClass("aok-hidden"));if(a){var b=a.find(".a-form-error");b&&b.length&&(b.removeClass("a-form-error"),(a=a.find(".pincode-err-block").filter(":visible"))&&a.length&&(C.continueErrPopover.hide().find(".error-message").hide(),C.continueBtns.find(".a-button-primary").removeClass("aok-hidden"),
C.continueBtns.find(".a-button-disabled").addClass("aok-hidden"),a.hide()))}}function Z(){C.continueErrPopover.filter(":visible").length||C.continueBtnTop.trigger("click")}function aa(a){if(13===a.which){var b=I(document.activeElement),d=b.closest("div.payment-row"),e=b.closest(".a-button"),b=b.get(0).tagName;if(d.length&&!e.length&&"A"!==b&&"a"!==b)return d=d.find('input[type\x3d"submit"]'),d.length?d.trigger("click"):(C.continueErrPopover.filter(":visible").length&&C.continueErrPopover.hide(),Ea(a)?
(c.isTouchCX()||(C.continueBtns.find(".a-button-primary").addClass("aok-hidden"),C.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")),a.preventDefault()):C.continueBtnTop.trigger("click")),!1}}function ba(a){k.show();var b=E(),d=b.find("input[type\x3dradio][name\x3dpaymentMethod]").val(),e=b.find(".card-unreg-rewards").data(),b=c.isTouchCX()?b.find(".flag-register-rewards"):C.rewardsRegister,b=c.getInputValues(b);b.programid=e.programid;b.paymentinstrumentid=e.paymentinstrumentid;
b.CARD_EXPIRATION_DATE=e.expiredate;b.CARD_HOLDER_NAME=e.holdername;b.returnRefreshedPage=a.data.returnRefreshedPage;b.rewardsdateofbirthmonth&&b.rewardsdateofbirthday&&(b.DATE_OF_BIRTH=b.rewardsdateofbirthmonth+b.rewardsdateofbirthday);-1===a.data.url.toLowerCase().indexOf("cachebuster")&&(a.data.url=p.addQueryStringParameter(a.data.url,"cacheBuster",(new Date).getTime()));c.makeAjaxCall(a.data.url,b,{successHandler:function(a,b,e){k.hide();if(a){a=m.jsonify(a);C.rewardsRegister.find(".register-content").hide();
var g=c.isTouchCX()?E().find(".register-error"):C.rewardsRegister.find(".register-error");g.hide();a.error?g.show().find(".error-message").hide().filter("#"+a.error).show():(n.ajaxUpdatePage(a.refreshedPage,b,e),b=C.paymentRows.find('input[type\x3dradio][name\x3dpaymentMethod][value\x3d"'+d+'"]').closest(".payment-row"),b.trigger("click"),c.scrollTopTo(b))}}})}function O(a){a=I(a.currentTarget).parents("div.currency-list");var b=a.find("label.a-touch-radio");b.length?b.trigger("click"):a.find("input[type\x3dradio][value\x3dOther]").trigger("click")}
function X(a){a=a.$target.closest("div.payment-row");var b=a.find(".currency-list");if(n.isSPP()){var d=v.getSelect(b.find("select"));null!==d&&d.setValue("")}a.find(".change-currency").hide();b.show();c.isTouchCX()&&(a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"),a.find(".bottom-cell").show());na();ya()}function fa(a){a=a.$target.closest("div.payment-row");a.find(".expire-info, .expire-date").hide();a.find(".enter-date, .expire-date-fields").show();na();J()}function y(a){var b=
a.$target.closest("div.payment-row"),d="true"===c.getAttributeData(b,"isaddresschallenge")?1:0;b.find(".expire-date-fields").length?(fa(a),b.find("#newExpDate").focus()):d&&b.find("#addCreditCardNumber").focus()}function ea(a){setTimeout(function(a){var b=I(a.target);a=document.createEvent("UIEvents");a.initUIEvent("DOMActivate",!0,!0,q,1);b.get(0).dispatchEvent(a)},0,a)}function V(a){var b=I(a.target).closest("div.payment-row");""!==I(a.target).val()&&("true"===c.getAttributeData(b,"isaddresschallenge")?
b.find("#addCreditCardNumber").focus():Z())}function ka(){var a=E();a.find("div.flag-register-rewards").is(":visible")?(a.find(".bottom-cell").hide(),a.find(".top-cell").removeClass("bottom-line"),a.find(".card-unreg-rewards").show()):(a.find(".card-unreg-rewards").hide(),a.find(".bottom-cell").show(),a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"))}function G(){ka()}function za(a){a.$event.preventDefault();if("1"===E().find("div.flag-register-rewards").attr("cached"))ka();
else{var b=a.$target.attr("href");-1===b.toLowerCase().indexOf("cachebuster")&&(b=p.addQueryStringParameter(b,"cacheBuster",(new Date).getTime()));k.show();c.makeAjaxCall(b,a.data,{successHandler:function(a){k.hide();var b=m.jsonify(a);a=c.decodeJSONResponse(b.widgetHTML);var d=E();d.find("div.flag-register-rewards").html(a);d.find("div.flag-register-rewards").attr("cached",1);d.find("div.flag-register-rewards .error-message").each(function(){var a=I(this),c=a.data("errorid");a.html(b.displaydata[c])});
ka()}})}}function ua(b){var d=I(b.target);if(!d.is(":visible"))return b.preventDefault(),b.stopPropagation(),!1;n.isSPP()&&(n.isPrefetchFromAddressEnabled()?n.disablePageNoUpdateTransition():I("#payment").find(".panel-cancel-row").hide(),x.clearCache());var e=I(b.currentTarget);C.jppoints.length&&h.handleJPPointsOnPaymentRows(b);var f=e.find("[name\x3duseAvailableBalance]");if("useAvailableBalance"!==b.target.name&&!f.length)if(R(e),g.toggleGCForMCB(e,C),U(e),e.hasClass("payment-selected")||e.hasClass("payment-label"))C.disableSubmitButtons.length&&
(pa(e,e,!1),!d.hasClass("continue-center")&&e.find(".continue-center").length||Z());else if(b=e.find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),b.length&&"disabled"!==b.attr("disabled")){$a();b=E();n.isSPP()?b.filter(function(){var a=I(this).attr("id");return"gcPromo"===a?(a=I(this).find('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]'))&&a.length:"jppoints"!==a}).removeClass("payment-selected"):b.removeClass("payment-selected");b.find("[name\x3dpaymentMethod]").attr("checked",
!1);b.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");b.find(".top-cell").removeClass("bottom-line");Aa(b);c.isTouchCX()&&(b.find(".bottom-cell").hide(),b.find(".card-unreg-rewards").show());e.addClass("payment-selected");e.find("[name\x3dpaymentMethod]").attr("checked",!0);e.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active");var d="true"===c.getAttributeData(e,
"isaddresschallenge")?1:0,f=e.find('.rewards-list input[type\x3d"radio"]').length,k="1"===c.getAttributeData(e,"hasDerivedCurrency")?1:0,l=e.find(".vcc-form-fields").length,m=e.find(".card-ref-num").length;c.isTouchCX()&&(d||f||l||m||k)&&(e.find(".top-cell").removeClass("align-top bottom-line").addClass("bottom-line"),e.find(".bottom-cell").show());r.when("rewards-section-desktop").execute(function(b){a.trigger("rewards-section-desktop:select-payment-row",e,ya)});La(e);Ma(e);Na(e);Oa(e);ab(e);"1"===
I("#suppressionMessageFixEnabledStatus").val()&&bb(e);cb(e);Pa(e);Da(e);Qa(e);db(e);eb(e);Ra(e);Fa(u,u.toggleEMIMenu,e);Sa(e);fb();da(e);Xa();na();J();W();qa();va(e,b);Ta();I.isEmptyObject(A)||A.toggleCustomerNudgingMessage(e);C.hideInputBoxes.length&&(Ua(e,b),Va(e));C.disableSubmitButtons.length&&pa(e,b,!0);Ia();ya();C.disableSubmitButtons.length&&!e.find(".continue-center").length&&Z()}}function U(a){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=I("input[type\x3d'hidden'][name\x3d'paySelectLocale']");
b.length&&"IN"===b.val()&&a.length&&r.when("client-side-metrics").execute(function(a){a.increaseCount("PayPage-COD-NonMobile",1)})}function R(a){var b=I("#isGlobalCODEligible").val();if(b&&"0"!==b){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=I("#button-add-gcpromo"),c=I("#button-add-gcpromo").parent().parent();a.length?(c.addClass("a-button-disabled"),b.attr("disabled","disabled")):(c.removeClass("a-button-disabled"),b.removeAttr("disabled"))}}function ra(a){r.when("A",
"a-tv").execute(function(b,c){b=b.$;var d=b(a);d.length&&(b(".tv-lastSelected").removeClass("tv-lastSelected"),d.addClass("tv-lastSelected"),c.select(d))})}function pa(a,b,c){c&&b.find(".billing-address, .cc-continue-button").hide();if(a.find(".tv-update").length)Ua(a,b),Va(a);else{var d=a.find(".billing-address, .cc-continue-button");if(d.length&&!d.is(":visible")){var e=!1;a.find(".no-address").length&&(e=!0,a.find(".a-button-primary").addClass("aok-hidden"),a.find(".a-button-disabled").removeClass("aok-hidden"));
r.when("a-tv").execute(function(g){c&&(b.find(".payment-container").hasClass(".a-tv-navigate")||g.add(b.find(".payment-container")));g.remove(a.find(".payment-container"));g=e?a.find(".billing-address-link"):d.find(".continue-center");ra(g)});d.show()}}}function da(a){var b=I("#one-click-final-review-message");b.length&&(a.find("#canTryTFX").length?b.removeClass("aok-hidden"):b.addClass("aok-hidden"))}function va(a,b){if(c.isTouchCX()&&(b&&b.find(".top-cell .data-row").children(".a-column").height("auto"),
a)){a=a.find(".top-cell .data-row");var d=a.find(".addr-challenge-card-scan .a-box");if(d.length){b=a.height();var d=d.height(),e=a.children(".a-column:first");a.children(".a-column").height(d);e.height(b);e.children(".vertical-center-grid:first").height(d)}else a.children(".a-column").height(a.height())}}function ta(d){k.hide();var e=m.jsonify(d);e.imbWidgetHTML&&I("#imb-wrapper").html(c.decodeJSONResponse(e.imbWidgetHTML));if(e.cardWidgetHTML&&(d=E(),d.replaceWith(c.decodeJSONResponse(e.cardWidgetHTML)),
null!=e.rewardsAccountsWidgetHTML&&r.when("rewards-section-desktop").execute(function(b){a.trigger("rewards-section-desktop:refresh-rewards-section",c.decodeJSONResponse(e.rewardsAccountsWidgetHTML))}),a.trigger("checkout:reload"),a.trigger("checkout:reload:payselect"),d=E(),"true"!==c.getAttributeData(d,"isaddresschallenge"))){b.setCardPasswordInputStatus(d,e.newpaymentmethodid,"cvv","#existingCvvNum");b.setCardPasswordInputStatus(d,e.newpaymentmethodid,"pincode","#existingPincodeNum");if(C.cvvColumnLabel.length){var g=
!1;C.paymentRows.each(function(){if("true"===c.getAttributeData(I(this),"isaddresschallenge"))return g=!0,!1});g||C.cvvColumnLabel.hide()}C.disableSubmitButtons.length&&Z()}}function na(){C.paymentRows.each(function(){var a=I(this),b=a.find('.currency-list input[type\x3d"radio"]').length,d=a.find('.rewards-list input[type\x3d"radio"]').length,e=a.find(".card-reg-info").is(":visible"),g=a.find(".expire-date-fields").is(":visible"),f=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),
h=a.find(".bottom-cell .inner-grid-left"),k=a.find(".bottom-cell .inner-grid-right");g?b||d||e?(h.removeClass("hidden a-span10 a-span12").addClass("a-span8"),k.removeClass("a-span12 a-span2 hidden").addClass("a-span4")):(h.removeClass("a-span8 a-span10 a-span12").addClass("hidden"),k.removeClass("a-span4 a-span2 hidden").addClass("a-span12")):f?(h.removeClass("a-span12 a-span8 hidden").addClass("a-span10"),k.removeClass("hidden a-span4 a-span12").addClass("a-span2")):(h.removeClass("a-span10 a-span8 hidden").addClass("a-span12"),
k.removeClass("a-span2 a-span4 a-span12").addClass("hidden"));!c.isTouchCX()&&f&&(b||d||e)&&a.find(".bottom-cell").removeClass("align-top").addClass("align-top")});var a=E(),b=a.find("a[data-action\x3dshow-expire-date-fields]").filter(":visible").length,d=a.find(".top-cell.bottom-line").length;b&&!d||a.find(".bottom-cell").removeClass("align-top")}function J(){c.isTouchCX()&&C.paymentRows.each(function(){var a=I(this),b="true"===c.getAttributeData(a,"isaddresschallenge")?1:0,d=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),
e=a.find(".expire-date-fields").is(":visible"),g=a.find(".card-reg-info").is(":visible"),f=a.find(".rewards-info").is(":visible"),h=a.find(".change-currency").is(":visible");d?a.find(".top-cell .second-row").addClass("align-top"):a.find(".top-cell .second-row").removeClass("align-top");b=b||h||g||f;g=e||d;f=a.find(".top-cell .inner-grid-left");a=a.find(".top-cell .inner-grid-right");b||(f.removeClass("a-span6 a-span8 a-span12").addClass("hidden"),a.removeClass("a-span4 a-span6 hidden").addClass("a-span12"));
g||(f.removeClass("a-span6 a-span8 hidden").addClass("a-span12"),a.removeClass("a-span4 a-span6 a-span12").addClass("hidden"));b&&d&&(f.removeClass("a-span6 a-span12 hidden").addClass("a-span8"),a.removeClass("a-span6 a-span12 hidden").addClass("a-span4"));b&&e&&(f.removeClass("a-span6 a-span8 hidden").addClass("a-span6"),a.removeClass("a-span4 a-span12 hidden").addClass("a-span6"))})}function Aa(a){var b=a.find(".currency-list");if(b.length){var c=b.find("[type\x3dradio]:checked").val(),b=b.find("#cardCurrencyDropDown option:selected").val();
"Other"!==c||"-1"!==b&&"-2"!==b||a.find(".currency-list input[type\x3dradio][value!\x3dOther]").attr("checked",!0)}}function xa(a){var b=I(a.currentTarget);a=b.find("option:selected");if(""===a.val())b.parents("div.selected-section").find(".selected-note-content").hide();else{var c=a.prop("disabled"),b=b.parents("div.selected-section"),d=b.find("#active-bank-content"),e=b.find("#disable-bank-content");c?(e.show(),d.hide()):(d.show(),e.hide());b.find("span.selected-note-bank").text(a.text()).show()}}
function T(a){var b=I(a.currentTarget);a=b.find("option:selected");""===a.val()?b.parents("div.selected-section-more-payment-method").find(".selected-more-payment-content").hide():(b=b.parents("div.selected-section-more-payment-method"),b.find("span.selected-payment-option").text(a.text()).show(),b.find("span.selected-more-payment-content").show())}function wa(a){(C.continueErrPopover.filter(":visible").length||Ea())&&a.$event.preventDefault()}function ia(b){b=I(b.currentTarget);var c=b.find("input[type\x3dcheckbox]");
c.attr("checked")?(c.attr("checked",!1),b.find(".checked-checkbox").addClass("aok-hidden"),b.find(".empty-checkbox").removeClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").addClass("aok-hidden")):(c.attr("checked",!0),b.find(".checked-checkbox").removeClass("aok-hidden"),b.find(".empty-checkbox").addClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").removeClass("aok-hidden"));r.when("a-tv").execute(function(b){setTimeout(function(){b.select(".tv-lastSelected")},500);a.trigger("a:tv:resize")})}
function ja(a){a=I(a.currentTarget);"1"===a.attr("isclicked")?a.attr("isclicked",0):a.attr("isclicked",1);qa()}function qa(a){var b=I("#pm_promo");a=I("#pm_gc_radio");var d=I("#pm_gc_checkbox"),e;I("input[name\x3ddoesPurchaseContainOnlyRecurringPrimeMembership]").length&&(e=I("input[name\x3ddoesPurchaseContainOnlyRecurringPrimeMembership]").val());if(a&&a.length||d&&d.length){var g=I("input[name\x3dgcBalanceRaw]").val();I("input[name\x3damBalanceRaw]").length&&(g=I("input[name\x3damBalanceRaw]").val());
var f=I("input[name\x3disAPBLimitMessagingLaunchWeblabEnabled]").val(),h=I("input[name\x3dhasAPBRedeemableLimitExhausted]").val(),k=I("input[name\x3damAvailableBalanceRaw]").val(),l=I("input[name\x3dremainingBalanceRaw]").val(),m=I("input[name\x3dpurchaseTotalRaw]").val(),p,n,ma=I(".purchase-total").length;ma?(n=I(".purchase-total").html(),p=I(".remaining-balance").html()):(n=I("input[name\x3dpurchaseTotal]").val(),p=I("input[name\x3dremainingBalance]").val());var oa=I(".balance-applied");ma?oa.html(n):
oa.text(n);(c.isTouchCX()&&"checkbox"===b.attr("type")?"1"===b.closest(".a-control-row").attr("isclicked"):b.is(":checked"))?(b=l,0<b&&(ma?oa.html(p):oa.text(p))):b=m;f&&D.renderAPBMessagingRemainingBalance({purchaseTotal:n,remainingBalance:p,balanceApplied:oa,isPurchaseTotalInSpan:ma},g,m,k);p=a.closest(".radio-col");n=d.closest(".radio-col");l=I(".amazon-money-limit-breached");ma=I(".long");oa=I(".short");"1"===f&&"1"===h?D.displayAPBRedeemableLimitExhaustedMessaging({gcRadioContainer:p,gcCheckboxContainer:n,
gcCheckbox:d,gcRadio:a,shortMsg:oa,longMsg:ma,amazonMoneyLimitBreachedMsg:l}):0<=g-m?("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),p.removeClass("hidden"),a.is(":checked")&&p.trigger("click"),n.addClass("hidden"),d.attr("disabled","disabled"),0==g-m?(ma.hide(),oa.show()):(ma.show(),oa.hide())):0<g-b?0>=b?(n.removeClass("hidden"),d.attr("disabled","disabled"),c.isTouchCX()&&n.find("i").addClass("a-button-disabled checkbox-disabled"),p.addClass("hidden"),a.attr("disabled","disabled"),oa.show(),
ma.hide()):("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),p.removeClass("hidden"),a.is(":checked")?p.trigger("click"):c.isTouchCX()&&p.find("i").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),n.addClass("hidden"),d.attr("disabled","disabled"),ma.show(),oa.hide()):("disabled"===d.attr("disabled")&&(d.removeAttr("disabled"),c.isTouchCX()&&n.find("i").removeClass("a-button-disabled checkbox-disabled")),n.removeClass("hidden"),(h=n.closest(".payment-row"))&&
h.hasClass("payment-selected")&&h.removeClass("payment-selected"),p.addClass("hidden"),a.attr("disabled","disabled"),"1"===f?D.renderAPBInsufficientMessaging({shortMsg:oa,longMsg:ma},g,k):(oa.show(),ma.hide()));"1"===e&&(a.attr("disabled","disabled"),d.attr("disabled","disabled"),(h=n.closest(".payment-row"))&&h.hasClass("payment-selected")&&h.removeClass("payment-selected"))}}function ga(b){var c=E().find(".enter-custom-rewards");if("rewardscustom"===I(b.currentTarget).children('input[type\x3d"radio"]').val()){c.show();
var d=c.find("input.custom-rewards-input");d.focus();C.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")&&(c=d.val().length,d=d.get(0),d.setSelectionRange?d.setSelectionRange(c,c):d.createTextRange&&(d=d.createTextRange(),d.collapse(!0),d.moveStart("character",c),d.moveEnd("character",c),d.select()))}else c.hide();r.when("installments-payselect").execute(function(c){a.trigger("installments-payselect:toggleRewardsInstallmentEligibility",I(b.currentTarget))});ya()}function ha(a){a=
a.$target||I(a.currentTarget);sa(a)}function sa(b){if(b.length){var c=C.paymentRows.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]'),d=C.paymentRows.find(".installments-select.a-row"),e=d.siblings(".installments-message"),g=d.siblings(".card-offers"),f=C.paymentRows.find('input[type\x3d"radio"][value\x3d"morePaymentMethod"]'),h=C.installmentsOnlyCards,k=C.paymentRows.find('input[type\x3d"radio"][id\x3d"pmEmiPaymentOptions"]'),l=C.paymentRows.find('input[type\x3d"radio"][value\x3d"amazonBusinessCredit"]');
if(c.length){var m=c.closest(".payment-row"),p=f.closest(".payment-row"),n=k.closest(".payment-row"),ma=l.closest(".payment-row");b.is(":checked")?(c.prop("disabled",!0),c.is(":checked")&&(c.prop("checked",!1),m.removeClass("payment-selected")),c.parent().siblings().addClass("a-color-secondary"),Fa(u,u.disableEMIPaymentMethods,k),r.when("abc-helper").execute(function(b){a.trigger("abc-helper:disable-payment",l)}),K.showInstantBankDiscountAmazonPaySelected(),Ba(f,p),(b=d.find("select"))&&b.each(function(){var a=
this.id.replace(/\./g,"\\.");v.setValue(a,"")}),d.find(".installments-enabled-text").hide(),e.find(".installments-enabled-text").hide(),g.find(".installments-enabled-text").hide(),d.find(".installments-disabled-text").show(),e.find(".installments-disabled-text").show(),g.find(".installments-disabled-text").show(),h.find("input[name\x3dpaymentMethod]").attr("disabled","disabled").removeAttr("checked"),h.removeClass("payment-selected")):(m.find(".payment-invalid").length||(c.prop("disabled",!1),c.parent().siblings().removeClass("a-color-secondary")),
p.find(".payment-invalid").length||la(f,p),n.find(".payment-invalid").length||Fa(u,u.enableEMIPaymentMethods,k),ma.find(".payment-invalid").length||r.when("abc-helper").execute(function(b){a.trigger("abc-helper:enable-payment",l)}),K.showInstantBankDiscountAmazonPayDeselected(),d.find(".installments-disabled-text").hide(),e.find(".installments-disabled-text").hide(),g.find(".installments-disabled-text").hide(),d.find(".installments-enabled-text").show(),e.find(".installments-enabled-text").show(),
g.find(".installments-enabled-text").show(),h.find("input[name\x3dpaymentMethod]").removeAttr("disabled"))}}}function la(a,b){a.prop("disabled",!1);a.parent().siblings().removeClass("a-color-secondary");b.find(".selected-section-more-payment-method").show();b.find(".more-payment-gc-disabled-text").hide()}function Ba(a,b){a.prop("disabled",!0);a.is(":checked")&&(a.prop("checked",!1),b.removeClass("payment-selected"));a.parent().siblings().addClass("a-color-secondary");b.find(".selected-section-more-payment-method").hide();
b.find(".more-payment-gc-disabled-text").show()}function Ca(a){var b=a.$target||I(a.currentTarget);a=b.closest(".currency-list");b=b.val();!0===(c.isTouchCX()?"Other"===b:"Other"!==b)?(a.find("select").attr("disabled",!0),a.find(".a-button.a-button-dropdown").addClass("a-button-disabled"),a.find(".a-button.a-touch-select").addClass("a-button-disabled")):(a.find("select").attr("disabled",!1),a.find(".a-button.a-button-dropdown").removeClass("a-button-disabled"),a.find(".a-button.a-touch-select").removeClass("a-button-disabled"));
ya()}function S(a){t.actionReregisterCardInBox(a);c.scrollTopTo(E())}function ma(a){ya()}function oa(){C.paymentRows.each(function(){var a=I(this),b=".card-ref-num, .addr-challenge, .addr-challenge-msg, .cup-expired-msg, .enter-date, .expire-date-fields, .rewards-static-help-link, .verified-fail-msg, .tv-update, .billing-address, .cc-continue-button",d=".card-info, .card-name, .card-reg-info, .expire-info, .rewards-err-msg, .rewards-list label, .rewards-list div.a-radio, .rewards-dynamic-help-link, .financial-offer-err-detail";
a.hasClass("payment-selected")&&("1"===c.getAttributeData(a,"hasDerivedCurrency")||"1"===c.getAttributeData(a,"hasPreferredCurrency")&&"1"===c.getAttributeData(a,"isNewCard"))||(b+=", .currency-list");"1"===c.getAttributeData(a,"hasPreferredCurrency")&&"1"!==c.getAttributeData(a,"isNewCard")&&(d+=", .change-currency");a.find(b).hide();a.find(d).show()})}function Xa(){C.paymentRows.each(function(){var a=I(this),b="#cc-errors, .enter-date, .expire-date-fields",d=".expire-info";if(a.hasClass("payment-selected")&&
"1"===c.getAttributeData(a,"hasDerivedCurrency"))b+=", .change-currency",d+=", .currency-list";else{var e=a.find(".currency-list"),g=e.find("[type\x3dradio]:checked").val();if(g){var f;if("Other"!==g)f=e.find(".currencyNameLabel").html();else{var g=e.find("#cardCurrencyDropDown option:selected"),h=g.val();"-1"!==h&&"-2"!==h&&(f=g.text())}f&&(d+=", .change-currency",e.closest("div.payment-row").find(".change-currency .currencyNameLabel").html(f))}b+=", .currency-list"}a.find(b).hide();a.find(d).show()})}
function Ya(){var a=I("#aan-ads-box");if(a.length){var b=a.data("adsendpoint"),c=a.data("adsclient"),d="https://"+b+"/2009-09-09/ad/",b="/jsc?pt\x3dstatic\x26slot\x3dlib\x26pt2\x3daanjs";a.data("useaannojq")&&(b+="-nojq");I.getScript(d+c+b,function(){q.d16g&&q.d16g.requestAanAd({elemId:"aan-ads-box",baseUrl:d,afterOnload:!0,client:c,pt:"checkout",slot:"display-ad-right",pt2:"payselect"})})}}function Za(){Wa&&(a.declarative("auto-rewards-reg",["click"],M),a.declarative("complete-rewards-register",
["click"],H),a.declarative("confirm-card",["click"],B),a.declarative("register-card-rewards",["click"],ba),a.declarative("cancel-register-card-rewards",["click"],G),a.declarative("show-currencies",["click"],X),a.declarative("show-expire-date-fields",["click"],fa),a.declarative("focus-cc-update-fields",["click"],y),a.declarative("show-rewards-reg",["click"],za),a.declarative("submit-payment-form",["submit"],wa),a.declarative("toggle-tfx-option",["click"],Ca),a.declarative("reregister-cc-in-dashboard",
["click"],S),a.declarative("modify-expire-date-fields",["change"],ma),c.isTouchCX()&&a.declarative("continue-button",["click"],Q),Wa=!1);C.paymentRows.unbind("click").has("input[name\x3dpaymentMethod]:enabled").bind("click",ua);r.when("apx-payselect-helper").execute(function(){var a=L.get("payselect");a&&a.initEvents(C.paymentRows,ya)});C.paymentRows.find("input[name\x3dusePromoBalance]").unbind("change",qa).bind("change",qa);C.disableSubmitButtons.length&&C.paymentRows.has("input[type\x3dcheckbox]:enabled").unbind("click",
ia).bind("click",ia);C.existingPincodeNum.unbind("click",Ha).bind("click",Ha);C.paymentRows.find("select#cardCurrencyDropDown").unbind("change",O).bind("change",O);C.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")?C.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ga).each(function(b,c){c=a.$(c);b=c.find("input.custom-rewards-input");c=c.find(".custom-reward-points");var d=a.$(b);b={$element:d,maxAmount:d.data("max")};c={$element:a.$(c),
decimalPlaces:d.data("decimalplaces"),ratio:d.data("ratio")};d=d.data("country-code");d=z.getCurrencyFormatByCountryCode(d);z.initializeInlineFormatting(b,c,d)}):C.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ga).undelegate("input.custom-rewards-input","keyup").delegate("input.custom-rewards-input","keyup",P);if(c.isTouchCX())C.pageContainer.find("#existing-payment-methods").find("select, input[type\x3dtext], input[type\x3dpassword]").unbind("change",W).bind("change",
W),C.pageContainer.find("#existing-payment-methods").find("div.currency-list label.a-touch-radio").unbind("click").bind("click",Ca),C.pageContainer.find("#existing-payment-methods").find("label.promoLabel").unbind("click").bind("click",ja);else if(!n.isSPP()){var b=C.continueBtns.find(".a-button-text");I("#payPageContinueBtnStateFixEnabled").length?b.filter('input[type\x3d"button"]').unbind("mouseenter",Ga).bind("mouseenter",Ga).unbind("focus",Ga).bind("focus",Ga).unbind("mouseleave",Y).bind("mouseleave",
Y).unbind("blur",Y).bind("blur",Y):(b.filter('input[type\x3d"submit"]').unbind("mouseenter").bind("mouseenter",N).unbind("focus").bind("focus",N),b.filter('input[type\x3d"button"]').unbind("mouseleave").bind("mouseleave",ca).unbind("blur").bind("blur",ca))}C.netBankingSelect.unbind("change",xa).bind("change",xa);C.morePaymentMethodsSelect.unbind("change",T).bind("change",T);C.continueBtnBottom.unbind("click").bind("click",Z);0<I("input[name\x3d'needDisableCODandEMIforGC']").length&&(b=I("input#pm_300[type\x3d'checkbox'], #pm_gc_checkbox"),
b.length&&(b.bind("change",ha),b.is(":checked")&&sa(b)));C.jppoints.length&&C.paymentRows.find('input[name\x3d"useAvailableBalance"]').bind("click",h.handleJPPointsOnPaymentRows);r.when("installments-payselect").execute(function(){a.trigger("installments-payselect:initEvents")});C.hideInputBoxes.length&&(C.paymentRows.find("#confirm-card").unbind("focus").bind("focus",F),C.paymentRows.find("#newExpDate").unbind("focus").bind("focus",ea),C.paymentRows.find("#newExpDate").unbind("change").bind("change",
V))}function Ia(){var a=e.create();a.validatePayment(E());a.hasErrors()||n.makePrefetch(C.existingPaymentForm)}function Ha(a){a=C.showAmexWarning;null!==a&&(a.removeClass("hidden"),a.removeClass("amex_display"))}function Ja(){if(!c.isMobileCX()){C=c.getElements(gb);C.paymentRows.filter(".payment-selected-marker").removeClass("payment-selected-marker").addClass("payment-selected");var b=E();r.when("rewards-section-desktop").execute(function(b){a.trigger("rewards-section-desktop:page-load",ya)});r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:page-load")});
Oa(b);Da(b);da(b);oa();La(b);Ma(b);Na(b);Qa(b);Ra(b);Sa(b);Pa(b);qa();Ta();I.isEmptyObject(A)||A.toggleCustomerNudgingMessage(b);I(document).undelegate("div.pay-desktop .checkout-page-form","keypress").delegate("div.pay-desktop .checkout-page-form","keypress",aa);I(document).undelegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup").delegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup",ya);C.addressChallengeCardList.length&&C.addressChallengeCardList.show();
C.paymentRows.find('input[type\x3d"radio"][value\x3d"rewardsmax"]').each(function(){I(this).siblings('[type\x3d"checkbox"]').remove()}).removeClass("hidden");J();na();Za();C.existingPaymentForm.data("checkoutFormReady",!0);Ia();Ya();C.orderSummaryBottom.show();va(b);W();ya();R(b);g.determineIsMCBEnabled(C);g.toggleGCForMCB(b,C);I(".a-popover-preload").each(function(){var b=I(this).find(".rewards-registration").data("parentPaymentMethodId");b&&(a.off("a:popover:show:rewards-registration-"+b,f.displayRewardsRegister),
a.off("a:popover:hide:rewards-registration-"+b,f.hideRewardsRegister),a.on("a:popover:show:rewards-registration-"+b,f.displayRewardsRegister),a.on("a:popover:hide:rewards-registration-"+b,f.hideRewardsRegister))});r.when("a-tv").execute(function(c){a.trigger("a:tv:resize");b.find(".a-tv-navigate").length&&pa(b,b,!1)})}}function ya(b){n.isSPP()?(Ea()?C.disableSubmitButtons.length?(b=E(),b.find(".continue-center").addClass("aok-hidden"),b.find(".a-button-disabled").removeClass("aok-hidden")):(C.continueBtns.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),
C.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")):ca(),a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")):I("#payPageContinueBtnStateFixEnabled").length&&N(b)}function Ka(a,b){a=I(a.target).closest(".order-summary-box").find(".continue-button-errors");a.length&&b.length&&(b=d.triggerLeft(a,b),a.show(),a.offset(b))}function Ga(a){if((!C.continueErrPopover.filter(":visible").length||c.isTouchCX())&&C.continueErrPopover.find(".error-message:not(.hidden)").length&&a&&
("mouseenter"===a.type||"focus"===a.type)){var b=I(a.target).closest(".continue-buttons").find(".a-button-disabled");Ka(a,b)}}function Ea(a){if(C.continueErrPopover.filter(":visible").length&&!c.isTouchCX())return!0;var b=E(),g=e.create();Fa(u,u.isEMIPaymentInstrument,b)&&(g.validateEMIMenuForContinueButton(b),b=Fa(u,u.getEMIMenuSelectedCardSection));g.validatePayment(b);g.apxValidatePayment(b,C.paymentRows);g=g.getHighestErrorId();if(!g||!g.identifier)return!1;C.continueErrPopover.find(".error-message").hide();
b=b.find(".pincode-err-block");b.hide();b&&b.length&&g.target&&g.target.length&&g.target.addClass("a-form-error");g.isPincodeError?(b.show(),b.addClass("a-form-error")):(C.continueErrPopover.find("#"+g.identifier).show(),C.continueErrPopover.find("#"+g.identifier).removeClass("hidden"),!a||"mouseenter"!==a.type&&"focus"!==a.type?n.isSPP||C.continueBtns.find(".a-button input").filter(":visible").each(function(){var a=I(this).closest(".order-summary-box").find(".continue-button-errors"),b=d.triggerLeft(a,
I(this));a.show();a.offset(b)}):(b=I(a.target).closest(".continue-buttons").find(".a-button-primary"),Ka(a,b)));return!0}function La(b){C.paymentRows.find(".addr-challenge, .addr-challenge-msg").hide();C.hideInputBoxes.length?C.paymentRows.find(".card-name").show():C.paymentRows.find(".card-info").show();if("true"===c.getAttributeData(b,"isaddresschallenge")){var d=b.find(".addr-challenge, .addr-challenge-msg");0===d.length&&l.increaseCount("Checkout:Payment:AddressChallengeMissingInputAndMsg");d.show();
C.hideInputBoxes.length?b.find(".card-name").hide():b.find(".card-info").hide();b=b.attr("paymentmethodid")?b.attr("paymentmethodid"):b.attr("data-paymentmethodid");a.trigger("checkout:payment:challenge:log",b)}}function Va(a){C.paymentRows.find(".expire-date-fields").hide();a=a.find(".expire-date-fields");a.length&&a.show()}function Ta(){C.paymentRows.find(".pci-blocking-cvv").length&&C.paymentRows.each(function(){var a=I(this),b=a.find(".pci-blocking-cvv");a.find("[type\x3dradio]:checked").val()&&
b.length?b.show():b.length&&b.hide()})}function Ua(a,b){r.when("a-tv").execute(function(c){c.add(b.find(".payment-container"));b.find(".tv-update").hide();var d=a.find(".tv-update");d.length&&(c.remove(a.find(".payment-container")),d.show(),ra(d.find(".a-button-primary")))})}function Ma(a){C.paymentRows.find(".verified-fail-msg").hide();"true"===c.getAttributeData(a,"isverifiedfail")&&a.find(".verified-fail-msg").show()}function Na(a){C.paymentRows.find(".cup-expired-msg").hide();"true"!==c.getAttributeData(a,
"iscupcardexpired")&&"true"!==c.getAttributeData(a,"iscupcardexpiringsoon")||a.find(".cup-expired-msg").show()}function Oa(b){C.paymentRows.find(".rewards-list").hide();C.paymentRows.find(".top-cell .inner-grid-left").show().find(".rewards-info").show();var d=b.find('.rewards-list input[type\x3d"radio"]'),e=d.filter(":checked");C.paymentRows.find('.rewards-list input[type\x3d"radio"]').prop("checked",!1);0<e.length?e.prop("checked",!0):b.find(".rewards-list").hasClass("apply-by-default")?d.filter('[value\x3d"rewardsmax"]').prop("checked",
!0):d.filter('[value\x3d"rewardsnone"]').prop("checked",!0);d=b.find(".rewards-list").show();d.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked")&&d.children(".enter-custom-rewards").show();c.isTouchCX()&&d.length&&(b.find(".rewards-info").hide(),b.find(".top-cell").addClass("bottom-line"),b.find(".bottom-cell").show());r.when("installments-payselect").execute(function(c){a.trigger("installments-payselect:toggleRewardsInstallmentEligibility",b)})}function Da(a){C.paymentRows.find(".financial-offer-list").hide();
C.paymentRows.find(".financial-offer-err-detail").hide();var b=a.find('.financial-offer-list input[type\x3d"radio"]'),d=b.filter(":checked");b.prop("checked",!1);0<d.length?d.prop("checked",!0):b.first().prop("checked",!0);b=a.find(".financial-offer-list").show();a.find(".financial-offer-err-detail").show();c.isTouchCX()&&b.length&&(a.find(".top-cell").addClass("bottom-line"),a.find(".bottom-cell").show())}function $a(){I(document.body).find(".a-dropdown").each(function(){w.hide(I(this))})}function ab(a){C.paymentRows.find(".installments-select").hide();
C.paymentRows.find(".installments-message").show();a.find(".installments-select").show();a.find(".installments-message").hide()}function bb(a){C.paymentRows.find("#savedCardSuppressed").hide();a.find("#savedCardSuppressed").show()}function cb(a){C.paymentRows.find(".installments-list").hide();a.find(".installments-list").show()}function Pa(a){C.paymentRows.find(".card-ref-num, .selected-note, .selected-more-payment-option").hide();C.paymentRows.find(".card-benefit").show();a.find(".card-ref-num, .selected-note, .selected-more-payment-option").show();
a.find(".card-benefit").hide()}function db(a){C.paymentRows.find(".otpBlock").hide();a.find(".otpBlock").show()}function eb(a){C.paymentRows.find(C.ovdWidgetSection).hide();a.find(C.ovdWidgetSection).show()}function Qa(a){C.paymentRows.find(".vcc-info-prompt,.vcc-form-fields").hide();a.find(".vcc-info-prompt,.vcc-form-fields").show()}function Ra(a){var b=C.newVDC.find("#vdcBanksSelect"),c=C.newVDC.find(".vdc-selected-bank-prompt").hide(),d=C.newVDC.find("#suppressedVerifiedDebitCard").hide(),e=b.val(),
g="1"===I("#save_citi_card").val()?"CIT"!==e:!0,f="1"===I("#save_citi_card").val()&&"CIT"===e;a.find("#vdcBanksSelect").length?""!==e&&"OtherBanks"!==e&&g&&(C.newVDC.find("option:selected").prop("disabled")?(d.show(),c.hide()):(d.hide(),c.show())):(("OtherBanks"===e||f)&&b.val(b.children("option").first().val()).trigger("change"),c.hide())}function Fa(a,b,c){if(!I.isEmptyObject(a)&&b)return b(c)}function Sa(a){var b=I("#cash-back-ineligible-for-cod-message");b&&b.length&&((a=a.find("#cashOnDeliveryCash"))&&
a.length?b.removeClass("hidden"):b.addClass("hidden"))}function fb(){var a=I("#imb-wrapper");if(a.length&&a.is(":visible")){var b=a.find(".defaultPaymentMethodExpired"),c=a.find(".codUnavailable"),d=a.find("p").length;0===b.length&&0===c.length||1!==d||a.hide()}}var I=a.$,Wa=!0,C={},gb={cardImages:"#newCreditCardImages",continueBtns:".continue-buttons:not(.place-order-button)",continueBtnTop:"#continue-top",continueBtnBottom:"#continue-bottom",continueErrPopover:".continue-button-errors",cvvColumnLabel:"#cvvColumnLabel",
existingPaymentForm:"form.checkout-page-form",netBankingSelect:"#net-banking-select-list",morePaymentMethodsSelect:"#more-payment-methods-select-list",newVDC:"#new-vdc",newEMI:"#newEmiCard",orderSummaryBottom:"#order-summary-bottom",pageContainer:"div.a-container",paymentRows:"#existing-payment-methods .payment-row",rewardsRegister:"#rewards-register",addressChallengeCardList:".address-challenge-card",hiddenFormFields:"#hiddenFormFields",jppoints:"#jppoints",gcpromo:"#gcPromo",disableSubmitButtons:"#disableSubmitButtons",
hideInputBoxes:"#hideInputBoxes",showAmexWarning:"#showAmexWarning",existingPincodeNum:"#existingPincodeNum",mcbBalanceWarning:"#mcbBalanceWarning",installmentsOnlyCards:".installments-only-card",ovdWidgetSection:"#ovdWidgetSection"};a.on("checkout:reload:payselect",Ja);a.on("checkout:reload:spp-payment",Ja);return{getSelectedPayment:E}});"use strict";r.when("A","page-detector").register("wechat-detector",function(a,m){var l=a.$,c=function(a){a&&!1!==a.isWeChatInstalled&&(a=l("#wechat_payment"),a.length&&
a.show())},e=function(a){},k="MShopWeChatPayment";a.on("checkout:reload:payselect",function(){l("#wechat_payment").length&&(l("#mShopWeChatApiName").length&&(k=l("#mShopWeChatApiName").val()),r.when("safe-mash").execute(function(a){q.cordova.require("cordova/exec")(c,e,k,"isWeChatInstalled",[])}))})});"use strict";r.when("A","page-main","client-side-metrics","ready").register("otp-for-cod",function(a,m,l){function c(){z=v("#cashOnDeliveryCash");if(z.length&&(x=z.find(F.verifyOTP),t=z.find(F.sendOTP),
E=x.length&&t.length,M=v(F.payMobile).length?1:0,E&&(g=z.find(F.submitSendOTP),u=z.find(F.submitVerifyOTP),q=z.find(F.submitResendOTP),r=z.find(F.changeOTPNumber),L=z.find(F.OTPPhoneNumber),D=z.find(F.otpCode),g.length&&u.length&&q.length&&r.length))){P=z.find(F.addURLHash).length;l.increaseCount(Y.metricPrefix+Y.block,1,1);g.click(function(){w();l.increaseCount(Y.metricPrefix+Y.send,1,1)});u.click(function(){H=L.val();W=D.val();p();var a=k(H),c;c=/^\d{6}$/;c=W&&c.test(W);a&&c&&""!==N?b("VerifyOTP",
N):c?a||z.find(F.otpServiceFailed).removeClass(F.aokHidden):z.find(F.invalidOTPError).removeClass(F.aokHidden);l.increaseCount(Y.metricPrefix+Y.verify,1,1)});if(P&&location.hash&&location.hash.length){for(var a=location.hash,a=a.replace("#",""),a=a.split(";"),c=0;c<a.length;c++)0<=a[c].indexOf(B.codehandle)&&(N=a[c].replace(B.codehandle,"")),0<=a[c].indexOf(B.contactid)&&(Q=a[c].replace(B.contactid,"")),0<=a[c].indexOf(B.phonenumber)&&(H=a[c].replace(B.phonenumber,""),L.val(H));""!==N&&""!==Q&&""!==
H&&d()}q.click(function(){l.increaseCount(Y.metricPrefix+Y.resend,1,1);w()});r.click(function(){x.addClass(F.aokHidden);t.removeClass(F.aokHidden);e(q,!1);e(u,!1);p();l.increaseCount(Y.metricPrefix+Y.changeNumber,1,1)})}}function e(a,b){b?a.addClass(F.aButtonDisabled):a.removeClass(F.aButtonDisabled);M?a.find("button").prop("disabled",b):a.find("input").prop("disabled",b)}function k(a){var b=/^\d{10}$/;return a&&b.test(a)}function n(){z.find(F.otpServiceFailed).removeClass(F.aokHidden)}function d(){var a=
z.find(F.verifyOTPPhoneNumber);z.find(F.invalidPhoneNumber).addClass(F.aokHidden);t.hasClass(F.aokHidden)?z.find(F.otpResentSuccess).removeClass(F.aokHidden):M&&z.find(F.otpSentSuccess).removeClass(F.aokHidden);t.addClass(F.aokHidden);x.removeClass(F.aokHidden);var b=H.substr(0,2)+"*****"+H.substr(7,9);a.text(b);e(q,!1)}function f(a){if(void 0!==a&&"object"!==typeof a)try{a=v.parseJSON(a)}catch(b){a={}}a=a||{};var c,d=P&&location.hash?location.hash:"#";P&&location.hash&&";"!==d.slice(-1)&&(d+=";");
c=a.status;a.codeHandle&&null!==a.codeHandle&&(N=a.codeHandle,P&&"SEND-SUCCESS"===c&&(d=h(d,B.codehandle,N)));a.contactId&&null!==a.contactId&&(Q=a.contactId,P&&"SEND-SUCCESS"===c&&(d=h(d,B.contactid,Q),d=h(d,B.phonenumber,H)));P&&(location.hash=d);z.find(F.otpAlertClass).addClass(F.aokHidden);if(ca[c])ca[c]();else ca.DEFAULT()}function h(a,b,c){var d=a.indexOf(b);if(0<=d){var e=a.indexOf(";",d),e=0<=e?e:a.length;a=a.substring(0,d)+a.substring(e+1,a.length+1)}return a+b+c+";"}function b(b,c){a.ajax("/gp/buy/payselect/handlers/otpAjaxHandler.html",
{method:"get",params:{phoneNumber:H,method:b,codeHandle:c,contactId:Q,otp:W},success:f,error:function(){f({status:"SERVICE-FAILED"})}})}function p(){D.val("");z.find(F.otpAlertClass).addClass(F.aokHidden)}function w(){p();H=L.val();k(H)?b("SendOTP",N):z.find(F.invalidPhoneNumber).removeClass(F.aokHidden)}var v=a.$,z,x,t,g,u,q,r,L,D,E,M,P,H="",N="",Q="",W="",F={aokHidden:"aok-hidden",aRadio:".a-radio",aButtonHidden:"a-button-hidden",aButtonDisabled:"a-button-disabled",payMobile:".pay-mobile",invalidOTPError:".invalidOTPError",
verifyOTP:"#verifyOTP",sendOTP:"#sendOTP",submitSendOTP:"#submitSendOTP",submitVerifyOTP:"#submitVerifyOTP",submitResendOTP:"#submitResendOTP",changeOTPNumber:"#changeOTPNumber",OTPPhoneNumber:"#OTPPhoneNumber",otpCode:"#otpCode",cashOnDeliveryCash:"#cashOnDeliveryCash",invalidPhoneNumber:".invalidPhoneNumber",otpServiceFailed:".otpServiceFailed",enterOTPLabel:"#enterOTPLabel",reEnterOTPLabel:"#reEnterOTPLabel",maxOTPError:".maxOTPError",numberAlreadyUsed:".numberAlreadyUsed",verifiedOTPSuccess:".verifiedOTPSuccess",
verifyOTPPhoneNumber:"#verifyOTPPhoneNumber",otpResentSuccess:".otpResentSuccess",otpSentSuccess:".otpSentSuccess",otpAlertClass:".otpAlertClass",phonenumberNotVerified:"phonenumberNotVerified",addURLHash:".addURLHash"},B={codehandle:"codehandle:",contactid:"contactid:",phonenumber:"phonenumber:"},Y={metricPrefix:"PayPage-COD-OTP-",block:"Block",send:"Send",verify:"Verify",resend:"ReSend",changeNumber:"ChangeNumber"},ca={"SERVICE-FAILED":n,"SEND-SUCCESS":d,"VERIFY-SUCCESS":function(){t.addClass(F.aokHidden);
x.addClass(F.aokHidden);z.find(F.verifiedOTPSuccess).removeClass(F.aokHidden);z.find("."+F.phonenumberNotVerified).removeClass(F.phonenumberNotVerified);M&&m.setContinueButtonStatus(!0)},"INVALID-NUMBER":function(){z.find(F.invalidPhoneNumber).removeClass(F.aokHidden)},"NUMBER-ALREADY-USED":function(){e(q,!0);e(u,!0);z.find(F.numberAlreadyUsed).removeClass(F.aokHidden)},"MAX-OTP-REACHED":function(){z.find(F.maxOTPError).removeClass(F.aokHidden);e(q,!0)},"INVALID-OTP":function(){z.find(F.invalidOTPError).removeClass(F.aokHidden);
D.val("");M?D.attr("placeholder","Re-enter OTP"):(z.find(F.enterOTPLabel).addClass(F.aokHidden),z.find(F.reEnterOTPLabel).removeClass(F.aokHidden))},DEFAULT:n};a.on("checkout:reload:payselect",c);a.on("checkout:reload:spp-payment",c)});"use strict";r.when("A","pay-common-util","ready").execute(function(a,m){var l={productGls:"#productGls",gcTypes:"#gcDeliveryTypes",device:"#device"},c=m.getElements(l);a.on("checkout:payment:challenge:log",function(e){var k={},m;for(m in l)l.hasOwnProperty(m)&&c[m]&&
c[m].val()&&(k[m]=c[m].val());e&&(k.paymentInstrumentId=e);Object.keys&&Object.keys(k).length&&a.ajax("/gp/buy/payselect/handlers/log-payment-challenge.html?ref_\x3dcheckout-payment-challenge",{method:"POST",params:k,timeout:1E3,cache:!1})})});"use strict";r.when("A","page-spinner-controller","page-main","page-transition-controller","page-conductor","client-side-metrics","button-blocker","ready").register("pay-auth",function(a,m,l,c,e,k,n){function d(){var a=p("#otp_id").val(),b=/^\d{6}$/;a&&b.test(a)?
n.hide("pay-auth-otp-checks"):(a=p("#otp_invalid_msg").val(),n.show("pay-auth-otp-checks",a))}function f(b,c){m.show();a.ajax("validate-otp.html",{method:"post",params:{otp_name:b,paystationRequestId:c},success:function(a){!a||"APPROVED"!==a.status&&"PENDING"!==a.status?(p("#otp_id").addClass("a-form-error"),p("#otpBadCode").removeClass("hidden"),m.hide()):(p("#isFormValidated").val("1"),v.submit())},error:function(a){m.hide()}})}function h(){p("#otp_id").removeClass("a-form-error");p("#otpBadCode").addClass("hidden")}
function b(){k.increaseCount(z.metricPrefix+z.resend,1,1);var b="1"===p("#isPaystationFlow").val(),c;b?(c="resend-otp.html?returnHtml\x3d0\x26isPaystationFlow\x3d1",m.show()):c="resend-otp.html?returnHtml\x3d0";a.ajax(c,{method:"get",success:function(a){b&&(a&&1===a.successful&&(p("#authSourceId").val(a.authSourceId),p("#paystationRequestId").val(a.paystationRequestId)),m.hide())},error:function(a){b&&m.hide()}})}var p=a.$,w,v,z={metricPrefix:"Payauth-",resend:"Resend"};a.on("checkout:reload:payauth",
function(){w=p("#resend_form");v=p("#otp_form");v.submit(function(a){var b=p(a.currentTarget);if("1"===b.find('input[id\x3d"isPaystationFlow"]').val()&&(h(),"1"!==b.find('input[id\x3d"isFormValidated"]').val()))return a=b.find('input[id\x3d"otp_id"]').val(),b=b.find('input[id\x3d"paystationRequestId"]').val(),f(a,b),!1});w.submit(function(a){"1"===p("#isPaystationFlow").val()&&h();b();return!1});d();p("#otp_id").unbind("keyup").bind("keyup",d)})});"use strict";r.when("A","ajax-utility","client-side-metrics",
"loading-spinner-controller","pay-common-lib","pay-common-util","page-conductor","page-transition-controller","quantity-service","weblab-helper").register("pay-gil",function(a,m,l,c,e,k,n,d,f,h){function b(a){L=a.popover;var b=g(L);r("#gil-estimates-popover-"+b+" .gil-popover-content").html("");r("#gil-estimates-popover-"+b+" .gil-popover-error").html("");a.popover.updatePosition(!0)}function p(a){L=a.popover;var b=g(L),d=r("#gil-estimates-popover-"+b);d.find("input[name\x3dgil-subtype]").val(b);
c.showSpinner(d,!1,L);a="/gp/buy/payselect/handlers/get-gil-popover-content.html?cachebuster\x3d"+(new Date).getTime();var e="hasWorkingJavascript\x3d1\x26subtype\x3d"+encodeURIComponent(b);r.ajax({type:"POST",url:a,data:e,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return m.jsonify(a)},success:function(a,e,f){g(L)===b&&(l.increaseCount("Checkout:GIL:"+b+":IneligiblePopoverSuccess",1),e=L,c.hideSpinner(d),a&&a.errors&&0<a.errors.length?d.find(".gil-popover-error").show():a&&a.widgetHTML?
d.find(".gil-popover-content").html(decodeURIComponent(a.widgetHTML)):d.find(".gil-popover-error").show(),e.updatePosition(!0))},error:function(a){g(L)===b&&(l.increaseCount("Checkout:GIL:"+b+":IneligiblePopoverError",1),a=L,c.hideSpinner(d),d.find(".gil-popover-error").show(),a.updatePosition(!0))}})}function w(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")}function v(a){a.$event.preventDefault();var b=g(L),e=r("#gil-estimates-popover-"+b);c.showSpinner(e,
!1,L);var k=z(a.$currentTarget.parents("#gil-estimates-popover-"+b));c.showSpinner(e,!1,L);f.callBatch(k,{success:function(c,e,f){g(L)===b&&(l.increaseCount("Checkout:GIL:"+b+":SubmitIneligiblePopoverSuccess",1),w(a),d.show(),1==parseInt(r("input[name\x3d'gil-rendered-using-apx']").val(),10)&&h.isGILCreditCardEnabled()?(c=r(".pmts-select-payment-instrument-form"),e=L,"APX_PSP_TO_RCX_SPC"==(e.attrs?e.attrs("data").onSubmit:e.data.onSubmit)&&c&&0<c.length?n.continueClicked(null,c):l.increaseCount("Checkout:GIL:"+
b+"Popover:ErrorRedirectingToSPC",1)):t(b))},error:function(a){g(L)===b&&(l.increaseCount("Checkout:GIL:"+b+":SubmitIneligiblePopoverError",1),a=L,c.hideSpinner(e),e.find(".gil-popover-error").show(),a.updatePosition(!0))},isTrial:0})}function z(a){var b={};a.find(".gil-ineligible-items").children(".gil-ineligible-item").each(function(a,c){a=r(c).find('input[name^\x3d"ineligible-item"]').val();b[a]=0});return b}function q(a){a.$event.preventDefault();var b=r("#gil-ineligible-"+a.data.subtype).find(".gil-ineligible-items"),
c=b.data("index"),d=b.data("size"),c=(c+("next"===a.data.direction?1:-1)+d)%d,d=(c+1)%d;b.find(".gil-ineligible-item").addClass("aok-hidden").removeClass("a-span-last");a=b.find("#gil-ineligible-item-"+c);d=b.find("#gil-ineligible-item-"+d);a.removeClass("aok-hidden");d.addClass("a-span-last").removeClass("aok-hidden");b.data("index",c)}function t(b){k.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{handler:"new-gil-payment",subtype:b},{successHandler:function(c,d,e){l.increaseCount("Checkout:GIL:"+
b+":NewToExistingSuccess",1);n.ajaxUpdatePage(c,d,e);k.scrollTopTo(r("#existing-payment-methods [value\x3d"+b+"]"));if(n.isSPP())a.on("checkout:afterReload",function N(){r("#existing-gil input[value\x3d"+b+"]").trigger("click");a.off("checkout:afterReload",N)});else r("#existing-gil input[value\x3d"+b+"]").trigger("click")},errorHandler:function(a,c,d){l.increaseCount("Checkout:GIL:"+b+":NewToExistingError",1);n.ajaxUpdatePage(a,c,d)}})}function g(a){return a.attrs?a.attrs("data").subtype:a.data.subtype}
function u(){A&&(a.declarative("gil-close-popover",["click"],w),a.declarative("gil-submit-popover",["click"],v),a.declarative("gil-ineligible-pagination",["click"],q));r("#gil-cc-payment-type").length&&(a.off("a:popover:beforeShow:gil-estimates",b),a.off("a:popover:show:gil-estimates",p),a.on("a:popover:beforeShow:gil-estimates",b),a.on("a:popover:show:gil-estimates",p));r("#gil-payment-type").length&&(a.off("a:popover:beforeShow:gil-si-estimates",b),a.off("a:popover:show:gil-si-estimates",p),a.on("a:popover:beforeShow:gil-si-estimates",
b),a.on("a:popover:show:gil-si-estimates",p));A=!1}var r=a.$,A=!0,L;a.on("checkout:reload:payselect",u);a.on("checkout:reload:spp-payment",u);return{submitNewGilPayment:t,displayGILEstimatesMobile:function(a,b,c){var d="/gp/buy/payselect/handlers/get-gil-popover-content.html?cachebuster\x3d"+(new Date).getTime(),e="hasWorkingJavascript\x3d1\x26subtype\x3d"+encodeURIComponent(a);k.makeAjaxCall(d,e,{successHandler:function(c,d,e){var g=m.jsonify(c);g&&!g.errors&&g.widgetHTML?l.increaseCount("Checkout:GIL:"+
a+":Mobile:IneligibleSubPageSuccess",1):l.increaseCount("Checkout:GIL:"+a+":Mobile:IneligibleSubPageError",1);b(c,d,e)},errorHandler:function(b){l.increaseCount("Checkout:GIL:"+a+":Mobile:IneligibleSubPageError",1);c(b)}})},actionCloseGilMobileSubpage:function(a){a.$event.preventDefault();r("#gil-estimates-subpage").remove();r(k.pages.main.pageId).show()},actionSubmitGilMobileSubpage:function(a,b,c){a.$event.preventDefault();r("#gil-ineligible-view");var d=z(a.$currentTarget.parents("#gil-ineligible-view"));
f.callBatch(d,{success:function(c,d,e){l.increaseCount("Checkout:GIL:"+a.data.subtype+":Mobile:SubmitIneligibleSubPageSuccess",1);b(c,d,e)},error:function(b){l.increaseCount("Checkout:GIL:"+a.data.subtype+":Mobile:SubmitIneligibleSubPageError",1);c(b)},isTrial:0})}}});"use strict";r.when("A","ready").register("new-verified-debit-card",function(a){});"use strict";r.when().register("recommendation-helper",function(){return{}});"use strict";r.when("A").register("apb-limit-messaging-helper",function(a){return{}});
"use strict";r.when("A","jQuery","client-side-metrics","ready").register("temporary-preference-indicator",function(a,m,l){function c(){m.ajax({type:"GET",url:"/gp/shopwithpoints/temporaryPreference/has-active-temporary-preference.html",async:!0,dataType:"json",success:function(a){a.hasOwnProperty("Result")?(e=a.Result,l.increaseCount("Checkout::PayPage::TemporaryPaymentPreferenceIndicator::Ajax::Success",1),l.increaseCount("Checkout::PayPage::TemporaryPaymentPreferenceIndicator::TPPCheckBackendCall::Success",
1)):l.increaseCount("Checkout::PayPage::TemporaryPaymentPreferenceIndicator::TPPCheckBackendCall::Failure",1)},error:function(){l.increaseCount("Checkout::PayPage::TemporaryPaymentPreferenceIndicator::Ajax::Failure",1)}})}var e="False";a.on("checkout:reload:payselect",c);a.on("checkout:reload:spp-payment",c);a.on("checkout:reload:pay",c);return{hasActiveTemporaryPreference:function(){return"True"===e}}});"use strict";r.when("A","page-detector").register("alipay-detector",function(a,m){var l=a.$,c=
function(){var a=l("input[name\x3d'isAlipayAppPayment']");0<a.length&&m.isMobileSpc&&a.val("1")},e=function(a){},k=function(){var a=l("input[name\x3d'isAlipayRedirect']");0<a.length&&m.isMobileSpc&&a.val("1")},n=function(a){};a.on("checkout:reload:spc",function(){l("input[name\x3d'isAlipayAppPayment']").length&&r.when("safe-mash").execute(function(a){a=q.cordova.require("cordova/exec");a(c,e,"AlipayPlugin","isAlipayInstalled",[]);l("input[name\x3d'isAlipayRedirect']").length&&a(k,n,"AlipayPlugin",
"isAlipayFailReturnSupported",[])})})});"use strict";r.when("A","page-transition-controller","page-detector").execute(function(a,m,l){function c(){var a=e("#backButtonProtection");a.length&&"1"===a.val()&&(m.showPageTransition(),document.location.reload())}var e=a.$;r.register("back-button-protection",function(){return{markAsDirty:function(){e("#backButtonProtection").val(1)}}});a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c)});"use strict";r.when("A","page-transition-controller",
"loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","delivery-preferences-csm-helper").register("delivery-preferences-controller",function(a,m,l,c,e,k,n,d,f){function h(){n.isTabletSpc()&&(u=g("#spc-orders .delivery-preferences-options"),x(),u.find("select").trigger("change"),q())}function b(){var a=u.find("input[name\x3dpreference]:checked").val(),b=u.find("select[name\x3dSafePlaceLocation]");"NeighborDelivery"===a?(u.find("input[name\x3dneighbor-name]").removeAttr("disabled").removeClass("a-form-disabled"),
u.find("input[name\x3dneighbor-house]").removeAttr("disabled").removeClass("a-form-disabled"),e.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),u.find(".safe-place-error").hide()):"SafePlaceDelivery"===a?(e.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"enabled"})}):b.removeAttr("disabled").closest(".a-button").removeClass("a-button-disabled"),
u.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),u.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),u.find(".neighbor-name-error").hide(),u.find(".neighbor-house-error").hide()):(u.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),u.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),e.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):
b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),u.find(".neighbor-name-error").hide(),u.find(".neighbor-house-error").hide(),u.find(".safe-place-error").hide());p(!0)}function p(a){var b=u.find("input[name\x3dpreference]:checked").val();u.find(".safe-place-error").hide();u.find(".neighbor-name-error").hide();u.find(".neighbor-house-error").hide();u.find("input").removeClass("a-form-error");u.find("div.a-input-text-wrapper").removeClass("a-form-error");u.find("select").closest(".a-button").removeClass("a-button-error");
0<g("div.spc-tablet").length?u.find(".set-delivery-preferences-button").removeClass("a-button-disabled"):u.find(".set-delivery-preferences-button").show();u.find(".save-disabled").hide();u.find(".current-blocker-content").text("");var c=!1;if("NeighborDelivery"===b){var d=u.find("input[name\x3dneighbor-name]");d.data("defaultValueRemoved")&&d.val()||(u.find(".neighbor-name-error").show(),d.addClass("a-form-error"),d.closest(".a-input-text-wrapper").addClass("a-form-error"),u.find(".current-blocker-content").html(u.find(".neighbor-name-error-text").text()),
c=!0);d=u.find("input[name\x3dneighbor-house]");d.data("defaultValueRemoved")&&d.val()||(u.find(".neighbor-house-error").show(),d.addClass("a-form-error"),d.closest(".a-input-text-wrapper").addClass("a-form-error"),u.find(".current-blocker-content").html(u.find(".neighbor-house-error-text").text()),c=!0)}else"SafePlaceDelivery"===b&&(d=u.find("select[name\x3dSafePlaceLocation]"),d.val()||(u.find(".safe-place-error").show(),d.closest(".a-button").addClass("a-button-error"),u.find(".current-blocker-content").html(u.find(".safe-place-error-text").text()),
c=!0));d=g("#disableSaveBtnWhenNoDeliveryPrefSelected").val();if(a&&c||"true"===d&&void 0===b)0<g("div.spc-tablet").length?u.find(".set-delivery-preferences-button").addClass("a-button-disabled"):u.find(".set-delivery-preferences-button").hide(),u.find(".save-disabled").show();return!c}function w(a){a&&a.$event&&a.$event.preventDefault();a="hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26";var b="",h=u.find(".popover-deliv-prefs-content");h.data("obfuscatedEntityId")?
b=h.data("obfuscatedEntityId"):u.data("obfuscatedEntityId")&&(b=u.data("obfuscatedEntityId"));a+="obfuscatedEntityId\x3d"+b+"\x26";b=u.find("input[name\x3dpreference]:checked").val();""!==b&&(a+="prefDelLocation\x3d"+b+"\x26","NeighborDelivery"===b?(a+="neighborName\x3d"+encodeURIComponent(u.find("input[name\x3dneighbor-name]").val())+"\x26",a+="houseNo\x3d"+encodeURIComponent(u.find("input[name\x3dneighbor-house]").val())+"\x26"):"SafePlaceDelivery"===b&&(a+="safePlaceLocation\x3d"+u.find("select[name\x3dSafePlaceLocation]").val()+
"\x26"),b=u.find("input[name\x3ddefaultPreference]:checked").val(),void 0!==b&&""!==b&&(a+="isDefaultPreference\x3d1"));0<g("div.spc-tablet").length?m.show():l.showSpinner(u.find(".popover-deliv-prefs-content"),!1,K);f.recordCSMWithCurrentFieldValues("popover-submitted","preference","defaultPreference");g.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-delivery-preference.html",data:a,dataType:"text",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc",
"x-amz-checkout-transition":"ajax"},success:function(a,b,f){A=!0;0<g("div.spc-tablet").length?m.hide():l.hideSpinner(u.find(".popover-deliv-prefs-content"));f.getResponseHeader("x-amz-checkout-page")?(u.find(".a-button-close").trigger("click"),e.ajaxUpdatePage(a,b,f)):(a=c.jsonify(a),e.redirect(a));d.increaseCount("checkoutSpcDeliveryPref-save",1)},error:function(a,b,c){0<g("div.spc-tablet").length?m.hide():l.hideSpinner(u.find(".popover-deliv-prefs-content"));p(!0)}})}function q(){u.find("input[name\x3d'neighbor-name'], input[name\x3d'neighbor-house']").unbind("focus").bind("focus",
function(){if(!g(this).data("defaultValueRemoved")){if(n.isMobileSpc()||n.isDesktopSpc())g(this).val(""),g(this).css("color","black");g(this).data("defaultValueRemoved",!0)}}).each(function(){(n.isMobileSpc()||n.isDesktopSpc())&&g(this).data("defaultValueRemoved")&&g(this).css("color","black")});u.find("input:radio[name\x3dpreference]").unbind("click").bind("click",b);u.find("input[name^\x3dneighbor]").unbind("keyup").bind("keyup",function(){p(!1)});0<g("div.spc-tablet").length?u.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",
z):u.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",function(){p(!1)})}function z(a){p(!0)&&w(a)}function x(a){var b=g("#spc-orders .delivery-preferences-options"),c,d="";a?(c=a.$currentTarget.find("input"),d=b.find("input[name\x3dpreference]:checked").val()):c=b.find("input[name\x3dpreference]:checked");b=c.val();if(d!==b){u.find(".expand-content").hide();var d=c,e=d.closest(".delivery-preferences-options");e.find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");
e.find("input").attr("checked",!1);d.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");d.attr("checked",!0);"NeighborDelivery"===b||"SafePlaceDelivery"===b?c.closest(".deliverypreference-option").siblings(".expand-content").show():a&&w(a)}}function t(a){(a=u.find("#delivery-preferences-set-default-checkbox"))&&1===a.length&&(a.prop("checked")?d.increaseCount("checkoutSpcDeliveryPref-setAsDefault",1):d.increaseCount("checkoutSpcDeliveryPref-setAsTemporary",
1))}var g=a.$;if(!g("html").hasClass("a-ie6")){var u,K,A;a.on("a:popover:beforeShow",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-delivprefs")&&(a.popover.$popover.find(".a-popover-inner").html(u.find(".current-blocker-content").text()),a.popover.updatePosition())});a.on("a:popover:show",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(d.increaseCount("checkoutSpcDeliveryPref-open",1),K=a.popover,u=K.$popover,A=!1,q(),f.recordCSMWithCurrentFieldValues("popover-displayed",
"preference","defaultPreference"),b(),u.find("select").trigger("change"))});a.on("a:popover:dismiss",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(A||d.increaseCount("checkoutSpcDeliveryPref-dismissed",1))});a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(A||f.recordCSM("popover-dismissed"))});a.declarative("delivery-preferences-switch-tablet",["click"],function(a){x(a)});a.declarative("delivery-preferences-expander-toggle",
["click"],function(a){k.toggleExpanderContent(a)});a.declarative("set-delivery-preferences",["click","touchend"],function(a){a.$event.preventDefault();k.protectAgainstDoubleAction("set-delivery-preferences")||p(!0)&&w()});a.declarative("delivery-preferences-set-default-checkbox-triggered","change",t);a.on("checkout:reload:spc",h)}});"use strict";r.when("A","page-detector","time-left-formatter").register("fast-track-controller",function(a,m,l){function c(){for(var b in w)w[b]&&clearInterval(w[b]);
a.defer(e)}function e(){b.DAY=h("#fasttrack-day").html();b.DAYS=h("#fasttrack-days").html();b.HOUR=h("#fasttrack-hour").html();b.HOURS=h("#fasttrack-hours").html();b.AND=h("#fasttrack-and").html();b.MINUTE=h("#fasttrack-minute").html();b.MINUTES=h("#fasttrack-minutes").html();b.SECOND=h("#fasttrack-second").html();b.SECONDS=h("#fasttrack-seconds").html();(h("#isfresh").length&&h(".checkout.spc-mobile").length||h("#lazy-fresh-promise-delivery-message").length?h("#spc-form"):h("#spc-orders")).find(".fasttrack-span").each(function(){var b=
h(this),c=b.find("input[name\x3d'countdownId']").val();p[c]=parseInt(b.find("input[name\x3d'fasttrackExpiration']").val());q[c]=a.now()/1E3+p[c];k(b.find("input[name\x3d'countdownThreshold']").val(),b,b.find("input[name\x3d'showSimplifiedCountdown']").val(),c);b.show()})}function k(a,b,c,e){0>=p[e]?d(b,null):a&&0<a&&p[e]>a?b.find("span.fasttrackavailable").hide():(n(b,c),w[e]=setInterval(function(){n(b,c,e)},1E3))}function n(c,e,f){0<p[f]?(p[f]=Math.round(q[f]-a.now()/1E3),e=l.getTimeLeftFormatted(p[f],
1===e||"1"===e?!0:!1,b),h("html").hasClass("a-tablet")?c.find("span[data-field\x3d'fasttrackcountdown']").html("\x26nbsp;"+e):c.find("span[data-field\x3d'fasttrackcountdown']").html(e),c.find("span.fasttrackexpired").hide(),c.find("span.fasttrackcountdown").show(),c.find("span.fasttrackavailable").show()):d(c,f)}function d(a,b){b?(w[b]&&clearInterval(w[b]),a.find("span.fasttrackavailable").hide(),a.find("span.fasttrackexpired").show()):clearInterval(w[b])}function f(){c()}var h=a.$;if(!h("html").hasClass("a-ie6")){var b=
{},p={},w={},q={};a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c);return{spcLiteLazyLoadFastTrack:f}}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","client-side-metrics").register("gc-redeem-controller",function(a,m,l,c,e){function k(a){if(!w){a.preventDefault();p(a.currentTarget);var b;0<p("#spc-gcpromoinput").length&&(b=encodeURIComponent(p("#spc-gcpromoinput").val()));0<p("#gc-promo-input").length&&(b=encodeURIComponent(p("#gc-promo-input").val()));
var d=encodeURIComponent(p("#spc-usePromoOnly").val());if(b&&0!==b.length){var e=encodeURIComponent(p("input[name\x3dpurchaseTotal]").val());p("#gc-error").hide();p("#gc-promo-success").hide();p("#gc-success").hide();p("#gc-ineligible").hide();p("#promo-success").hide();c.isSPP()?(m.blockAllActions(),m.showTransitionInContainer(p("#payment"))):m.show();var h=(new Date).getTime();a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_pay_page_gc_add";p(".checkout.spc.aui-templatized").length&&
(a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_spc_gc_add");b="purchaseTotal\x3d"+e+"\x26claimcode\x3d"+b+"\x26disablegc\x3d"+d+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+p("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+h;d=c.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});p.ajax({type:"POST",url:a,data:b,headers:d,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
dataType:"text",complete:function(){w=!1},success:n,error:c.ajaxRedirect});w=!0}else f("addGiftCardOrPromo_NoCode")}}function n(a,b,e){var g=e.getResponseHeader("x-amz-checkout-page");if(g){if(c.ajaxUpdatePage(a,b,e),"spc"===g||"spclite"===g||"spp-revieworder"===g)(a=parseInt(p("#checkoutDisplayPage").data("delaySetTitle"),10)||parseInt(p("#gc-promo-delay").data("egcDelayUpdateRedemptionMessage"),10)||0)?setTimeout(function(){d(e)},a):d(e)}else{a=l.jsonify(a);if(!a)return c.redirect();if(a.error)return f(a.error);
if(a.errors)return f(a.errors);if(a.autohandlererror)return h(a.autohandlererror);c.redirect(a)}}function d(a){var c=a.getResponseHeader("x-updated-promo-type");a=a.getResponseHeader("x-updated-gc-applied-but-ineligible");c&&(a||p("#gc-promo-success").show(),0<p("div.spc-desktop").length?(p("#spc-gcpromoinput").removeClass("a-form-error"),p("#gc-promo-input").removeClass("a-form-error")):(p("#spc-gcpromoinput").closest(".a-input-text-wrapper").removeClass("a-form-error"),p("#gc-promo-input").closest(".a-input-text-wrapper").removeClass("a-form-error")),
"giftcard"===c?(b("applied"),a?(p("#gc-ineligible").show(),b("gcIneligible")):p("#gc-success").show()):p("#promo-success").show())}function f(a){m.hide();p("#gc-error p").hide();p("#gc-error").show();b("error");0<p("div.spc-desktop").length?(p("#spc-gcpromoinput").addClass("a-form-error"),p("#gc-promo-input").addClass("a-form-error")):(p("#spc-gcpromoinput").closest(".a-input-text-wrapper").addClass("a-form-error"),p("#gc-promo-input").closest(".a-input-text-wrapper").addClass("a-form-error"));p(0<
p("#gc-promo-input").length?"."+v[a]:"#"+a).show()}function h(a){if(a){var b=a.action,c="/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(a.type?a.type:b&&b.code?b.code:"string"===typeof a?a:"Unknown:pipelineJSError");"fatal"===b?c+="\x26errorAction\x3dfatal":"redirect"===b&&(a.url?c=a.url:"cart"===a.page&&(c="/gp/cart/view.html"));q.location.href=c}else q.location.href="/gp/buy/payselect/handlers/error.html?errorType\x3dUnknown:pipelineJSError"}function b(b){var c=a.state("cxt-gc-redemption-method").method;
e.increaseCount("rcxGCRedeem:"+c+":"+b,1)}var p=a.$,w=!1;if(!p("html").hasClass("a-ie6")){a.state("cxt-gc-redemption-method",{method:"type"});var v={addGiftCardOrPromo_Unknown:"UNKNOWN",addGiftCardOrPromo_NoCode:"NO_CODE",addPromo_InvalidForPurchase:"PROMO_INVALID_FOR_PURCHASE",addPromo_BadCode:"PROMO_BAD_CODE",addPromo_ExpiredCode:"PROMO_EXPIRED_CODE",addPromo_InvalidForOrgUnit:"PROMO_INVALID_FOR_ORG_UNIT",addPromo_OfferNotYetBegun:"USED_BEFORE_START_DATE",addPromo_AlreadyRedeemed:"PROMO_ALREADY_REDEEMED",
addGiftCard_AlreadyRedeemedByAnotherAccount:"GC_ALREADY_REDEEMED_BY_ANOTHER_ACCOUNT",addGiftCard_AlreadyRedeemedByThisAccount:"GC_ALREADY_REDEEMED_BY_THIS_ACCOUNT",addGiftCard_BadCode:"GC_BAD_CODE",addGiftCard_ExpiredCode:"GC_EXPIRED_CODE",addGiftCard_Cancelled:"CANCELLED_CODE",addGiftCard_WrongOrgUnit:"GC_WRONG_ORG_UNIT",addGiftCard_ServiceDown:"GC_SERVICE_DOWN",addGiftCard_InvalidForAGS:"GC_INVALID_FOR_AGS",addGiftCard_PassedClaimByDate:"PASSED_CLAIM_BY_DATE",addGiftCard_OfferNotYetBegun:"GC_NOT_YET_BEGUN",
addGiftCard_ExceededMaxLimit:"GC_EXCEED_MAX_LIMIT",addGiftCard_Disabled:"GC_DISABLED",addGiftCard_OTP_Required:"GC_OTP_REQUIRED",addGiftCard_SEVIS_Decline:"GC_SEVIS_DECLINE",addGiftCard_OCRAH_Decline:"GC_OCRAH_DECLINE",addGiftCard_DEFAULT_Message:"GC_DEFAULT_MESSAGE"};a.declarative("gc-element",["click"],function(a){var b=a.data.click;b&&null!==b&&k(a.$event)});a.on("a:expander:redeem-gc-expander:toggle:expand",function(a){e.increaseCount("checkout:spp-payment:expand_addgc_coll",1)});p(document).delegate("#spc-gcpromoinput, #gc-promo-input",
"keypress",function(a){13===a.which&&k(a)});return{actionAddGiftPromotion:k,giftSystemErrorHandling:h}}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","gift-utility","weblab-helper").register("gift-popover-controller",function(a,m,l,c,e,k,n,d,f,h){function b(){var a=T;a.find("#select-recipient").empty();for(var b=0;b<ha.length;b++){var c=J("\x3coption/\x3e").attr({value:ha[b].value}).text(ha[b].text);
a.find("#select-recipient").append(c)}la&&(b=a.find('#select-recipient option[value\x3d"'+la+'"]').attr("selected","selected"),a.find("#select-recipient").closest("#popover-gift-connection-recipient").find(".a-placeholder").text(b.text()),V())}function p(){a.defer(function(){J("#spc-orders").find(".gift-popover-link").each(function(){J(this).data("action")&&J(this).removeAttr("href").attr("tabindex",0)})});J(".larger-image-link").find("a").removeAttr("href")}function w(a){var c=T;c.find(".gift-error-box").hide();
c.find(".fake-label").each(function(){J(this).unbind("click").bind("click",function(){J(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&c.find(".popover-gift-top .gift-item-title span").html(a.item.title);a&&a.item&&a.item.isAutoripEligible?c.find("#gift-autorip-unavailable-msg").show():c.find("#gift-autorip-unavailable-msg").hide();if(a&&a.obfuscatedEntityId){var d=c.find(".set-gift-options-button input");d.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,
giftData:a},v);k.bindActionEnterKeyOnButton(d)}ja?(ga=a&&a.item&&a.item.isAmazonFulfilled,qa=!(a&&a.address&&0===a.address.shipToSelf),ga&&(a&&a.options&&a.options.canHaveMessage||a&&a.options&&a.options.canBeWrapped)?(t(!0),c.find(".mfn-hide-prices").hide(),c.find(".include-gift-receipt").show()):ga||(t(!0),c.find(".include-gift-receipt").hide(),c.find(".mfn-hide-prices").show(),c.find(".include-gift-message").show()),Ba=c.find(".include-gift-message").is(":visible"),L()):a&&a.options&&a.options.canHidePrices?
c.find(".hide-prices-checkbox").closest("div").show():c.find(".hide-prices-checkbox").closest("div").hide();a&&a.selected&&(d=S(c.find(".hide-prices-checkbox")),a.selected.hidePrices?d.attr("checked",!0):d.removeAttr("checked"));if(a&&a.item&&a.item.purchaseIsKindle){if(d=c.find(".kindle-registration-box"),d.show(),d.find(".register-kindle-customer-name").html(c.find(".gift-customer-name").html()),!ja){var d=S(c.find(".kindle-reg-radio-another-account")),e=S(c.find(".kindle-reg-radio-your-account"));
a.selected.hidePrices||a.selected.isWrapped?(e.removeAttr("checked"),d.attr("checked",!0)):(d.removeAttr("checked"),e.attr("checked","checked"));S(c.find(".hide-prices-checkbox")).trigger("change")}}else c.find(".kindle-registration-box").hide();if(a&&a.options&&a.options.canHaveMessage){a&&a.selected&&(d=a.selected.message,e=S(c.find(".include-gift-message-checkbox")),d&&d.length?(c.find("textarea[name\x3d'gift-message-text']").val(d),u(!0)):null===d&&(a.selected.isWrapped||a.selected.hasReceipt)?
(e.removeAttr("checked"),c.find(".textarea[name\x3d'gift-message-text']").val("")):(c.find("textarea[name\x3d'gift-message-text']").val(""),d="",ja?(d+=c.find(".sample-gift-msg-greeting").html(),a&&a.address&&a.address.firstName&&!qa&&(d+=" "+a.address.firstName),d=d+",\n"+c.find(".sample-gift-msg").html(),d+="\n"):(d+=c.find(".sample-gift-msg").html(),d+="\n\n"),d+=c.find(".sample-gift-msg-from").text(),d=ja?d+f.getNameWithNoTitle(c.find(".gift-customer-name").html()):d+f.getFirstName(c.find(".gift-customer-name").html()),
c.find("textarea[name\x3d'gift-message-text']").val(d),!ja||qa&&Ba||u(!0)));var g=J(".gift-message-warning").length,d=function(){ja&&u(!0);N(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);if(g){var b=T.find("textarea[name\x3d'gift-message-text']");f.toggleGiftMessageWarning(b,T)}};if(a&&a.options){var h=c.find("textarea[name\x3d'gift-message-text']");h.bind("keyup",d);h.bind("mouseup",d);N(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);
g&&f.toggleGiftMessageWarning(h,c);S(c.find(".include-gift-message-checkbox")).bind("change",function(){var b=J(this).is(":checked"),d=a.options.maxMessageChars,e=a.options.maxMessageLines,k=a.options.hasFixedGiftMsgLimit,l=T,m=l.find("textarea[name\x3d'gift-message-text']");b?ja&&A():(0<l.find(".validateInputCharactersOnBlur.a-form-error").size()&&(l.find(".validateInputCharactersOnBlur.a-form-error").removeClass("a-form-error"),0<l.find("#onblur-character-validation-error-gift-message-text").size()&&
l.find("#onblur-character-validation-error-gift-message-text").remove()),ja?L():(m.val(""),N(d,e,k)));g&&f.toggleGiftMessageWarning(h,c)})}}else c.find(".popover-gift-message-text").css("visibility","hidden"),c.find(".include-gift-message").css("visibility","hidden"),ja&&(c.find(".include-gift-message").hide(),c.find(".popover-gift-message").css("visibility","hidden")),c.find(".popover-gift-message-not-available").show();a&&a.options&&!a.options.canBeWrapped?(c.find(".wrap-option").hide(),c.find(".popover-gift-no-wrap-available").show(),
c.find(".hide-prices-amazon-msg").hide(),c.find(".hide-prices-note").hide(),c.find(".hide-prices-merchant-msg").show(),S(c.find(".hide-prices-checkbox")).attr("disabled",!1)):a&&a.item&&a.item.isAmazonFulfilled?(c.find(".wrap-option").hide(),c.find(".popover-gift-fba-wrap").show(),c.find(".hide-prices-amazon-msg").show(),c.find(".hide-prices-merchant-msg").hide(),(d=a.options.wraps[0].imageurl)&&0<d.length&&(c.find(".large-preview").find("img").attr("src",d),c.find(".large-preview").show(),c.find(".fba-wrap-checkbox").show(),
e=c.find(".larger-image-link"),e.unbind("click").bind("click",{imageURL:d},Q),k.bindActionEnterKeyOnButton(e)),a.options.wraps[0].description&&c.find(".gift-wrap-title").show().html(a.options.wraps[0].description),"1"===J("#multipleAFNGiftWrapOption").val()?a.options&&a.options.wraps&&1<=a.options.wraps.length&&(d=c.find(".popover-gift-amazon-wrap"),r(c,d),ba(a,"afn",d)):a.options&&a.options.wraps&&1===a.options.wraps.length?(c.find(".popover-gift-amazon-wrap").hide(),c.find(".popover-gift-merchant-wrap").hide(),
c.find(".fba-wrap-checkbox .gift-wrap-price").html(a.options.wraps[0].price),e=S(c.find(".amazon-gift-wrap")),e.val(a.options.wraps[0].id),d=S(c.find(".hide-prices-checkbox")),a.selected.isWrapped?(e.attr("checked",!0),a.item.purchaseIsKindle||(d.attr("checked",!0),d.attr("disabled",!0),c.find(".hide-prices-note").show())):(e.removeAttr("checked"),d.attr("disabled",!1),c.find(".hide-prices-note").hide())):a.options&&a.options.wraps&&1<a.options.wraps.length&&(d=c.find(".popover-gift-amazon-wrap"),
r(c,d),X(a,"afn",d))):(c.find(".wrap-option").hide(),S(c.find(".hide-prices-checkbox")).removeAttr("disabled"),c.find(".hide-prices-amazon-msg").hide(),c.find(".hide-prices-note").hide(),c.find(".hide-prices-merchant-msg").show(),c.find(".large-preview").hide(),d=c.find(".popover-gift-merchant-wrap").show(),d.find(".mfn-wrap-copy").remove(),X(a,"mfn",d));ja&&(P(),H(),D());if(0<J(".enable-gift-connections").length){c.find("#popover-gift-connection select.a-touch-select-input").each(function(){J(this).unbind("change").bind("change",
function(){var a=J(this),b=a.siblings("a.a-placeholder"),a=a.find(":selected").text();b.text(a);return!1})});c.find("#select-recipient").bind("change",function(a){G(a);return!1});c.find("#select-occasion").bind("change",function(a){za(a);return!1});c.find("#input-recipient-first-name").keyup(function(){V()});c.find("#input-recipient-last-name").keyup(function(){V()});c.find("#popover-gift-connection-recipient").unbind("click").bind("click",function(a){a=T;sa||a.find("#select-recipient-spinner").show()});
la=void 0;if(a.giftConnection){"0"===a.giftConnection.giftlistTypeId&&"0"===a.giftConnection.occasionId&&c.find("#include-gift-connection-checkbox").attr("checked",!1);a.giftConnection.firstName&&c.find("#input-recipient-first-name").val(a.giftConnection.firstName);a.giftConnection.lastName&&c.find("#input-recipient-last-name").val(a.giftConnection.lastName);if("1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)d=c.find('#select-recipient option[value\x3d"'+a.giftConnection.giftlistTypeId+
'"]').attr("selected","selected"),c.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(d.text()),c.find(".gift-connection-recipient-extra").show();if(a.giftConnection.giftlistId&&"0"!==a.giftConnection.giftlistId)la=a.giftConnection.giftlistId;else if("0"===a.giftConnection.giftlistTypeId||"1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)la=a.giftConnection.giftlistTypeId;a.giftConnection.occasionId&&(d=c.find('#select-occasion option[value\x3d"'+
a.giftConnection.occasionId+'"]').attr("selected","selected"),c.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.occasionMonth&&(d=c.find('#select-occasion-month option[value\x3d"'+a.giftConnection.occasionMonth+'"]').attr("selected","selected"),c.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.occasionDay&&(d=c.find('#select-occasion-day option[value\x3d"'+a.giftConnection.occasionDay+
'"]').attr("selected","selected"),c.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.age&&(d=c.find('#select-occasion-age option[value\x3d"'+a.giftConnection.age+'"]').attr("selected","selected"),c.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(d.text()));if("1"===a.giftConnection.occasionId||"2"===a.giftConnection.occasionId)c.find(".gift-connection-occasion-extra").show(),"2"===a.giftConnection.giftlistTypeId&&
c.find("#select-occasion-age-row").show();a.giftConnection.hasReminder&&"0"===a.giftConnection.hasReminder&&c.find("#occasion-has-reminder-checkbox").attr("checked",!1)}(!a.giftConnection||"1"!==a.giftConnection.occasionId&&"2"!==a.giftConnection.occasionId&&"3"!==a.giftConnection.occasionId)&&V();ha?(b(),c.find("#select-recipient").show(),c.find("#select-recipient-spinner").hide(),sa=!0):(sa=!1,ua())}T.find(".content-container").css("visibility","visible");wa.updatePosition(!0);l.hideSpinner(c.find(".popover-content-main"))}
function v(a){var b=T,d="";if(!(0<b.find(".validateInputCharactersOnBlur.a-form-error").size())){a&&a.data&&a.data.obfuscatedentityid&&(d+="obfuscatedEntityId\x3d"+a.data.obfuscatedentityid+"\x26");ga&&(d+="isAFN\x3d1\x26");S(b.find(".include-gift-receipt-checkbox")).is(":checked")&&(d+="includeReceipt\x3d1\x26");S(b.find(".include-gift-message-checkbox")).is(":checked")?(d+="includeMessage\x3d1\x26message\x3d"+encodeURIComponent(b.find("textarea[name\x3d'gift-message-text']").val())+"\x26",d+="maxChars\x3d"+
a.data.giftData.options.maxMessageChars+"\x26",d+="maxLines\x3d"+a.data.giftData.options.maxMessageLines+"\x26"):d+="includeMessage\x3d0\x26";d=S(b.find(".hide-prices-checkbox")).is(":checked")?d+"hidePrices\x3d1\x26":d+"hidePrices\x3d0\x26";b.find(".kindle-registration-box").is(":visible")&&(d+="isKindlePurchase\x3d1\x26");var g;if(b.find(".popover-gift-fba-wrap").is(":visible"))if(b.find(".popover-gift-amazon-wrap").is(":visible")){if((g=b.find("input[name\x3d'afn-gift-wrap']:checked").eq(0).val())&&
g.length)for(d+="giftWrap\x3d"+g+"\x26",g=0;g<a.data.giftData.options.wraps.length;g++)if(b.find(".popover-gift-amazon-wrap").find(".afn-wrap-"+g).is(":checked")){d+="currencyAmount\x3d"+a.data.giftData.options.wraps[g].priceAmount+"\x26";d+="currencyUnit\x3d"+a.data.giftData.options.wraps[g].unit+"\x26";break}}else g=S(b.find(".amazon-gift-wrap")),g.is(":checked")&&(d+="giftWrap\x3d"+g.val()+"\x26",a.data.giftData.options&&(d+="currencyAmount\x3d"+a.data.giftData.options.wraps[0].priceAmount+"\x26",
d+="currencyUnit\x3d"+a.data.giftData.options.wraps[0].unit+"\x26"));else if(b.find(".popover-gift-merchant-wrap").is(":visible")&&(g=b.find("input[name\x3d'mfn-gift-wrap']:checked").eq(0).val())&&g.length)for(d+="giftWrap\x3d"+g+"\x26",g=0;g<a.data.giftData.options.wraps.length;g++)if(b.find(".popover-gift-merchant-wrap").find(".mfn-wrap-"+g).is(":checked")){d+="currencyAmount\x3d"+a.data.giftData.options.wraps[g].priceAmount+"\x26";d+="currencyUnit\x3d"+a.data.giftData.options.wraps[g].unit+"\x26";
break}if(0<J(".enable-gift-connections").length)if(b.find("#include-gift-connection-checkbox").is(":checked")){d+="includeGiftConnection\x3d1\x26";a=b.find("#select-recipient").val();d+="gcGiftlistTypeId\x3d"+a+"\x26";if("1"===a||"2"===a)d+="gcFirstName\x3d"+b.find("#input-recipient-first-name").val()+"\x26",d+="gcLastName\x3d"+b.find("#input-recipient-last-name").val()+"\x26";g=b.find("#select-occasion").val();d+="gcOccasionId\x3d"+g+"\x26";if("1"===g||"2"===g)d+="gcMonth\x3d"+b.find("#select-occasion-month").val()+
"\x26",d+="gcDay\x3d"+b.find("#select-occasion-day").val()+"\x26","1"===g&&"2"===a&&(d+="gcAge\x3d"+b.find("#select-occasion-age").val()+"\x26"),d+="gcHasReminder\x3d"+(b.find("#occasion-has-reminder-checkbox").is(":checked")?"1":"0")+"\x26"}else d+="includeGiftConnection\x3d0\x26";(a=J("input#executionId").val())&&(d+="executionId\x3d"+a+"\x26");a=(new Date).getTime();d+="isClientTimeBased\x3d"+J("input[name\x3d'useCtb']").val()+"\x26returnjson\x3d1\x26isDecoupleSPC\x3d1\x26hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+
a;e.isSPP()&&(wa.hide(),a=J("#setOrderingPrefsCheckbox"),a.length&&a.is(":checked")&&(d+="\x26saveAsDefaultsSelected\x3d1"));m.show();a=e.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"});J.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-gift.html",data:d,dataType:"text",async:!0,cache:!1,headers:a,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,d,g){g.getResponseHeader("x-amz-checkout-page")?(e.isSPP()||b.find(".a-button-close").trigger("click"),
e.ajaxUpdatePage(a,d,g)):(a=c.jsonify(a),e.redirect(a))},error:function(a,b,c){e.ajaxRedirect(a,b,c)}})}}function r(a,b){a.find(".fba-wrap-checkbox").hide();a.find(".large-preview").hide();b.show();b.find(".afn-wrap-copy").remove()}function x(){var a=T,b=a.find(".popover-gift-amazon-wrap").is(":visible"),c=S(a.find(".amazon-gift-wrap")),d=S(a.find(".afn-wrap-none")),e=S(a.find(".hide-prices-checkbox"));if(c.is(":checked")||!d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!0),a.find(".hide-prices-note").show();
else if(c.not(":checked")||d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!1),a.find(".hide-prices-note").hide()}function t(a){var b=T,c=S(b.find(".include-gift-receipt-checkbox")),b=S(b.find(".mfn-hide-prices-checkbox"));a?(ga&&!c.is(":checked")&&c.attr("checked",!0).trigger("change"),ga||b.is(":checked")||b.attr("checked",!0).trigger("change")):(ga&&c.is(":checked")&&c.removeAttr("checked").trigger("change"),!ga&&b.is(":checked")&&b.removeAttr("checked").trigger("change"))}function g(a){var b=
T,c=S(b.find(".include-gift-receipt-checkbox")),b=S(b.find(".mfn-hide-prices-checkbox"));a?(t(!0),ga?c.attr("disabled","disabled"):b.attr("disabled","disabled")):ga?c.removeAttr("disabled"):b.removeAttr("disabled")}function u(a){var b=S(T.find(".include-gift-message-checkbox"));a?(b.is(":checked")||b.attr("checked",!0).trigger("change"),K(!1),A()):(b.is(":checked")&&b.removeAttr("checked").trigger("change"),L())}function K(a){var b=T,c=b.find(".no-message-warning"),d=b.find(".no-receipt-warning"),
e=b.find("textarea[name\x3d'gift-message-text']"),b=b.find(".message-remaining-text");a&&!d.is(":visible")?(h.showGiftTextAreaOnWarning()||e.addClass("gift-message-warning"),b.hide(),c.show()):(h.showGiftTextAreaOnWarning()||e.removeClass("gift-message-warning"),c.hide(),b.show())}function A(){var a=T,b=a.find("textarea[name\x3d'gift-message-text']"),a=a.find(".gift-message-label");b.removeClass("gift-message-inactive");a.removeClass("a-color-secondary")}function L(){var a=T,b=a.find("textarea[name\x3d'gift-message-text']"),
a=a.find(".gift-message-label");b.addClass("gift-message-inactive");a.addClass("a-color-secondary")}function D(){var b=T,c=S(b.find(".include-gift-message-checkbox")),d=b.find(".gift-msg-on-card"),e=b.find(".gift-msg-on-receipt"),g=a.trim(b.find(".gift-message-default-placeholder").text()),f=a.trim(b.find(".gift-message-with-wrap-placeholder").text()),h=b.find("textarea"),k=!1;b.find(".amazon-gift-wrap").each(function(){S(J(this)).is(":checked")&&(k=!0)});b.find(".afn-gift-wrap").each(function(){S(J(this)).is(":checked")&&
(k=!0)});b.find(".mfn-gift-wrap").each(function(){S(J(this)).is(":checked")&&(k=!0)});k?(e.hide(),d.show(),h.attr("placeholder",f),ga&&(u(!0),Ba&&c.attr("disabled","disabled"))):(d.hide(),ga&&e.show(),h.attr("placeholder",g),c.removeAttr("disabled"))}function E(){var a=T,b=S(a.find(".include-gift-message-checkbox")),a=a.find("textarea[name\x3d'gift-message-text']");!qa&&ga&&(b.is(":checked")&&0<a.val().length?K(!1):K(!0))}function M(){var a=T,b=S(a.find(".include-gift-receipt-checkbox")),c=a.find(".no-receipt-warning"),
a=a.find(".no-message-warning");b.is(":checked")?(c.hide(),Ba||u(!0)):(a.hide(),c.show(),u(!1))}function P(a){a=T;var b=S(a.find(".include-gift-receipt-checkbox")),b=ga&&b.is(":checked"),c=S(a.find(".mfn-hide-prices-checkbox")),c=!ga&&c.is(":checked");b||c?(B(),a.find(".kindle-reg-msg-your-account").hide(),a.find(".kindle-reg-msg-another-account").show()):(Y(),g(!1),a.find(".kindle-reg-msg-another-account").hide(),a.find(".kindle-reg-msg-your-account").show())}function H(a){a=T;var b=!1;S(a.find(".include-gift-message-checkbox")).is(":checked")&&
(b=!0);var c=!1;a.find(".amazon-gift-wrap").each(function(){S(J(this)).is(":checked")&&(c=!0)});a.find(".afn-gift-wrap").each(function(){S(J(this)).is(":checked")&&(c=!0)});a.find(".mfn-gift-wrap").each(function(){S(J(this)).is(":checked")&&(c=!0)});(b||c)&&t(!0);b&&Ba||c?g(!0):g(!1)}function N(a,b,c){var d=T;Aa=a;xa=b;if(a=d.find("textarea[name\x3d'gift-message-text']")){b=c?a.val().length:q.unescape(encodeURIComponent(a.val())).length;ja&&!qa&&ga&&(0<b?K(!1):K(!0));var g=a.val().split("\n").length;
c=Aa-b;g=xa-g;!ja&&0<b&&d.find(".include-gift-message-checkbox").not(":checked")&&d.find(".include-gift-message-checkbox").attr("checked",!0);a=a.val().split("\n");for(var f in a)24<a[f].length&&(g=0===a[f].length%24?g-(Math.floor(a[f].length/24)-1):g-Math.floor(a[f].length/24));d.find(".popover-gift-center .remainder-count").hide();(-1>c?d.find(".popover-gift-center .remaining-char-over-multiple").show():0>c?d.find(".popover-gift-center .remaining-char-over-single").show():1===c?d.find(".popover-gift-center .remaining-char-single").show():
d.find(".popover-gift-center .remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(c));(-1>g?d.find(".popover-gift-center .remaining-line-over-multiple").show():0>g?d.find(".popover-gift-center .remaining-line-over-single").show():1===g?d.find(".popover-gift-center .remaining-line-single").show():d.find(".popover-gift-center .remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(g));if(0>c||0>g)e.isSPP()?(d.find(".set-gift-options-button").addClass("aok-hidden"),
d.find(".set-gift-options-button-disabled").removeClass("aok-hidden")):(d.find(".set-gift-options-button").hide(),d.find(".set-gift-options-button-disabled").show()),0>c?(d.find(".gift-char-limit-error").find(".char-limit-error").html(Aa),d.find(".current-blocker-content").html(d.find(".gift-char-limit-error").html())):0>g&&(d.find(".gift-line-limit-error").find(".line-limit-error").html(xa),d.find(".current-blocker-content").html(d.find(".gift-line-limit-error").html()));-1<c&&-1<g&&(e.isSPP()?(d.find(".set-gift-options-button").removeClass("aok-hidden"),
d.find(".set-gift-options-button-disabled").addClass("aok-hidden")):(d.find(".set-gift-options-button").show(),d.find(".set-gift-options-button-disabled").hide()))}}function Q(a){a.stopPropagation();var b=T;b.find(".popover-content-main").fadeOut(100,function(){b.find(".popover-content-gift-wrap-preview .gift-wrap-preview-image").attr("src",a.data.imageURL);b.find(".popover-content-gift-wrap-preview").fadeIn(100)});var c=b.find(".popover-content-gift-wrap-preview .back-to-gift-options-button");c.unbind("click").bind("click",
W);k.bindActionEnterKeyOnButton(c);ia=!0}function W(a){ia=!1;var b=T;a?b.find(".popover-content-gift-wrap-preview").fadeOut(100,function(){b.find(".popover-content-main").fadeIn(100)}):setTimeout(function(){b.find(".popover-content-gift-wrap-preview").hide();b.find(".popover-content-main").show()},500)}function F(a){var b=T,c=!1;J(".amazon-gift-wrap").each(function(){S(J(this)).is(":checked")&&(c=!0)});J(".afn-gift-wrap").each(function(){S(J(this)).is(":checked")&&(c=!0)});J(".mfn-gift-wrap").each(function(){S(J(this)).is(":checked")&&
(c=!0)});if(c)B(),ca();else if(S(b.find(".hide-prices-checkbox")).is(":disabled"))Z();else if(a.is("input[type\x3dcheckbox]")&&(a.closest(".a-checkbox").hasClass("hide-prices-checkbox")||a.hasClass("hide-prices-checkbox")))a.is(":checked")?B():Y();else if(e.isSPP())(b=a.closest(".a-radio"))&&a.is(":checked")&&(b.hasClass("kindle-reg-radio-your-account")?Y():b.hasClass("kindle-reg-radio-another-account")&&B());else if(a.hasClass("kindle-reg-radio-another-account")||a.hasClass("kindle-reg-radio-your-account"))b.find(".kindle-reg-radio-your-account").is(":checked")?
Y():B()}function B(){var a=T,b=S(a.find(".hide-prices-checkbox"));b.is(":checked")&&!e.isSPP()||b.attr("checked","checked");S(a.find(".kindle-reg-radio-your-account")).is(":checked")&&S(a.find(".kindle-reg-radio-another-account")).attr("checked",!0)}function Y(){var a=T,b=S(a.find(".hide-prices-checkbox"));b.is(":checked")&&b.removeAttr("checked");S(a.find(".kindle-reg-radio-another-account")).is(":checked")&&S(a.find(".kindle-reg-radio-your-account")).attr("checked",!0)}function ca(){var a=T;S(a.find(".hide-prices-checkbox")).attr("disabled",
"true");S(a.find(".kindle-reg-radio-another-account")).attr("disabled",!0);S(a.find(".kindle-reg-radio-your-account")).attr("disabled",!0);a.find(".hide-prices-merchant-cant").is(":visible")||a.find(".hide-prices-note").show()}function Z(){var a=T;S(a.find(".hide-prices-checkbox")).removeAttr("disabled");S(a.find(".kindle-reg-radio-another-account")).removeAttr("disabled");S(a.find(".kindle-reg-radio-your-account")).removeAttr("disabled");a.find(".hide-prices-note").hide()}function aa(a){var b=k.getPosition(a,
"#",2),c=k.getPosition(a,"#",3);return"60"===a.substring(b+1,c)}function ba(b,c,d){var e=O(),g,f;e?(g=d.find('li[class\x3d"a-carousel-card gift-wrap noshi-wrap none-wrap"]'),f=d.find(".carousel-gift-wrap").find("ol")):(g=d.find("."+c+"-wrap-template"),f=d.find("ul.allGiftWrapList"));e&&a.trigger("checkout:gift:removeEmptyCarouselCards",f);var k=(d.data("lineitemid")||b.obfuscatedEntityId||"").replace(":","-");"afn"!==c||e||(f.find('li[class!\x3d"none-wrap gift-wrap noshi-wrap"]').remove(),J("#giftwrap-carousel-wrap-holder-"+
k).css("width",90*(b.options.wraps.length+1)),J("#giftwrap-carousel-wrap-pane-"+k).css("width",360));for(var l=T,m=l.find(".larger-image-link-carousel-template"),p=0;p<b.options.wraps.length;p++){var n=g.clone(!0).removeClass(c+"-wrap-template").addClass(c+"-wrap-copy"),u=m.clone(!0).removeClass("larger-image-link-carousel-template").addClass("larger-image-link-carousel-"+p),t=c,w=b,q=p,v=n,r=u,V=w.options.wraps[q].id;v.find("input").addClass(t+"-wrap-"+q).val(V);v.find("label").attr("for",t+"-wrap-"+
q);V=w.options.wraps[q].description;v.find("."+t+"-wrap-description").html(V);V=w.options.wraps[q].price;v.find("."+t+"-wrap-price").html(V);(w=w.options.wraps[q].imageurl)&&w.length?(v.find("."+t+"-image").attr("src",w).show(),t=v.find(".larger-image-link"),t.show(),t.unbind("click").bind("click",{imageURL:w},Q),r.unbind("click").bind("click",{imageURL:w},Q),r.find("a").unbind("click").bind("click",{imageURL:w},Q)):"mfn"!==t||O()||(v.find(".a-span3").hide(),v.find(".a-span9").addClass("a-span12").removeClass("a-span9"),
v.find(".a-color-price").removeClass("wrap-price"));if("afn"===c){q=b;r=p;v=k;t=f;w=l;V=q.options.wraps[r].id;n.data("giftwrap-id",V);n.data("wrap-no",r);if(q.selected.wrap===V){t.find("li.none-wrap").find("img").removeClass("selected-giftwrap-image");n.find("img").addClass("selected-giftwrap-image");var q=n.find("img").attr("src"),G=J("#giftwrap-option-preview-imagearea-image-"+v);G.find("img").attr("src",q);G.removeClass("aok-hidden");J("#giftwrap-option-preview-imagearea-default-"+v).addClass("aok-hidden");
F(n.find("input"));x();h.isNoshiGiftMessageEnabled()||aa(V)&&na(v);u.removeClass("aok-hidden");u.addClass("selectedWrapLargeLink")}O()?(v=aa(V)?"gift-wrap":"noshi-wrap",n.removeClass(v).removeClass("none-wrap"),t.append(n.show())):(v=aa(V)?"\x3cli class\x3dnoshi-wrap\x3e":"\x3cli class\x3dgift-wrap\x3e",t.append(J(v).append(n.show())));n=w.find("#carousel-larger-image-div");n.find(".larger-image-link-carousel-"+r).length||n.append(u.show())}}d.find("."+c+"-wrap-checkbox").removeAttr("checked");b.selected&&
b.selected.isWrapped?d.find("input[value\x3d'"+b.selected.wrap+"']").attr("checked",!0):S(d.find("."+c+"-wrap-none")).attr("checked",!0);e&&a.trigger("checkout:gift:adjustCarouselInitial",b,d)}function O(){return e.isSPP()&&J("input[name\x3dsppGiftPopoverWithCarousel]").length}function X(a,b,c){for(var d=c.find("."+b+"-wrap-template"),g=0;g<a.options.wraps.length;g++){var f=d.clone(!0).removeClass(b+"-wrap-template").addClass(b+"-wrap-copy"),h=a.options.wraps[g].id;f.find("input").addClass(b+"-wrap-"+
g).val(h);f.find("label").attr("for",b+"-wrap-"+g);h=a.options.wraps[g].description;f.find("."+b+"-wrap-description").html(h);h=a.options.wraps[g].price;f.find("."+b+"-wrap-price").html(h);if((h=a.options.wraps[g].imageurl)&&h.length){var k=f.find("."+b+"-image");e.isSPP()&&k.removeClass("hidden");k.attr("src",h).show();k=f.find(".larger-image-link");e.isSPP()&&k.removeClass("hidden");k.show();k.unbind("click").bind("click",{imageURL:h},Q)}else f.find(".a-span3").hide(),f.find(".a-span9").addClass("a-span12").removeClass("a-span9"),
f.find(".a-color-price").removeClass("wrap-price");e.isSPP()&&f.removeClass("hidden");f.insertAfter(d).show()}c.find("."+b+"-wrap-checkbox").removeAttr("checked");a.selected&&a.selected.isWrapped?c.find("input[value\x3d'"+a.selected.wrap+"']").attr("checked",!0):S(c.find("."+b+"-wrap-none")).attr("checked",!0)}function fa(){T.find("#include-gift-connection-checkbox").attr("checked",!0)}function y(){if(T.find(".include-gift-connection-checkbox").not(":checked")){var a=T;a.find(".gift-connection-recipient-extra").hide();
var b;b=a.find('#select-recipient option[value\x3d"0"]').attr("selected","selected");a.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(b.text());a.find("#input-recipient-first-name").val("");a.find("#input-recipient-last-name").val("");V()}}function ea(a){for(var b=T,c=0;c<ha.length;c++)if(a&&a===ha[c].value&&ha[c].bMonth&&ha[c].bDay){var d;d=b.find('#select-occasion-month option[value\x3d"'+ha[c].bMonth+'"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(d.text());
d=b.find('#select-occasion-day option[value\x3d"'+ha[c].bDay+'"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(d.text())}}function V(){var a=T,b=a.find("#popover-gift-connection #select-recipient").find(":selected").val();if(""!==b&&"0"!==b&&("1"!==b&&"2"!==b||a.find("#input-recipient-first-name").val()||a.find("#input-recipient-last-name").val()))a.find("#select-occasion").prop("disabled",!1),a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:1});
else{b=T;b.find(".gift-connection-occasion-extra").hide();var c;c=b.find('#select-occasion option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-month option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-day option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(c.text());
c=b.find('#select-occasion-age option[value\x3d"-1"]').attr("selected","selected");b.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(c.text());b.find("#occasion-has-reminder-checkbox").attr("checked",!0);a.find("#select-occasion").prop("disabled",!0);a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:.5})}}function ka(a,b){var c=T;"1"===a&&"2"===b?c.find("#select-occasion-age-row").show():c.find("#select-occasion-age-row").hide()}function G(a){a=
T;var b=a.find("#popover-gift-connection #select-recipient").find(":selected").val(),c=a.find("#popover-gift-connection #select-occasion").find(":selected").val();!b||"1"!==b&&"2"!==b?(a.find(".gift-connection-recipient-extra").hide(),"1"===c&&b&&ea(b)):a.find(".gift-connection-recipient-extra").show();ka(c,b);V()}function za(a){a=T;var b=a.find("#popover-gift-connection #select-occasion").find(":selected").val(),c=a.find("#popover-gift-connection #select-recipient").find(":selected").val();!b||"1"!==
b&&"2"!==b?a.find(".gift-connection-occasion-extra").hide():("1"===b&&c&&"1"!==c&&"2"!==c&&ea(c),a.find(".gift-connection-occasion-extra").show());ka(b,c)}function ua(a){var c=T,d="/gp/buy/pipeline/handlers/list-of-giftlists.html?escape\x3d0";ha&&(d+="\x26mappingOnly\x3d1");a&&(d+="\x26fromRegistryIds\x3d"+a);J.ajax({type:"POST",url:d,dataType:"json",async:!0,cache:!1,timeout:5E3,success:function(d){c.find("#select-recipient").hide();!ha&&d.options&&0<d.options.length&&(ha=d.options);a&&d.registryIdMapping&&
(la=d.registryIdMapping[a]);ha&&b();c.find("#select-recipient").show();c.find("#select-recipient-spinner").hide();sa=!0},error:function(){c.find("#select-recipient").show();c.find("#select-recipient-spinner").hide();sa=!0}})}function U(b,c){var d=O(),e=c.lineItemId;c=O()?c.currentTab:b.data("current-tab");var g=J("#popover-gift-options-wrapper-"+e).data("active-tab");c!==g&&(b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab"),b.addClass("selected-giftwrap-tab"),b=J("#giftwrap-carousel-wrap-holder-"+
e),d||b.css("left",0),g=J("#giftwrap-carousel-wrap-holder-"+e+" li"),d?(a.trigger("checkout:gift:changeCarouselWrapOptions",b,c,e),a.trigger("checkout:gift:adaptCarouselSPCPanel",e,c)):"all"===c?g.show():(g.hide(),g.filter("."+{"gift-wrap":"gift-wrap",noshi:"noshi-wrap"}[c]).show()),J("#popover-gift-options-wrapper-"+e).data("active-tab",c),g.find(".selected-giftwrap-image").removeClass("selected-giftwrap-image"),g.filter(".none-wrap").find("img").addClass("selected-giftwrap-image"),J("#giftwrap-option-preview-imagearea-default-"+
e).removeClass("aok-hidden"),J("#giftwrap-option-preview-imagearea-image-"+e).addClass("aok-hidden"),d=J("#allGiftWrapList-"+e).find(".none-wrap").find("input"),c=J(".selectedWrapLargeLink"),d.prop("checked",!0),d.val("").change(),h.isNoshiGiftMessageEnabled()||ta(e),c.length&&(c.addClass("aok-hidden"),c.removeClass("selectedWrapLargeLink")))}function R(a,b,c){c.$event.preventDefault();a=b.lineItemId;b=parseInt(J("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);0>b&&(b=b+90+"px",J("#giftwrap-carousel-wrap-holder-"+
a).css("left",b))}function ra(a,b,c){c.$event.preventDefault();a=b.lineItemId;var d=J("#allGiftWrapList-"+a);b=d.find("li").size();c=d.find("li.gift-wrap").size();var d=d.find("li.noshi-wrap").size(),e=J("#popover-gift-options-wrapper-"+a).data("active-tab"),g;"all"===e?g=b:"gift-wrap"===e?g=c:"noshi"===e&&(g=d);b=parseInt(J("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);b>-90*(g-4)&&(b=b-90+"px",J("#giftwrap-carousel-wrap-holder-"+a).css("left",b))}function pa(a,b){var c=b.lineItemId;J("#allGiftWrapList-"+
c).find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".afn-image").addClass("selected-giftwrap-image");b=a.parent();h.isNoshiGiftMessageEnabled()||(b.hasClass("noshi-wrap")&&!b.hasClass("none-wrap")?(na(c),J("#afn-message-span-"+c).find("input").prop("checked",!1)):(ta(c),J("#afn-message-span-"+c).find("input").prop("checked",!0)));var d=a.data("giftwrap-id"),e=a.find("input"),g=a.data("wrap-no");e.prop("checked",!0);e.val(d).change();d=J("#giftwrap-option-preview-imagearea-default-"+
c);c=J("#giftwrap-option-preview-imagearea-image-"+c);e=J(".selectedWrapLargeLink");g=J(".larger-image-link-carousel-"+g);b.hasClass("none-wrap")?(d.removeClass("aok-hidden"),c.addClass("aok-hidden"),e.length&&(e.addClass("aok-hidden"),e.removeClass("selectedWrapLargeLink"))):(a=a.find("img").attr("src"),c.find("img").attr("src",a),d.addClass("aok-hidden"),c.removeClass("aok-hidden"),e.length&&(e.addClass("aok-hidden"),e.removeClass("selectedWrapLargeLink")),g.length&&(g.addClass("selectedWrapLargeLink"),
g.removeClass("aok-hidden")))}function da(a,b){var c=b.lineItemId;b=J("#giftwrap-option-preview-imagearea-default-"+c);c=J("#giftwrap-option-preview-imagearea-image-"+c);a.hasClass("none-wrap")?(b.removeClass("aok-hidden"),c.addClass("aok-hidden")):(a=a.find("img").attr("src"),c.find("img").attr("src",a),b.addClass("aok-hidden"),c.removeClass("aok-hidden"))}function va(a,b){var c=b.lineItemId;a=J("#giftwrap-option-preview-imagearea-default-"+c);b=J("#giftwrap-option-preview-imagearea-image-"+c);J("#allGiftWrapList-"+
c).find(".selected-giftwrap-image").parentsUntil("ul","li").hasClass("none-wrap")?(a.removeClass("aok-hidden"),b.addClass("aok-hidden")):(c=J("#allGiftWrapList-"+c).find(".selected-giftwrap-image").attr("src"),b.find("img").attr("src",c),a.addClass("aok-hidden"),b.removeClass("aok-hidden"))}function ta(a){var b=J("#afn-message-span-"+a+", #gift-message-"+a);J("#gift-message-noshi-warning-"+a).addClass("aok-hidden");b.removeClass("disable-message-area").addClass("enable-message-area");b.find("input").removeAttr("disabled");
b.find("textarea").removeAttr("disabled")}function na(a){var b=J("#afn-message-span-"+a+", #gift-message-"+a);J("#gift-message-noshi-warning-"+a).removeClass("aok-hidden");b.removeClass("enable-message-area").addClass("disable-message-area");b.find("input").attr("disabled","disabled");b.find("textarea").attr("disabled","disabled")}var J=a.$;if(!J("html").hasClass("a-ie6")){var Aa,xa,T,wa,ia=!1,ja=!1,qa=!0,ga=!0,ha,sa=!1,la,Ba=!1;a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")&&
(e.isSPP()&&d.increaseCount("checkout:spp-revieworder:gift_pop_cancel_sec",1),ia&&W(),ja&&(a=T,a.find(".gift-msg-on-card").hide(),a.find(".popover-gift-warning").hide(),a.find(".message-remaining-text").show(),S(a.find(".amazon-gift-wrap")).removeAttr("checked"),u(!1),a.find('input[type\x3d"checkbox"]').removeAttr("disabled")))});a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")){T=a.popover.$popover;wa=a.popover;0<T.find(".include-gift-receipt-checkbox").length&&
(ja=!0);l.showSpinner(T.find(".popover-content-main"),!1,wa);T.find(".content-container").css("visibility","hidden");a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var b=wa.data;if(b)a+="\x26obfuscatedEntityId\x3d"+b;else throw{name:"MissingData",message:"lineItemId is undefined"};}catch(d){q.ueLogError&&q.ueLogError(d,{logLevel:"FATAL",attribution:"gift-popover",message:"[No lineItemId to open the gift-popover with]. "})}J.ajax({type:"POST",
url:"/gp/buy/pipeline/handlers/gift-select-content.html",data:a,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},dataFilter:function(a){return c.jsonify(a)},success:function(a,b,c){a&&a.conductoraction&&a.conductoraction.url&&e.redirect(a);null!==a?w(a,b,c):e.ajaxRedirect()},error:function(a,b,c){e.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-gift"))b=T,a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text()),
a.popover.updatePosition(!0);else if(a.popover&&a.popover.$popover){var b=a.popover.$popover;a=b.find(".validateInputCharactersOnBlur.a-form-error");0<a.size()&&a.removeClass("a-form-error");b=b.find("#onblur-character-validation-error-gift-message-text");0<b.size()&&b.remove()}});var Ca={enforceSelectorParity:F,enforceGiftReceiptParity:H,enforceHidePriceParity:P,disableHidePrice:x,toggleMessageBoxDisplay:D,toggleEmptyMsgWarning:E,toggleNoReceiptWarning:M,includeGiftConnection:fa,clearGiftConnection:y,
toggleGiftConnectionRecipientArea:G,toggleGiftConnectionOccasionArea:za,updateGiftOptionsTabSelection:U,updateCarouselOnLeftClick:R,updateCarouselOnRightClick:ra,updateSelectedGiftWrap:pa,updatePreviewImageOnMouseEnter:da,updatePreviewImageOnMouseLeave:va},S=f.getInput;a.declarative("gift-popover-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(Ca[b[c]])Ca[b[c]](a.$target,a.data)});a.declarative("gift-popover-element","click mouseenter mouseleave",
function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(Ca[b[c]])Ca[b[c]](a.$currentTarget,a.data,a)});a.declarative("spc-update-gift-options-tab-selection","click",function(a){var b=a.$target.parents("li");b.attr("data",a.data);U(b,a.data)});a.on("checkout:reload:spc",p);a.on("checkout:reload:spp-revieworder",p)}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor",
"checkout-general-utils","page-detector","client-side-metrics").register("concealment-popover-controller",function(a,m,l,c,e,k,n,d){function f(){w("#spc-orders").find(".concealment-widgets-desktop").removeClass("no-js-hide");a.defer(function(){w("#spc-orders").find(".concealment-popover-link").each(function(){w(this).data("action")&&w(this).removeAttr("href").attr("tabindex",0)})})}function h(a){return a.is("input")?a:a.find("input")}function b(a){var b=v;b.find(".fake-label").each(function(){w(this).unbind("click").bind("click",
function(){w(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&b.find(".concealment-item-title").html(a.item.title);if(a&&a.obfuscatedEntityId){var c=b.find(".set-concealment-options-button input");c.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,concealmentData:a,quantity:a.quantity},p);k.bindActionEnterKeyOnButton(c)}x=a&&a.item&&a.item.isAmazonFulfilled;a&&a.selected&&(c=h(b.find(".conceal-item-checkbox")),a.selected.concealItem?
c.attr("checked",!0):c.removeAttr("checked"));v.find(".content-container").css("visibility","visible");r.updatePosition(!0);l.hideSpinner(b.find(".popover-content-main"))}function p(a){var b=v,f="";a&&a.data&&a.data.obfuscatedentityid&&(f+="obfuscatedEntityId.0\x3d"+a.data.obfuscatedentityid+"\x26");a&&a.data&&a.data.quantity&&(f+="quantity.0\x3d"+a.data.quantity+"\x26");var k="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.saveConcealmentRefTag&&(k=a.data.concealmentData.saveConcealmentRefTag);
var l="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.cancelConcealmentRefTag&&(l=a.data.concealmentData.cancelConcealmentRefTag);(a=h(b.find(".conceal-item-checkbox")).is(":checked"))?(x&&(f+="isAFN.0\x3d1\x26"),f=f+"includeReceipt.0\x3d1\x26includeMessage.0\x3d1\x26"+("message.0\x3d"+encodeURIComponent(w("input[name\x3d'concealment-item-message']").val())+"\x26"),f=f+"hidePrices.0\x3d0\x26saveOnly\x3d1"+("ref\x3d"+k+"\x26")):f+="ref\x3d"+l+"\x26";var p=w("input#executionId").val();
p&&(f+="executionId\x3d"+p+"\x26");p="/gp/buy/gift/handlers/save-all.html/ref\x3d";a?(p+=k,d.increaseCount("CPEX.Checkout.Select.Concealment",1)):(p+=l,d.increaseCount("CPEX.Checkout.Cancel.Concealment",1));e.isSPP()&&(b.find(".a-button-close").trigger("click"),k=w("#setOrderingPrefsCheckbox"),k.length&&k.is(":checked")&&(f+="\x26saveAsDefaultsSelected\x3d1"));m.show();w.ajax({type:"POST",url:p,data:f,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"},
contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,d,g){g.getResponseHeader("x-amz-checkout-page")?(e.isSPP()||b.find(".a-button-close").trigger("click"),e.ajaxUpdatePage(a,d,g)):(a=c.jsonify(a),e.redirect(a))},error:function(a,b,c){e.ajaxRedirect(a,b,c)}})}var w=a.$;if(!w("html").hasClass("a-ie6")){var v,r,x=!0;w(document).delegate(".concealment-popover-link, .concealment-options-button","click",function(){d.increaseCount("CPEX.Checkout.Concealment.Button.click",
1)});a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("concealment-")&&(e.isSPP()&&d.increaseCount("checkout:spp-revieworder:concealment_pop_cancel_sec",1),h(v.find(".conceal-item-checkbox")).removeAttr("checked"))});a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("concealment-")){v=a.popover.$popover;r=a.popover;l.showSpinner(v.find(".popover-content-main"),!1,r);v.find(".content-container").css("visibility","hidden");
a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var d=r.data.lineItemEntityId,f=r.data.itemId;if(d)a+="\x26obfuscatedEntityId\x3d"+d;else if(f)a+="\x26lineItemEntityId\x3d"+f;else throw{name:"MissingData",message:"lineItemId is undefined"};var h=r.data.quantity;if(h)a+="\x26quantity\x3d"+h;else throw{name:"MissingData",message:"quantity is undefined"};}catch(k){q.ueLogError&&q.ueLogError(k,{logLevel:"FATAL",attribution:"concealment-popover",
message:"[Data missing to open the concealment-popover]. "})}d=r.data.ref;w.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/concealment-select-content.html/ref\x3d"+d,data:a+("\x26ref\x3d"+d),dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},dataFilter:function(a){return c.jsonify(a)},success:function(a,c,d){a&&a.conductoraction&&a.conductoraction.url&&e.redirect(a);null!==a?b(a,c,d):e.ajaxRedirect()},error:function(a,b,c){e.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",
function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-concealment")){var b=v;a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text());a.popover.updatePosition(!0)}});var t={};a.declarative("concealment-popover-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(t[b[c]])t[b[c]](a.$target,a.data)});a.declarative("concealment-popover-element","click mouseenter mouseleave",
function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(t[b[c]])t[b[c]](a.$currentTarget,a.data,a)});a.on("checkout:reload:spc",f);a.on("checkout:reload:spp-revieworder",f)}});"use strict";r.when("A","page-conductor","scroll-controller","page-detector","client-side-metrics","button-blocker").register("gold-box-controller",function(a,m,l,c,e,k){function n(){a.defer(f);a.defer(h)}var d=a.$;if(!d("html").hasClass("a-ie6")){var f=
function(){var a=d("#goldbox-countdown"),c=d("#spc-orders");c&&0!==c.length||(c=d("#spclite-items-block"));c=c.find("input[name\x3dgoldboxexpirelefttime]");if(0!==c.length){if(1<c.size()){var f=parseInt(c.attr("data-timeleftms"),10),h=c;d.each(c,function(){var a=d(this),b=parseInt(a.attr("data-timeleftms"),10);b<f&&(h=a,f=b)});c=h}var k=parseFloat(c.attr("data-pagestarttime")),n=parseFloat(c.attr("data-timeleftms")/1E3);if(!(isNaN(k)||isNaN(n)||0>=n)){var t=(new Date).getTime(),g=a.find("span[data-timefield\x3dminute]"),
u=a.find("span[data-timefield\x3dsecond]"),r=q.setInterval(function(){var c=(new Date).getTime();n-=(c-t)/1E3;t=c;if(0>n&&r)u.html("00"),q.clearInterval(r),r=null,m.isSPP()&&e.increaseCount("checkout:spp-revieworder:deal_expired",1),d("#gold-box-modal-launcher").trigger("click"),l.scrollToTop(),l.toggleScrollOff();else{var c=Math.floor(n/60%60),f=Math.floor(n%60),f=10>f?"0"+f:f;g.html(c);u.html(f);a.is(":visible")||a.show()}},1E3);m.isSPP()&&e.increaseCount("checkout:spp-revieworder:deal_countdown",
1)}}},h=function(){var a=d("#gold-box-button-blocker");1===a.length&&k.show("place-order-gold-box-blocker",a.attr("data-blocker-message"))};a.on("checkout:reload:spc",n);a.on("checkout:reload:spclite",n);a.on("checkout:reload:spp-revieworder",n)}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","currency-formatter","page-detector","client-side-metrics","pay-rewards-currency").register("inline-points-controller",function(a,m,l,c,e,k,n,d){function f(){t("#spc-points-input")&&
t("#spc-points-input").data("points-used")&&(t("#points-applied").show(),t("#inline-points-button").hide());t("#inline-points-register")&&t("#inline-points-register").removeAttr("href");t("#spc-loyalty-points-input")&&t("#spc-loyalty-points-input").val()&&(t("#loyalty-points-applied").show(),t("#loyalty-points-button").hide());t("#spc-points-input")&&t("#spc-points-input").hasClass("show-currency-input-widget-new")&&t("#spc-points-input").each(function(b,c){var e=a.$(c);b={$element:e,maxAmount:e.data("max-dollar-amount")};
c={$element:a.$("#inline-raw-points"),decimalPlaces:e.data("decimal-places"),ratio:e.data("conversion-ratio")};var f=e.data("country-code"),f=d.getCurrencyFormatByCountryCode(f);d.initializeInlineFormatting(b,c,f);t(document).delegate("#spc-points-input","keydown",function(a){if(e.data("points-used")!==e.val){a=t("#inline-points-button");var b=!1;a.is("span")&&(b=!0);var c=a.find("span.apply"),d=a.find("span.change");t("#points-applied").hide();e.data("points-used")?(c.hide(),d.show()):(c.show(),
d.hide());b?a.addClass("display-inline-block"):a.show()}})})}function h(a,d){a.preventDefault();if(b(d)){c.isSPP()?(m.blockAllActions(),m.showTransitionInContainer(t("#payment"))):m.show();var e;a={"x-amz-checkout-page":"spc"};if(d)e=t("#loyalty-points-hidden-fields"),d="/gp/buy/spc/handlers/update-loyalty-points.html/ref\x3dox_spc_points_edit",e="\x26jpPointsPaymentInstrumentId\x3d"+encodeURIComponent(e.find("input[name\x3d'jpPointsPaymentInstrumentId']").val())+"\x26jpPointsCustomerRequestedAmount\x3d"+
t("#spc-loyalty-points-input").val()+"\x26jpPointsConversionRate\x3d"+e.find("input[name\x3d'jpPointsConversionRate']").val()+"\x26jpPointsBaseCurrencyCode\x3d"+e.find("input[name\x3d'jpPointsBaseCurrencyCode']").val()+"\x26jpPointsTargetCurrencyCode\x3d"+e.find("input[name\x3d'jpPointsTargetCurrencyCode']").val()+"\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+t("input[name\x3duseCtb]").val();else{a=c.setAjaxTransitionHeader(a);e=t("#inline-points-hidden-fields");var f=e.find("input[name\x3d'useGCBalance']").val();
d="/gp/buy/pipeline/handlers/update-reward-points.html/ref\x3d"+(c.isSPP()?"chk_pay_addswp_coll":"ox_pay_page_points_apply");e="paymentMethodId\x3d"+e.find("input[name\x3d'paymentMethodId']").val()+"\x26paymentMethodType\x3d"+e.find("input[name\x3d'paymentMethodType']").val()+"\x26rewardAccountId\x3d"+e.find("input[name\x3d'rewardAccountId']").val()+"\x26rewardAccountAmount\x3d"+t("#spc-points-input").val()+"\x26rewardAccountRate\x3d"+e.find("input[name\x3d'rewardAccountRate']").val()+"\x26useGCBalance\x3d"+
f+"\x26usePromoBalance\x3d"+f+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+t("input[name\x3duseCtb]").val()}t.ajax({type:"POST",url:d,data:e,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:a,success:function(a,b,d){d.getResponseHeader("x-amz-checkout-page")?c.ajaxUpdatePage(a,b,d):(a=l.jsonify(a),c.redirect(a))},error:function(a,b,d){c.ajaxRedirect(a,b,d)}})}}function b(a){var b=!1,c=
t("input[name\x3drewardAccountAmount]"),d=t("#inline-points-error-block");a||t("#spc-points-input")&&!t("#spc-points-input").hasClass("show-currency-input-widget-new")?(a&&(c=t("input[name\x3dloyaltyPointsValue]"),d=t("#loyalty-points-error")),d.hide(),d.find("p").hide(),w(c))?q(c,a)?r(c,a)||(d.find("p").filter(function(){return"badMax"===t(this).data("error")}).show().css("display","inline"),b=!0):(d.find("p").filter(function(){return"badMin"===t(this).data("error")}).show().css("display","inline"),
b=!0):(d.find("p").filter(function(){return"badValue"===t(this).data("error")}).show().css("display","inline"),b=!0):a||q(c,a)||(d.find("p").filter(function(){return"badMin"===t(this).data("error")}).show().css("display","inline"),b=!0);if(b)return d.show(),c.addClass("a-form-error"),!1;c.removeClass("a-form-error");return!0}function p(a,b){var c=t(a.currentTarget),d=c.val();a=t("#inline-raw-points");b&&(a=t("#loyalty-points-applied-value"));var f=a.html();if(b)!/^\s*$/.test(d)&&!isNaN(d)&&0<d?a.html(d):
a.html(0);else if(!t("#spc-points-input").hasClass("show-currency-input-widget-new")){var h=c.data("min-dollar-amount");!/^\s*$/.test(d)&&!isNaN(d)&&0<d&&!isNaN(h)&&d>=h?(h=c.data("conversion-ratio"),c=c.data("decimal-places"),d=e.getNumberWithSeparators(d/h,c),a.html(d)):a.html(0)}(b||t("#points-applied").is(":visible"))&&f!==a.html()&&(a=t("#spc-loyalty-points-display"),f=t("#loyalty-points-applied"),d=t("#loyalty-points-button"),c=!1,b||(a=t("#inline-points-button"),a.is("span")&&(c=!0),f=a.find("span.apply"),
d=a.find("span.change"),t("#points-applied").hide()),f.hide(),d.show(),c?a.css("display","inline-block"):a.show())}function w(a){a=a.val();return/^\s*$/.test(a)||!isNaN(a)}function q(a,b){if(b)return!0;b=a.val();if(/^\s*$/.test(b))return!0;b=parseFloat(b);return isNaN(b)||!a.data("min-dollar-amount")?!0:0===b||b>=a.data("min-dollar-amount")}function r(a,b){var c=a.val();if(/^\s*$/.test(c))return!0;var c=parseFloat(c),d=a.data("max-dollar-amount");b&&(d=a.data("available-points"));return isNaN(c)||
!d?!0:c<=d}function x(a){switch(a.keyCode?a.keyCode:a.which){case 13:case 10:var b=t("#loyalty-points-button"),c=t("#spc-points-input");0<b.length&&b.is(":visible")?h(a,1):0<c.length&&h(a,0)}}var t=a.$;t("html").hasClass("a-ie6")||(t(document).delegate("#spc-loyalty-points-input","keypress",function(a){x(a)}),t("#spc-points-input")&&!t("#spc-points-input").hasClass("show-currency-input-widget-new")&&(t(document).delegate("#spc-points-input","keypress",function(a){x(a)}),t(document).delegate("#spc-points-input",
"keyup",function(a){p(a,0)})),t(document).delegate("#spc-loyalty-points-input","keyup",function(a){p(a,1)}),t(document).delegate("#inline-points-button","click",function(a){h(a,0)}),t(document).delegate("#loyalty-points-button","click",function(a){h(a,1)}),a.on("a:expander:apply-point-expander:toggle:expand",function(a){n.increaseCount("checkout:spp-payment:expand_addswp_coll",1)}),a.on("checkout:reload:spc",f),a.on("checkout:reload:spp-revieworder",f))});"use strict";r.when("A","client-side-metrics",
"ready").execute(function(a,m){var l=a.$;a.on("checkout:reload:spc",function(){var a=l("input[name\x3d'rewardsProgramId']").val(),e=l("input[name\x3d'swpWidgetCase']").val();a&&e&&m.increaseCount("Checkout::SPC::SWPWidgetCSM::"+a+"::"+e,1)})});"use strict";r.when("A","client-side-metrics","ready").execute(function(a,m){function l(){e||c.ajax({type:"POST",url:"/gp/shopwithpoints/temporaryPreference/verify-and-log-temporary-preference.html",data:{sourcePage:"SPC"},dataType:"text",async:!0,success:function(){e=
!0;m.increaseCount("Checkout::SPC::LogTemporaryPaymentPreferenceAppliedAjax::Success",1)},error:function(){m.increaseCount("Checkout::SPC::LogTemporaryPaymentPreferenceAppliedAjax::Failure",1)}})}var c=a.$,e=!1;a.on("checkout:reload:spc",l);a.on("checkout:reload:spclite",l);a.on("checkout:reload:spp-revieworder",l);a.on("checkout:reload:spp-collapsed",l)});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor").register("inline-fps-balance-controller",function(a,m,l,
c){function e(a){a.preventDefault();k("#inline-fps-balance-checkbox").prop("disabled","disabled");c.isSPP()?(m.blockAllActions(),m.showTransitionInContainer(k("#payment"))):m.show();var d=k("#inline-fps-balance-hidden-fields"),e=0;k("#inline-fps-balance-checkbox").prop("checked")&&(e=1);a=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});var h="/gp/buy/pipeline/handlers/update-fps-balance.html/ref\x3d"+(c.isSPP()?"chk_pay_"+(e?"apply":"remmove")+"_fps_balance_coll":"ox_spc_page_fps_balance_apply"),
d="fpsPaymentMethodId\x3d"+d.find("input[name\x3d'fpsPaymentMethodId']").val()+"\x26useFlexiblePayments\x3d"+e+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+k("input[name\x3duseCtb]").val();k.ajax({type:"POST",url:h,data:d,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,d,e){e.getResponseHeader("x-amz-checkout-page")?c.ajaxUpdatePage(a,d,e):(a=l.jsonify(a),c.redirect(a))},error:function(a,d,e){c.ajaxRedirect(a,d,e)}})}var k=a.$;k("html").hasClass("a-ie6")||
k(document).delegate("#inline-fps-balance-checkbox","click",function(a){e(a)})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","checkout-general-utils","error-feature-detection","page-detector","client-side-metrics","weblab-helper","a-modal").register("shipping-speed-selection-controller",function(a,m,l,c,e,k,n,d,f,h){function b(){ba?B("fieldset div.a-radio").addClass("a-touch-radio").removeClass("a-radio"):a.defer(function(){var a=B("#spc-orders").find("div.ship-option");
a.filter(".no-scheduled-delivery");a.each(function(){B(this).find("input.radio-image").remove()});a.each(function(){var a=B(this).find("input.radio-standard");a.attr("checked")&&a.attr("checked",!0)})});fa=B("#spc-orders").find("div.ship-option").find('input[type\x3d"radio"]:checked');p();f.isShippingOptionTrialCallsDisabled()||a.defer(A);k.markFeatureAvailable("shipping-speed-selection-controller");w()}function p(){var a=0<B("#trigger-case-call-to-resolve-cv").length||0<B(".force-resolve-invalid-ship-option").length;
if(c.isSPP()&&a){var a=function(){var a=q.setInterval(function(){c.isAnimating()||(m.show(),q.clearInterval(a))},50)},b=B("div.ship-option").filter(".call-set-to-resolve-cv").first().find("input[type\x3d'radio']");if(b&&b.length){var d=b.parents(".shipping-speeds").find("input.lineitemidinput[type\x3dhidden]").val();E(b,null,null,{transitionAction:a,refTag:"chk_revieworder_set_ship_option_no_default",extraData:{callingCASEResolveCV:1,lineItemIds:d}})}}}function w(){B("#buy-button-disabled-state").length&&
r(function(a){z(a)})}function r(a){B("div.sd_widget_root").each(function(b,c){a(c)})}function z(a){var b=setInterval(B.proxy(function(){if(B(this).hasClass("sd_widget_initialized")){var a=B(this),c=B(a).attr("id");c&&(a=x(a),a["ScheduledDeliveryEntity.startDeliveryDate"]&&E(null,c,a));q.clearInterval(b)}},a),1E3)}function x(a){var b={};t(a,function(a){var c=B(a).attr("key");a=B(a).val();b[c]=a||""});return b}function t(a,b){B(a).find("input[type\x3d'hidden']").each(function(a,c){b(c)})}function g(){ca||
(ca=B("input[type\x3d'hidden'][name\x3d'scopeId']").val());return ca}function u(a,b,d){var e=d.getResponseHeader("x-amz-checkout-page");if(e)return"spc"===e&&Y||(Z=!1),(e=l.jsonify(a))&&e.success&&e.trialkey&&aa[e.trialkey]?(a=aa[e.trialkey],c.isSPP()&&"object"===typeof a&&(a=JSON.stringify(aa[e.trialkey])),f.isSPCMobileDisplayMoreShipOptionsEnabled()&&0<B(".mobile-view").length?c.ajaxUpdatePage(a,b,d,{pushNewFrame:"false"}):c.ajaxUpdatePage(a,b,d),O&&(clearTimeout(O),O=null),aa={},!0):f.isSPCMobileDisplayMoreShipOptionsEnabled()&&
0<B(".mobile-view").length?c.ajaxUpdatePage(a,b,d,{pushNewFrame:"false"}):c.ajaxUpdatePage(a,b,d);Z=!1;return c.redirect(a)}function K(a,b){if(a){var c=a.data(b);if(void 0!==c)return c;(a=a.closest(".radio-standard"))&&(c=a.data(b));return c}}function A(){aa={};ca=null;O&&(clearTimeout(O),O=null);var a=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'shiptrialprefix']").val(),b=B("#spc-orders").find("div.shipment"),d=B("#setDeliveryPrefetchMultiGroups").val(),e=B("#setDeliveryPrefetchGroupLimit").val(),
f=1;d&&(f=b.length,e&&e<b.length&&(f=e));for(var h=e?18E4:6E4,k=0;k<f;k++){var m="returnpipedata\x3d0\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1",p=0,n=[],t=B("#shipTrialToCacheCount").val();b.each(function(a,b){b=B(b);var d="",e=b.find(".shipping-speed").find("input[type\x3d'radio']");a=a===k?e.filter(function(){return 1===K(B(this),"istrial")}):e.filter(function(){return B(this).is(":checked")});var f=b.find(".ship-split-preferences").find("input[type\x3d'radio']:checked");
1!==f.length&&(f=b.find(".ship-split-preferences").find("input[type\x3d'hidden'][name^\x3d'shippriority']"));d+="\x26lineitemids"+p+"\x3d"+b.find("input[name\x3d'lineitemids"+p+"']").attr("value");d+=W(b,p);a.length&&a.each(function(){var a=B(this),b=M(a,f,p),d="ox_spc_set_trial_ship_option_no_data";c.isSPP()&&(d="chk_revieworder_set_trial_ship_option_no_data");if(1===K(a,"istrial")){var e=!1;K(a,"trialIndex")<t&&(e=!0,d="ox_spc_set_trial_ship_option",c.isSPP()&&(d="chk_revieworder_set_trial_ship_option"));
a=g()+":"+a.attr("name")+":"+a.attr("value");n.push({trialkey:a,speedparams:b,cacheResult:e,ref:d})}else m+=b});m+=d;p++});0<p&&(m+="\x26groupcount\x3d"+p);m+="\x26istrial\x3d1";0===m.indexOf("\x26")&&(m=m.substr(1));var q=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});B.each(n,function(b,c){b=m+c.speedparams+"\x26trialkey\x3d"+c.trialkey;c.cacheResult&&(b+="\x26returnFullHTML\x3d1");if(c.cacheResult||!a){var d=c.trialkey;c=B.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+
c.ref,data:b,dataType:"text",async:!0,cache:!1,headers:q,dataFilter:function(a){return l.jsonify(a)},success:function(a){delete X[d];if(a&&a.trialkey){var b=a.trialkey.split(":")[0];!Z&&b===g()&&a.fullhtml&&(aa[a.trialkey]=a.fullhtml,O||(O=setTimeout(function(){aa={}},h)))}},error:function(){delete X[d]}});X[d]=c}})}}function L(a){a.closest("fieldset").find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");a.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive")}
function D(a){var b=a;B(".shipping-group").each(function(a,c){var d=!1;B(c).parents().each(function(a,b){return B(b).hasClass("shipment")?(d=!0,!1):!0});d||(b=b.add(c))});return b}function E(a,b,d,e){ba&&L(a);e&&e.transitionAction?e.transitionAction():m.show();Y=!1;Z=!0;for(var h in X)X.hasOwnProperty(h)&&(X[h].abort(),delete X[h]);h=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'shiptrialprefix']").val();var k;a||(a=B("#"+b).closest(".shipping-speed").find("input[type\x3d'radio']"));k=a.closest(".shipment").data("orderid");
a&&a.length&&a.hasClass("valid-btn")&&a.closest(".prime-calendar").hasClass("long-calendar")&&(k=a.closest(".prime-calendar").data("orderid"));var l="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1";if(e&&e.extraData)for(var p in e.extraData)e.extraData.hasOwnProperty(p)&&(l+="\x26"+p+"\x3d"+e.extraData[p]);var n=B(".shipment"),t=0;p=n.length;n=D(n);l+="\x26groupsadded\x3d"+(n.length-p);n.each(function(c,e){e=B(e);c="";var f=e.has(".prime-calendar-container"),
g=e.find("input[name\x3d'currentshippingspeed']").attr("value"),h=e.find("input[name\x3d'currentshipsplitpreference']").attr("value");1===n.length&&(l+="\x26oldoption\x3d"+g+"."+h);g=e.find("input[name\x3d'defaultshipsplitpreference."+t+"']").attr("value");h=e.find("input[name\x3d'usingprimeshipping."+t+"']").attr("value");g&&h&&(l+="\x26defaultshipsplitpreference."+t+"\x3d"+g,l+="\x26usingprimeshipping."+t+"\x3d"+h);g=e.find(".shipping-speed");g=a?g.find('input[type\x3d"radio"]:checked'):g.find("input[src*\x3dradio-on]");
f&&!g.length&&(g=e.find("input[name\x3d'hiddenSelection"+t+"']"));h=e.find(".ship-split-preferences").find("input[type\x3d'radio']:checked");1!==h.length&&(h=e.find(".ship-split-preferences").find("input[type\x3d'hidden'][name^\x3d'shippriority']"));k===e.data("orderid")&&(K(a,"shippingofferingid")?g=a:h=a,1===n.length&&(c=f?c+("\x26option\x3d"+g.data("key")+"."+(h?h.attr("value"):"")):c+("\x26option\x3d"+g.attr("value")+"."+(h?h.attr("value"):""))));var m=e.find("input[name\x3d'lineitemids"+t+"']");
0<m.length&&(c+="\x26lineitemids"+t+"\x3d"+m.attr("value"));c+=W(e,t);if(g.length)if(c+=M(g,h,t,f),1===K(g,"isscheduleddelivery")){e=g.closest(".shipping-speed").find('[id^\x3d"sd_widgets_"]');if(b&&d&&(b===e.attr("id")||void 0===b))for(var p in d)d.hasOwnProperty(p)&&(c+="\x26"+p+"."+t+"\x3d"+d[p]);else c+="\x26"+e.children(":input").serialize();Y=!0}else 1===K(g,"isscheduleddeliveryslot")&&K(g,"sddatastring")&&(c+="\x26ScheduledDeliveryEntity.data."+t+"\x3d"+encodeURIComponent(g.data("sddatastring")));
else c+="\x26isdigital"+t+"\x3d1";t++;l+=c});0<t&&(l+="\x26groupcount\x3d"+t);p="ox_spc_set_ship_option";if(c.isSPP()){p="chk_revieworder_set_ship_option";var q=B("#setOrderingPrefsCheckbox");q.length&&q.is(":checked")&&(l+="\x26saveAsDefaultsSelected\x3d1")}q=B("input[name\x3duseCtb]").val();l+="\x26isClientTimeBased\x3d"+q;1===K(a,"istrial")?(h=g()+":"+a.attr("name")+":"+a.attr("value"),l+="\x26trialkey\x3d"+h,aa[h]&&(O&&clearTimeout(O),p="ox_spc_set_cached_ship_option",c.isSPP()&&(p="chk_revieworder_set_cached_ship_option"),
l=l.replace("returnFullHTML\x3d1","returnFullHTML\x3d0"),l+="\x26trialSuccess\x3d1")):"undefined"!==typeof h&&(h=h+":"+a.attr("name")+":"+a.attr("value"),l+="\x26trialkey\x3d"+h);e&&e.refTag&&(p=e.refTag);e&&e.removeGiftOption&&(l+="\x26giftOrderid\x3d"+a.closest(".shipment").data("orderid"));0===l.indexOf("\x26")&&(l=l.substr(1));e="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+p;h=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});f.isSPCMobileDisplayMoreShipOptionsEnabled()&&0<
B(".mobile-view").length&&(h=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"}));B.ajax({type:"POST",url:e,data:l,dataType:"text",async:!0,cache:!1,headers:h,success:function(a,b,c){u(a,b,c)},error:function(a,b,d){Z=!1;c.ajaxRedirect(a,b,d)}})}function M(a,b,c,d,e){var f="";"undefined"!==typeof e&&(c+="-"+e);if(K(a,"rcxsspdecoupling"))return f={},f["shippingspeed"+c]=d?a.attr("key"):a.attr("value"),f["shippingofferingid"+c]=K(a,"shippingofferingid"),f["guaranteetype"+
c]=K(a,"guaranteetype"),f["issss"+c]=K(a,"issss"),f["forceshipsplitpreference"+c]=K(a,"forceshipsplitpreference"),d="shipWhenComplete",b&&(d=b.attr("value")),1===K(a,"isscheduleddelivery")&&(f["isscheduleddelivery"+c]="1",d="shipWhenComplete"),f["shippriority"+c]=d,f["preferredSSP"+c]=K(a,"shipsplitpriority"),f["currentSSP"+c]=b.attr("value"),f["isShipWheneverValid"+c]=K(a,"isshipwhenevervalid"),f["isShipWhenCompleteValid"+c]=K(a,"isshipwhencompletevalid"),f=B.param(f),"\x26"+f;f=d?f+("\x26shippingspeed"+
c+"\x3d"+a.data("key")):f+("\x26shippingspeed"+c+"\x3d"+a.attr("value"));f+="\x26shippingofferingid"+c+"\x3d"+K(a,"shippingofferingid");f+="\x26guaranteetype"+c+"\x3d"+K(a,"guaranteetype");f+="\x26issss"+c+"\x3d"+K(a,"issss");f+="\x26forceshipsplitpreference"+c+"\x3d"+K(a,"forceshipsplitpreference");d="shipWhenComplete";b&&(d=b.attr("value"));1===K(a,"isscheduleddelivery")&&(f+="\x26isscheduleddelivery"+c+"\x3d1",d="shipWhenComplete");return f+("\x26shippriority"+c+"\x3d"+d)}function P(a){var b=[a.closest(".shipment").data("orderid")];
N(a,b)}function H(a){var b=[];B("#spc-orders").find(".shipment").each(function(a,c){b.push(a)});f.isFTCMobileUpsellBannerMetricsEnabled()&&d.increaseCount("checkout:spc:mobile:same-day-upsell-banner:clicked",1);N(a,b)}function N(a,b){m.show();var d="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1",e="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+a.data("reftag");B("#spc-orders").find(".shipment").each(function(c,e){d+="\x26lineitemids"+
c+"\x3d"+B(e).find("input[type\x3d'hidden'][name\x3d'lineitemids"+c+"']").attr("value");d+=W(B(e),c);var f=B(e).find("input[type\x3d'hidden'][name^\x3d'shippriority']");if(e=-1===b.indexOf(c)?B(e).find("#selected-ship-option-"+c):a)d+="\x26shippingofferingid"+c+"\x3d"+e.data("shippingofferingid"),d+="\x26guaranteetype"+c+"\x3d"+e.data("guaranteetype"),d+="\x26issss"+c+"\x3d"+e.data("issss"),d+="\x26forceshipsplitpreference"+c+"\x3d"+e.data("forceshipsplitpreference"),d+="\x26shippriority"+c+"\x3d"+
e.data("targetshipoptionkey"),e.data("rcxsspdecoupling")&&(d+="\x26preferredSSP"+c+"\x3d"+e.data("shipsplitpriority"),d+="\x26currentSSP"+c+"\x3d"+f.attr("value"),d+="\x26isShipWheneverValid"+c+"\x3d"+e.data("isshipwhenevervalid"),d+="\x26isShipWhenCompleteValid"+c+"\x3d"+e.data("isshipwhencompletevalid"))});var f=B("#spc-orders").find("input[type\x3d'hidden'][name\x3d'groupcount']").val(),d=d+("\x26groupcount\x3d"+f),d=d+("\x26isClientTimeBased\x3d"+B("input[type\x3d'hidden'][name\x3d'useCtb']").attr("value")),
d=d+("\x26trialkey\x3d"+g()+":"+a.data("orderindex")+":"+a.data("targetshipoptionkey")),f=c.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});B.ajax({type:"POST",url:e,data:d,dataType:"text",async:!0,cache:!1,headers:f,success:function(a,b,c){u(a,b,c)},error:function(a,b,d){Z=!1;c.ajaxRedirect(a,b,d)}})}function Q(b,c,d,f){e.protectAgainstDoubleAction(c)||ea||(a.trigger(d,b),b=b.$currentTarget.find("a"),f&&f(b))}function W(a,b){var c=a.find("input[name\x3d'onOrAfterAppointment"+b+"']").val();
a=a.find("input[name\x3d'onOrAfterLineItemId"+b+"']").val();var d="";c&&a&&(d=d+("\x26onOrAfterAppointment"+b+"\x3d"+c)+("\x26onOrAfterLineItemId"+b+"\x3d"+a));return d}function F(){y.closest("div.shipping-speed").find('input[type\x3d"radio"]').attr("checked",!0);"undefined"!==typeof h?(0<B(".mobile-view").length?h.get(B("#faster-than-same-day-sosp-popover")):h.get(B("#faster-than-same-day-spc-popover"))).hide():a.$("div.a-popover button.a-button-close").trigger("click");E(y,null,null,{removeGiftOption:!0})}
var B=a.$;if(!B("html").hasClass("a-ie6")){var Y=!1,ca,Z=!1,aa={},ba=B("html").hasClass("a-touch"),O,X={},fa,y;q.spcpage.scheduledDeliverySetSOCallback=function(b,d){c.isSPP()&&a.objectIsEmpty(b)||(q.spcpage&&B("#spcpagecontent").is(":visible")?q.spcpage.actionSetShipOptions(null,d,b):E(null,d,b))};q.spcpage.scheduledDeliveryEnableSOCallback=function(){};B(document).delegate(".ship-option","click",function(b){var c=B(b.target);f.isSPCMobileDisplayMoreShipOptionsEnabled()&&B(b.target).closest(".ship-option").hasClass("mobile-view")&&
b.preventDefault();var g=B(b.currentTarget);d.resetMetrics();if(!(c.is('a[target\x3d"AmazonHelp"]')||c.is('a[target\x3d"PromoDetails"]')||c.hasClass("no-ship-option-selection-change")||g.is("input")||c.hasClass("a-button")||c.closest("a-button").length||c.is("img")&&(c.closest("div").is(".prime-ship-speed")||c.closest(".prime-fake-radio").parent().is(".prime-ship-speed"))))if(c=g.find("div.prime-ship-speed"),0<c.length)c.find("a:first img").trigger("click");else if((c=g.find("input[type\x3d'image']").attr("src"))&&
c.match(/radio-off/)&&B(".ap_popover_sprited").hide(),g=g.find("input[type\x3d'radio']"),(c=g.closest("div.shipping-speeds").data("sospargs"))&&1===g.data("isscheduleddelivery")&&!g.is(":checked"))m.show(),g.attr("checked",!0),L(g),e.redirectWithJavascript("/gp/buy/shipoptionselect/handlers/display.html?"+c);else if(f.removesGiftOptionOnRush()&&0<g.closest(".shipment").find("input[name^\x3dItemIsGift]").length&&1===g.closest(".radio-standard").data("nosupportforgiftoption")){y=g;y.is(":checked")&&
(y.attr("checked",!1),fa.attr("checked",!0));var k=0<B(".mobile-view").length?B("#faster-than-same-day-sosp-popover"):B("#faster-than-same-day-spc-popover");"undefined"!==typeof h?h.get(k).show():a.delay(function(){k.trigger("click")},10)}else{g.hasClass("js-no-serverside-callback")&&(g.attr("checked",!0),L(g),g.closest(".a-section-expander-container").find(".a-link-section-expander").click());var c=B("#disableSubmitButtons").length,l=!1;f.isSPCMobileDisplayMoreShipOptionsEnabled()&&(b=B(b.currentTarget).closest(".ship-option"),
b.hasClass("mobile-view")&&!b.hasClass("mobile-selected-option")&&(l=!0));!c&&g.is(":checked")&&!l||1===g.data("isscheduleddelivery")||(g.attr("checked",!0),E(g))}});B(document).delegate(".ship-option input[type\x3d'radio']","change",function(a){if(!f.isSPCMobileDisplayMoreShipOptionsEnabled()||!B(a.target).closest(".ship-option").hasClass("mobile-view")){a=B(a.currentTarget);var b=a.closest("div.prime-ship-speed");f.removesGiftOptionOnRush()&&0<a.closest(".shipment").find("input[name^\x3dItemIsGift]").length&&
1===a.closest(".radio-standard").data("nosupportforgiftoption")||(0<b.length?b.find('input[type\x3d"radio"]').attr("checked",!1):1!==a.data("isscheduleddelivery")&&E(a))}});a.declarative("shipping-speed-expander-toggle",["click"],function(a){var b=a.$target.closest(".a-box"),c,d;b.hasClass("a-single")?(c=b.find(".expanded-header-content"),d=b.find(".collapsed-header-content"),d.hide(),c.hasClass("prime-title")&&c.find("div").attr("style",""),c.show()):(d=b.find(".collapsed-header-content"),c=b.find(".expanded-header-content"),
b=b.siblings(".a-expander-content").find(".a-icon-touch-radio-active").siblings(".a-radio-label").html(),d.html(b),c.hide(),d.show());e.toggleExpanderContent(a)});a.declarative("select-prime-slot",["click"],function(a){a=a.$currentTarget;B(".a-button-close").trigger("click");a.closest(".valid-slot").hasClass("selected-slot")||E(a)});var ea=!1;B(document).delegate(".mobile-upsell","touchmove",function(a){ea=!0});B(document).delegate(".mobile-upsell","touchstart",function(a){ea=!1});a.declarative("select-upsell-shipping-speed",
["click","touchend"],function(a){Q(a,"select-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select",P)});a.declarative("select-all-upsell-shipping-speed",["click","touchend"],function(a){Q(a,"select-all-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select-all",H)});a.declarative("faster-than-same-day-save",["click"],F);a.declarative("faster-than-same-day-sosp-save",["click"],F);a.on("checkout:reload:spc",b);a.on("checkout:reload:spp-revieworder",b)}});"use strict";
r.when("A","page-detector","spc-page-state","client-side-metrics","page-conductor","weblab-helper").register("order-summary-controller",function(a,m,l,c,e,k){function n(){r=b("#transactionalRadio");z=b("#marketplaceRadio");b("#tfx-see-exchange-rates");w=b("#tfx-switch-currency-options");p||(c.increaseCount("removeauijs15"),b("#transactionalRadioImage").remove(),b("#marketplaceRadioImage").remove(),b("#acceptAccImage").remove());var a=b("#exchange-rate-link"),e=b("#switch-currency-link");if(0!==z.length){var f=
w.find('input[name\x3d"switchCurrency"]'),h=f.not(":checked"),f=l.prop("currencyType")||f.filter(":checked").val();h.val()===f?h.parent().trigger("click"):d(f);p||(c.increaseCount("removeauijs16"),a.find("i.a-icon-collapse").remove(),e.find("i.a-icon-collapse").remove())}}function d(d){b(".tfx-currency").each(function(){b(this).text(b(this).data(d))});l.prop("currencyType",d);var f=b("#subtotals-marketplace-table"),g=b("#subtotals-transactional-table"),h=b("#subtotals-marketplace-spp-bottom"),k=b("#subtotals-transactional-spp-bottom"),
n=b("#vatRetailSubtotals-transactional-table"),q=b("#vatGlobalSubtotals-transactional-table"),w=b("#vatMerchantSubtotals-transactional-table"),E=b("#vatRetailSubtotals-marketplace-table"),M=b("#vatGlobalSubtotals-marketplace-table"),P=b("#vatMerchantSubtotals-marketplace-table"),H=b(".place-your-order-button"),N=e.isSPP()?b(".place-order-button-text"):b(".place-your-order-button + span");e.isSPP()||setTimeout(function(){var a=Math.max(f.outerHeight(),g.outerHeight());0<a&&(f.height(a),g.height(a))},
500);if(!p){c.increaseCount("removeauijs17");var Q=z.siblings("i"),W=r.siblings("i");if(Q.hasClass("a-icon-touch-radio-inactive")||Q.hasClass("a-icon-touch-radio-active"))"marketplace"===d?(Q.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),W.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive")):(W.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),Q.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"))}"marketplace"===
d?(b("#fxGoodNews-transactional").hide(),b("#fxGoodNews-marketplace").show(),g.hide(),f.show(),k.hide(),h.show(),n.hide(),q.hide(),w.hide(),E.show(),M.show(),P.show(),H.val(b("#placeYourOrderTextMarketplace").val()),p&&N.text(b("#placeYourOrderTextMarketplace").val()),b("#currencyChanged").attr("value","true"),b("#fxCurrencyChoice").attr("value","marketplace"),b("#tfx-total-header").addClass("aok-hidden"),b("#mkt-total-header").removeClass("aok-hidden")):(b("#fxGoodNews-transactional").show(),b("#fxGoodNews-marketplace").hide(),
f.hide(),g.show(),h.hide(),k.show(),E.hide(),M.hide(),P.hide(),n.show(),q.show(),w.show(),H.val(b("#placeYourOrderTextTransactional").val()),p&&N.text(b("#placeYourOrderTextTransactional").val()),b("#currencyChanged").attr("value","false"),b("#fxCurrencyChoice").attr("value","transactional"),b("#mkt-total-header").addClass("aok-hidden"),b("#tfx-total-header").removeClass("aok-hidden"));a.trigger("checkout:spc:ordersummary:sizeChanged");m.isMobileSpc()&&(h=b("#vatBreakdownNote"),0<h.size()&&(k=h.attr("href"),
k=0<k.lastIndexOf(".html?")?k+("\x26currencyType\x3d"+d):k+("?currencyType\x3d"+d),h.attr("href",k)))}function f(a){var e=b("#tfx-footer"),f=b("#tfx-header");if(!p){c.increaseCount("removeauijs18");var k=b("#fxApplicabilityDecision").siblings("i"),l=b("#fxApplicabilityAdoption").siblings("i");if(l.hasClass("a-icon-touch-checkbox-inactive")||l.hasClass("a-icon-touch-checkbox-active"))l.removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),k.removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active")}"accept"===
a?(h()?(b("#fx-terms-and-conditions").show(),b("#fxCardCurrencySubcondition").hide()):(b("#fx-enable").show(),b("#fx-disable").hide()),b("#fxApplicabilityDecision").prop("checked",!0),f.show(),d("transactional"),e.show(),b("#marketplaceRadio").prop("checked",!1),b("#transactionalRadio").prop("checked",!0),b("#fxApplicabilityChoice").attr("value","accept")):(h()?(b("#fx-terms-and-conditions").hide(),b("#fxCardCurrencySubcondition").show()):(b("#fx-enable").hide(),b("#fx-disable").show()),b("#fxApplicabilityAdoption").prop("checked",
!1),f.hide(),d("marketplace"),e.hide(),b("#transactionalRadio").prop("checked",!1),b("#marketplaceRadio").prop("checked",!0),b("#fxApplicabilityChoice").attr("value","decline"))}function h(){return e.isSPP()&&b("input[name\x3disNewTFXExperienceEnabled]").length}var b=a.$;if(!b("html").hasClass("a-ie6")){var p=q.P&&q.P.AUI_BUILD_DATE,w,r,z;k.isFixTfxCurrencyToggleEnabled()?(b(document).delegate("#transactionalRadio","click",function(){d("transactional")}),b(document).delegate("#marketplaceRadio","click",
function(){d("marketplace")})):(b(document).delegate("#checkoutCurrencyTransactional","click",function(){d("transactional")}),b(document).delegate("#checkoutCurrencyMarketplace","click",function(){d("marketplace")}));b(document).delegate("#fxApplicabilityDecisionCheckbox","click",function(){f("decline")});b(document).delegate("#fxApplicabilityAdoptionCheckbox","click",function(){var a=h()&&!b("#fxApplicabilityAdoption").is(":checked");f(a?"decline":"accept")});a.on("a:expander:tfx-options-expander:toggle:expand",
function(a){c.increaseCount("checkout:spp-ordersummary:expand_tfx_options",1)});a.on("a:expander:tfx-see-rate-expander:toggle:expand",function(a){c.increaseCount("checkout:spp-ordersummary:expand_tfx_see_rate",1)});return{changeCurrency:d,initOrderSummary:n}}});"use strict";r.when("A","ready").register("spc-page-state",function(a){var m={};return{prop:function(a,c){if(a&&"string"===typeof a)return 1<arguments.length&&(m[a]=c),m[a]}}});"use strict";r.when("A","ready").execute(function(a){function m(){0<
l("#spcCachedPromiseData").length&&(c=(new Date).getTime(),l(".place-your-order-button").click(function(){var a=(new Date).getTime()-c;l("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'spcWaitingTime' value\x3d'"+a+"' /\x3e")}))}var l=a.$,c=0;a.on("checkout:reload:spc",m);a.on("checkout:reload:spclite",m);a.on("checkout:reload:spp-revieworder",m)});"use strict";r.when("A","page-transition-controller","scroll-controller","loading-spinner-controller","page-conductor","checkout-general-utils",
"ready").register("changeCustomerDetailsPopover",function(a,m,l,c,e,k){function n(){return 0<h("#onblur-character-validation-error-changeNameInput").size()}function d(){b&&b.find("button[data-action\x3da-popover-close]").trigger("click")}function f(){var a=h("#saveButton");if(a.length){var b=h("#changeNameInput"),c=h("#changePostNumberInput"),d=h("#changePhoneInput"),e=1,f=1,g=1;b.length&&!b.val()&&(e=0);c.length&&!c.val()&&(f=0);d.length&&!d.val()&&(g=0);e&&f&&g&&!n()?(a.removeClass("a-button-disabled"),
a.removeAttr("disabled")):(a.addClass("a-button-disabled"),a.attr("disabled","true"))}}var h=a.$,b;a.declarative("clickedsave","click submit",function(a){if(!n()){var b=h("#changeNameInput").val(),c=h("#changePhoneInput").val(),f=h("#changePostNumberInput").val(),k=h("#changeAccountNameCheckBox").is(":checked")?1:0,l=h("#changePostNumberCheckBox").is(":checked")?1:0,b="custName\x3d"+encodeURIComponent(b)+"\x26changeAccountName\x3d"+encodeURIComponent(k);c&&(b=b+"\x26custPhoneNumber\x3d"+encodeURIComponent(c));
f&&(b=b+"\x26dhlPostNumber\x3d"+encodeURIComponent(f),l&&(b=b+"\x26changeDhlPostNumberInEmbu\x3d"+encodeURIComponent(l)));c=a.data.changeDetailUrl;e.isSPP()&&(c=a.$target.data("changedetailurl"),h("#cancelReminderPopover").click());e.isSPP()||(b+="\x26usePipelineDispatch\x3d1");m.show();c&&h.ajax({type:"POST",data:b,url:c,dataType:"html",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",async:!0,cache:!1,headers:e.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"}),success:function(a,
b,c){d();m.hide();e.ajaxUpdatePage(a,b,c)},error:function(a,b,c){e.ajaxRedirect(a,b,c)}})}});a.declarative("clickedsave","mouseenter mousemove touchstart",function(a){f()});a.declarative("changeNameKeyIn changePostNumberKeyIn changePhoneNumberKeyIn","keydown keyup change keypress mouseenter mouseleave mousemove",function(a){f()});a.declarative("clickedcancel","click submit",function(a){d()});a.on("a:popover:beforeShow:changeDetailPopover",function(a){n()&&h("#onblur-character-validation-error-changeNameInput").remove()});
a.on("a:popover:show:changeDetailPopover",function(a){if(!e.isSPP()){var c=h(q).width(),d=h(q).height(),c=parseInt(.6*c,10),d=parseInt(.7*d,10);b=a.popover.$popover;var k=a.popover;b.css("position","absolute");b.css("top","50px");b.css("height",d+"px");b.css("width",c+"px");k.updatePosition()}c=e.isSPP()?a.popover.originalnamevalue:a.popover.$trigger.data("original-name-value");d=e.isSPP()?a.popover.originalcellphonevalue:a.popover.$trigger.data("original-cellphone-value");a=e.isSPP()?a.popover.originalpostnumbervalue:
a.popover.$trigger.data("original-postnumber-value");var k=h("#changeNameInput"),l=h("#changePhoneInput"),m=h("#changePostNumberInput");k.val(c);l.val(d);m.val(a);f()})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","page-detector","checkout-general-utils").register("prime-decline-controller",function(a,m,l,c,e,k){function n(){f("input[name\x3d'changeCardNoEndDatePrime']").attr("data-action","prime-decline-element")}function d(a,b,d){if(d.getResponseHeader("x-amz-checkout-page"))c.ajaxUpdatePage(a,
b,d);else{a=l.jsonify(a);if(!a)return c.redirect();a.error?m.hide():a.errors?m.hide():a.autohandlererror?(b=(a=a.autohandlererror)?a.action:null,d=a&&a.type?a.type:b&&b.code?b.code:"string"===typeof a?a:"Unknown:pipelineJSError",q.location.href="fatal"===b?"/gp/buy/payselect/handlers/error.html?errorAction\x3dfatal\x26errorType\x3d"+encodeURIComponent(d):"redirect"===b?a.url:"/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(d)):c.redirect(a)}}var f=a.$;f("html").hasClass("a-ie6")||
(a.declarative("prime-decline-element",["click","touchend"],function(a){k.protectAgainstDoubleAction("prime-decline-element")||(a.$event.preventDefault(),m.show(),a=(new Date).getTime(),a="changeCardNoEndDatePrime\x3d1\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26fromAnywhere\x3d"+f("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+a,f.ajax({type:"POST",url:"/gp/buy/spc/handlers/stuff-handler.html/ref\x3dox_spc_prime_renew_nodate",data:a,headers:{"Cache-Control":"no-cache",
pragma:"no-cache","x-amz-checkout-page":"spc"},contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",success:d,error:c.ajaxRedirect}))}),a.on("checkout:reload:spc",n),a.on("checkout:reload:spp-revieworder",n))});"use strict";r.when("A","loading-spinner-controller","page-conductor").register("prime-popover-controller",function(a,m,l){function c(){k={};a.defer(function(){0!==e("#spc-orders").find(".prime-popover-link").length&&(e("#spc-orders").find(".prime-popover-link").each(function(){var a=
e(this);if(a.data("action")){a.removeAttr("href").attr("tabindex",0);var c=a.data("aCheckoutModalPopover");var f=c.name,h="";c.width&&c.height&&(h="width:"+c.width+"px;height:"+c.height+"px;");0<e("#spc-orders").find("#"+f+"-popover").length||(c=e(['\x3cdiv id\x3d"a-popover-'+f+'" class\x3d"a-popover-preload" style\x3d"display:none;"\x3e','\x3cdiv id\x3d"'+f+'-popover" class\x3d"checkout" style\x3d"'+h+'"\x3e\x3c/div\x3e',"\x3c/div\x3e"].join("")),e("#spc-orders").append(c));a=a.data("aCheckoutModalPopover").name;
k[a]||(c=e(".prime-popover-content").html())&&0<c.length&&(k[a]=c,e("#"+a+"-popover").html(c))}}),e("#spc-orders").find(".a-box").each(function(){var a=e(this),c=a.find(".prime-ad-banner-content .prime-popover-link");1<c.length&&(c=c.first());a.find("a.primeAdLauncher").each(function(){var a=e(this);a.wrap('\x3cspan class\x3d"a-declarative" data-action\x3d"prime-event" data-prime-event\x3d\'{"metric":"lm3"}\'\x3e\x3c/span\x3e');a.replaceWith(c.clone().text(a.text()).addClass("a-size-mini"))})}))})}
var e=a.$;if(!e("html").hasClass("a-ie6")){var k={};a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("prime")&&(a=a.popover.name,!k[a])){var c=e("input#primePopopverFallbackContent").val()||"";k[a]=c;e("#"+a+"-popover").html(c)}});a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c)}});"use strict";r.when("A","page-transition-controller","back-button-protection","page-conductor","continue-wrapper-selector","weblab-helper").register("place-order-controller",
function(a,m,l,c,e,k){function n(){if(!c.isAnimating()){var d=f("#spc-form");if("0"===f("#showPageTransition").attr("content")){if(0<f("#enableAlternatePYOBlocker").length){var b;b=e.SELECTOR?f(e.SELECTOR):d.find(".a-button.continue-button");if("disabled"===b.find("input").attr("disabled"))return;b.find("input").attr("disabled","disabled");b.addClass("a-button-disabled");setTimeout(function(){b.removeClass("a-button-disabled");b.find("input").removeAttr("disabled")},4E4)}}else m.showPageTransition();
var p=f("#currencyChanged");0<p.length&&"true"===p.val()&&(p='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+f("#tfx-switch-currency-options").find("input:radio:checked").val()+'" /\x3e',f("#spc-form-inputs").append(p));if(k.isMfaPSD2DeviceDescriptionCollectionEnabled())for(var p=[{name:"javaEnabled",value:q&&q.navigator&&q.navigator.javaEnabled()},{name:"language",value:q&&q.navigator&&q.navigator.language},{name:"screenColorDepth",value:q&&q.screen&&q.screen.colorDepth},{name:"screenHeight",
value:q&&q.screen&&q.screen.height},{name:"screenWidth",value:q&&q.screen&&q.screen.width},{name:"timeZone",value:(new Date).getTimezoneOffset()}],n=0;n<p.length;n++)if(void 0!==p[n].name&&void 0!==p[n].value){var r='\x3cinput type\x3d"hidden" name\x3d"'+p[n].name+'" value\x3d"'+p[n].value+'" /\x3e';f("#spc-form-inputs").append(r)}d.append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");(p=a.state("firetv-aws-attributes"))&&p.queryParams&&(n=d.attr("action"),n+=0<=n.indexOf("?")?
"\x26":"?",n+=f.param(p.queryParams),d.attr("action",n));c.isSPP()&&d.append(f("#subtotalsSection").find("input").hide());l.markAsDirty();d.submit()}}function d(a){a.preventDefault();n(a.target)}var f=a.$;if(!f("html").hasClass("a-ie6"))return a.declarative("a-checkout-place-order",["click"],function(a){n(a.target)}),f(document).delegate("span.place-order-button-link","click",d),{placeOrderClick:n,placeOrderClickDelegate:d,PLACE_ORDER_BUTTON_LINK_SELECTOR:"span.place-order-button-link"}});"use strict";
r.register("continue-wrapper-selector",function(){return{SELECTOR:null}});"use strict";r.when("A","page-conductor","button-blocker","client-side-metrics","weblab-helper").register("verification-checkbox-controller",function(a,m,l,c,e){function k(a){x?n(a):d(a);t&&a&&a.blocking&&(c.setmarker("fn"),t=!1)}function n(a){var c=w(".continue-button"),d=w(".continue-button-blocker"),e=w(".place-order-blocker-message.custom-blocker-message");if(a.blocking||!b())a.blocking?(e.text(a.message),c.addClass("aok-hidden"),
d.removeClass("aok-hidden")):(e.empty(),c.removeClass("aok-hidden"),d.addClass("aok-hidden"),r.when("a-tooltip").execute(function(a){(a=a.get(d))&&a.isActive()&&a.hide()}))}function d(a){a.blocking?l.show("place-order-imb-checks",a.message):(l.hide("place-order-imb-checks"),w("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.select(".continue-button")}))}function f(){var b,d={blocking:!1,message:""};if(x)b=w("#spc-imb").find(".verification-checkbox input:not(:checked)"),0<b.length&&
(d={blocking:!0,message:b.first().closest(".verification-checkbox").attr("data-blocker-message")});else{c.increaseCount("removeauijs23");if(!w("#spc-imb").find(".verification-checkbox").length)return;b=m.isSPP()?w("#spc-imb").find(".verification-checkbox input:not(:checked)"):w("#spc-imb").find(".verification-checkbox:not(:checked)");0<b.length&&(d={blocking:!0,message:m.isSPP()?b.first().closest(".spp-panel").hasClass("aok-hidden")?b.first().closest(".verification-checkbox").data("non-review-panel-blocker-msg"):
b.first().closest(".verification-checkbox").data("blocker-message"):b.first().attr("data-blocker-message")})}e.isPyoClientSideInitiationEnabled()?k(d):a.trigger("checkbox:primaryActionBlocker:blockingStateChanged",d)}function h(){var a=w("#wineNoticeCheckbox");a&&a.length&&(v?(a.attr("checked",""),z&&(a=a.siblings(".a-icon-touch-checkbox-inactive"))&&a.length&&(a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-touch-checkbox-active"))):(a.removeAttr("checked",""),z&&(a=a.siblings(".a-icon-touch-checkbox-active"))&&
a.length&&(a.removeClass("a-icon-touch-checkbox-active"),a.addClass("a-icon-touch-checkbox-inactive"))))}function b(){var a=w("input[name\x3disINExpressCheckoutCC]");return a&&a.length?1===parseInt(a.val(),10):!1}function p(){e.isPyoClientSideInitiationEnabled()||h();w('[data-client-component\x3d"PrimaryActionBlockerCheckbox"]').length||(f(),e.isPyoClientSideInitiationEnabled()&&h());var a=q.P&&q.P.AUI_BUILD_DATE?'.verification-checkbox input[type\x3d"checkbox"]':"input.verification-checkbox";w("#spc-imb").find(a).unbind("change.verification-checkbox").bind("change.verification-checkbox",
f)}var w=a.$,v,z=w("html").hasClass("a-touch"),x=!m.isSPP()&&q.P&&q.P.AUI_BUILD_DATE,t=!0;if(!w("html").hasClass("a-ie6")){if(!e.isPyoClientSideInitiationEnabled())a.on("checkbox:primaryActionBlocker:blockingStateChanged",k);a.declarative("change-wine-notice-checkbox",["change"],function(a){v=a.$target.is(":checked")?1:0});a.on("checkout:reload:spc",p);a.on("checkout:reload:spclite",p);a.on("checkout:reload:spp-revieworder",p);a.on("checkout:reload:spp-collapsed",p);a.on("checkout:unload",function(){t=
!0});a.on("checkout:afterReload",function(){t=!1});return{verifyCheckboxes:f,updatePyo:k}}});"use strict";r.when("A","page-transition-controller","scroll-controller","ajax-utility","page-conductor","quantity-service","checkout-modal-popover","page-detector","checkout-general-utils","a-popover","client-side-metrics","weblab-helper").register("quantity-update-controller",function(a,m,l,c,e,k,n,d,f,h,b,p){function w(){ca=Y=!1;a.defer(function(){var a=H("#spc-orders");a.find("a.quantity-change-button-static").remove();
"1"!==H("#spc-form-inputs").find("input[name\x3d'isQuantityInvariant']").val()&&a.find("div.quantity-value-static").remove()});H(".lineitem").each(function(a,b){a=H(b);a.find(".no-js-quantity").remove();b=a.find(".quantity-dropdown");b.is(":visible")?(a.find(".js-select").prop("disabled",!1),b.removeClass("a-button-disabled")):(a=a.find(".quantity-input"),a.prop("disabled",!1),a.removeClass("a-form-disabled"))});var c=H("#pantry-mov-popover-content"),d=H("#pantry-mov-popover-placeholder");!c.length&&
d.length&&(c=d.attr("data-device"),H.ajax({type:"GET",url:"/gp/pantry/checkout/mov/get-pantry-mov-popover-contents.html",data:"device\x3d"+c,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,c,e){~a.indexOf("pantry-mov-popover-content")?d.append(a):b.increaseCount("checkout:pantry:pantry_mov_popover_contents:bad-content",1)},error:function(a,c,d){b.increaseCount("checkout:pantry:pantry_mov_popover_contents:"+d,1)}}))}function v(a,
b){a=H('.update-quantity-error[data-itemid\x3d"'+a+'"]');a.find(".error-message").hide();a.find('.error-message[data-error-type\x3d"'+b+'"]').show();a.find("i").show();a.find(".a-span12").show();a.show();b=a.closest(".item-details-right-column");b.find(".spc-quantity-dropdown-button").addClass("a-button-error");b.find(".spc-quantity-input").addClass("a-form-error");b=a.parents("div.update-quantity-error");a=b.siblings(".item-details");0<a.length&&(a.find(".a-input-text-wrapper").addClass("a-form-error"),
a.removeClass("a-spacing-large"),a.find(".a-touch-select").addClass("a-input-text a-form-error"));b.show()}function z(a,d,g){var k=g.getResponseHeader("x-amz-checkout-new-cart-quantity");f.updateCartByMash(k);if(g.getResponseHeader("x-amz-checkout-page"))e.ajaxUpdatePage(a,d,g,{pushNewFrame:"false"}),a=g.getResponseHeader("x-amz-checkout-updated-itemid"),g=g.getResponseHeader("x-amz-checkout-quantity-error"),a&&g&&v(a,g);else if(a=c.jsonify(a))if(a&&a.errors&&a.errors.pantry&&a.errors.pantry.mov)t(a.errors.pantry.showAddonInfo);
else{if(a&&a.errors&&a.errors.addon&&(e.isSPP()&&b.increaseCount("checkout:spp-revieworder:addon_warn_pri",1),g=a.errors.addon.type,d=a.errors.addon.asins,x(),H(".item-list").hide(),d.forEach(function(a){H('[data-asin\x3d"'+a+'"]').show()}),g=H("#addon-warning-"+g+"-launcher"),g.length)){H("input[name\x3duseLiveAUI]").length?h.get(g).attrs({$trigger:Z}).show():aa&&H("div.checkout.spc-mobile.aui-templatized").length?g.click():(b.increaseCount("removeauijs19"),a=H.Event("keyup",{triggerPositioningElement:Z,
manualTrigger:!0}),g.trigger(a),0<H("div.spc-mobile").length&&(l.scrollToTop(),l.toggleScrollOff()));m.hide();return}return e.redirect(a)}else e.redirect()}function x(){H("#a-popover-addon-warning-normal .select-address-title").hide();0<N?(H("#a-popover-addon-warning-normal .reduce-title").show(),H("#a-popover-addon-warning-normal .delete-title").hide()):(H("#a-popover-addon-warning-normal .delete-title").show(),H("#a-popover-addon-warning-normal .reduce-title").hide())}function t(a){var c=H("#pantry-mov-popover-launcher"),
d=H(".pantry-mov-reduce-prompt"),f=H(".pantry-mov-delete-prompt"),g=H("#pantry-mov-addon-info-container");c.length?(P()||b.increaseCount("checkout:pantry:pantry_mov_popover:non_spc",1),g.length&&g.empty(),a&&H("#addon-warning-normal-popover-content").length&&(x(),g.length||(g=H("\x3cdiv/\x3e",{id:"pantry-mov-addon-info-container"})),g.append('\x3chr class\x3d"a-divider-normal"\x3e').append(H("#addon-warning-normal-popover-content").html()).appendTo("#pantry-mov-popover-content")),0<N?(d.show(),f.hide()):
(f.show(),d.hide()),c.length&&(c.click(),m.hide())):(b.increaseCount("checkout:pantry:pantry_mov_popover_contents:no-launcher",1),e.redirect())}function g(a,b){m.show();var c={isClientTimeBased:H('input[name\x3d"useCtb"]').val(),fromAnywhere:H("input[name\x3dfromAnywhere]").val(),success:z};if(b)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);e.isSPP()?(c.ref="chk_ship_chg_qty_pri",b=H("#setOrderingPrefsCheckbox"),b.length&&b.is(":checked")&&(c.saveAsDefaultsSelected=1)):H(".spc-mobile.aui-templatized").length&&
(c.ref="ox_spc_change_quantity");b=H("#addon-indicator")&&"true"===H("#addon-indicator").attr("data-has-addon-items");d=H("#pantry-mov-indicator")&&"true"===H("#pantry-mov-indicator").attr("data-has-pantry-items");a||!b&&!d||(c.istrial=1);k.call(W,N,c);F?F.data("currentQuantity",N):B&&B.data("currentQuantity",N)}function u(){m.hide();q.location="/gp/aw/c/ref\x3dox_spc_deal_expired?app-action\x3dcart"}function K(a){var b=Q;N=Q;F&&r.when("a-dropdown").execute(function(a){F&&(a.getSelect(F).setValue(b.toString()),
F.data("currentQuantity",N))});a===ba.addOn&&l.toggleScrollOn();B&&(B.val(b),B.data("currentQuantity",N),a=B.closest(".quantity-block"),a.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden"),a.find(".quantity-display").removeClass("hidden"),a.find(".quantity-display-block-tablet").removeClass("hidden"),a.find(".dynamic-quantity-update").hasClass("stay-visible")||a.find(".dynamic-quantity-update").addClass("hidden").children().addClass("hidden"))}function A(a,b){var c=a.$currentTarget.is("a")?
a.$currentTarget:a.$currentTarget.find("a");W=c.data("entityId");N=0;F=null;Q=c.data("currentQuantity");Z=H("a.quantity-delete-button[data-entity-id\x3d'"+W+"']");Z.length||(Z=a.$currentTarget);B=c.closest(".dynamic-quantity-update").find(".quantity-input");B.length||(B=null);c.data("isBundleDelete")?setTimeout(function(){H("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):(g(!1,b),n.hideById(c.closest(".a-popover").data("aPopoverId")))}function L(a){if(!f.protectAgainstDoubleAction("order-summary-update-quantity",
200)){b.resetMetrics();var c=a.$currentTarget,d=c.closest(".lineitem"),e=c.find("select"),e=e.length?e:c;W=d.data("entityId");var h=H('.update-quantity-error[data-itemid\x3d"'+W+'"]');B=F=null;e.is("select")?(F=c.find("select"),N=e.val()):(B=d.find(".quantity-input"),N=B.val());Q!==N&&(Z=e.is("select")?F.parent():B,""===N?M(d):"Delete"===N||0===parseInt(N,10)?(a.$event.preventDefault(),f.protectAgainstDoubleAction("delete-item")||D(a)):f.validateNumber(N,0,999)?(h.hide(),d.blur(),d.data("isBundleDelete")?
setTimeout(function(){H("#pb-delete-trigger-"+d.data("bundleGroupId")).trigger("click")},100):g(!1)):v(W,"changeQuantity_quantityNotInRange"))}}function D(a,b){var c=a.$currentTarget.closest(".lineitem");W=c.data("entityId");N=0;c.data("isBundleDelete")?setTimeout(function(){H("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):(g(!1,b),n.hideById(c.closest(".a-popover").data("aPopoverId")))}function E(a){var b=a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),
c=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val(),d=a.$currentTarget.find("input").data("currentQuantity");Q=d;-1===parseInt(c,10)||""===c?("change"===a.type&&M(a.$currentTarget.closest(".lineitem")),b.hide()):parseInt(c,10)!==d?b.show():b.hide()}function M(a){a.find(".quantity-input").val(Q)}function P(){return e.isSPP()?H("#revieworder").hasClass("expanded")?!0:!1:0<H("div.spc").length?!0:!1}var H=a.$;if(!H("html").hasClass("a-ie6")){var N,Q,W,F,B,Y=!1,ca=
!1,Z,aa=q.P&&q.P.AUI_BUILD_DATE,ba={addOn:"addOn",pantryMOV:"pantryMOV"};a.declarative("change-quantity",["click","touchend"],function(a){if(!f.protectAgainstDoubleAction("lock-update-quantity",200)){a=a.$currentTarget;var b=!0;a.addClass("hidden");a=a.closest(".quantity-block");a.find(".change-quantity").addClass("hidden");a.find(".quantity-display").addClass("hidden");a.find(".quantity-display-block-tablet").addClass("hidden");a.find(".dynamic-quantity-update").removeClass("hidden").find(".hidden").each(function(){var a=
H(this);a.removeClass("hidden");a.is("input")&&(a.focus(),a.select(),a.unbind("keydown.update-quantity-spc").bind("keydown.update-quantity-spc",function(a){13===a.which&&a.preventDefault()}),a.unbind("keyup.update-quantity-spc").bind("keyup.update-quantity-spc",function(a){13!==a.which||b||H(a.target).closest(".dynamic-quantity-update").find(".update-quantity-button").trigger("click")}))});setTimeout(function(){b=!1},500)}});a.declarative("order-summary-get-quantity",["click","touchend"],function(a){f.protectAgainstDoubleAction("order-summary-get-quantity",
200)||a.$currentTarget.find("select").length&&(Q=a.$currentTarget.find("select").val())});a.declarative("order-summary-update-quantity",["change"],L);a.declarative("order-summary-update-quantity-text-field",["click","touchend"],L);a.declarative("order-summary-handle-text-input",["keydown"],function(a){13===a.$event.which?(a.$event.preventDefault(),L(a)):f.limitInputToNumbers(a)});a.declarative("order-summary-show-update-button",["change","keyup"],E);a.declarative("trigger-update-quantity-button",
["keydown"],function(a){13===a.$event.which&&(a.$event.preventDefault(),a.$currentTarget.closest(".quantity-block").find(".update-quantity-button").trigger("click"))});a.declarative("toggle-update-quantity-button",["change","keyup"],function(a){var b=a.$currentTarget.closest(".quantity-block").find(".update-quantity-button"),c=a.$currentTarget.find("input"),d=c.val(),e=c.data("currentQuantity");""===d?("change"===a.type&&c.val(e),b.hide()):parseInt(d,10)!==e?b.show():b.hide()});a.declarative("update-quantity",
["click","touchend"],function(a){b.resetMetrics();var c=a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a");a=c.closest(".quantity-block");var d=c.closest(".dynamic-quantity-update"),e=d.find(".quantity-input");d.length||(e=a.find(".quantity-input"));if(f.protectAgainstDoubleAction("lock-update-quantity",200))e.focus();else{var h=e.val();W=c.data("entityId");var k=H('.update-quantity-error[data-itemid\x3d"'+W+'"]');f.validateNumber(h,0,999)?(k.hide(),d.find(".a-form-error").removeClass("a-form-error"),
e.removeClass("a-form-error"),h=parseInt(h,10),B=e,Q=B.data("currentQuantity"),Q=parseInt(Q,10),h===Q?(a.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden"),a.find(".quantity-display").removeClass("hidden"),a.find(".quantity-display-block-tablet").removeClass("hidden"),d.addClass("hidden").children().addClass("hidden")):(N=h,Z=c,c.blur(),c.data("isBundleDelete")?setTimeout(function(){H("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):g(!1))):v(W,"changeQuantity_quantityNotInRange")}});
H(document).delegate(".spc-quantity-dropdown","change",function(a){F=H(a.currentTarget);b.resetMetrics();aa?(a=F.next(),W=a.data("entityId"),Q=a.data("currentQuantity")):(b.increaseCount("removeauijs21"),W=F.data("entityId"),Q=F.data("currentQuantity"));var c=F.find(":selected");N=parseInt(c.val(),10);Q!==N&&(a=H("#toggleDropdownQuantityTrigger"),a.length&&N===parseInt(a.val(),10)?(a=F.closest(".quantity-block"),a.find(".spc-quantity-dropdown-button").hide(),a.find(".quantity-input").show()):(Z=F.parent(),
F.blur(),c&&c.data("isBundleDelete")?setTimeout(function(){H("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click")},100):g(!1)))});a.declarative("dont-delete-item",["click","touchend"],function(a){a.$event.preventDefault();f.protectAgainstDoubleAction("dont-delete-item")||n.hideById(a.$currentTarget.closest(".a-popover").data("aPopoverId"))});a.declarative("delete-item",["click","touchend"],function(a){a.$event.preventDefault();f.protectAgainstDoubleAction("delete-item")||A(a)});a.declarative("delete-prime-membership-item-confirm",
["click","touchend"],function(a){a.$event.preventDefault();if(!f.protectAgainstDoubleAction("delete-prime-membership-item-confirm")){var b={additionalData:{deletePrimeMembership:1,primeMembershipASIN:(a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a")).data("asin")}};A(a,b)}});a.declarative("bundle-delete",["click","touchend"],function(){f.protectAgainstDoubleAction("bundle-delete")||g(!1)});a.declarative("bundle-delete-action",["click","touchend"],function(a){f.protectAgainstDoubleAction("bundle-delete-action")||
(r.when("a-popover-base").execute(function(b){b.get(a.data.popoverName).hide()}),g(!1))});a.declarative("egc-delete",function(a){W=a.entityId;N=0;g(!0)});a.declarative("bundle-dont-delete",["click","touchend"],function(){f.protectAgainstDoubleAction("bundle-dont-delete")||(N=Q,F&&r.when("a-dropdown").execute(function(a){a.setValue(F.attr("id"),Q.toString());F.data("currentQuantity",N)}))});a.declarative("pantry-return-to-cart-btn",["click","touchend"],function(){f.protectAgainstDoubleAction("pantry-return-to-cart-btn")||
P()&&u()});a.declarative("pantry-delete-items-btn",["click","touchend"],function(){!f.protectAgainstDoubleAction("pantry-delete-items-btn")&&P()&&(ca=!0,H(".a-button-close").trigger("click"),g(!0))});a.declarative("pantry-cancel-delete-btn",["click","touchend"],function(){f.protectAgainstDoubleAction("pantry-cancel-delete-btn")||P()&&K(ba.pantryMOV)});a.on("a:popover:hide:pantry-mov-popover",function(){P()&&(ca||K(ba.pantryMOV))});a.declarative("addon-return-to-cart",["click","touchend"],function(){f.protectAgainstDoubleAction("addon-return-to-cart")||
P()&&u()});a.declarative("addon-delete-items",["click","touchend"],function(){f.protectAgainstDoubleAction("addon-delete-items")||(P()&&(Y=!0,H(".a-button-close").trigger("click"),g(!0)),e.isSPP()&&b.increaseCount("checkout:spp-revieworder:addon_delete_pri",1))});a.declarative("addon-dont-delete",["click","touchend"],function(){f.protectAgainstDoubleAction("addon-dont-delete")||(P()&&K(ba.addOn),e.isSPP()&&b.increaseCount("checkout:spp-revieworder:addon_keep_pri",1))});a.on("a:popover:hide:addon-warning-normal",
function(){0<H("div.spc-mobile").length?u():P()&&(Y||K(ba.addOn))});a.on("a:popover:hide:addon-warning-special",function(){P()&&(Y||K(ba.addOn))});a.on("checkout:reload:spc",w);a.on("checkout:reload:spp-revieworder",w)}});r.when("A","ready").execute(function(a){a.on("a:popover:beforeShow",function(a){if(a.popover.$trigger.hasClass("quantity-dropdown-button")){var l=a.popover.$popover,c=l.closest("div.a-dropdown");c.length&&(a.popover.$iframe.css("max-height","260px"),l.css("max-height","260px"),l=
c.find("div.a-popover-inner"),l.css({"max-height":"260px"}),a.popover.updatePosition(),l.css({"overflow-y":"scroll"}))}})});"use strict";r.when("A","page-transition-controller","page-conductor","ajax-utility").register("tax-exemption-controller",function(a,m,l,c){function e(a,e,h){return h.getResponseHeader("x-amz-checkout-page")?l.ajaxUpdatePage(a,e,h,{pushNewFrame:"false"}):(a=c.jsonify(a))?l.redirect(a):l.redirect()}function k(a,c){var h=c.$target.data("entityId");if(h){m.show();var b={isClientTimeBased:n('input[name\x3d"useCtb"]').val(),
fromAnywhere:n("input[name\x3dfromAnywhere]").val()},b=b||{};c={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};n.extend(c,b);c.entityId=h;c.optOut=a;a=l.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});n.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/tax-exemption-optout.html",data:n.param(c),dataType:"text",async:!0,cache:!1,headers:a,success:e,error:l.ajaxRedirect})}else q.ueLogError&&q.ueLogError({name:"MissingData",message:"lineItemId is undefined, when trying to opt out from tax exemption",
logLevel:"FATAL"})}var n=a.$;n("html").hasClass("a-ie6")||(a.declarative("tax-exemption-opt-out",["click","touchend"],function(a){k(!0,a)}),a.declarative("tax-exemption-opt-in",["click","touchend"],function(a){k(!1,a)}))});"use strict";r.when("A").execute(function(a){return{}});"use strict";r.when("A","page-transition-controller","page-conductor").register("sns-subscription-controller",function(a,m,l){function c(){var c=n(document);c.delegate(".sns-option","click",function(a){a=n(this);k(a.closest(".sns-upsell"),
a)});c.delegate(".sns-option-mobile","click",function(a){var c=n(this);a.target.name&&"snsSetCreateSubscription"===a.target.name&&k(c.closest(".sns-upsell-mobile"),c)});c.delegate(".sns-option-tablet","click",function(a){a=n(this);k(a.closest(".sns-upsell-tablet"),a)});c.delegate(".sns-upsell-nextdelivery","change",function(){e(n(this))});a.declarative("sns-upsell-nextdelivery-dropdown","change",function(a){e(n(a.$target))});c.delegate(".sns-upsell-learn-more","click",function(a){var c=n(this);a=
c.width();var b=c.height(),d=c.position(),c=c.find(".sns-upsell-popover-learn-more");c.removeClass("aok-hidden");var e=c.width();c.height();c.css({top:d.top+b,left:d.left-(e-a)/2,position:"absolute"})});c.delegate(".sns-upsell-learn-more-close","click",function(a){(a=n(this))&&a.closest(".sns-upsell-popover-learn-more")&&a.closest(".sns-upsell-popover-learn-more").addClass("aok-hidden");return!1})}function e(a){var c=a.closest(".sns-upsell,.sns-upsell-mobile,.sns-upsell-tablet");if(a.length&&c.length){var e=
c.data("index"),b=c.find("span.sns-change-delivery-txt");b&&b.text(a.find("option:selected").data("date"));b=a.find("option:selected").data("epoch");a=a.find("option:selected").val();c.find("input[type\x3d'hidden'][name\x3d'sns_nextDelivery"+e+"']").val(b);c.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+e+"']").val(a)}}function k(a,c){m.show();var e=a.data("index"),b=(new Date).getTime(),k=a.find("input[type\x3d'hidden'][name\x3d'sns_lineItemIdentifier"+e+"']").attr("value"),q=a.find("input[type\x3d'hidden'][name\x3d'sns_merchantId"+
e+"']").attr("value"),r=a.find("input[type\x3d'hidden'][name\x3d'sns_asin"+e+"']").attr("value");a=a.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+e+"']").attr("value");c=c.prop("checked")||c.find("[type\x3dcheckbox]").is(":checked");b={returnpipedata:0,returnFullHTML:1,cachebuster:b,hasWorkingJavascript:1};b.lineItemIdentifier=k;b.isONMLSelected=c?1:0;b.merchantId=q;b.asin=r;b.frequency=a;k=l.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});n.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-sns-options.html",
data:n.param(b),dataType:"text",async:!0,cache:!1,headers:k,success:function(a,b,c){return l.ajaxUpdatePage(a,b,c)},error:function(a,b,c){l.ajaxRedirect(a,b,c)}})}var n=a.$;n("html").hasClass("a-ie6")||c()});"use strict";r.when("A","page-detector","page-detector-current-page","page-conductor","page-transition-controller","ajax-utility","place-order-controller","client-side-metrics").execute(function(a,m,l,c,e,k,n,d){function f(a){"function"===typeof q.ues&&(q.ues("t0",a,new Date),q.ues("ctb",a,"1"));
"function"===typeof q.uet&&q.uet("tc",a,{wb:1})}function h(a,b){"function"===typeof q.ues&&q.ues("id",a,b)}function b(a,b){"function"===typeof q.uet&&q.uet(a,b,{wb:1})}function p(a){"function"===typeof q.uex&&q.uex("ld",a,{wb:1})}function r(a){q.ueLogError&&q.ueLogError({message:a},{logLevel:"WARN",attribution:"ajax-typ"})}function v(){var a=M("span#typ-load").attr("data-typ-args");q.location.href="https://"+q.location.hostname+"/gp/buy/thankyou/handlers/display.html?"+a}function z(){if(ca){var a=
M("#typ-desktop-frame").contents(),b=ca;if(b.deliveryestimates)for(var c in b.deliveryestimates)if(b.deliveryestimates.hasOwnProperty(c)){var d=a.find("span#"+c);d&&d.replaceWith(b.deliveryestimates[c])}b.autorip&&(a=a.find("#thank-you-rogue"))&&a.replaceWith(b.autorip)}}function x(){b("cf","ajax-typ:place-your-order");z();var a=M("#typ-desktop-frame").contents(),c="ThankYouCart",f=a.find("span#typ-rewrite-url");history&&history.pushState&&f&&0<f.length&&(history.pushState({},"",f.attr("data-url")),
c=f.attr("data-view"));a=a.find("title").text();M("#checkoutDisplayPage").hide();M("#typ-desktop").show();document.title=a;e.hide();c=M("span#typ-load").attr("data-typ-args")+"\x26viewId\x3d"+c;b("be","ajax-typ:place-your-order");d.setmarker&&(a=d.getscope(),aa&&(c+="\x26requestID\x3d"+ba,d.setscope("ajax-typ")),d.setmarker("cf"),aa&&d.setscope(a));M.ajax({type:"POST",url:"/gp/buy/thankyou/handlers/log-data.html",data:c,dataType:"text",async:!0,cache:!1,complete:function(a,b){b=M("#typ-desktop-frame")[0].contentWindow;
"function"===typeof b.updateCart&&b.updateCart();a.getResponseHeader("x-amz-checkout-requestid")&&(a=a.getResponseHeader("x-amz-checkout-requestid"),d.sendue&&(b=d.getscope(),d.setscope("ajax-typ"),d.setrid(a),d.sendue("ld"),d.setscope(b)),h("ajax-typ:place-your-order",a),p("ajax-typ:place-your-order"))}});aa||(d.sendUEPageLoadStats(),p("ajax-typ:place-your-order"))}function t(a,d,e){a&&a.conductoraction&&a.conductoraction.url?c.redirect(a):(b("af","ajax-typ:place-your-order"),ca=a,Q?x():H?W=1:(r("No TYP data available after place-order, redirecting to static TYP"),
v()))}function g(){if(!fa)if(X&&clearTimeout(X),3===O.readyState){var a;try{a=k.jsonify(O.responseText)}catch(b){a=null}null!==a?(fa=1,t(a)):X=setTimeout(g,50)}else 4===O.readyState&&(fa=1,200===O.status?(a=k.jsonify(O.responseText),null!==a?t(a):(r("No results from place-order, calling ajaxRedirect"),c.ajaxRedirect())):(r("Error calling place-order, calling ajaxRedirect"),c.ajaxRedirect()))}function u(){N=1;B&&clearTimeout(B);Y&&clearTimeout(Y);var a=M("#currencyChanged");0<a.length&&"true"===a.val()&&
(a='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+M("#tfx-switch-currency-options").find("input:radio:checked").val()+'" /\x3e',M("#spc-form-inputs").append(a));M("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");a=(new Date).getTime()-y;M("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'waitingTime' value\x3d'"+a+"' /\x3e");M("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'returnjson' value\x3d'1' /\x3e");ea&&M("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'isAsyncTYPEnabled' value\x3d'1' /\x3e");
var a=M("#spc-form").serialize(),b=M("#typ-desktop-frame").contents().find("input#cached-promise-data");0<b.length&&(a+="\x26cachedPromiseData\x3d"+b.val());if(Z){if(q.XMLHttpRequest)O=new XMLHttpRequest;else if(q.ActiveXObject)try{O=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(d){O=null}if(!O){r("Can't get XMLHttpRequest for data stream, calling standard placeOrderController");N=1;n.placeOrderClick();return}O.open("POST","/gp/buy/spc/handlers/place-your-decoupled-order.html",!0);O.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");O.setRequestHeader("Content-length",a.length);O.setRequestHeader("Connection","close");O.onreadystatechange=g;O.overrideMimeType("text/plain");O.send(a)}else M.ajax({type:"POST",url:"/gp/buy/spc/handlers/place-your-decoupled-order.html",data:a,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return k.jsonify(a)},success:function(a,b,d){null!==a?t(a,b,d):(r("No results from place-order, calling ajaxRedirect"),c.ajaxRedirect())},error:function(a,b,d){r("Error calling place-order, calling ajaxRedirect");
c.ajaxRedirect(a,b,d)}});"function"===typeof q.uet&&q.uet("bb","ajax-typ:place-your-order",{wb:1})}function K(){Q=H=F=0;M("div#typ-desktop").empty()}function A(a,b,c){F||(F=1,clearTimeout(Y),H=0,Q=1,P++,(a=M("#typ-desktop-frame").contents().find("span#typ-rewrite-url"))&&0<a.length&&(a=a.attr("data-requestid"),f("ajax-typ:place-your-order"),aa?ba=a:(d.setAsyncRequestId(a),h("ajax-typ:place-your-order",a))),W?x():!N&&5>P&&(B=setTimeout(function(){K();L()},12E4)))}function L(){if(!(N||H||5<=P)){H=1;
var a=M("span#typ-load").attr("data-typ-args");Y=setTimeout(function(){K();W&&(r("Timed out waiting for TYP fetch after place-order, redirecting to static TYP"),v())},45E3);M("\x3ciframe /\x3e",{name:"typ-desktop-frame",id:"typ-desktop-frame",width:"100%",height:"100%",frameborder:"0",src:"/gp/buy/thankyou/handlers/display.html?"+a}).appendTo("div#typ-desktop").load(A)}}function D(){A()}function E(){m.isSpc()&&0<M("span#typ-load").length&&(y=(new Date).getTime(),P=0,M("div#typ-desktop").length?K():
M("body").append('\x3cdiv id\x3d"typ-desktop" style\x3d"position:absolute;left:0;right:0;bottom:0;top:0;display:none;"\x3e\x3c/div\x3e'),Z=M("span#typ-load").attr("data-early-json-flush")&&!M("html").hasClass("a-lt-ie10"),ea=0<M("span#async-typ-enabled").length,aa=M("span#typ-load").attr("data-use-cds-stub"),M(document).undelegate("span.place-order-button-link","click"),M(document).delegate("span.place-order-button-link","click",function(a){a.preventDefault();aa?(a=d.getscope(),d.setscope("ajax-typ"),
d.setctb(),d.resetue(),d.setmarker("tc"),d.setscope(a)):(d.resetMetrics(),d.setmarker("tc"));H||Q?(e.show(),u()):(N=1,n.placeOrderClick())}),L())}var M=a.$;if(!M("html").hasClass("a-ie6")){var P=0,H=0,N=0,Q=0,W=0,F=0,B,Y,ca,Z=0,aa=0,ba,O,X,fa=0,y=0,ea=0;a.on("ajax-typ-cf",D);a.on("checkout:reload:spc",E);a.on("checkout:reload:spp-revieworder",E);a.on("checkout:reload:spclite",E)}});"use strict";r.when("A","client-side-metrics").register("trialSignPrefetchCommon",function(a,m){function l(){c()&&(b().val(0),
m.increaseCount("TrialSign:js:activated"),e(),void 0!==r&&h(),r=a.interval(f,5E4),z=0)}function c(){return 0!==b().length&&0!==p("input[name\x3d'purchaseID']").length}function e(){void 0!==q&&q.abort();q=a.ajax("/gp/buy/spc/handlers/trigger-trial-sign.html",{method:"post",params:{purchaseId:p("input[name\x3d'purchaseID']").val()},success:k,error:n,abort:d})}function k(a,c,d){b().val(a.signPurchaseTrialId);q=void 0;m.increaseCount("TrialSign:js:success")}function n(a,b,c){h();q=void 0;m.increaseCount("TrialSign:js:failed")}
function d(){h();q=void 0;m.increaseCount("TrialSign:js:aborted")}function f(){z++;10<z?h():(m.increaseCount("TrialSign:js:retry"),m.increaseCount("TrialSign:js:retry:"+z),e())}function h(){void 0!==r&&(clearInterval(r),r=void 0)}function b(){return p("input[name\x3d'trialSignId']")}var p=a.$,q,r,z=0;a.on("checkout:reload:spc",l);a.on("checkout:reload:spclite",l);a.on("checkout:billing-address-update",l);return{makeTrialSignCall:e,trialSignCallSucceeded:k,isTrialSignActivated:c}});"use strict";r.when("A",
"client-side-metrics","ajax-utility","button-blocker","button-blocker-popover","spclite-items-viewer","fast-track-controller").register("get-final-results-update",function(a,m,l,c,e,k,n){function d(){for(var b=function(){a.trigger("checkout:spc:ordersummary:sizeChanged")},c=0;20>c;++c)setTimeout(b,100*c)}function f(a,b){setTimeout(function(){var c=k.prepare(a);c&&v("#spclite-items-operation").show();v("#spclite-items-header-dynamic").fadeIn(b?0:300,function(){c&&v("#spclite-items-operation").find(".spclite-items-view-switch").each(function(){var a=
v(this).attr("view-name");a&&v(this).find("a").click(function(){m.increaseCount("SPCLite:ClientSide:SwitchViewClick:"+a,1);k.switchToView(a);v("#spclite-items-operation").fadeOut(b?0:300);d()})})})},b?0:800)}function h(b,c,d){if(b&&v.isArray(b))for(var e=!1,f=0;f<b.length;f++){var h=b[f];if(h.identifier&&h.content){var k=v("#"+c+"-"+h.identifier);k&&0!==k.length?a.slideDown(k.html(h.content),d?0:500,"ease-out",function(){}):(m.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Item:"+c,1),e||(m.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Page:"+
c,1),e=!0))}}}function b(b,c){if(b.presentCVs&&0<b.presentCVs.countOfCVs)p();else{b.orderSummaryHTML&&(a.fadeOut(v("#order-summary-footer"),c?0:250,"ease-out"),a.fadeOut(v("#spc-order-summary"),c?0:250,"ease-out",function(){v("#spc-order-summary").replaceWith(b.orderSummaryHTML).hide();b.additionalOrderSummaryHTML&&v("#order-summary-footer").html(b.additionalOrderSummaryHTML);a.fadeIn(v("#spc-order-summary"),c?0:400,"ease-out");a.fadeIn(v("#order-summary-footer"),c?0:400,"ease-out")}));b.freshDeliveryMessageHTML&&
(v("#lazy-fresh-promise-delivery-message").html(b.freshDeliveryMessageHTML),a.slideDown(v("#lazy-fresh-promise-delivery-message"),c?0:500,"ease-out"),n.spcLiteLazyLoadFastTrack());h(b.itemToPrimeMembershipDelivery,"lazy-membership-delivery",c);h(b.itemToGiftContentMapping,"lazy-gift-options",c);h(b.itemToShipOfferingMapping,"lazy-ship-method",c);h(b.itemToPromise,"lazy-promise",c);b.freshDeliverySlotInformationHTML&&(v("#lazy-fresh-delivery-slot-information").html(b.freshDeliverySlotInformationHTML),
a.slideDown(v("#lazy-fresh-delivery-slot-information"),c?0:250,"ease-out"));b.freshDeliveryInstructionsHTML&&(v("#lazy-fresh-delivery-instructions").html(b.freshDeliveryInstructionsHTML),a.slideDown(v("#lazy-fresh-delivery-instructions"),c?0:250,"ease-out"));if(b.itemToPromoMapping&&v.isArray(b.itemToPromoMapping))for(var e=v("#items-block"),k=0;k<b.itemToPromoMapping.length;k++){var l=b.itemToPromoMapping[k];"lightningdeal"===l.type?e.find(".lazy-lightning-promo-details-"+l.identifier).removeClass("aok-hidden"):
"promotion"===l.type&&e.find(".lazy-promo-details-"+l.identifier).removeClass("aok-hidden")}b.freeShippingId&&v("#"+b.freeShippingId).removeClass("aok-hidden");v("input#isOrderSummaryReady").val(1);f(b.itemGroupData,c);d()}}function p(){var b=v("#spclite-block-order-place-message").html()||"";c.show("disabled-order-place",b);c.lock();e.create({name:"disabled-order-place",content:b});e.lock();var d=c.getButtonBlocker().data("a-popover-id");a.on("checkout:beforeReload",function(){e.unlock();c.unlock();
e.destroy();v("#a-popover-"+d).remove()})}function r(a){if(a&&a.data){var b;try{b=q.atob(a.data)}catch(c){return m.increaseCount("SPCLite:FinalResult:Base64Decode:Failure",1),null}if((b=l.jsonify(b))&&!v.isEmptyObject(b))return b}return null}var v=a.$,z,x=function(a,b){function c(){if(f&&0!==f.length){for(var a="",b=0;b<d%3+1;b++)a+=".";f.html(a);d++}}var d=0,e,f;this.start=function(){b&&b.useTextAnimate&&(d=0,f=a.find(".spclite-loading-text .spclite-processing-indicator"),e=setInterval(c,800))};
this.stop=function(){e&&(clearInterval(e),f&&0<f.length&&f.html(""),d=0);a.find(".spclite-loading-spinner").hide();b&&b.showTextAlways||a.find(".spclite-loading-text").hide()}};a.on("checkout:reload:spclite",function(){if("1"===v('script[type\x3d"spclite-encoding"]').attr("data-base64-encode-final-results")){var a=r(q.__spcliteFinalResultsData);if(a){b(a,!0);return}}else if(q.__spcliteFinalResultsData){b(q.__spcliteFinalResultsData,!0);return}var a="",c=v("input#executionId").val();c&&(a+="executionId\x3d"+
c);return v.ajax({type:"GET",url:"/gp/buy/spclite/handlers/get-final-results.html/ref\x3dox_spclite_get_final_results",data:a,dataType:"text",async:!0,beforeSend:function(a){z=new x(v("#spclite-order-summary-loading-indicator"),{showTextAlways:!0});z.start();q.uet&&q.uet("bb","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},success:function(a,c,d){a=l.jsonify(a);"1"===v('script[type\x3d"spclite-encoding"]').attr("data-base64-encode-final-results")?(a=r(a))?b(a,!1):p():a&&!v.isEmptyObject(a)?b(a,!1):p()},
error:function(a,b,c){p()},complete:function(a){z.stop();q.uex&&q.uex("ld","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},cache:!1})});a.on("checkout:beforeLoadPage",function(){q.__spcliteFinalResultsData=void 0})});"use strict";r.when("A","client-side-metrics").register("spclite-items-viewer",function(a,m){function l(){var a=e("#spclite-items-block").find(".spclite-item-detail");a&&0<a.length&&(n={},a.each(function(a){a=e(this).attr("entity-id");n[a]=e("\x3cp\x3e\x3c/p\x3e").append(e(this).clone().removeClass("a-span-last")).html()}))}
function c(a,c){if(!c||0===c.length)return null;a=e('\x3cdiv class\x3d"a-row spclite-item-view" view-type\x3d"order-by-delivery"\x3e\x3c/div\x3e');var h=c;c=[];for(var b=[],k=0;k<h.length;k++){var l=h[k];if("normal"!==l.type)b.push(l);else{for(var m=0;m<c.length;)if(l.data.destinationAddressId!==c[m].data.destinationAddressId)m++;else break;for(;m<c.length;)if(l.data.destinationAddressId===c[m].data.destinationAddressId&&l.data.promise.starttime.dayepoch>c[m].data.promise.starttime.dayepoch)m++;else break;
c.splice(m,0,l)}}for(h=0;h<b.length;h++)switch(l=b[h],l.type){case "primemembership":c.unshift(l);break;case "vas":case "digital":case "no-promise":case "exception":c.push(l);break;default:c.push(l)}for(b=0;b<c.length;b++){l=c[b];if(h=l.content)k='\x3cdiv class\x3d"row spclite-item-group-title"\x3e',h.destination&&(k+='\x3cdiv class\x3d"row destination"\x3e'+h.destination+"\x3c/div\x3e"),h.promise&&(k+='\x3cdiv class\x3d"row promise"\x3e'+h.promise+"\x3c/div\x3e"),k+="\x3c/div\x3e",a.append(k);a:if(h=
l.items,n&&h&&0!==h.length){k="";for(m=0;m<h.length;m++){0===m%2&&(k+='\x3cdiv class\x3d"a-row"\x3e');var q=h[m].identifier;if(!n[q]){h=null;break a}q=e(n[q]);1===m%2&&q.addClass("a-span-last");k+=e("\x3cp\x3e\x3c/p\x3e").append(q).html();1===m%2&&(k+="\x3c/div\x3e")}1===h.length%2&&(k+='\x3cdiv class\x3d"a-column a-span6 a-span-last"\x3e\x3c/div\x3e\x3c/div\x3e');h=k}else h=null;if(h)h=e(h),("no-promise"===l.type||"normal"===l.type&&l.data&&l.data.promise&&"scheduled"!==l.data.promise.type)&&h.find(".spclite-promise").hide(),
a.append(h);else return null;b<c.length-1&&a.append("\x3chr\x3e")}return a}var e=a.$,k,n;return{prepare:function(a){try{var e;a:{l();if(n){var h=c("order-by-delivery",a);if(h){k={"order-by-delivery":h};e=!0;break a}}e=!1}return e}catch(b){m.increaseCount("SPCLite:ClientSide:Exception:SwitchViewPrepare",1)}return!1},switchToView:function(a,f){var h;k&&k[a]?h=k[a]:(m.increaseCount("SPCLite:ClientSide:SwitchViewNoPrepared:"+a,1),"order-by-delivery"===a&&(h=c(a,f)));if(h){var b=e("#spclite-items-block");
b.find(".spclite-item-view").fadeOut(300,function(){b.empty();b.append(h.clone().hide());b.find(".spclite-item-view").fadeIn(500)})}}}});"use strict";r.when("A","loading-spinner-controller").register("cpf-controller",function(a,m){function l(a){var c,l,d;if(/^\d{11}$/.test(a)||/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(a)){a=a.replace(/[^\w\s]|_/g,"");if(/(\d)\1{10}/.test(a))return!1;c=a.substring(0,9);l=a.substring(9);d=0;for(var f=10;1<f;f--)d+=c.charAt(10-f)*f;if((2>d%11?0:11-d%11)!==l.charAt(0))return!1;
c=a.substring(0,10);d=0;for(a=11;1<a;a--)d+=c.charAt(11-a)*a;return(2>d%11?0:11-d%11)!==l.charAt(1)?!1:!0}return!1}var c=a.$;a.on("checkout:reload:spp-taxid",function(){c("#useThresholdTaxIdService").length||c("#taxidForm").submit(function(){var a=c("#taxidregistration-imb");if(!l(c("#taxid-field").val()))return m.hideSpinner(c("#spinner-anchor"),!0),a.show(),!1;a.hide();return!0})})});"use strict";r.when("A","page-conductor","ready").register("taxid-threshold-controller",function(a,m){function l(){var a=
c();m.isSPP()?a?(e("#taxid-continue-disabled").hide(),e("#taxid-continue-enabled").show()):(e("#taxid-continue-enabled").hide(),e("#taxid-continue-disabled").show()):a?e("span.#continue").removeClass("a-button-disabled").find('input[type\x3d"submit"]').removeAttr("disabled"):e("span.#continue").addClass("a-button-disabled").find('input[type\x3d"submit"]').attr("disabled","disabled")}function c(){var a=!0,c=e("#taxIdForm");c.length&&c.find('input[type\x3d"text"]').each(function(){var c=e(this);if(!c.val()||
7>c.val().length)c.parents(".taxid-form").find('input[type\x3d"checkbox"]').attr("checked")||(a=!1)});return a}var e=a.$;a.on("checkout:reload:spp-taxid",function(){if(e("#useThresholdTaxIdService").length){var a=e("#taxIdForm");a.length&&(a.find('input[type\x3d"text"]').keyup(l),a.find('input[type\x3d"checkbox"]').change(l));l()}})});"use strict";r.when("A","page-conductor","loading-spinner-controller","taxaddress-page-config","ready").register("taxaddress-controller",function(a,m,l,c){function e(){var a=
d(h.taxidInputIdSelector).val();if(0===a.length)return!0;var b=d(h.taxlegalnameInputIdSelector).val();return f.test(a)&&0!==b.trim().length?(a=d(h.taxaddressInputNameSelector).val())&&0<a.length:!1}function k(){var a=e();if(m.isSPP()){var b=d("#taxid-continue-enabled"),c=d("#taxid-continue-disabled");a?(c.hide(),b.show()):(b.hide(),c.show());0<d(h.taxidInputIdSelector).val().length?(b.find("span.a-button-text").text(h.saveContinueLabel),c.find("span.a-button-text").text(h.saveContinueLabel)):(b.find("span.a-button-text").text(h.continueLabel),
c.find("span.a-button-text").text(h.continueLabel))}}function n(){var a=d(h.taxidInputIdSelector).val();if(b||0===a.length)b=!1;else{var c=0<d(h.newTaxaddressInputIdSelector).val().length;b||!c&&!e()||d.ajax({type:"POST",url:h.sifEncryptionUrl,dataType:"json",data:{taxid:a},success:function(a,c,e){d(h.taxidInputIdSelector).val(a.sifEncryptedPayload);b=!0;d(h.taxaddressFormIdSelector).submit()},error:function(a,b,c){console.log("Error [tramway][away] failed calling sifcontinue.html :"+b)}});return!1}}
var d=a.$,f=/^\d{11}$/,h=c.getConfig(),b=!1;a.on("checkout:reload:spp-taxaddress",function(){d(h.taxidInputIdSelector).keyup(k);d(h.taxlegalnameInputIdSelector).keyup(k);d('input:radio[name\x3d"'+h.taxaddressInputName+'"]').each(function(){d(this).change(k)});d(h.taxaddressFormIdSelector).submit(n);k()});return{getNewTaxAddressPopoverURL:function(){return h.newTaxAddressPopoverURL},submitTaxAddressFormWithNewAddressId:function(a){d(h.newTaxaddressInputIdSelector).val(a);l.showSpinner(d(h.taxAddressPanelSelector),
!1);d(h.taxaddressFormIdSelector).submit()}}});r.when("A","address-popovers","taxaddress-controller","ready").register("taxaddress-addresspopover-helper",function(a,m,l){m.actionRegisterTaxAddressController(l)});"use strict";r.when("A","page-spinner-controller","ajax-utility","page-conductor","client-side-metrics").execute(function(a,m,l,c,e){function k(){function e(a){if(!k)if(a.preventDefault(),a=encodeURIComponent(n("#spc-deliverytipinput").val()),n("#tip-error").addClass("aok-hidden"),n("#tip-promo-success").addClass("aok-hidden"),
n("#tip-success").addClass("aok-hidden"),n("#tip-ineligible").addClass("aok-hidden"),n("#tip-success").addClass("aok-hidden"),a&&0!==a.length)if(0>a)b("invalidDeliveryTip_NoAmount");else if(/^[0-9]*(\.[0-9]{1,2})?$/.test(a)){m.show();l=n("#spc-deliverytipnoticecheckbox").attr("checked")?1:0;var d=(new Date).getTime();a="tipamount\x3d"+a+"\x26isDefaultTip\x3d"+l+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+n("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+
d;d=c.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});n.ajax({type:"POST",url:"/gp/buy/spc/handlers/add-delivery-tip.html/ref\x3dox_tip_page_delivery_tip_add",data:a,headers:d,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){k=!1;m.hide()},success:h,error:c.ajaxRedirect});k=!1}else b("invalidDeliveryTip_NoAmount");else b("addDeliveryTip_NoAmount")}function h(a,b,c){m.hide()}function b(a){m.hide();
n("#tip-error").removeClass("aok-hidden");0<n("div.spc-desktop").length?n("#spc-deliverytipinput").addClass("a-form-error"):n("#spc-deliverytipinput").closest(".a-input-text-wrapper").addClass("a-form-error");n("#"+a).removeClass("aok-hidden")}var k=!1,l=0;d&&(a.declarative("tip-element",["click"],function(a){var b=a.data.click;b&&null!==b&&e(a.$event)}),d=!1)}var n=a.$;if(!n("html").hasClass("a-ie6")){var d=!0;a.on("checkout:reload:spc",k);a.on("checkout:reload:spclite",k)}});"use strict";r.when("A",
"checkout-general-utils","page-conductor","loading-spinner-controller").register("checkout-feedback-controller",function(a,m,l,c){function e(){if(!n||"function"!==typeof n)return"";var a=n(),c="";if(a)for(var e in a)if("number"===typeof a[e]||"string"===typeof a[e]||"boolean"===typeof a[e])c+="\x26__pagedata_"+e+"\x3d"+a[e];return c}var k=a.$,n;a.declarative("checkout-submit-feedback",["click","touchend"],function(a){if(!m.protectAgainstDoubleAction("checkout-submit-feedback",200)&&(a=k("#checkout-feedback-form"),
a.length)){c.showSpinner(a,!1);var f=a.serialize(),f=f+e();k.ajax({type:"POST",url:a.attr("action"),data:f,dataType:"text",error:l.ajaxRedirect,success:function(a,b,c){b=c.getResponseHeader("checkout-feedback-submitted");k(".a-button-close").trigger("click");null!==b&&void 0!==b&&k("#checkout-feedback-banner").append(a)}})}});return{registerPageDataCollecter:function(a){a&&"function"===typeof a&&(n=a)}}});"use strict";r.when("A","page-spinner-controller","scroll-controller","ajax-utility","page-conductor",
"checkout-modal-popover","page-detector","checkout-general-utils","a-popover","client-side-metrics").execute(function(a,m,l,c,e,k,n,d,f,h){function b(){function b(a){a=a.$currentTarget.closest(".delivery-instructions-block");a.find(".edit-delivery-instructions-link").addClass("aok-hidden");a.find(".delivery-instructions-display").addClass("aok-hidden");var c=a.find(".dynamic-delivery-instructions-update").find(".delivery-instructions-input").attr("maxlength");a.find(".dynamic-delivery-instructions-update").removeClass("aok-hidden");
p("#deliveryInstructions").focus();p("#deliveryInstructions").select();p("#deliveryInstructions").keydown(function(a){10===a.which&&a.preventDefault()});p("#deliveryInstructions").keyup(function(){p("#delivery-instructions-left-text").hasClass("aok-hidden")&&p("#delivery-instructions-left-text").removeClass("aok-hidden");var a=c-p(this).val().length;0>a&&(a=0);p("#delivery-instructions-left").text(a)});setTimeout(function(){},500)}function d(a){m.show();a=a.$currentTarget;var b=p("#deliveryInstructions").val(),
c=a.closest(".delivery-instructions-block"),k=a.closest(".dynamic-delivery-instructions-update");c.find(".edit-delivery-instructions-link").removeClass("aok-hidden");c.find(".delivery-instructions-display").removeClass("aok-hidden");k.addClass("aok-hidden");c=(new Date).getTime();b="deliveryInstructions\x3d"+encodeURIComponent(b)+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+p("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+c;c=e.setAjaxTransitionHeader({"Cache-Control":"no-cache",
pragma:"no-cache","x-amz-checkout-page":"spc"});p.ajax({type:"POST",url:"/gp/buy/spc/handlers/add-delivery-instructions.html/ref\x3dox_instructions_page_delivery_instructions_update",data:b,headers:c,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){m.hide()},success:f,error:e.ajaxRedirect});a.blur()}function f(a,b,d){(a=c.jsonify(a))&&!p.isEmptyObject(a)&&p("#deliveryInstructionsDisplay").html(a.deliveryInstructions);m.hide()}q&&(a.declarative("edit-delivery-instructions",
["click"],b),a.declarative("update-delivery-instructions",["click"],d),q=!1)}var p=a.$;if(!p("html").hasClass("a-ie6")){var q=!0;a.on("checkout:reload:spc",b);a.on("checkout:reload:spclite",b)}});"use strict";r.when("A","page-conductor").register("installments-service",function(a,m){var l=a.$;return{call:function(a,e,k){l.ajax({type:"POST",url:"/gp/buy/installments/handlers/set-item-installments.html/ref\x3dox_spc_inst_toggle",data:{itemId:a,programId:e},dataType:"text",async:!0,cache:!1,headers:m.setAjaxTransitionHeader(),
success:k.success||null,error:k.error||null})}}});"use strict";r.when("A","page-transition-controller","page-conductor","page-detector","button-blocker","installments-service").register("installments-controller",function(a,m,l,c,e,k){function n(){a.defer(f)}function d(a,c,d){m.hide();l.ajaxUpdatePage(a,c,d,{pushNewFrame:"false"})}function f(){var a=h("#installments-button-blocker");1===a.length&&(a=a.data("blocker-message"),e.show("place-order-installments-blocker",a))}var h=a.$;a.declarative("installments-sync-state",
["change"],function(a){var c=a.data.itemId;a=a.$target.is(":checked")?a.data.programId:"";var e={success:d,error:l.ajaxRedirect};m.show();k.call(c,a,e)});a.on("checkout:reload:spp-revieworder",n);a.on("checkout:reload:spc",n)});"use strict";r.when("A","page-conductor","checkout-modal-popover","page-transition-controller","ajax-utility","page-detector","payments-portal-common","ready").register("spc-payments-portal",function(a,m,l,c,e,k,n){function d(b,c){c={refTag:c,callbackBeforePageUpdate:function(){a.$("div.a-popover button.a-button-close").trigger("click")}};
m.isSPP()&&(c.keepCachedPagesData=1);m.loadPage("spc",b,null,c)}function f(a,d,e){m.isSPP()?(c.blockAllActions(),c.showTransitionInContainer(h("#payment"))):c.show();a="/gp/buy/spc/handlers/pmts-continue-widget.html/ref\x3d"+a;var f=m.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});h.ajax({type:"POST",url:a,data:d,headers:f,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",success:function(a,b,c){c.getResponseHeader("x-amz-checkout-page")?
m.ajaxUpdatePage(a,b,c):e(a)},error:m.ajaxRedirect})}var h=a.$;return{prepareDelegatedPopovers:function(b){function c(a,b){a=h(a);a.data("aCheckoutModalPopover",b);l.createModal({$declarativeParent:a},b)}a.on("pmts:retail:billing-address-popover",function(a){c(".pmts-change-address-link",{header:b.billingAddressPopoverHeader,footer:"",name:"billing-address",allowScrollOnPage:!0})});a.on("pmts:retail:rewards-registration",function(a){c(".pmts-shop-with-points-learn-more-link",{header:b.rewardsRegistrationPopoverHeader,
footer:"",name:"rewards-registration",allowScrollOnPage:!0})})},handleClaimCodeSubmittedEvent:function(a,c){var d={returnjson:"1",returnFullHTML:"1",hasWorkingJavascript:"1",fromAnywhere:h("input[name\x3dfromAnywhere]").val(),cachebuster:(new Date).getTime(),nextAction:"pipeline-dispatch",embedOnlyData:"1"};a=h.param(a)+"\x26"+h.param(d);f("ox_pay_page_gc_add",a,function(a){n.claimCodePageUpdater(c,a)})},handleChangeBillingAddressRequestedEvent:function(){k.isDesktopSpc()?m.isSPP()?h("#pmts-change-billing-address-popover").trigger("click"):
a.trigger("pmts:retail:billing-address-popover"):(c.show(),m.isPipeliningOn()&&d("billingaddressselect","ox_spc_change_ship_addr"))},handleChangePaymentInstrumentRequestedEvent:function(){c.show();m.isPipeliningOn()&&d("payselect","ox_spc_change_payment")},handleRewardsAccountLearnMoreRequestedEvent:function(){a.trigger("pmts:retail:rewards-registration")},handlePointsAccountSubmittedEvent:function(a){var c={hasWorkingJavascript:"1",isClientTimeBased:h("input[name\x3duseCtb]").val(),nextAction:"dispatch"};
a=h.param(a)+"\x26"+h.param(c);f("ox_spc_points_edit",a,function(a){a=e.jsonify(a);m.redirect(a)})}}});"use strict";r.when("ajax-utility","gc-redeem-controller","page-transition-controller","ready").register("payments-portal-common",function(a,m,l){return{claimCodePageUpdater:function(c,e){e=a.jsonify(e);null!==e?e.widgetJsonData?(c.update(e.widgetJsonData),l.hide()):e.autohandlererror&&m.giftSystemErrorHandling(e.autohandlererror):l.hide()}}});"use strict";r.when("A","page-detector-current-page",
"a-button","a-meter").register("checkout-throttle-error",function(a,m,l,c){var e=a.$;a.on("checkout:reload:throttle",function(){if(e("#checkout-throttle-meter").length){var a=1E3*e('input[name\x3d"waiting-time"]').val()/100;l("#checkout-throttle-return-to-cart").disable();var m=c("#checkout-throttle-meter"),d=0,f=setInterval(function(){m.percent(d);if(100>d)d+=1;else{clearInterval(f);var a=l("#checkout-throttle-return-to-cart");a.text(e("#checkout-throttle-primary-button-active-text").text());a.enable()}},
a)}})});"use strict";r.when("A","weblab-helper").register("nav-bar-helper",function(a,m){function l(){try{r.register("navCF")}catch(a){if(-1===a.message.toLowerCase().indexOf("already registered"))throw a;}}if(m.isNavCFWeblabOn())a.on("checkout:reload",l)});r.when("A").execute(function(a){a.declarative("remaining-customizations-action","click",function(a){a.$currentTarget.parent().find(".remaining_customization_info").removeClass("aok-hidden");a.$currentTarget.hide();a.$event.preventDefault()})});
"use strict";r.when("A","checkout-federation-utilities","client-side-metrics").register("checkout-federation-wrapper",function(a,m,l){function c(a){for(var c=[],d=e;d<a.length;d++)c.push(a[d]);return c}var e=2;return{wrap:function(a,e){try{return a.apply(null,c(arguments))}catch(b){var d=e,f=b,h;h=d;h=m.getExternalDependecies()[h];h=void 0!==h&&null!==h?h.cti:"Undefined";l.logError(f,"["+d+"] Javascript error thrown while executing wrapper",h,"FATAL");q.console&&q.console.error&&q.console.error(f,
d,h)}}}});"use strict";r.when("A","jQuery","checkout-federation-utilities").register("checkout-federation-injector",function(a,m,l){function c(a){a=a.assetsModule;if(e[a]?0:0<m('script[type\x3d"checkout-asset-trigger"][data-checkout-asset-trigger\x3d"'+a+'"]').length)e[a]=!0,r.register("trigger"+a,function(){})}var e={};a.on("checkout:reload",function(){var a=l.getExternalDependecies(),e;for(e in a)a.hasOwnProperty(e)&&c(a[e])})});"use strict";r.when("A","client-side-metrics").register("checkout-federation-utilities",
function(a,m){return{getExternalDependecies:function(){var l=a.state("triggerExternalDependencies");Object&&Object.keys&&m.increaseCount("Checkout:ExternalDependencies:count:"+(l?Object.keys(l).length:"undefined"));return void 0===l||null===l?{}:l}}})});
/* ******** */
(function(k){var m=window.AmazonUIPageJS||window.P,z=m._namespace||m.attributeErrors,a=z?z("CheckoutSinglePagePipeline",""):m;a.guardFatal?a.guardFatal(k)(a,window):a.execute(function(){k(a,window)})})(function(k,m,z){k.when("A").register("scroller-controller",function(a){function d(a){a.scrollTop>=l&&g(m).height()>e.height()?e.css({position:"fixed",width:"inherit",top:"14px"}):e.css({position:"relative",top:"0px"})}var g=a.$,e,l;a.on("checkout:reload",function(){if(e=g("#subtotalsContainer")){var c=
e.closest(".page-container");c&&c.offset()&&(l=c.offset().top,a.on.scroll(d))}})});"use strict";k.when("A","address-book-controller","address-utilities","page-conductor","cache-page-data-controller").register("spp-address-controller",function(a,d,g,e,l){function c(){h("div.address-book-entry").each(function(){h(this).find(".displayAddressLI:last-child").append(h(this).find(".address-edit-link, .address-delete-link").show())});var a=h("#inline-address-form");0<a.length&&g.customizeFormFromIdentity(a);
a=h("#address-list");e.isPrefetchFromAddressEnabled()&&0<a.length&&f(a)}function f(a){a.data("enableFormPrefetch")&&0<a.find("input:checked").length&&(a.data("checkoutFormReady",!0),e.makePrefetch(a),a.data("checkoutFormReady",!1))}function b(a){a=a.popover.getContent().find(".enterAddressFormField");a.length&&(a.unbind("keydown.overrideEnterKeypress").bind("keydown.overrideEnterKeypress",function(a){q=h(a.currentTarget).val()}),a.unbind("keyup.overrideEnterKeypress").bind("keyup.overrideEnterKeypress",
function(a){13!==a.which&&13!==a.keyCode||h(a.currentTarget).val()!==q||(a.preventDefault(),a=h(a.target).closest(".a-popover"),a.length&&(a=a.find(".a-popover-footer .a-button-primary"),a.length&&a.click()))}))}var h=a.$,q;a.on("a:popover:afterUpdatePosition:edit-address",b);a.on("a:popover:afterUpdatePosition:add-address",b);a.declarative("switch-address-book-page","click",function(b){b.$event.preventDefault();var c,f,g=b.$target.closest("div.address-book"),q=g.find(".address-book-page.current-visible-page");
q.length&&(c=q.first(),f=c.find(".a-pagination li.a-selected a").attr("href"),f=""===f||void 0===f?0:f);if(b.$target.is("a")&&(b=b.$target.attr("href"),b=""===b||void 0===b?0:b,b!==f)){var e=g.find(".address-book-page-"+b);c.removeClass("current-visible-page").hide();a.fadeIn(e,500,"ease-in",function(){e.addClass("current-visible-page");h("div.address-book").trigger("recalculate-address-height")});c=e;f=b}});a.declarative("show-all-addresses","click",function(a){a.$event.preventDefault();a=a.$target.closest("div.address-book");
a.find(".address-book-page").each(function(){var a=h(this);a.removeClass("current-visible-page");a.show();a.find(".pagination-row").hide()});a.trigger("recalculate-address-height");a.find(".show-all-addresses").hide();a.find(".hide-all-addresses").show()});a.declarative("hide-all-addresses","click",function(a){a.$event.preventDefault();a=a.$target.closest("div.address-book");a.find(".address-book-page").each(function(){var a=h(this);a.find(".pagination-row").show();a.hide()});a.find(".address-book-page-0").addClass("current-visible-page").show();
a.trigger("recalculate-address-height");a.find(".hide-all-addresses").hide();a.find(".show-all-addresses").show()});a.declarative("select-address-in-list","click",function(a){a=a.$target;if(!a.is("a")){var b=h(".address-row");b.removeClass("list-address-selected");b.find('input[type\x3d"radio"]').removeAttr("checked");b=a.closest(".address-row");a=b.find('input[type\x3d"radio"]');b.addClass("list-address-selected");a.attr("checked","checked");b=h("#address-list");b.attr("action",a.val());e.isPrefetchFromAddressEnabled()&&
(e.disablePageNoUpdateTransition(),l.clearCache(),f(b))}});a.on("checkout:reload:spp-shipaddress",c);a.on("checkout:reload:spp-billing-address",c)});"use strict";k.when("A").register("spp-address-suggestion-controller",function(a){var d=a.$;a.declarative("suggestion-continue-submit",["click"],function(a){a.$event.preventDefault();var e=a.data.name;"editSelectedAddress"===e&&(e=(e=a.$target.parents("form:first").find('input[type\x3d"radio"]:checked'))?"edit_"+e.val():void 0);var l=a.data.value;a=a.$target.parents("form:first");
var c=a.attr("action"),c=0<c.indexOf("?")?c+"\x26":c+"?";a=c=c+(e+"\x3d"+l+"\x26")+a.serialize();e=d("#continueLink");e.attr("href",a);e.trigger("click")})});"use strict";k.when("A","a-checkbox","weekend-availability-expander-helper").register("weekend-availability-expander",function(a,d,g){function e(a){a=a.expander.expanderName;null!==q[a]&&(a=l(q[a].saturdayId,q[a].sundayId),g.updateAllWeekendAvailabilityStates(a),g.updateAllTitles(a),h=b=!1)}function l(a,b){return{isSaturdayChecked:d("#"+a).isChecked(),
isSundayChecked:d("#"+b).isChecked()}}function c(a){g.logExpanderState("spc",a.action,h,b)}var f=a.$,b=!0,h=!0,q={"sat-sun-availability-expander":{saturdayId:"sat-sun-availability-checkbox-sat",sundayId:"sat-sun-availability-checkbox-sun"},"sat-sun-availability-expander-domestic":{saturdayId:"sat-sun-availability-checkbox-sat-domestic",sundayId:"sat-sun-availability-checkbox-sun-domestic"}};a.on("checkout:reload:spp-shipaddress",function(){a.declarative("sat-sun-availability-checkbox-change","change",
function(a){var b=l(a.data.satCheckboxId,a.data.sunCheckboxId);g.updateAllWeekendAvailabilityStates(b);g.updateAllTitles(b);b=f("input[name\x3d'BusinessHours']").attr("value");b=g.stateToCheckboxes(b);f(".weekend-checkbox-sat input").prop("checked",b.isSaturdayChecked);f(".weekend-checkbox-sun input").prop("checked",b.isSundayChecked);g.updateAllOptOutMessages(l(a.data.satCheckboxId,a.data.sunCheckboxId))});a.on("a:expander:sat-sun-availability-expander:toggle:expand",e);a.on("a:expander:sat-sun-availability-expander-domestic:toggle:expand",
e);a.on("a:expander:sat-sun-availability-expander:toggle:collapse",function(a){b=!0;h=!1});a.on("a:expander:sat-sun-availability-expander-domestic:toggle:collapse",function(a){b=!0;h=!1});"expander"===f("input[name\x3d'weekendDeliveryDisplayType']").attr("value")&&(a.declarative("edit-address-popover-submit",["click"],c),a.declarative("add-address-popover-submit",["click"],c))})});"use strict";k.when("A","page-detector-current-page","delivery-preferences-csm-helper").register("spp-delivery-preferences-controller",
function(a,d,g){function e(a,f){"displayed"===a&&g.recordCSMForEligiblePages("address-form:"+f+":");g.recordCSMWithCurrentFieldValues("embedded-in-address-"+f+"-"+a,"prefDelLocation","isDefaultPreference")}var l=a.$;a.on("checkout:reload",function(){"spp-shipaddress"!==d.getCurrentPage()?g.recordCSMForEligiblePages():l("#inline-address-form").length&&(e("displayed","inline"),l("#inline-address-form form").submit(function(){e("submitted","inline")}))});a.on("a:popover:show:add-address",function(){e("displayed",
"popover")});a.declarative("add-address-popover-submit","click",function(a){e("submitted","popover")})});"use strict";k.when("A").register("spp-item-controller",function(a){function d(a,c,f){a=a.trim();a=JSON.parse(a);var b=e(".lineitem");c=e("#address-filter-message");if(""!==a.address_results){var h=a.address_results.split(",");k.when("a-dropdown").execute(function(f){for(f=0;f<h.length;f++){var c=e(b).find("input:hidden[value\x3d"+h[f]+"]")[0];if(c){c=c.name.split(".")[1];c="#addressID.destinationType.destinationId.destinationOwnerId."+
c;c=c.replace(/\./g,"\\.");c=e(c)[0];if(!c)break;for(var g=1;g<c.length-1;g++)if(c[g].value.split(".")[0]===a.addr_id.split(".")[0]){e(c[g]).remove();break}}}});c.hasClass("aok-hidden")&&c.removeClass("aok-hidden")}}function g(){var a="",a="",c=e("#"+"addressID.destinationType.destinationId.destinationOwnerId.1-1".replace(/\./g,"\\."))[0];if(c)for(var f=1;f<c.length-1;f++)a=c[f].value.slice(0,-7),a="addressid\x3d"+a,e.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/get-shipping-eligibility.html",
dataType:"text",data:a,async:!0,cache:!1,error:function(a){alert("error: "+a.responseText)},success:function(a,c,f){d(a,c,f)}})}var e=a.$;a.on("checkout:reload:spp-itemselect",function(){e("form#changeQuantityFormId").attr("action",e("form#changeQuantityFormId").attr("action")+"\x26action\x3dcontinue");e(".lineitem-error-message")&&0!==e(".lineitem-error-message").length&&e("#address-filter-message")&&0!==e("#address-filter-message").length&&g()})});"use strict";k.when("A","a-carousel-framework").register("spp-gift-controller",
function(a,d){a.on("checkout:reload:spp-giftoptions",function(){d.createAll();d.initializeAll()})});"use strict";k.when("A").register("pay-popovers",function(a){var d=a.$;a.on("checkout:reload:spp-payment",function(){d("#payment .payment-popover").each(function(){var a=d(this);1===a.data("haserrors")&&d("#"+a.data("trigger")).trigger("click")})})});"use strict";k.when("A","pay-common-util","jppoints").register("gcpromo",function(a,d,g){function e(){var a=c.gcpromo.find("#pm_300");if(!a.is(":disabled")){var f=
a.is(":checked"),e=c.gcpromo.find('input[type\x3d"checkbox"][name\x3d"useAvailableBalance"]');f?e&&e.length&&c.gcpromo.addClass("payment-selected"):(c.gcpromo.removeClass("payment-selected"),d.selectDefaultPaymentMethodIfNotSelected());(f=l("#jppoints"))&&f.length&&g.handleJPPointsWithGC(a)}}var l=a.$,c={},f={gcpromo:"#gcPromo"};a.on("checkout:reload:spp-payment",function(){if(!d.isMobileCX()&&l("#gcPromo").length&&(c=d.getElements(f),c.gcpromo&&c.gcpromo.length)){var a=c.gcpromo.find("#pm_300");
d.isTouchCX()?a.parents("label").unbind("click").bind("click",e):a.unbind("click").bind("click",e)}})});"use strict";k.when("A").register("new-payment-methods",function(a){var d=a.$;a.declarative("click-store-card","click",function(a){a=d("#linkToApplyForStoreCard");a.length&&a[0].click()});a.declarative("click-add-loc","click",function(a){a=d("#linkToLoCPopup");a.length&&a[0].click()});a.declarative("trigger-add-new-direct-debit","click",function(a){a=d("#direct-debit-popover-link");a.length&&a[0].click()});
a.declarative("trigger-add-new-invoice-account","click",function(a){a=d("#invoice-account-popover-link");a.length&&a[0].click()})});"use strict";k.when("A","checkout-general-utils","a-tooltip").register("spp-button-blocker",function(a,d,g){var e=a.$;a.declarative("a-tooltip-button-blocker","mouseenter click mouseleave touchend touchenter touchleave".split(" "),function(a){if(d.protectAgainstDoubleAction("tooltip-button-blocker",400))a.$event.preventDefault();else{var c=a.$currentTarget.find(".a-button-disabled"),
f=a.$currentTarget.find("#orderSummaryPrimaryActionBtn");f.length&&(c=f);if("mouseleave"===a.type||"touchleave"===a.type)c.length&&g.remove(c);else if("mouseenter"===a.type||"click"===a.type||"touchenter"===a.type||"touchend"===a.type)a:if(f=e("#"+a.data.name),f=a.data.content||a.$currentTarget.data("blockerText")||f.html(),a=a.data.position,f&&f.length&&c.length){g.remove(c);var b=c.attr("id");if(b&&"orderSummaryPrimaryActionBtn"===b&&(b=e("#orderSummaryPrimaryActionBtn"),b.is(":visible")&&!b.hasClass("a-button-disabled")))break a;
c=g.create(c,{content:f,position:a});c.isActive()||c.show()}}});return{hideContinueBtnBlocker:function(){e(".continue-button-blocker").closest("span.a-declarative").each(function(){var a=e(this);a.length&&g.remove(a)})},showDefaultContinueBtnBlocker:function(){e("#show-default-blocker-in-prefetch").length&&k.when("button-blocker").execute(function(a){var c=e("#defaultBuyBtnBlockerMsg");c.length&&a.show("default-buy-btn-blocker",c.val())})},hideDefaultContinueBtnBlocker:function(){e("#show-default-blocker-in-prefetch").length&&
k.when("button-blocker").execute(function(a){a.hide("default-buy-btn-blocker")})}}});"use strict";k.when("A").register("addtocart-transition-controller",function(a){a.on("checkout:reload:addtocart",function(){k.when("page-transition-controller").execute(function(a){a.hidePageTransition()})})});"use strict";k.when("A","a-modal").execute(function(a,d){var g=a.$;a.declarative("trigger-modal-dialog","click",function(a){var l=a.$currentTarget.find(".a-declarative").filter(function(){return"a-modal"===
g(this).data("action")}).first();l.length&&(d.get(l).lock(11).show(),setTimeout(function(){d.get(l).unlock(12)},550))})});"use strict";k.when("A","a-button","weblab-helper").register("order-summary-primary-action",function(a,d,g){function e(){var a=c("#orderSummaryPrimaryActionBtn");if(a.length){var b=c(".primary-action-button");b.length&&a.find(".os-primary-action-button-text").text(b.text())}}function l(){var a=d("#orderSummaryPrimaryActionBtn");a.isEmpty()||(c(".primary-action-button").is(":visible")?
a.enable():a.disable())}var c=a.$;a.declarative("buy-button-as-primary-action",["click","touchend"],function(a){a=c(".primary-action-button");var b=d("#orderSummaryPrimaryActionBtn");a.length&&b.isEnabled()&&a.find("input").trigger("click")});a.on("orderSummary:primaryActionButton:mirrorPanelBtnState",l);a.on("checkout:afterReload",l);if(g.isRemoveOrderSummaryPrimaryActionBtnTextWeblabOff())a.on("checkout:afterReload",e)});"use strict";k.when("A","checkout-general-utils","page-conductor","loading-spinner-controller").register("feedback-controller",
function(a,d,g,e){var l=a.$,c;a.on("a:popover:show:feedback-banner",function(a){c=a.popover});a.declarative("submit-spp-feedback",["click","touchend"],function(a){if(!d.protectAgainstDoubleAction("submit-spp-feedback",200)&&(a=l("#feedback-form"),a.length)){e.showSpinner(a,!1,c);var b=a.serialize(),b=b+("\x26lineitems\x3d"+l("#lineitemcountforfeedback").val()),b=b+("\x26expandedPanel\x3d"+l(".expanded").attr("id")),b=b+("\x26ordertotal\x3d"+l(".grand-total-price").text().trim()),b=b+("\x26buttonStatus\x3d"+
l("#place-order-btn-blocker-msg").text().trim());l.ajax({type:"POST",url:a.attr("action"),data:b,dataType:"text",error:g.ajaxRedirect,success:function(a,b,c){b=c.getResponseHeader("spp-feedback-submitted");l(".a-button-close").trigger("click");null!==b&&void 0!==b&&l("#feedback-banner").append(a)}})}})});"use strict";k.when("A","page-conductor","ajax-utility","checkout-general-utils","page-transition-controller","client-side-metrics").register("page-conductor-spp",function(a,d,g,e,l,c){function f(a,
b){try{a.replaceWith(b.hide())}catch(f){throw c.increaseCount("checkout:spp:panelreplacefailed:"+a.attr("id"),1),l.show(),d.redirect(),Error(f);}}function b(a,b){b&&(c.startWidgetTiming(a),q("#"+a).replaceWith(b),c.finishWidgetTiming(a))}function h(h){var m=q("#auiAnimationSpeedRate");m.length&&(k=.05*(parseInt(m.val(),10)-1)+.2);if(h=g.jsonify(h)){d.overrideIsAnimating(!0);l.hide();var w,t,r,u,x,v=0,m=0,A=!1;if(h.panels)if(q.each(h.panels,function(b,h){b=q("#"+h.id);var e=q(h.content),d=b.hasClass("expanded"),
g=e.hasClass("expanded");"revieworder"===h.id&&d&&!g&&(A=!0);d&&g?(c.startWidgetTiming(h.id),f(b,e),a.fadeIn(e,300,"ease-in",function(){c.finishWidgetTiming(h.id)})):d||g?d&&!g?(u=b,x=e):(w=b,t=e,r=h.id,c.startWidgetTiming(r)):b.replaceWith(e)}),A&&q("#hidden-revieworder").html(q("#revieworder").html()),void 0!==t||void 0!==x){var y=q("#page-buffer");void 0!==x&&(m=Math.max(m,50),y.height(u.height()),v=Math.floor(u.height()*k),v=Math.min(v,600),u.slideUp(v,"swing",function(){u.replaceWith(x)}),y.slideDown(v,
"swing"),void 0===t&&d.overrideIsAnimating(!1));void 0!==t&&(v+=50,m=Math.max(m,v),a.delay(function(){f(w,t);var a=Math.floor(t.height()*k),a=Math.min(a,600);t.slideDown(a,"swing",function(){d.overrideIsAnimating(!1);void 0!==r&&c.finishWidgetTiming(r)});y.slideUp(a,"swing")},v))}else d.overrideIsAnimating(!1);b("spc-imb",h.imb);b("fixup-imb",h.fixupImb);b("tv-ham",h.ham);b("subtotals",h.subtotals);b("callouts",h.callouts);b("footer",h.footer);b("header",h.header);b("bottomsubtotals",h.bottomsubtotals);
return m+5}e.logError("parsing data as JSON obj failed in SPP transition");d.ajaxSorryPage()}var q=a.$,k=.7;d.initFunc(h,function(a){h(a)});d.overrideIsSPP(!0);a.on("checkout:afterReload",function(){d.enablePageNoUpdateTransition()})});"use strict";k.when("A","page-detector-current-page","first-load-dependencies-base","weblab-helper").register("first-load-dependencies",function(a,d,g,e){var l=a.$;d={"spp-shipaddress":["spp-address-controller","spp-address-suggestion-controller","address-popovers",
"address-book-controller","weekend-availability-expander"],"spp-addresstranslate":["address-translator","address-translation-controller","spp-address-translation-controller"],"spp-itemselect":["spp-item-controller","itemselect-address-controller","itemselect-quantity-controller","address-popovers"],"spp-shipoption":["shipoptionselect-controller","deliv-prefs-sosp","scheduled-delivery-readiness-checker"],"spp-giftoptions":["gift-form-base-controller","gift-form-del-opt-controller"],"spp-payment":["existing-payments",
"new-payments","pay-popovers"],"spp-revieworder":"prime-popover-controller prime-decline-controller shipping-speed-selection-controller fast-track-controller gold-box-controller verification-checkbox-controller back-button-protection gift-popover-controller concealment-popover-controller cv-continue-blocker-controller installments-controller".split(" "),"spp-billing-address":["address-popovers","address-book-controller","spp-address-controller"],"spp-taxid":["cpf-controller","taxid-threshold-controller"],
"spp-taxaddress":["taxaddress-controller"],addtocart:["addtocart-transition-controller"]}[d.getCurrentPage()]||[];var c=l.merge("page-transition-controller page-conductor page-conductor-spp gc-redeem-controller inline-fps-balance-controller inline-points-controller order-summary-controller-spp checkout-modal-popover store-search-popover-controller imb-transition-controller verification-checkbox-spp order-summary-primary-action new-payment-methods checkout-federation-injector".split(" "),d);e=e.getFixFederatedAssetsInjectionTimingIssueTreatment();
l=function(){g.allDependenciesCheck(c)};if(/T1|T2/.test(e))a.on({T1:"afterReady",T2:"ready"}[e],l);else l()});"use strict";k.when("A","page-spinner-controller").register("transition-controller",function(a,d){function g(a,b){var f=c('\x3cdiv class\x3d"section-overwrap"/\x3e');f.css({opacity:null===b?.5:b}).css({width:a.outerWidth(),height:a.outerHeight()});a.prepend(f)}function e(a){a.find("div.section-overwrap").remove()}function l(a,b){var f=a.height(),h=a.width(),e=a.offset(),d=c(m),g=a=0;0<d.scrollTop()-
e.top&&(a=d.scrollTop()-e.top);0>d.height()+d.scrollTop()-(e.top+f)&&(g=e.top+f-(d.height()+d.scrollTop()));f=f-a-g;e=b.width();d=b.height();b.css("left",h/2-e/4+"px");d<f&&b.css("top",f/2-d/4+a+"px")}var c=a.$,f=null,b=null,h=null;c(document).delegate("a.disabled-link","click",function(a){a.preventDefault();return!1});d.initFunc({blockAllActions:function(){g(c("#subtotals"),.5);g(c("#bottomsubtotals"),.5);d.clearFocus();c(".spp-panel.collapsed span.a-declarative").each(function(){var a=c(this);a.find("span.a-button").addClass("a-button-disabled");
a.find("a").not(".a-button-text").addClass("disabled-link");a.find(":checkbox, :text").attr("disabled","disabled");a.addClass("off-declarative").removeClass("a-declarative")});g(c(".spp-panel.expanded"),0)},unblockAllActions:function(){e(c("#subtotals"));e(c("#bottomsubtotals"));c(".spp-panel.collapsed span.off-declarative").each(function(){var a=c(this);a.find("span.a-button").removeClass("a-button-disabled");a.find("a").not(".a-button-text").removeClass("disabled-link");a.find(":checkbox, :text").removeAttr("disabled");
a.addClass("a-declarative").removeClass("off-declarative")});e(c(".spp-panel.expanded"))},shrinkPanel:function(a,b,f){if(a){var e=a.find(".panel-content");a=a.find(".shrink-placeholder");e.hide();e=a.find(".loading-img-text");f&&0<f.length&&e.find(".loading-text").html(f);b?e.show():e.hide();a.addClass("current-spinner").show();c("html, body").animate({scrollTop:0},300)}},showTransitionInContainer:function(a,e){var d=a.find(".section-overwrap");d.length&&"0"!==d.css("opacity")||(d=a.height(),(e=400<
d||e?c("#bigLoadingSpinner"):c("#smallLoadingSpinner"))&&e.length||(e=c('\x3cimg id\x3d"loading-spinner-img" class\x3d"loading-spinner-img" src\x3d"https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-'+(400<d?"4":"1")+'x._V391853217_.gif" /\x3e')),d=c('\x3cdiv class\x3d"section-overwrap"\x3e\x3cdiv class\x3d"loading-spinner-inner loading-spinner-image-only"\x3e\x3c/div\x3e\x3c/div\x3e'),d.find(".loading-spinner-image-only").prepend(e.removeClass("aok-hidden")),e=d.find("div.loading-spinner-inner"),
d.css({opacity:.8}).css({width:a.outerWidth(),height:a.outerHeight()}),a.prepend(d),b=a,h=e,l(b,h),c(m).unbind("scroll.checkout-panel-spinner").bind("scroll.checkout-panel-spinner",function(a){f&&m.clearTimeout(f);f=setTimeout(function(){l(b,h);f=null},50)}),c(m).unbind("resize.checkout-panel-spinner").bind("resize.checkout-panel-spinner",function(){l(b,h)}))},hideSpinner:function(){c(".spp-panel").each(function(){c(this).find("div.section-overwrap").remove()});c(m).unbind("scroll.checkout-panel-spinner");
c(m).unbind("resize.checkout-panel-spinner")}})});"use strict";k.when("A").register("page-mash-transition-controller",function(a){function d(a){return function(b){console.error("Could not run MASHLoadingMessage: "+a+b)}}function g(){k.when("mash").execute(function(a){var c=void 0===b?"":b;void 0!==a&&void 0!==m.cordova?m.cordova.exec(null,d("showTransition(): "),"MASHLoadingMessage","startLoading",{message:c}):console.error("Error showing loading screen:"+(void 0!==a).toString()+", cordova:"+(void 0!==
m.cordova).toString())});l();return!0}function e(){k.when("mash").execute(function(a){void 0!==a&&void 0!==m.cordova?m.cordova.exec(null,d("hideTransition(): "),"MASHLoadingMessage","finishLoading",{}):console.error("Error Hiding loading screen:"+(void 0!==a).toString()+", cordova:"+(void 0!==m.cordova).toString())});c();return!0}function l(){k.when("a-tv").execute(function(a){a.disable()})}function c(){k.when("a-tv").execute(function(a){a.enable()})}var f=a.$,b;return{show:g,hide:e,showPageTransition:function(){if("0"===
f("#showPageTransition").attr("content"))return!1;l();return g()},hidePageTransition:function(){c();return e()},blockAllActions:l,unblockAllActions:c,showTransitionInContainer:function(a){return g()},shrinkPanel:function(a,b,c){return g()},setLoadingMessage:function(a){b=a},resetLoadingMessage:function(){b=void 0}}});"use strict";k.when("A","client-side-metrics").register("imb-transition-controller",function(a,d){function g(a){var b=c(a.target);if(!b.is(":visible"))return a.stopPropagation(),!1;a=
b.closest(".imb-content");a.hide();var h=a.closest(".tv-imb");k.when("a-tv").execute(function(a){a.add(h);a.select(h)});a=a.find("input[type\x3dcheckbox]");a.is(":checked")?(a.prop("checked",!1),d.increaseCount("checkouttv:imb-actionable-content-unselected",1)):(a.prop("checked",!0),d.increaseCount("checkouttv:imb-actionable-content-selected",1));e(h,".outer-box");k.when("verification-checkbox-controller").execute(function(a){a.verifyCheckboxes()})}function e(a,b){a.find("input[type\x3dcheckbox]").is(":checked")?
(a.find("i.empty-checkbox"+b).addClass("aok-hidden"),a.find("i.checked-checkbox"+b).removeClass("aok-hidden")):(a.find("i.empty-checkbox"+b).removeClass("aok-hidden"),a.find("i.checked-checkbox"+b).addClass("aok-hidden"))}function l(a){var b=c(a.target);if(b.hasClass("tv-imb")){a=c(".tv-checkbox-container:visible");if(a.length){var h=a.closest(".tv-imb");e(h,".outer-box");k.when("a-tv").execute(function(a){a.add(h);a.select(b)})}a=b.find(".imb-content");var g=a.is(":hidden");c(".imb-content").hide();
var l=b.find(".confirm-button");l.length?(a.show(),d.increaseCount("checkouttv:imb-actionable-content-shown",1),k.when("a-tv").execute(function(a){a.remove(b);a.select(l)})):g?(d.increaseCount("checkouttv:imb-non-actionable-content-shown",1),a.show()):a.hide()}}var c=a.$;a.on("checkout:reload",function(){if(c("#hasTVNavigation").length&&c(".tv-imb").length){c(".imb-content").hide();var a=c("#fixup-imb");if(a.length){var b=c(".tv-scroll-area");if(b.length){var d=b.height()-a.outerHeight(!0);b.height(d)}a.find(".imb-content").show()}c(".tv-checkbox-container").length&&
c(".tv-imb").each(function(){e(c(this),".outer-box")});c(".tv-imb").unbind("click").bind("click",l);c(".confirm-button").unbind("click").bind("click",g)}})});"use strict";k.when("A","a-tv","page-conductor").register("tv-controller",function(a,d,g){function e(a){void 0===a&&(a=".tv-selected-first:visible:first");return function(){0<l(a).length?d.select(a):d.select(".a-tv-navigate:visible:first")}}var l=a.$;g.overrideAddToCart(!0);a.on("checkout:beforeReload",e());a.on("checkout:reload:spp-collapsed",
e(".continue-button.a-tv-navigate:visible:first"))});k.when("A","mash","client-side-metrics").register("firetv-legal-disclaimer-mash",function(a,d,g){a.declarative("firetv-legal-disclaimer-mash","click",function(a){g.increaseCount("checkouttv:legal-ingress-clicked",1);m.cordova.exec(null,null,"MASHLegalDisclaimerPlugin","execute",{})})});k.when("A","mash").register("firetv-seller-mash",function(a,d){a.declarative("firetv-seller-mash","click",function(a){m.cordova.exec(null,null,"MASHDisplaySellerInfoPlugin",
"execute",{merchant_id:a.data.sellerMerchantID})})});k.when("A","page-mash-transition-controller").execute(function(a,d){a.on("checkout:beforeReload",d.resetLoadingMessage);a.declarative("tv-abort-checkout","click",function(a){var e=a.data.url;d.setLoadingMessage(a.data.loadingMsg);d.showPageTransition();m.location=e})});"use strict";k.when("A","verification-checkbox-controller","page-detector-current-page").register("verification-checkbox-spp",function(a,d,g){var e=a.$;a.on("checkout:reload",function(){e("#show-default-blocker-in-prefetch").length&&
"spc"!==g.getCurrentPage()&&"spp-revieworder"!==g.getCurrentPage()&&d.verifyCheckboxes()})});"use strict";k.when("A","a-tv").register("kindle-controller",function(a,d){function g(){var a=e(".tv-kindle-register-row");a.find(".tv-kindle-register").toggleClass("tv-kindle-register-selected");a.find(".kindle-register-checkmark").toggleClass("aok-hidden")}var e=a.$;a.declarative("tv-kindle-register-select","click",function(a){if(!a.$target.is(".tv-kindle-register-selected")){g();a=e(".tv-kindle-register-row");
var c=a.find(".tv-kindle-register-selected").is(".tv-kindle-register-other"),d="obfuscatedEntityId\x3d"+a.find("input:hidden[name\x3dkindleLineItem]:first").val()+"\x26",d=d+"isKindlePurchase\x3d1\x26",d=d+("hidePrices\x3d"+(c?"1":"0")+"\x26");k.when("page-conductor","page-transition-controller").execute(function(a,c){c.show();e.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-gift.html",data:d,dataType:"text",async:!0,cache:!1,headers:a.setAjaxTransitionHeader({"x-amz-checkout-page":"spc",
"x-amz-checkout-transition":"ajax"}),contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,b,d){c.hide();e(".kindle-register-error-message").addClass("aok-hidden")},error:function(a,b,d){c.hide();g();e(".kindle-register-error-message").removeClass("aok-hidden")}})})}})});"use strict";k.when("A","a-carousel-framework").register("gift-carousel-utils",function(a,d){function g(a,c,d,e){b("."+a,b(e)).not("."+c).each(function(){var a=b(this),c=a.parent();c&&c.is("div")&&
c.hasClass(d)&&a.unwrap()})}function e(a,c){a.each(function(){b(this).attr("aria-posinset",c);c++});return c}function l(a,c){b("li",b(a)).hide();b("li",b(a)).css("visibility","hidden");b(".gift-wrap",b(a)).css("visibility","visible");b(".gw-hidden",b(a)).size()&&g("gift-wrap","noshi-wrap","gw-hidden",a);b(".noshi-wrap",b(a)).not(".gift-wrap").each(function(){b(this).wrap("\x3cdiv class\x3d'noshi-hidden'\x3e\x3c/div\x3e")});c=b(".gift-wrap",b(a));e(c,1);b(".gift-wrap",b(a)).show()}function c(a,c){b("li",
b(a)).hide();b("li",b(a)).css("visibility","hidden");b(".noshi-wrap",b(a)).css("visibility","visible");b(".noshi-hidden",b(a)).size()&&g("noshi-wrap","gift-wrap","noshi-hidden",a);b(".gift-wrap",b(a)).not(".noshi-wrap").each(function(){b(this).wrap("\x3cdiv class\x3d'gw-hidden'\x3e\x3c/div\x3e")});c=b(".noshi-wrap",b(a));e(c,1);b(".noshi-wrap",b(a)).show()}function f(a,c,e,f){var g=d.getCarousel(document.getElementById("giftwrap-carousel-wrap-holder-"+a));b("#afn-gift-options-wrapper-"+a);"all"===
c?a=7:(a=4,e=f);g.setAttr("set_size",a);g.setAttr("totalPages",e);g.gotoPage(1)}var b=a.$;a.on("checkout:gift:changeCarouselWrapOptions",function(a,d,f){"all"===d?(b("li",b(a)).show(),b(".noshi-hidden").size()?g("noshi-wrap","gift-wrap","noshi-hidden",a):b(".gw-hidden").size()&&g("gift-wrap","noshi-wrap","gw-hidden",a),b("li",b(a)).css("visibility","visible"),d=1,f=b(".gift-wrap",b(a)),d=e(f,d),f=b(".noshi-wrap",b(a)).not(".gift-wrap"),e(f,d)):"GW"===d||"gift-wrap"===d?l(a,f):"noshi"===d&&c(a,f)});
a.on("checkout:gift:adaptCarouselGiftPanel",function(a,b){f(a,b,3,2)});a.on("checkout:gift:adaptCarouselSPCPanel",function(a,b){f(a,b,2,1)})});"use strict";k.when("A","order-summary-controller").register("order-summary-controller-spp",function(a,d){a.on("checkout:reload",function(){d.initOrderSummary()})});"use strict";k.when("A","button-blocker").register("cv-continue-blocker-controller",function(a,d){function g(){var a=e("#cv-block-msg");a&&a.length&&d.show("cv-block-msg",a.html())}var e=a.$;a.on("checkout:reload:spc",
g);a.on("checkout:reload:spp-revieworder",g)});"use strict";k.when("A","page-transition-controller","page-conductor","a-popover-base").register("pallet-delivery-controller",function(a,d,g,e){function l(f){var b=c('input[name\x3d"pallet-delivery-option"]:checked').val(),h=f.loadingText,l=c("#shipaddress");f=function(){d.blockAllActions();d.shrinkPanel(c(".spp-panel.expanded"),!1);d.shrinkPanel(l,!0,h)};var k=(new Date).getTime(),m=c('input[name\x3d"palletDeliveryAddressId"]').val(),b="cachebuster\x3d"+
k+"hasWorkingJavascript\x3d1\x26addressId\x3d"+m+"\x26palletDelivery\x3d"+b,k=g.setAjaxTransitionHeader({"x-amz-checkout-page":"truespc","x-amz-checkout-transition":"ajax"});e.get("pallet-delivery-setting").hide();g.isNonBlockingAnimationEnabled()?a.delay(f,0):f();c.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-pallet-delivery.html/ref\x3dox_truespc_set_pallet_delivery",data:b,dataType:"text",async:!0,cache:!1,headers:k,success:function(a,b,d){d.getResponseHeader("x-amz-checkout-page")?g.ajaxUpdatePage(a,
b,d):d.getResponseHeader("x-amz-checkout-pallet-warning")?(g.ajaxUpdatePage(a,b,d),c(".pallet-delivery-setting-error-message").removeClass("aok-hidden")):g.redirect(a)},error:g.ajaxRedirect})}var c=a.$;c("html").hasClass("a-ie6")||a.declarative("pallet-delivery-select","click",function(a){l(a.data)})});"use strict";k.when("A","a-carousel-framework").register("spp-gift-popover-controller",function(a,d){var g=a.$;a.on("checkout:gift:adjustCarouselInitial",function(a,g){a=a.options.wraps.length+1;var c;
c=Math.ceil(a/4);var f=g.find(".carousel-gift-wrap").attr("id"),f=d.getCarousel(document.getElementById(f));f.setAttr("set_size",a);f.setAttr("pageSize",4);f.setAttr("totalPages",c);f.gotoPage(1);g.find(".a-carousel-viewport").css("height",160)});a.on("checkout:gift:removeEmptyCarouselCards",function(a){a.find(".a-carousel-card-empty").each(function(){g(this).remove()})})});"use strict";k.when("A").register("dhl-controller",function(a){var d=a.$;a.declarative("change-existing-dhl-number","click",
function(a){d("#existing-dhl-number").hide();d("#change-dhl-number").show()});a.declarative("save-dhl-number","click",function(a){a=d("#dhlPostNumberInput").val();d.ajax({type:"POST",url:"/gp/buy/storeaddress/handlers/change-name.html",data:{callFromSearchPage:1,changeDhlPostNumberInEmbu:1,dhlPostNumber:a},dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"truespc"}});d("#dhl-number").html(a);d("#change-dhl-number").hide();d("#existing-dhl-number").show()})});"use strict";k.when("A",
"a-dropdown").register("search-utilities-controller",function(a,d){function g(){var a=f("#popover_storeCountry"),b=f("#pickupType"),c=d.getSelect("pickupType");c.removeOptions(b.find(".de-pickup-option"));c.removeOptions(b.find(".at-pickup-option"));c.removeOptions(b.find(".lb-pickup-option"));c.removeOptions(b.find(".nl-pickup-option"));c.removeOptions(b.find(".pl-pickup-option"));"Germany"===a.val()?(b.append(m),b.find('option[value\x3d"'+b.val()+'"]').hasClass("de-pickup-option")||c.setValue("All")):
"Austria"===a.val()?(b.append(C),b.find('option[value\x3d"'+b.val()+'"]').hasClass("at-pickup-option")||c.setValue("All")):"Luxembourg"===a.val()?(b.append(t),b.find('option[value\x3d"'+b.val()+'"]').hasClass("lb-pickup-option")||c.setValue("All")):"Netherland"===a.val()?(b.append(r),b.find('option[value\x3d"'+b.val()+'"]').hasClass("nl-pickup-option")||c.setValue("All")):"Poland"===a.val()&&(b.append(u),b.find('option[value\x3d"'+b.val()+'"]').hasClass("pl-pickup-option")||c.setValue("All"))}function e(){var a=
f("#popover_storeCountry"),b=f("#pickupType"),c=d.getSelect("pickupType");c.removeOptions(b.find(".fr-pickup-option"));c.removeOptions(b.find(".be-pickup-option"));"France"===a.val()?(b.append(D),b.find('option[value\x3d"'+b.val()+'"]').hasClass("be-pickup-option")&&c.setValue("All")):(b.append(w),b.find('option[value\x3d"'+b.val()+'"]').hasClass("fr-pickup-option")&&c.setValue("All"))}function l(){var a=f("form.locker-search");b=a.find("select[name\x3dstoreCountry]");h=a.find("select[name\x3dpickupType]");
b&&h&&b.length&&h.length&&(b.find("option").each(function(a,b){(a=f(b))&&a.attr("data-pickuptypeclass")&&(k[a.attr("data-pickuptypeclass")]=h.find("option."+a.attr("data-pickuptypeclass")).clone())}),c())}function c(){if(b&&h&&b.length&&h.length&&k){var a=b.find("option:selected"),a=f(a).attr("data-pickuptypeclass"),c=f("#pickupType"),e=d.getSelect("pickupType");f.each(k,function(a,b){e.removeOptions(c.find("."+a))});k.hasOwnProperty(a)&&(c.append(k[a]),c.find('option[value\x3d"'+c.val()+'"]').hasClass(a)||
e.setValue("All"))}}var f=a.$,b,h,k={},m,C,D,w,t,r,u;a.declarative("country-filter-pickup-point","change",c);a.declarative("filter-de-pickup-types","change",g);a.declarative("filter-fr-pickup-types","change",e);return{reloadSearchUtils:function(){var a=f("input[name\x3dmerchantAutomation]");a&&a.length?l():(a=f("#searchLocale"),a.length&&"de"===a.val()?(m=f(".de-pickup-option").clone(),C=f(".at-pickup-option").clone(),r=f(".nl-pickup-option").clone(),t=f(".lb-pickup-option").clone(),u=f(".pl-pickup-option").clone(),
g()):a.length&&"fr"===a.val()&&(D=f(".fr-pickup-option").clone(),w=f(".be-pickup-option").clone(),e()))}}});"use strict";k.when("A","a-popover-data","a-modal","search-utilities-controller","page-conductor","a-dropdown","client-side-metrics").register("store-search-popover-controller",function(a,d,g,e,l,c,f){function b(){void 0!==p&&null!==p&&k.when("a-modal").execute(function(a){a.remove(p);p=void 0})}function h(){!p.isContentLoaded()&&0<E?(E--,setTimeout(h,100)):(q(),E=20)}function q(){if(0<B&&"undefined"!==
typeof m.Map)try{m.Map.getMapAndIcons(),"undefined"!==typeof m.Map&&m.Map.registerPinClickCallback(z),"undefined"!==typeof m.Map&&m.Map.registerPinClickCallback(C),M=!0}catch(a){--B,0<B&&setTimeout(q,500)}0===B&&(B=20)}function z(a){var b=n("#storeAddressList");a=b.find("#form_"+(a+1));a.length&&b.length&&(w(b,a),t(b,a))}function C(a){n("#storeAddressList #form_"+(a+1)).length||f.increaseCount("checkout:locker-map:click-on-search-location-pin",1)}function D(a){a.filter("script").each(function(){this.src&&
0<this.src.indexOf("mapcontrol")&&(F=this.src)})}function w(a,b){a.animate({scrollTop:b.offset().top-a.offset().top+a.scrollTop()})}function t(a,b){a.find(".address-row").removeClass("list-address-selected");b.find(".address-row").addClass("list-address-selected")}function r(a){d.showSpinner(p);n.ajax({type:"POST",url:a,dataType:"html",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",headers:{"x-amz-checkout-page":"truespc"},success:function(a,b,c){if(!c.getResponseHeader("x-amz-checkout-popover-valid"))return l.redirect({conductoraction:{url:"/gp/cart/view.html",
type:"redirect"}});b=n(a);p.updateContent(a);p.updatePosition(!0);D(b);null!==F&&!1===M?n.ajax({url:F,async:!1,success:h,dataType:"script"}):h();e.reloadSearchUtils()},error:function(a,b,c){p.updateContent("")}})}function u(a,b){if(a.is("span.a-declarative")){var c=a.find("a");if(c.length&&c.hasClass("locker-search-link"))return c.attr("href")}a=a.parents("form");c=(c=a.attr("action"))?c:"/gp/buy/storeaddress/handlers/popover/search.html";b&&(a=n("#form_"+b));return c+"?"+a.serialize()}function x(){var a=
n("#inlineStoreSearchRow"),b=a.find("[name\x3dpickupUrl]").val()+"?",a=v(a,"pickupUrl"),b=b+a;n("#storeCountry").length&&(a&&a.length&&(b+="\x26"),a=c.getSelect("storeCountry").val(),b+="storeCountry\x3d"+a);return b}function v(a,b){var c="";a.find("input").not("[name\x3d"+b+"]").each(function(){""!==c&&(c+="\x26");c+=n(this).serialize()});return c}function A(a,b){"undefined"!==typeof a&&(a=parseInt(a,10)-1,m.Map.togglePinVisibility(a,b))}function y(a){a.length&&(p&&p.hide(),a.submit())}function J(a,
b){var c=a.find('input[name\x3d"storeId"]'),d=a.find('input[name\x3d"formBaseAction"]');c.length&&d.length&&a.attr("action",d.val()+"/ref\x3d"+b+c.val())}function K(a){if(!p){var b=n("#search-popover-header").html();p=g.create(a,{name:"inline-store-search-popover",header:b,popoverLabel:b})}p.isActive()?(a=x(),r(a)):p.show()}function N(){G&&(l.reloadPage(),G=0)}function L(){if(void 0!==p&&null!==p){var a=n("#accessibilityPreferenceLink"),a=x(a);null!=H&&null!=I&&(a+="\x26latitude\x3d"+H+"\x26longitude\x3d"+
I);r(a)}else l.reloadPage()}var n=a.$;if(!n("html").hasClass("a-ie6")){var p,F=null,M=!1,B=20,E=20,H=null,I=null;a.declarative("zoom-in-pinpoint","click",function(a){a=a.$target[0].id.replace("pinpointImage_idx_","");var b=n("#storeAddressList"),c=b.find("#form_"+a);c.length&&b.length&&"undefined"!==typeof m.Map&&(m.Map.selectPin(a-1),w(b,c),t(b,c))});a.on("a:popover:show:store-search-popover",function(a){p=a.popover;p.updateContent("");var b=p.attrs("urlTrigger");b?p.attrs("urlTrigger",""):(b=p.attrs("formTrigger"),
b||(b=a.popover.$trigger),b=u(b));r(b)});a.on("a:popover:show:inline-store-search-popover",function(a){p=a.popover;p.updateContent("");a=x();r(a)});a.declarative("trigger-store-search-popover","click",function(a){p?p.updateContent(""):p=g.create(a.$currentTarget,{name:"store-search-popover",header:a.data.header});p.attrs("urlTrigger",u(a.$currentTarget));p.show()});a.on("a:popover:positionUpdated:inline-store-search-popover",function(a){a=a.popover.getContent();if(a.length){var b=a.find(".locker_map_scale");
b.length&&a.find("#sl_map").width(b.innerWidth())}});n(document).delegate("div.store-restrict-warning input[type\x3dcheckbox]","click",function(a){a=n(this).is(":checked");var b=n(this).parents("div.store-restrict-warning").parent().find(".store-ship-btn"),c="ship_to_store_map_button_"+b.attr("id").replace("ship_to_store_button_",""),c=n("#"+c);a?(b.hasClass("a-button-disabled")&&(b.removeClass("a-button-disabled"),b.find("input[type\x3dsubmit]").removeAttr("disabled")),c.hasClass("a-button-disabled")&&
(c.removeClass("a-button-disabled"),c.find("input[type\x3dsubmit]").removeAttr("disabled"))):(b.hasClass("a-button-disabled")||(b.addClass("a-button-disabled"),b.find("input[type\x3dsubmit]").attr("disabled","disabled")),c.hasClass("a-button-disabled")||(c.addClass("a-button-disabled"),c.find("input[type\x3dsubmit]").attr("disabled","disabled")))});n(document).delegate("div#store-search-result input[name\x3dsearchCriterion][type\x3dradio]","click",function(a){a=n(this).attr("value");n(this).parents("form").find("input.search-term").attr("name",
a)});n(document).delegate("div#store-search-result input[name\x3drefineSearch][type\x3dradio]","click",function(a){var b=n(this).parents("[data-a-input-name\x3drefineSearch]");a=b.attr("data-longitude");var b=b.attr("data-latitude"),c=n(this).parents("form");c.find("input[name\x3dlongitude][type\x3dhidden]").attr("value",a);c.find("input[name\x3dlatitude][type\x3dhidden]").attr("value",b);H=b;I=a});n(document).delegate("div#store-search-result .store-address-list input[type\x3dsubmit]","click",function(a){a.preventDefault();
f.increaseCount("checkout:locker-map:click-on-ship-to-address-from-store-list",1);a=n(this).parents("form");J(a,"chk_addr_locker_search_selected_");y(a)});n(document).delegate("form.locker-search","submit",function(a){a.preventDefault();a=n(this).find(".search-btn");if(!p){var b=n("#search-popover-header").html();p=g.create(a,{name:"store-search-popover",header:b,popoverLabel:b})}p.isActive()?(a=u(a),r(a)):(p.attrs("formTrigger",a),p.show())});n(document).delegate("input[name\x3dfilterLocations]",
"change",function(a){n(this).is(":checked")?(n(".ineligible-store").hide(),"undefined"!==typeof m.Map&&n(".ineligible-store").each(function(){A(n(this).attr("data-store-display-number"),!1)})):(n(".ineligible-store").show(),"undefined"!==typeof m.Map&&n(".ineligible-store").each(function(){A(n(this).attr("data-store-display-number"),!0)}))});n(document).delegate("input[name\x3dstoreZip]","keydown",function(a){13===a.which&&n("[name\x3disUnifiedActionsDesignEnabled]").length&&(a.stopPropagation(),
p&&p.isActive()?(a=n("form.locker-search").find(".search-btn"),a=u(a),r(a)):(a=n("#pickupSearchBtn"),K(a)))});a.declarative("trigger-addressselect-search-popover","click",function(a){n("[name\x3disUnifiedActionsDesignEnabled]").length&&K(a.$currentTarget)});a.declarative("map-popover-ship-to-store","submit",function(a){a.$event.preventDefault();f.increaseCount("checkout:locker-map:click-on-ship-to-address-from-popover",1);a=n("#storeAddressList #form_"+a.data.storeIndex);J(a,"chk_locker_map_search_selected_");
y(a)});var G=0;a.on("toggle-preference-success",function(){L();G=1});a.on("toggle-preference-failure",L);a.on("a:popover:dismiss",N);a.on("checkout:reload",b)}});"use strict";k.when("A","mash","client-side-metrics").register("continue-shopping-mash",function(a,d,g){a.declarative("continue-shopping-mash","click",function(a){m.cordova.exec(null,null,"MASHCloseWebview","execute",{})});a.declarative("firetv-review-order-mash","click",function(a){g.increaseCount("checkouttv:review-order-clicked-from-thank-you-page",
1);m.cordova.exec(null,null,"MASHReviewOrder","execute",{})})});k.when("A","a-tv").execute(function(a,d){var g=a.$;d.select(".continuebutton");a.on.ready(function(){var a=g(".review");0<a.length&&d.add(a)})});k.when("A","mash","client-side-metrics").execute(function(a,d,g){a=a.$;a("#tv-final-page-addToCart").length&&(d=m.cordova,d.exec(null,null,"MASHFinalPageNotification","execute",{message:"AddToCart"}));a("#tv-final-page-TYP").length&&(d=m.cordova,d.exec(null,null,"MASHFinalPageNotification","execute",
{message:"ThankYouPage"}));a("#native-add-to-cart").length&&(g.increaseCount("checkouttv:native-add-to-cart-triggered",1),d=m.cordova,d.exec(null,null,"MASHNativeAddToCartPlugin","execute",{}))})});
/* ******** */
